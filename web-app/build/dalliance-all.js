(function e$$0(t,s,p){function m(h,r){if(!s[h]){if(!t[h]){var z="function"==typeof require&&require;if(!r&&z)return z(h,!0);if(n)return n(h,!0);throw Error("Cannot find module '"+h+"'");}z=s[h]={exports:{}};t[h][0].call(z.exports,function(a){var b=t[h][1][a];return m(b?b:a)},z,z.exports,e$$0,t,s,p)}return s[h].exports}for(var n="function"==typeof require&&require,h=0;h<p.length;h++)m(p[h]);return m})({1:[function(d,t,s){function p(){}function m(e,g,u,q,r){function d(c){if(!c)return q(null,"Couldn't access BAM");
c=b(c,c.byteLength);c=new Uint8Array(c);var a=h(c,0);if(a!=k)return q(null,"Not a BAM file, magic=0x"+a.toString(16));for(var e=h(c,4),f="",a=0;a<e;++a)f+=String.fromCharCode(c[a+8]);f=h(c,e+8);e+=12;v.chrToIndex={};v.indexToChr=[];for(a=0;a<f;++a){for(var y=h(c,e),g="",A=0;A<y-1;++A)g+=String.fromCharCode(c[e+4+A]);h(c,e+y+4);v.chrToIndex[g]=a;0==g.indexOf("chr")?v.chrToIndex[g.substring(3)]=a:v.chrToIndex["chr"+g]=a;v.indexToChr.push(g);e=e+8+y}if(v.indices)return q(v)}var v=new p;v.data=e;v.bai=
g;v.indexChunks=u;var F=v.indexChunks?v.indexChunks.minBlockIndex:1E9;if(v.indexChunks){g=v.indexChunks.chunks;v.indices=[];for(var E=0;E<g.length;E++)v.indices[E]=null;v.data.slice(0,F).fetch(d)}else v.bai.fetch(function(c){var b,g,k;if(c){var y=new Uint8Array(c),D=h(y,0);if(D!=f)c=q(null,"Not a BAI file, magic=0x"+D.toString(16));else{D=h(y,4);v.indices=[];for(var A=8,J=0;J<D;++J){var l=A;b=y;var G=k=l;g=h(b,G);for(var G=G+4,Q=0;Q<g;++Q){h(b,G);var K=h(b,G+4),G=G+(8+16*K)}for(var Q=h(b,G),G=G+4,
K=1E9,E=G,V=0;V<Q;++V){var n=a(b,E),E=E+8;if(n){b=n.block;0<n.offset&&(b+=65536);b<K&&(K=b);break}}G+=8*Q;b=K;k=G-k;A+=k;F=Math.min(b,F);0<g&&(v.indices[J]=new Uint8Array(c,l,A-l))}c=!0}}else c="Couldn't access BAI";!0!==c?v.bai.url&&"undefined"===typeof r?(v.bai.url=v.data.url.replace(/.bam$/,".bai"),m(e,v.bai,u,q,!0)):q(null,c):v.data.slice(0,F).fetch(d)})}function n(){}if("undefined"!==typeof d){d("./spans");s=d("./bin");var h=s.readInt,x=s.readShort,r=s.readByte,z=s.readFloat;d=d("./lh3utils");
var a=d.readVob,b=d.unbgzf,q=d.reg2bins,g=d.Chunk}var k=21840194,f=21578050;d={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};p.prototype.blocksForRange=function(e,f,b){var u=this.indices[e];if(!u)return[];e=q(f,b);for(var k=[],r=0;r<e.length;++r)k[e[r]]=!0;e=[];for(var v=[],r=h(u,0),F=4,E=0;E<r;++E){var c=h(u,
F),w=h(u,F+4),F=F+8;if(k[c])for(var C=0;C<w;++C){var I=a(u,F),y=a(u,F+8);(4681>c?v:e).push(new g(I,y));F+=16}else F+=16*w}r=h(u,F);k=null;f=Math.min(f>>14,r-1);b=Math.min(b>>14,r-1);for(r=f;r<=b;++r)(f=a(u,F+4+8*r))&&(!k||f.block<k.block||f.offset<k.offset)&&(k=f);u=[];if(null!=k)for(r=0;r<v.length;++r)b=v[r],b.maxv.block>=k.block&&b.maxv.offset>=k.offset&&u.push(b);v=u;u=[];for(r=0;r<v.length;++r)u.push(v[r]);for(r=0;r<e.length;++r)u.push(e[r]);u.sort(function(y,c){var a=y.minv.block-c.minv.block;
return 0!=a?a:y.minv.offset-c.minv.offset});e=[];if(0<u.length){v=u[0];for(r=1;r<u.length;++r)b=u[r],b.minv.block==v.maxv.block?v=new g(v.minv,b.maxv):(e.push(v),v=b);e.push(v)}return e};p.prototype.fetch=function(a,e,f,g,u){function q(){if(C>=E.length)return g(w);if(I){var y=new Uint8Array(I),y=k.readBamRecords(y,E[C].minv.offset,w,e,f,r,u);I=null;++C;return y?g(w):q()}var c=E[C],y=c.minv.block;k.data.slice(y,c.maxv.block+65536-y).fetch(function(y){I=b(y,c.maxv.block-c.minv.block+1);return q()})}
var k=this;u=u||{};var r=this.chrToIndex[a],E;if(void 0===r)E=[];else{if(null===this.indices[r]&&this.indexChunks.chunks[r]){var c=this.indexChunks.chunks[r];return this.bai.slice(c[0],c[1]).fetch(function(y){y=new Uint8Array(y);this.indices[r]=y;return this.fetch(a,e,f,g,u)}.bind(this))}(E=this.blocksForRange(r,e,f))||g(null,"Error in index fetch")}var w=[],C=0,I;q()};var e="=ACxGxxxTxxxxxxN".split(""),u="MIDNSHP=X???????".split("");p.prototype.readBamRecords=function(a,f,b,g,q,k,v){for(;;){var F=
h(a,f),F=f+F+4;if(F>=a.length)return!1;var E=new n,c=h(a,f+4),w=h(a,f+8),C=h(a,f+12),I=(C&65280)>>8,y=C&255,C=h(a,f+16),D=(C&4294901760)>>16,A=C&65535,C=h(a,f+20),J=h(a,f+24),l=h(a,f+28);h(a,f+32);E.segment=this.indexToChr[c];E.flag=D;E.pos=w;E.mq=I;v.light&&(E.seqLength=C);if(!v.light){0<=J&&(E.nextSegment=this.indexToChr[J],E.nextPos=l);I="";for(w=0;w<y-1;++w)I+=String.fromCharCode(a[f+36+w]);E.readName=I;f=f+36+y;y="";for(w=0;w<A;++w)I=h(a,f),y=y+(I>>4)+u[I&15],f+=4;E.cigar=y;A="";y=C+1>>1;for(w=
0;w<y;++w)I=a[f+w],A+=e[(I&240)>>4],A+=e[I&15];f+=y;E.seq=A;A="";for(w=0;w<C;++w)A+=String.fromCharCode(a[f+w]+33);f+=C;for(E.quals=A;f<F;){A=String.fromCharCode(a[f],a[f+1]);y=String.fromCharCode(a[f+2]);if("A"==y)y=String.fromCharCode(a[f+3]),f+=4;else if("i"==y||"I"==y)y=h(a,f+3),f+=7;else if("c"==y||"C"==y)y=a[f+3],f+=4;else if("s"==y||"S"==y)y=x(a,f+3),f+=5;else if("f"==y)y=z(a,f+3),f+=7;else if("Z"==y||"H"==y)for(f+=3,y="";w=a[f++],0!=w;)y+=String.fromCharCode(w);else if("B"==y){y=String.fromCharCode(a[f+
3]);w=h(a,f+4);if("i"==y||"I"==y||"f"==y)I=4,D="f"==y?z:h;else if("s"==y||"S"==y)I=2,D=x;else if("c"==y||"C"==y)I=1,D=r;else throw"Unknown array type "+y;f+=8;y=[];for(J=0;J<w;++J)y.push(D(a,f)),f+=I}else throw"Unknown type "+y;E[A]=y}}if(!g||E.pos<=q&&E.pos+C>=g)void 0!==k&&c!=k||b.push(E);if(E.pos>q)return!0;f=F}};"undefined"!==typeof t&&(t.exports={makeBam:m,BAM_MAGIC:k,BAI_MAGIC:f,BamFlags:d})},{"./bin":4,"./lh3utils":24,"./spans":35}],2:[function(d,t,s){function p(a){this.type=a}function m(a,
f){this.parser=a;this.sink=f}function n(a,f){this.parser=a;this.sink=f;this.wigState=null}if("undefined"!==typeof d){var h=d("./spans"),x=h.Range,r=h.union,z=h.intersection,h=d("./sourceadapters").registerParserFactory;t=d("./das");var a=t.DASStylesheet,b=t.DASStyle,q=t.DASGroup,g=d("./utils").shallowCopy}p.prototype.createSession=function(a){return"wig"==this.type?new n(this,a):new m(this,a)};var k=/([^=]+)=(.+)/,f=/\s/,e=/^[0-9]+,[0-9]+,[0-9]+/;m.prototype.parse=function(a){var b=a.split(f);if(!(3>
b.length)){var k=parseInt(b[1])+1;a=parseInt(b[2]);a={segment:b[0],min:k,max:a};3<b.length&&"."!==b[3]&&(a.label=b[3]);4<b.length&&(a.score=parseFloat(b[4]));5<b.length&&(a.orientation=b[5]);if(8<b.length){var h=b[8];e.test(h)&&(a.itemRgb="rgb("+h+")")}if(12<=b.length){var h=parseInt(b[6]),n=parseInt(b[7]),d=parseInt(b[9]),m=b[10].split(",").map(function(c){return parseInt(c)}),v=b[11].split(",").map(function(c){return parseInt(c)});a.type="transcript";var F=new q;F.id=b[3];F.type="transcript";F.notes=
[];a.groups=[F];if(12<b.length){var E=F=b[12];13<b.length&&(E=b[13]);b=new q;b.id=F;b.label=E;b.type="gene";a.groups.push(b)}b=null;for(F=0;F<d;++F)E=v[F]+k,E=new x(E,E+m[F]),b=b?r(b,E):E;v=b.ranges();for(k=0;k<v.length;++k)m=v[k],d=g(a),d.min=m.min(),d.max=m.max(),this.sink(d);if(n>h&&(h="+"==a.orientation?new x(h,n+3):new x(h-3,n),h=z(b,h)))for(a.type="translation",h=h.ranges(),k=n=0;k<h.length;++k)d=k,"-"==a.orientation&&(d=h.length-k-1),m=h[d],d=g(a),d.min=m.min(),d.max=m.max(),a.readframe=n,
m=m.max()-m.min(),n=(n+m)%3,this.sink(d)}else this.sink(a)}};m.prototype.flush=function(){};n.prototype.parse=function(a){a=a.split(f);if("fixedStep"==a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var e=k.exec(a[b]);e&&("chrom"==e[1]?this.chr=e[2]:"start"==e[1]?this.pos=parseInt(e[2]):"step"==e[1]?this.step=parseInt(e[2]):"span"==e[1]&&(this.span=parseInt(e[2])))}}else if("variableStep"==a[0])for(this.wigState="variableStep",this.chr=null,b=
this.span=1;b<a.length;++b)e=k.exec(a[b]),"chrom"==e[1]?this.chr=e[2]:"span"==e[1]&&(this.span=parseInt(e[2]));else this.wigState?"fixedStep"==this.wigState?1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),
score:parseFloat(a[3])},this.sink(a))};n.prototype.flush=function(){};p.prototype.getStyleSheet=function(f){var e=new a;if("wig"==this.type){var g=new b;g.glyph="HISTOGRAM";g.BGCOLOR="blue";g.HEIGHT=30;e.pushStyle({type:"default"},null,g)}else g=new b,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="blue",g.HEIGHT=8,g.BUMP=!0,g.LABEL=!0,g.ZINDEX=20,e.pushStyle({type:"default"},null,g),g=new b,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="red",g.HEIGHT=10,g.BUMP=!0,g.ZINDEX=20,e.pushStyle({type:"translation"},
null,g),g=new b,g.glyph="BOX",g.FGCOLOR="black",g.BGCOLOR="white",g.HEIGHT=10,g.ZINDEX=10,g.BUMP=!0,g.LABEL=!0,e.pushStyle({type:"transcript"},null,g),g=new b,g.glyph="HISTOGRAM",g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,e.pushStyle({type:"density"},null,g);return f(e)};h("bed",function(a){return new p(a)});h("wig",function(a){return new p(a)})},{"./das":10,"./sourceadapters":34,"./spans":35,"./utils":48}],3:[function(d,t,s){function p(a,c){return a[c]+a[c+1]*H+a[c+2]*L+a[c+3]*P+a[c+4]*v}function m(){}
function n(a,c,f,e){this.bwg=a;this.cirTreeOffset=c;this.cirTreeLength=f;this.isSummary=e}function h(a,c,f){var e=new m;e.data=a;e.name=f;e.data.slice(0,512).salted().fetch(function(a){if(!a)return c(null,"Couldn't fetch file");var y=new Uint8Array(a),f=new Int16Array(a);a=new Int32Array(a);var b=y[0]+H*y[1]+L*y[2]+P*y[3];b==u?e.type="bigwig":b==Q?e.type="bigbed":b==B||b==M?c(null,"Currently don't support big-endian BBI files"):c(null,"Not a supported format, magic=0x"+b.toString(16));e.version=f[2];
e.numZoomLevels=f[3];e.chromTreeOffset=p(y,8);e.unzoomedDataOffset=p(y,16);e.unzoomedIndexOffset=p(y,24);e.fieldCount=f[16];e.definedFieldCount=f[17];e.asOffset=p(y,36);e.totalSummaryOffset=p(y,44);e.uncompressBufSize=a[13];e.extHeaderOffset=p(y,56);e.zoomLevels=[];for(f=0;f<e.numZoomLevels;++f){var b=a[6*f+16],g=p(y,24*f+72),l=p(y,24*f+80);e.zoomLevels.push({reduction:b,dataOffset:g,indexOffset:l})}e.readChromTree(function(){e.getAutoSQL(function(l){e.schema=l;return c(e)})})})}function x(a,c,f,
e,b){this.bbi=a;this.type=c;this.fieldCount=f;this.offset=e;this.field=b}if("undefined"!==typeof d){s=d("./spans");var r=s.Range,z=s.union,a=s.intersection;s=d("./das");var b=s.DASFeature,q=s.DASGroup,g=d("./utils").shallowCopy,k=d("./bin").readInt;d=d("jszlib");var f=d.inflateBuffer,e=d.arrayCopy}var u=2291137574,B=654086024,Q=2273964779,M=3958540679,H=256,L=65536,P=16777216,v=4294967296,F=/^[0-9]+,[0-9]+,[0-9]+/;m.prototype.readChromTree=function(a){var c=this;this.chromsToIDs={};this.idsToChroms=
{};this.maxID=0;var f=this.unzoomedDataOffset,f=f+4-(f-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,f-this.chromTreeOffset).fetch(function(f){var e=new Uint8Array(f),y=new Int16Array(f),b=(new Int32Array(f))[2];p(e,16);var A=function(a){var l=e[a],f=y[a/2+1];a+=4;for(var g=0;g<f;++g)if(0==l){a+=b;var w=p(e,a);a+=8;w-=c.chromTreeOffset;A(w)}else{for(var w="",k=0;k<b;++k){var q=e[a++];0!=q&&(w+=String.fromCharCode(q))}k=e[a+3]<<24|e[a+2]<<16|e[a+1]<<8|e[a+0];a+=8;c.chromsToIDs[w]=k;
0==w.indexOf("chr")&&(c.chromsToIDs[w.substr(3)]=k);c.idsToChroms[k]=w;c.maxID=Math.max(c.maxID,k)}};A(32);a(c)})};n.prototype.readWigData=function(a,c,f,e){a=this.bwg.chromsToIDs[a];if(void 0===a)return e([]);this.readWigDataById(a,c,f,e)};n.prototype.readWigDataById=function(a,c,f,e){var b=this;if(this.cirHeader){var y=[],g=0;Date.now();var A=function(l,y,e,b){return(0>a||l==a)&&y<=f&&e>=c},J=function(c,a){b.bwg.instrument&&console.log("level="+a+"; offset="+c+"; time="+(Date.now()|0));g+=c.length;
if(1==c.length&&48==c[0]-b.cirTreeOffset&&b.cachedCirRoot)G(b.cachedCirRoot,0,a),--g,0==g&&b.fetchFeatures(A,y,e);else{for(var f=4+32*b.cirBlockSize,w,J=0;J<c.length;++J){var k=new r(c[J],c[J]+f);w=w?z(w,k):k}f=w.ranges();for(w=0;w<f.length;++w)l(c,f[w],a)}},l=function(l,c,a,f){c.max();c.min();b.bwg.data.slice(c.min(),c.max()-c.min()).fetch(function(f){for(var w=0;w<l.length;++w)c.contains(l[w])&&(G(f,l[w]-c.min(),a),48==l[w]-b.cirTreeOffset&&0==l[w]-c.min()&&(b.cachedCirRoot=f),--g,0==g&&b.fetchFeatures(A,
y,e))})},G=function(l,e,b){var g=new Uint8Array(l),A=new Int16Array(l);l=new Int32Array(l);var G=g[e],A=A[e/2+1];e+=4;if(0!=G)for(G=0;G<A;++G){var k=e/4,D=l[k],q=l[k+1],C=l[k+2],k=l[k+3],u=p(g,e+16);b=p(g,e+24);(0>a||D<a||D==a&&q<=f)&&(0>a||C>a||C==a&&k>=c)&&y.push({offset:u,size:b});e+=32}else{for(var I=[],G=0;G<A;++G)k=e/4,D=l[k],q=l[k+1],C=l[k+2],k=l[k+3],u=p(g,e+16),(0>a||D<a||D==a&&q<=f)&&(0>a||C>a||C==a&&k>=c)&&I.push(u),e+=24;0<I.length&&J(I,b+1)}};J([b.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,
48).fetch(function(l){b.cirHeader=l;l=new Int32Array(b.cirHeader);b.cirBlockSize=l[1];b.readWigDataById(a,c,f,e)})};n.prototype.fetchFeatures=function(a,c,g){var k=this;c.sort(function(c,y){return(c.offset|0)-(y.offset|0)});if(0==c.length)g([]);else{var q=[],y=function(c,y,l,a){a||(a={});var f=new b;f._chromId=c;f.segment=k.bwg.idsToChroms[c];f.min=y;f.max=l;f.type="bigwig";for(var e in a)f[e]=a[e];q.push(f)},D=function(){if(0==c.length)Date.now(),g(q);else{var b=c[0];if(b.data)k.parseFeatures(b.data,
y,a),c.splice(0,1),D();else{for(var J=b.offset,l=b.size,b=1;b<c.length&&c[b].offset==J+l;)l+=c[b].size,++b;k.bwg.data.slice(J,l).fetch(function(y){for(var a=0,b=0;a<l;){var g=c[b],A;0<k.bwg.uncompressBufSize?A=f(y,a+2,g.size-2):(A=new Uint8Array(g.size),e(new Uint8Array(y,a,g.size),0,A,0,g.size),A=A.buffer);g.data=A;a+=g.size;++b}D()})}}};D()}};n.prototype.parseFeatures=function(f,c,e){var b=new Uint8Array(f);if(this.isSummary)for(var k=new Int16Array(f),y=new Int32Array(f),D=new Float32Array(f),
b=f.byteLength/32,k=0;k<b;++k){f=y[8*k];var A=y[8*k+1],J=y[8*k+2],l=y[8*k+3],G=D[8*k+5],u=D[8*k+6];e(f,A+1,J)&&(l={type:"bigwig",score:u/l,maxScore:G},"bigbed"==this.bwg.type&&(l.type="density"),c(f,A+1,J,l))}else if("bigwig"==this.bwg.type)if(k=new Int16Array(f),y=new Int32Array(f),D=new Float32Array(f),f=y[0],G=y[1],u=y[3],l=y[4],A=b[20],b=k[11],3==A)for(k=0;k<b;++k){var K=D[k+6],y=G+k*u+1,A=G+k*u+l;e(f,y,A)&&c(f,y,A,{score:K})}else if(2==A)for(k=0;k<b;++k)A=y[2*k+6]+1,J=A+l-1,K=D[2*k+7],e(f,A,
J)&&c(f,A,J,{score:K});else if(1==A)for(k=0;k<b;++k)A=y[3*k+6]+1,J=y[3*k+7],K=D[3*k+8],A>J&&(A=J),e(f,A,J)&&c(f,A,J,{score:K});else console.log("Currently not handling bwgType="+A);else if("bigbed"==this.bwg.type)for(k=0,l=this.bwg.definedFieldCount,G=this.bwg.schema;k<b.length;){f=b[k+3]<<24|b[k+2]<<16|b[k+1]<<8|b[k+0];A=b[k+7]<<24|b[k+6]<<16|b[k+5]<<8|b[k+4];J=b[k+11]<<24|b[k+10]<<16|b[k+9]<<8|b[k+8];k+=12;for(K="";;)if(u=b[k++],0!=u)K+=String.fromCharCode(u);else break;var u={},h;h=0<K.length?
K.split("\t"):[];0<h.length&&3<l&&(u.label=h[0]);1<h.length&&4<l&&(K=parseInt(h[1]),isNaN(K)||(u.score=K));2<h.length&&5<l&&(u.orientation=h[2]);5<h.length&&8<l&&(K=h[5],F.test(K)&&(u.itemRgb="rgb("+K+")"));if(h.length>l-3&&G)for(K=l-3;K<h.length;++K)u[G.fields[K+3].name]=h[K];if(e(f,A+1,J,h))if(12>l)c(f,A+1,J,u);else{var K=h[3]|0,B=h[4]|0,d=h[6]|0,v=h[7].split(","),n=h[8].split(",");u.exonFrames&&(D=u.exonFrames.split(","),u.exonFrames=void 0);u.type="transcript";var m=new q;for(y in u)m[y]=u[y];
m.id=h[0];m.segment=this.bwg.idsToChroms[f];m.min=A+1;m.max=J;m.notes=[];u.groups=[m];if(9<h.length){var L=J=u.geneName||h[9];10<h.length&&(L=h[10]);u.geneName2&&(L=u.geneName2);h=g(m);h.id=J;h.label=L;h.type="gene";u.groups.push(h)}J=[];for(h=0;h<d;++h)m=(n[h]|0)+A,m=new r(m,m+(v[h]|0)),J.push(m);v=z(J);d=v.ranges();for(A=0;A<d.length;++A)J=d[A],c(f,J.min()+1,J.max(),u);if(B>K&&(A="+"==u.orientation?new r(K,B+3):new r(K-3,B),A=a(v,A))){u.type="translation";K=A.ranges();for(v=B=0;K[0].min()>d[v].max();)v++;
for(A=0;A<K.length;++A)d=A,"-"==u.orientation&&(d=K.length-A-1),J=K[d],u.readframe=B,D&&(d=parseInt(D[d+v]),"number"===typeof d&&0<=d&&2>=d&&(u.readframe=d,u.readframeExplicit=!0)),d=J.max()-J.min(),B=(B+d)%3,c(f,J.min()+1,J.max(),u)}}}else throw Error("Don't know what to do with "+this.bwg.type);};n.prototype.getFirstAdjacent=function(a,c,f,e){a=this.bwg.chromsToIDs[a];if(void 0===a)return e([]);this.getFirstAdjacentById(a,c,f,e)};n.prototype.getFirstAdjacentById=function(a,c,f,e){var b=this;if(this.cirHeader){var y=
null,g=-1,A=-1,k=0;Date.now();var l=function(l,c){k+=l.length;for(var y=4+32*b.cirBlockSize,a,f=0;f<l.length;++f){var e=new r(l[f],l[f]+y);a=a?z(a,e):e}y=a.ranges();for(a=0;a<y.length;++a)G(l,y[a],c)},G=function(l,g,A,G){g.max();g.min();b.bwg.data.slice(g.min(),g.max()-g.min()).fetch(function(G){for(var D=0;D<l.length;++D)if(g.contains(l[D])&&(q(G,l[D]-g.min(),A),--k,0==k)){if(!y)return 0<f&&(0!=a||0<c)?b.getFirstAdjacentById(0,0,f,e):0>f&&(a!=b.bwg.maxID||1E9>c)?b.getFirstAdjacentById(b.bwg.maxID,
1E9,f,e):e([]);b.fetchFeatures(function(l,y,e,b){return 0>f&&(l<a||e<c)||0<f&&(l>a||y>c)},[y],function(l){for(var c=null,y=-1,a=-1,b=0;b<l.length;++b){var g=l[b],A=g._chromId,G=g.min,k=g.max;if(null==c||0>f&&(A>y||k>a)||0<f&&(A<y||G<a))c=g,a=0>f?k:G,y=A}return null!=c?e([c]):e([])})}})},q=function(e,G,k){var J=new Uint8Array(e),q=new Int16Array(e);e=new Int32Array(e);var u=J[G],q=q[G/2+1];G+=4;if(0!=u)for(u=0;u<q;++u){var C=G/4,h=e[C],r=e[C+1],B=e[C+2],d=e[C+3],C=p(J,G+16);k=p(J,G+24);(0>f&&(h<a||
h==a&&r<=c)||0<f&&(B>a||B==a&&d>=c))&&!/_random/.exec(b.bwg.idsToChroms[h])&&(null==y||0>f&&(B>g||B==g&&d>A)||0<f&&(h<g||h==g&&r<A))&&(y={offset:C,size:k},A=0>f?d:r,g=0>f?B:h);G+=32}else{for(var v=J=-1,u=0;u<q;++u){C=G/4;h=e[C];r=e[C+1];B=e[C+2];d=e[C+3];C=e[C+4]<<32|e[C+5];if(0>f&&(h<a||h==a&&r<=c)&&B>=a||0<f&&(B>a||B==a&&d>=c)&&h<=a)if(0>J||d>v)J=C,v=0>f?d:r;G+=24}0<=J&&l([J],k+1)}};l([b.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(l){b.cirHeader=l;l=new Int32Array(b.cirHeader);
b.cirBlockSize=l[1];b.getFirstAdjacentById(a,c,f,e)})};m.prototype.readWigData=function(a,c,f,e){this.getUnzoomedView().readWigData(a,c,f,e)};m.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new n(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};m.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new n(this,a.indexOffset,4E3,!0));return a.view};
m.prototype._tsFetch=function(a,c,f,e,b){var y=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var g=[],A=this.topLevelReductionCache,k=0;k<A.length;++k)A[k]._chromId==c&&g.push(A[k]);return b(g)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(l){y.topLevelReductionCache=l;return y._tsFetch(a,c,f,e,b)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(c,f,e,b)};m.prototype.thresholdSearch=function(a,c,f,e,b){function y(){if(0==
A.length)return b(null);A.sort(function(l,c){var a=l.zoom-c.zoom;if(0!=a)return a;a=l.chrOrd-c.chrOrd;return 0!=a?a:l.min-c.min*f});var l=A.splice(0,1)[0];g._tsFetch(l.zoom,l.chr,l.min,l.max,function(a){var g=0<f?0:3E8;l.fromRef&&(g=c);for(var k=0;k<a.length;++k){var J=a[k],q;q=void 0!=J.maxScore?J.maxScore:J.score;if(0<f){if(q>e)if(0>l.zoom){if(J.min>g)return b(J)}else J.max>g&&A.push({chr:l.chr,chrOrd:l.chrOrd,zoom:l.zoom-2,min:J.min,max:J.max,fromRef:l.fromRef})}else if(q>e)if(0>l.zoom){if(J.max<
g)return b(J)}else J.min<g&&A.push({chr:l.chr,chrOrd:l.chrOrd,zoom:l.zoom-2,min:J.min,max:J.max,fromRef:l.fromRef})}y()})}f=0>f?-1:1;var g=this;a=this.chromsToIDs[a];for(var A=[{chrOrd:0,chr:a,zoom:g.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],k=1;k<=this.maxID+1;++k){var l=(a+f*k)%(this.maxID+1);0>l&&(l+=this.maxID+1);A.push({chrOrd:k,chr:l,zoom:g.zoomLevels.length-1,min:0,max:3E8})}y()};m.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(c){var f=
new Uint8Array(c);c="";for(var e=0;e<f.length&&0!=f[e];++e)c+=String.fromCharCode(f[e]);var f=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,b=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(c);if(b){e={declType:b[1],name:b[2],comment:b[4],fields:[]};c=c.substring(b[0]);for(b=f.exec(c);null!=b;b=f.exec(c))e.fields.push({type:b[1],name:b[2],comment:b[4]});return a(e)}})};m.prototype.getExtraIndices=function(a){var c=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,
64).fetch(function(f){if(!f)return a(null,"Couldn't fetch extension header");var e=new Uint8Array(f),b=new Int16Array(f);new Int32Array(f);var y=b[1];f=p(e,4);if(0==y)return a(null);c.data.slice(f,20*y).fetch(function(f){if(!f)return a(null,"Couldn't fetch index info");var e=new Uint8Array(f),b=new Int16Array(f);new Int32Array(f);f=[];for(var l=0;l<y;++l){var g=b[10*l],k=b[10*l+1],w=p(e,20*l+4),g=new x(c,g,k,w,b[10*l+8]);f.push(g)}a(f)})})};x.prototype.lookup=function(a,c){var f=this;this.bbi.data.slice(this.offset,
32).fetch(function(e){function b(l){f.bbi.data.slice(l,4+g*(A+J)).fetch(function(l){var y=new Uint8Array(l),e=new Uint16Array(l);new Uint32Array(l);e=e[1];l=4;if(0==y[0]){for(var g=null,q=0;q<e;++q){for(var u="",D=0;D<A;++D){var h=y[l++];0!=h&&(u+=String.fromCharCode(h))}D=p(y,l);l+=8;if(0>a.localeCompare(u)&&g){b(g);return}g=D}b(g)}else{for(q=0;q<e;++q){u="";for(D=0;D<A;++D)h=y[l++],0!=h&&(u+=String.fromCharCode(h));if(u==a)return e=p(y,l),y=k(y,l+8),f.bbi.getUnzoomedView().fetchFeatures(function(l,
c,y,e){if(e&&e.length>f.field-3)return e[f.field-3]==a},[{offset:e,size:y}],c);l+=J}return c([])}})}var y=new Uint8Array(e);new Int16Array(e);e=new Int32Array(e);var g=e[1],A=e[2],J=e[3];p(y,16);b(f.offset+32)})};"undefined"!==typeof t&&(t.exports={makeBwg:h,BIG_BED_MAGIC:Q,BIG_WIG_MAGIC:u})},{"./bin":4,"./das":10,"./spans":35,"./utils":48,jszlib:64}],4:[function(d,t,s){function p(a){this.blob=a}function m(a,e,b,g){g||("object"===typeof e?(g=e,e=void 0):g={});this.url=a;this.start=e||0;b&&(this.end=
b);this.opts=g}function n(a){if(!a)return null;for(var e=new Uint8Array(a.length),b=0;b<e.length;++b)e[b]=a.charCodeAt(b);return e.buffer}function h(a,e){return a[e+7]<<24|a[e+6]<<16|a[e+5]<<8|a[e+4]}function x(a,e){return a[e+3]<<24|a[e+2]<<16|a[e+1]<<8|a[e]}function r(a,e){return a[e+1]<<8|a[e]}function z(a,e){return a[e]}function a(a,e){return a[e]<<24|a[e+1]<<16|a[e+2]<<8|a[e+3]}if("undefined"!==typeof d)var b=d("./utils").shallowCopy,q=d("./sha1").b64_sha1;p.prototype.slice=function(a,e){var b;
b=this.blob.slice?e?this.blob.slice(a,a+e):this.blob.slice(a):e?this.blob.webkitSlice(a,a+e):this.blob.webkitSlice(a);return new p(b)};p.prototype.salted=function(){return this};p.prototype.fetch="undefined"!==typeof FileReader?function(a){var e=new FileReader;e.onloadend=function(b){a(n(e.result))};e.readAsBinaryString(this.blob)}:function(a){var e=new FileReaderSync;try{var b=e.readAsArrayBuffer(this.blob);a(b)}catch(g){a(null,g)}};m.prototype.slice=function(a,e){if(0>a)throw"Bad slice "+a;var b=
this.start,g=this.end,b=b&&a?b+a:a||b;return new m(this.url,b,e&&b?b+e-1:g||e-1,this.opts)};var g=0,k=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");m.prototype.fetchAsText=function(a){var b=new XMLHttpRequest,u=this.url;(k||this.opts.salt)&&0>u.indexOf("?")&&(u=u+"?salt="+q(""+Date.now()+","+ ++g));b.open("GET",u,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}b.onreadystatechange=function(){if(4==
b.readyState)return 200==b.status||206==b.status?a(b.responseText):a(null)};this.opts.credentials&&(b.withCredentials=!0);b.send("")};m.prototype.salted=function(){var a=b(this.opts);a.salt=!0;return new m(this.url,this.start,this.end,a)};m.prototype.fetch=function(a,b,u){var h=this;b=b||1;if(3<b)return a(null);var r=new XMLHttpRequest,d,m=this.url;(k||this.opts.salt)&&0>m.indexOf("?")&&(m=m+"?salt="+q(""+Date.now()+","+ ++g));r.open("GET",m,!0);r.overrideMimeType("text/plain; charset=x-user-defined");
if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";r.setRequestHeader("Range","bytes="+this.start+"-"+this.end);d=this.end-this.start+1}r.responseType="arraybuffer";r.onreadystatechange=function(){if(4==r.readyState){if(200==r.status||206==r.status){if(r.response){var g=r.response.byteLength;return!d||d==g||u&&g==u?a(r.response):h.fetch(a,b+1,g)}if(r.mozResponseArrayBuffer)return a(r.mozResponseArrayBuffer);g=r.responseText;return!d||d==g.length||u&&g.length==u?a(n(r.responseText)):h.fetch(a,
b+1,g.length)}return h.fetch(a,b+1)}};this.opts.credentials&&(r.withCredentials=!0);r.send("")};(function(a){var b=new ArrayBuffer(8),g=new Uint8Array(b),k=new Float32Array(b);a.readFloat=function(a,b){g[0]=a[b];g[1]=a[b+1];g[2]=a[b+2];g[3]=a[b+3];return k[0]}})(this);"undefined"!==typeof t&&(t.exports={BlobFetchable:p,URLFetchable:m,readInt:x,readIntBE:a,readInt64:h,readShort:r,readByte:z,readFloat:this.readFloat})},{"./sha1":33,"./utils":48}],5:[function(d,t,s){function p(h){var d="bp";1E9<h?(h/=
1E9,d="Gb"):1E6<h?(h/=1E6,d="Mb"):1E3<h&&(h/=1E3,d="kb");return""+Math.round(h)+d}if("undefined"!==typeof d){var m=d("./cbrowser").Browser,n=d("./utils").makeElement,h=d("./numformats").formatLongInt,x=d("./zoomslider");d("./tier-edit");d("./export-config");d("./export-ui");d("./export-image");d("./svg-export");d("./session")}m.prototype.initUI=function(r,d){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(n("link",
"",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var a=this;a.disableDefaultFeaturePopup||this.addFeatureListener(function(c,l,y,b){a.featurePopup(c,l,y,b)});r.classList.add("dalliance");var b=a.toolbar=n("div",null,{className:"btn-toolbar toolbar"}),q=a.coordSystem.speciesName+" "+a.nameForCoordSystem(a.coordSystem);this.setDocumentTitle&&(document.title=q+" :: dalliance");var g=n("input","",{className:"loc-field"});a.makeTooltip(g,"Enter a genomic location or gene name");var k=
n("p","",{className:"loc-status"}),f=n("a",[n("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),e=new x;a.makeTooltip(e,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var u=n("a",[n("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),B=n("a",[n("i",null,{className:"fa fa-eraser"})],{className:"btn"}),m=n("a",[n("i",null,{className:"fa fa-plus"})],{className:"btn"}),M=n("a",[n("i",null,{className:"fa fa-bookmark"})],
{className:"btn"}),H=n("a",[n("i",null,{className:"fa fa-print"})],{className:"btn"});n("a",[n("i",null,{className:"fa fa-refresh"})],{className:"btn"});var L=n("a",[n("i",null,{className:"fa fa-cogs"})],{className:"btn"}),P=n("a",[n("i",null,{className:"fa fa-question"})],{className:"btn"}),v=n("a",[n("i",null,{className:"fa fa-road"})],{className:"btn"});a.makeTooltip(v,"Configure currently selected track(s) (E)");var F=n("a",[n("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),
E=n("a",[n("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),c=n("div",null,{className:"btn-group pull-right"});this.noTrackAdder||c.appendChild(m);this.noTrackEditor||c.appendChild(v);this.noExport||c.appendChild(H);this.noOptions||c.appendChild(L);this.noHelp||c.appendChild(P);this.setUiMode=function(a){this.uiMode=a;var l={help:P,add:m,opts:L,"export":H,tier:v},c;for(c in l)c==a?l[c].classList.add("active"):l[c].classList.remove("active")};this.noLeapButtons||
b.appendChild(E);c.firstChild&&b.appendChild(c);this.noLeapButtons||b.appendChild(F);this.noTitle||b.appendChild(n("div",n("h4",q,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||b.appendChild(n("div",[g,k],{className:"btn-group loc-group"}));this.noClearHighlightsButton||b.appendChild(B);this.noZoomSlider||b.appendChild(n("div",[f,n("span",e,{className:"btn"}),u],{className:"btn-group"}));this.toolbarBelow?(r.appendChild(d),r.appendChild(b)):(r.appendChild(b),r.appendChild(d));
var w=Math.log(2)/Math.log(10),C=Math.log(5)/Math.log(10),I=function(c){var l=(c/a.zoomExpt+Math.log(a.zoomBase))/Math.log(10);c=l|0;l-=c;return((0.01>l?c:l<=w+0.01?c+w:l<=C+0.01?c+C:c+1)*Math.log(10)-Math.log(a.zoomBase))*a.zoomExpt},y=function(c){e.addLabel(c,p(Math.exp(c/a.zoomExpt)*a.zoomBase))};this.addViewListener(function(c,l,b,A,k){g.value=c+":"+h(l)+".."+h(b);e.min=k.min|0;e.max=k.max|0;k.isSnapZooming?(e.value=k.alternate,e.value2=k.current,e.active=2):(e.value=k.current,e.value2=k.alternate,
e.active=1);k.current==k.min?f.classList.add("disabled"):f.classList.remove("disabled");k.current==k.max?u.classList.add("disabled"):u.classList.remove("disabled");e.removeLabels();c=k.min;k=k.max;l=k-c;y(I(c));y(I(c+1*l/3));y(I(c+2*l/3));y(I(k));a.storeStatus&&a.storeViewStatus();B.style.display=0<a.highlights.length?"inline-block":"none"});this.addTierListener(function(){a.storeStatus&&a.storeTierStatus()});g.addEventListener("keydown",function(c){40==c.keyCode&&(c.preventDefault(),c.stopPropagation(),
a.setSelectedTier(0));if(10==c.keyCode||13==c.keyCode)c.preventDefault(),a.search(g.value,function(a){k.textContent=a?""+a:""})},!1);var D;m.addEventListener("click",function(c){D&&D.displayed?a.removeAllPopups():D=a.showTrackAdder(c)},!1);a.makeTooltip(m,"Add a new track from the registry or an indexed file. (A)");f.addEventListener("click",function(c){c.stopPropagation();c.preventDefault();a.zoomStep(-10)},!1);a.makeTooltip(f,"Zoom in (+)");u.addEventListener("click",function(c){c.stopPropagation();
c.preventDefault();a.zoomStep(10)},!1);a.makeTooltip(u,"Zoom out (-)");e.addEventListener("change",function(c){c=2==e.active;c!=a.isSnapZooming&&(a.savedZoom=a.zoomSliderValue-a.zoomMin,a.isSnapZooming=c);c=1==e.active?e.value:e.value2;a.zoomSliderValue=1*c;a.zoom(Math.exp(1*c/a.zoomExpt))},!1);M.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);a.makeTooltip(M,"Favourite regions");H.addEventListener("click",function(c){c.stopPropagation();c.preventDefault();a.openExportPanel()},
!1);a.makeTooltip(H,"Export publication-quality SVG. (X)");L.addEventListener("click",function(c){c.stopPropagation();c.preventDefault();a.toggleOptsPopup(c)},!1);a.makeTooltip(L,"Configure options.");P.addEventListener("click",function(c){c.stopPropagation();c.preventDefault();a.toggleHelpPopup(c)});a.makeTooltip(P,"Help; Keyboard shortcuts. (H)");v.addEventListener("click",function(c){c.stopPropagation();c.preventDefault();1==a.selectedTiers.length&&a.openTierPanel(a.tiers[a.selectedTiers[0]])},
!1);F.addEventListener("click",function(c){a.leap(a.reverseKeyScrolling?-1:1,!1)},!1);a.makeTooltip(F,function(c){c=a.getSelectedTier();var l;0<=c&&(l=a.tiers[c]);return l&&l.featureSource&&a.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(l.config.name||l.dasSource.name)+'"" (ctrl+LEFT)':l&&l.featureSource&&a.sourceAdapterIsCapable(l.featureSource,"leap")?'Jump to the next feature in the selected track "'+
(l.config.name||l.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});E.addEventListener("click",function(c){a.leap(a.reverseKeyScrolling?1:-1,!1)},!1);a.makeTooltip(E,function(c){c=a.getSelectedTier();var l;0<=c&&(l=a.tiers[c]);return l&&l.featureSource&&a.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(l.config.name||l.dasSource.name)+'"" (ctrl+RIGHT)':l&&l.featureSource&&
a.sourceAdapterIsCapable(l.featureSource,"leap")?'Jump to the next feature in the selected track "'+(l.config.name||l.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});a.addTierSelectionListener(function(){var c=a.getSelectedTier(),l;0<=c&&(l=a.tiers[c]);c=!1;l&&l.featureSource&&(a.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold?c=!0:a.sourceAdapterIsCapable(l.featureSource,"leap")&&(c=!0));F.firstChild.className=c?"fa fa-angle-double-left":"fa fa-angle-left";
E.firstChild.className=c?"fa fa-angle-double-right":"fa fa-angle-right"});B.addEventListener("click",function(c){a.clearHighlights()},!1);a.makeTooltip(B,"Clear highlights (C)");a.addTierSelectionWrapListener(function(c){0>c&&(a.setSelectedTier(null),g.focus())});a.addTierSelectionListener(function(c){"tier"===a.uiMode&&(0==c.length?(a.hideToolPanel(),a.manipulatingTier=null,a.uiMode="none"):(c=a.tiers[c[0]],c!=a.manipulatingTier&&a.openTierPanel(c)))});var A=function(c){if(65==c.keyCode||97==c.keyCode)c.preventDefault(),
c.stopPropagation(),a.showTrackAdder();else if(72==c.keyCode||104==c.keyCode)c.stopPropagation(),c.preventDefault(),a.toggleHelpPopup(c);else if(69==c.keyCode||101==c.keyCode)c.stopPropagation(),c.preventDefault(),1==a.selectedTiers.length&&a.openTierPanel(a.tiers[a.selectedTiers[0]]);else if(88==c.keyCode||120==c.keyCode)c.stopPropagation(),c.preventDefault(),a.openExportPanel();else if(67==c.keyCode||99==c.keyCode)c.stopPropagation(),c.preventDefault(),a.clearHighlights()};r.addEventListener("focus",
function(c){r.addEventListener("keydown",A,!1)},!1);r.addEventListener("blur",function(c){r.removeEventListener("keydown",A,!1)},!1);r.addEventListener("keydown",function(c){27===c.keyCode&&"none"!==a.uiMode&&(c.preventDefault(),c.stopPropagation(),a.setUiMode("none"),a.hideToolPanel(),a.selectedTiers&&0<a.selectedTiers.length&&a.browserHolder.focus())},!1)};m.prototype.showToolPanel=function(h,d){var a=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);
var b;b=d?h:n("div",h,{},{overflowY:"auto",width:"100%"});var q=n("div",n("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});q.addEventListener("click",function(b){a.hideToolPanel();a.setUiMode("none")},!1);this.makeTooltip(q,"Close tool panel (ESC)");this.activeToolPanel=n("div",[q,b],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();a=this};m.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);
this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};m.prototype.toggleHelpPopup=function(h){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(h=n("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(h,!1),this.setUiMode("help"))};m.prototype.toggleOptsPopup=function(h){var d=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{h=n("div",null,{className:"form-horizontal"},
{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var a=n("table");a.cellPadding=5;var b=n("input","",{type:"checkbox",checked:d.reverseScrolling});b.addEventListener("change",function(a){d.reverseScrolling=b.checked;d.storeStatus()},!1);a.appendChild(n("tr",[n("td","Reverse trackpad scrolling",{align:"right"}),n("td",b)]));var q=n("input","",{type:"checkbox",checked:d.reverseKeyScrolling});q.addEventListener("change",function(a){d.reverseKeyScrolling=
q.checked;d.storeStatus()},!1);a.appendChild(n("tr",[n("td","Reverse scrolling buttons and keys",{align:"right"}),n("td",q)]));var g=n("select");g.appendChild(n("option","Left",{value:"left"}));g.appendChild(n("option","Center",{value:"center"}));g.appendChild(n("option","Right",{value:"right"}));g.appendChild(n("option","None",{value:"none"}));g.value=d.rulerLocation;g.addEventListener("change",function(a){d.rulerLocation=g.value;d.positionRuler();for(a=0;a<d.tiers.length;++a)d.tiers[a].paintQuant();
d.storeStatus()},!1);a.appendChild(n("tr",[n("td","Vertical guideline",{align:"right"}),n("td",g)]));var k=n("input","",{type:"checkbox",checked:d.singleBaseHighlight});k.addEventListener("change",function(a){d.singleBaseHighlight=k.checked;d.positionRuler();d.storeStatus()},!1);k.setAttribute("id","singleBaseHightlightButton");a.appendChild(n("tr",[n("td","Display and highlight current genome location",{align:"right"}),n("td",k)]));h.appendChild(a);a=n("button","Reset browser",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});a.addEventListener("click",function(a){d.reset()},!1);h.appendChild(a);this.showToolPanel(h);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":14,"./export-image":15,"./export-ui":16,"./numformats":26,"./session":32,"./svg-export":37,"./tier-edit":43,"./utils":48,"./zoomslider":51}],6:[function(d,t,s){function p(c,a,b){this.min=a;this.max=b;this.chr=c}function m(c){c||(c={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=
[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.registry="//www.dasregistry.org/das/sources";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=
100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.singleBaseHighlight=this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.availableSources=new k;this.defaultSources=
[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new g;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.initListeners=[];this.baseColors=c.baseColors?c.baseColors:{A:"green",C:"blue",G:"orange",T:"red","-":"hotpink",I:"red"};if(void 0!==c.viewStart&&"number"!==typeof c.viewStart)throw Error("viewStart must be an integer");if(void 0!==c.viewEnd&&"number"!==typeof c.viewEnd)throw Error("viewEnd must be an integer");
for(var a in c)this[a]=c[a];"string"===typeof c.uiPrefix&&"string"!==typeof c.prefix&&(this.prefix=c.uiPrefix);0>this.prefix.indexOf("//")&&0===this.prefix.indexOf("/")&&(this.prefix="//"+window.location.hostname+this.prefix);0===this.prefix.indexOf("//")&&(c=window.location.protocol,"http:"!=c&&"https:"!=c&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix));
if(!this.coordSystem)throw Error("Coordinate system must be configured");if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var b=this;"complete"===document.readyState?b.realInit():window.addEventListener("load",function(c){b.realInit()},!1)}function n(c,a,b){if(b)for(var e=0;e<a.length;++e)a[e].mapping=b;c.set(a)}function h(c){return c.uri?c.uri:c.blob?"file:"+c.blob.name:c.bwgBlob?"file:"+c.bwgBlob.name:c.bamBlob?"file:"+
c.bamBlob.name:c.twoBitBlob?"file:"+c.twoBitBlob.name:c.bwgURI||c.bamURI||c.jbURI||c.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function x(c){return c.stylesheet_uri?c.stylesheet_uri:"sequence"==c.tier_type||c.twoBitURI||c.twoBitBlob?"http://www.biodalliance.org/magic/sequence":h(c)}function r(c,a){if(h(c)!=h(a)||c.mapping!=a.mapping||c.tier_type!=a.tier_type)return!1;if(c.overlay){if(!a.overlay||a.overlay.length!=c.overlay.length)return!1;for(var b=0;b<c.overlay.length;++b)if(!r(c.overlay[b],
a.overlay[b]))return!1}else if(a.overlay)return!1;return!0}function z(c,a){if(h(c)!=h(a)||x(c)!=x(a)||c.mapping!=a.mapping||c.tier_type!=a.tier_type)return!1;if(c.overlay){if(!a.overlay||a.overlay.length!=c.overlay.length)return!1;for(var b=0;b<c.overlay.length;++b)if(!z(c.overlay[b],a.overlay[b]))return!1}else if(a.overlay)return!1;return!0}function a(c,b,e,f){f=f||[];for(var l=c.length-1;0<=l;--l){var g=c[l];if(!g.notSelectable&&g.min()<=b&&g.max()>=b&&(!g.minY||!(e<g.minY()||e>g.maxY()))){g.feature?
f.push(g.feature):g.group&&f.push(g.group);if(g.glyphs)return a(g.glyphs,b,e,f);if(g.glyph)return a([g.glyph],b,e,f);break}}return f}function b(c,a){var b=this;this.tagSeed=0;this.callbacks={};this.browser=c;this.worker=a;this.worker.onmessage=function(c){var a=b.callbacks[c.data.tag];a&&(a(c.data.result,c.data.error),delete b.callbacks[c.data.tag])}}function q(c){var a=c.resolveURL(c.workerPath);0==a.indexOf("//")&&(a="https:"==window.location.protocol?"https:"+a:"http:"+a);var e=new Blob(['importScripts("'+
a+'");'],{type:"application/javascript"});return new E(function(a,l){var f=new Worker(URL.createObjectURL(e));f.onmessage=function(l){"init"===l.data.tag&&(console.log("Worker initialized"),a(new b(c,f)))};f.onerror=function(c){l(c.message)}})}function g(){this.sourcesByURI={}}if("undefined"!==typeof d){s=d("./utils");var k=s.Observed,f=s.makeElement,e=s.removeChildren,u=s.miniJSONify,B=s.shallowCopy,Q=d("./tier").DasTier,M=d("./sha1").hex_sha1,H=d("./thub").connectTrackHub,L=d("./version");s=d("./numformats");
var P=s.formatQuantLabel,v=s.formatLongInt,F=d("./chainset").Chainset,E=d("es6-promise").Promise}m.prototype.resolveURL=function(c){return c.replace("$$",this.prefix)};m.prototype.realInit=function(){var c=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var a=navigator.userAgent||"dummy";0<=a.indexOf("Trident")&&0<=a.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;
this.defaultEnd=this.viewEnd;this.defaultSources=[];for(a=0;a<this.sources.length;++a){var b=this.sources[a];b&&this.defaultSources.push(b)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var g=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=f("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=
this.maxHeight&&(this.browserHolder.style.maxHeight=null);e(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=f("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=f("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=f("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.locSingleBase=f("span","",{className:"loc-single-base"});a=f("div",this.locSingleBase,
{className:"loc-single-base-holder"});this.addViewListener(function(a,l,b,e,f,g,k){l=Math.round((k+g)/2);c.locSingleBase.appendChild(document.createTextNode(a+":"+v(l)));c.locSingleBase.removeChild(c.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=f("div",[a,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=
f("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(f("span",["Powered by ",f("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+L],{className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",function(c){g.resizeViewer()},!1);this.ruler=f("div",null,{className:"guideline"});this.ruler2=f("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=
this.chains||{};this.chains={};for(var l in this.chainConfigs)a=this.chainConfigs[l],a instanceof F&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[l]=new F(a);if(0<this.maxWorkers){l=[];for(a=0;a<this.maxWorkers;++a)l.push(q(this));l=E.all(l)}else l=E.resolve([]);this.fetchWorkers=null;this.nextWorker=0;l.then(function(c){console.log("Booted "+c.length+" workers");g.fetchWorkers=c},function(c){console.log("Failed to boot workers",c)}).then(function(){if("none"!=
window.getComputedStyle(g.browserHolderHolder).display&&0<g.tierHolder.getBoundingClientRect().width)setTimeout(function(){g.realInit2()},1);else var c=setInterval(function(){"none"!=window.getComputedStyle(g.browserHolderHolder).display&&0<g.tierHolder.getBoundingClientRect().width&&(clearInterval(c),g.realInit2())},300)})}};m.prototype.realInit2=function(){var c=this;e(this.tierHolder);e(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/
(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",function(a){a.stopPropagation();a.preventDefault();if(a.wheelDeltaX){var l=a.wheelDeltaX/5;c.reverseScrolling||(l=-l);c.move(l)}a.wheelDeltaY&&(l=a.wheelDeltaY,
c.reverseScrolling&&(l=-l),c.tierHolder.scrollTop+=l)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(a){a.stopPropagation();a.preventDefault();1==a.axis?0!=a.detail&&(a=a.detail/4,c.reverseScrolling&&(a=-a),c.move(a)):(a=a.detail,c.reverseScrolling||(a=-a),c.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("touchstart",function(a){return c.touchStartHandler(a)},!1);this.tierHolderHolder.addEventListener("touchmove",function(a){return c.touchMoveHandler(a)},
!1);this.tierHolderHolder.addEventListener("touchend",function(a){return c.touchEndHandler(a)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(a){return c.touchCancelHandler(a)},!1);var a=function(a){if(13==a.keyCode){var l=!1;for(a=0;a<c.tiers.length;++a){var b=c.tiers[a];b.wantedLayoutHeight&&b.wantedLayoutHeight!=b.layoutHeight&&(b.layoutHeight=b.wantedLayoutHeight,b.clipTier(),l=!0)}l&&c.arrangeTiers()}else if(32==a.keyCode||32==a.charCode)c.isSnapZooming?(c.isSnapZooming=!1,
l=(c.savedZoom||20)+c.zoomMin):(c.isSnapZooming=!0,l=(c.savedZoom||0)+c.zoomMin),c.savedZoom=c.zoomSliderValue-c.zoomMin,c.zoomSliderValue=l,c.zoom(Math.exp(1*l/c.zoomExpt)),a.stopPropagation(),a.preventDefault();else if(85==a.keyCode)"opts"===c.uiMode&&(l=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=!l),c.singleBaseHighlight=!c.singleBaseHighlight,c.positionRuler(),a.stopPropagation(),a.preventDefault();else if(39==a.keyCode)a.stopPropagation(),
a.preventDefault(),c.scrollArrowKey(a,-1);else if(37==a.keyCode)a.stopPropagation(),a.preventDefault(),c.scrollArrowKey(a,1);else if(38==a.keyCode||87==a.keyCode)if(a.stopPropagation(),a.preventDefault(),a.shiftKey)a=c.getSelectedTier(),0>a||(l=c.tiers[a],a=l.forceHeight||l.subtiers[0].height,40<=a&&l.mergeConfig({height:a-10}));else if(a.ctrlKey||a.metaKey){if(a=c.getSelectedTier(),!(0>a)&&(l=c.tiers[a],l.quantLeapThreshold)){var b=l.subtiers[0].height,e=l.subtiers[0].quant;e&&(a=1*e.min,e=1*e.max,
b=(e-a)/b,l.mergeConfig({quantLeapThreshold:a+((Math.round((l.quantLeapThreshold-a)/b)|0)+1)*b}),l.notify("Threshold: "+P(l.quantLeapThreshold)))}}else if(a.altKey){if(e=c.selectedTiers.length,0!=e){a=c.selectedTiers[0];for(var f=!0,l=[],b=0;b<c.selectedTiers.length;++b)l.push(c.tiers[c.selectedTiers[b]]),0<b&&1!=c.selectedTiers[b]-c.selectedTiers[b-1]&&(f=!1);if(!(f&&0>=a)){for(b=c.selectedTiers.length-1;0<=b;--b)c.tiers.splice(c.selectedTiers[b],1);c.selectedTiers.splice(0,e);a=f?a-1:a;for(b=0;b<
l.length;++b)c.tiers.splice(a+b,0,l[b]),c.selectedTiers.push(a+b);c.withPreservedSelection(c._ensureTiersGrouped);c.markSelectedTiers();c.notifyTierSelection();c.reorderTiers();c.notifyTier()}}}else if(a=c.getSelectedTier(),0<a){if(c.setSelectedTier(a-1),a=c.tiers[c.getSelectedTier()],l=a.row.offsetTop,a=l+a.row.offsetHeight,l<c.tierHolder.scrollTop||a>c.tierHolder.scrollTop+c.tierHolder.offsetHeight)c.tierHolder.scrollTop=l}else c.notifyTierSelectionWrap(-1);else if(40==a.keyCode||83==a.keyCode)if(a.stopPropagation(),
a.preventDefault(),a.shiftKey)a=c.getSelectedTier(),0>a||(l=c.tiers[a],a=l.forceHeight||l.subtiers[0].height,l.mergeConfig({height:a+10}));else if(a.ctrlKey||a.metaKey){if(a=c.getSelectedTier(),!(0>a)&&(l=c.tiers[a],l.quantLeapThreshold&&(b=l.subtiers[0].height,e=l.subtiers[0].quant)))a=1*e.min,e=1*e.max,b=(e-a)/b,e=Math.round((l.quantLeapThreshold-a)/b)|0,1<e&&(l.mergeConfig({quantLeapThreshold:a+(e-1)*b}),l.notify("Threshold: "+P(l.quantLeapThreshold)))}else if(a.altKey){if(e=c.selectedTiers.length,
0!=e){a=c.selectedTiers[0];for(var g=0,l=[],b=0;b<c.selectedTiers.length;++b)l.push(c.tiers[c.selectedTiers[b]]),0<b&&(g+=c.selectedTiers[b]-c.selectedTiers[b-1]-1);f=0==g;if(!(f&&a+e>=c.tiers.length)){for(b=c.selectedTiers.length-1;0<=b;--b)c.tiers.splice(c.selectedTiers[b],1);c.selectedTiers.splice(0,e);a=f?a+1:a+g;for(b=0;b<l.length;++b)c.tiers.splice(a+b,0,l[b]),c.selectedTiers.push(a+b);c.withPreservedSelection(function(){c._ensureTiersGrouped(!0)});c.markSelectedTiers();c.notifyTierSelection();
c.reorderTiers();c.notifyTier()}}}else{if(a=c.getSelectedTier(),a<c.tiers.length-1&&(c.setSelectedTier(a+1),a=c.tiers[c.getSelectedTier()],l=a.row.offsetTop,a=l+a.row.offsetHeight,l<c.tierHolder.scrollTop||a>c.tierHolder.scrollTop+c.tierHolder.offsetHeight))c.tierHolder.scrollTop=Math.min(l,a-c.tierHolder.offsetHeight)}else if(187==a.keyCode||61==a.keyCode)a.stopPropagation(),a.preventDefault(),c.zoomStep(-10);else if(189==a.keyCode||173==a.keyCode)a.stopPropagation(),a.preventDefault(),c.zoomStep(10);
else if(73==a.keyCode||105==a.keyCode)a.stopPropagation(),a.preventDefault(),a=c.getSelectedTier(),0>a||(b=c.tiers[a],b.infoVisible?(b.infoElement.style.display="none",b.updateHeight(),b.infoVisible=!1):(b.infoElement.style.display="block",b.updateHeight(),b.infoVisible=!0));else if(84==a.keyCode||116==a.keyCode)if(a.shiftKey)for(a.stopPropagation(),a.preventDefault(),a=0;a<c.tiers.length;++a)b=c.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===l&&(l=!b.bumped),b.mergeConfig({bumped:l}));else a.ctrlKey||
a.metaKey||(a.stopPropagation(),a.preventDefault(),a=c.getSelectedTier(),0>a||(b=c.tiers[a],b.dasSource.collapseSuperGroups&&(void 0===l&&(l=!b.bumped),b.mergeConfig({bumped:l}))));else if(77==a.keyCode||109==a.keyCode)a.stopPropagation(),a.preventDefault(),(a.ctrlKey||a.metaKey)&&1<c.selectedTiers.length&&c.mergeSelectedTiers();else if(68==a.keyCode||100==a.keyCode){if(a.stopPropagation(),a.preventDefault(),a.ctrlKey||a.metaKey)a=c.getSelectedTier(),0>a||c.addTier(c.tiers[a].dasSource)}else if(80==
a.keyCode||112==a.keyCode)if(a.ctrlKey||a.metaKey){l=[];for(a=0;a<c.selectedTiers.length;++a)l.push(c.tiers[c.selectedTiers[a]]);for(a=0;a<l.length;++a)l[a].mergeConfig({pinned:!l[a].pinned})}};this.browserHolder.addEventListener("focus",function(l){c.browserHolder.addEventListener("keydown",a,!1)},!1);this.browserHolder.addEventListener("blur",function(l){c.browserHolder.removeEventListener("keydown",a,!1)},!1);this.hPopupHolder=f("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]=
"12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var b=0;b<this.sources.length;++b){var g=this.sources[b];if(g){var l={};this.restoredConfigs&&(l=this.restoredConfigs[b]);g.disabled||this.makeTier(g,l)}}c._ensureTiersGrouped();c.arrangeTiers();c.reorderTiers();c.refresh();c.setSelectedTier(1);c.positionRuler();(b=this.getSequenceSource())&&b.getSeqInfo(this.chr,function(a){c.currentSeqMax=a?a.length:-1});this.queryRegistry();for(var k in this.chains)this.queryRegistry(k,
!0);if(this.hubs)for(k=0;k<this.hubs.length;++k)b=this.hubs[k],"string"==typeof b&&(b={url:b}),function(a){H(a.url,function(l,b){if(b)console.log(b);else{var e;if(e=a.genome?l.genomes[a.genome]:l.genomes[c.coordSystem.ucscName])a.mapping&&(e.mapping=a.mapping),c.hubObjects.push(e)}},a)}(b);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();for(k=0;k<this.initListeners.length;++k)try{this.initListeners[k].call(this)}catch(w){console.log(w)}};m.prototype.touchStartHandler=
function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};m.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var c=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&c!=this.touchOriginX&&this.move(c-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&
(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=c;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){c=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(c!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var b=this.viewStart+a/this.scale|0;this.scale=c/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=b-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=c}};m.prototype.touchEndHandler=function(a){};m.prototype.touchCancelHandler=
function(a){};m.prototype.makeTier=function(a,c){try{return this.realMakeTier(a,c)}catch(b){console.log("Error initializing",a),console.log(b.stack||b)}};m.prototype.realMakeTier=function(c,b){var e=this,f=null;this.tierBackgroundColors&&(f=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var l=new Q(this,c,b,f);l.oorigin=this.viewStart;var g=!1,k,w,q,h=function(c,b){var f=l.subtiers;if(f){var g=0;for(b-=l.padding;g<f.length&&b>f[g].height&&g<f.length-1;)b=b-f[g].height-
l.padding,++g;if(!(g>=f.length))return f=f[g].glyphs,c-=(l.glyphCacheOrigin-e.viewStart)*e.scale,a(f,c,b)}},u=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=w&&(e.move(a-w,!0),w=a);e.isDragging=!0},C=function(a){window.removeEventListener("mousemove",u,!0);window.removeEventListener("mouseup",C,!0);e.move(a.clientX-w)};l.viewport.addEventListener("mousedown",function(a){e.browserHolder.focus();a.preventDefault();l.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",
u,!0);window.addEventListener("mouseup",C,!0);k=w=a;e.isDragging=!1},!1);l.viewport.addEventListener("mousemove",function(a){var c=l.row.getBoundingClientRect(),b=a.clientX-c.left,f=a.clientY-c.top,c=h(b,f);l.row.style.cursor=c&&0<c.length?"pointer":"default";q&&clearTimeout(q);g||(q=setTimeout(function(){var c=h(b,f);c&&0<c.length&&e.notifyFeatureHover(a,c[c.length-1],c,l)},1E3))});var d=null;l.viewport.addEventListener("mouseup",function(a){var c=l.row.getBoundingClientRect(),b=a.clientX-c.left,
c=a.clientY-c.top,f=h(b,c);f&&0<f.length&&!e.isDragging&&(d?(clearTimeout(d),d=null,e.featureDoubleClick(f,b,c)):d=setTimeout(function(){d=null;e.notifyFeature(a,f[f.length-1],f,l)},500));if(e.isDragging&&b!=k&&l.sequenceSource){var c=e.viewStart+b/e.scale,g=e.viewStart+k/e.scale;c<g?(b=c|0,c=g|0):(b=g|0,c|=0);e.notifyRegionSelect(e.chr,b,c)}e.isDragging=!1},!1);l.viewport.addEventListener("mouseout",function(a){g=!1});l.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();
for(a=0;a<e.tiers.length;++a)if(e.tiers[a]===l){e.removeTier({index:a});break}},!1);l.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){a=-1;for(var c=0;c<e.tiers.length;++c)if(e.tiers[c]===l){a=c;break}0<=a&&(c=e.selectedTiers.indexOf(a),0<=c?e.selectedTiers.splice(c,1):(e.selectedTiers.push(a),e.selectedTiers.sort()),e.markSelectedTiers(),e.notifyTierSelection(),0<e.selectedTiers.length?e.browserHolder.focus():e.notifyTierSelectionWrap(-1))}else{for(c=
0;c<e.tiers.length;++c)if(e.tiers[c]===l&&(e.browserHolder.focus(),1!=e.selectedTiers.length||e.selectedTiers[0]!=c)){e.setSelectedTier(c);return}l.infoVisible?(l.infoElement.style.display="none",l.updateHeight(),l.infoVisible=!1):(l.infoElement.style.display="block",l.updateHeight(),l.infoVisible=!0)}},!1);l.bumpButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();var c;l.dasSource.collapseSuperGroups&&(void 0===c&&(c=!l.bumped),l.mergeConfig({bumped:c}))},!1);var r,
B,v,m,n,F=!1,I=function(a){var c=l.label;a.stopPropagation();a.preventDefault();if(!r){B=l.pinned?e.pinnedTierHolder:e.tierHolder;v=B.scrollHeight-B.offsetHeight;r=c.cloneNode(!0);r.style.cursor="pointer";B.appendChild(r);c.style.visibility="hidden";for(var b=0;b<e.tiers.length;++b)if(e.tiers[b]===l){m=b;break}n=a.clientY}var f=B.getBoundingClientRect();r.style.left=c.getBoundingClientRect().left-f.left+"px";r.style.top=a.clientY-f.top+B.scrollTop-10+"px";c=a.clientY-f.top+B.scrollTop;for(b=0;b<e.tiers.length;++b)if(f=
e.tiers[b],!(f.pinned^l.pinned)&&(f=f.row.getBoundingClientRect(),c-=f.bottom-f.top,0>c)){if(b<m&&a.clientY<n||b>m&&a.clientY>n){e.withPreservedSelection(function(){e.tiers.splice(m,1);e.tiers.splice(b,0,l);e._ensureTiersGrouped(b>m)});for(c=0;c<e.tiers.length;++c)e.tiers[c]==l&&(m=c);n=a.clientY;e.reorderTiers();B.appendChild(r);F=!0}break}r.offsetTop<B.scrollTop?B.scrollTop-=B.scrollTop-r.offsetTop:r.offsetTop+r.offsetHeight>B.scrollTop+B.offsetHeight&&(B.scrollTop=Math.min(B.scrollTop+(r.offsetTop+
r.offsetHeight)-(B.scrollTop+B.offsetHeight),v))},p=function(a){var c=l.label;a.stopPropagation();a.preventDefault();r&&(r.style.cursor="auto",B.removeChild(r),r=null,c.style.visibility="visible");document.removeEventListener("mousemove",I,!1);document.removeEventListener("mouseup",p,!1);if(F){for(a=0;a<e.tiers.length;++a)if(e.tiers[a]==l){e.setSelectedTier(a);break}e.notifyTier()}};l.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();F=!1;document.addEventListener("mousemove",
I,!1);document.addEventListener("mouseup",p,!1)},!1);this.tiers.push(l);l.init();l.currentlyHeight=50;this.updateHeight();l.updateLabel();l.featureSource&&l.featureSource.addActivityListener&&l.featureSource.addActivityListener(function(a){l.loaderButton.style.display=0<a?"inline-block":"none";e.pingActivity()});this.withPreservedSelection(e._ensureTiersGrouped);l._updateFromConfig();this.reorderTiers();return l};m.prototype.reorderTiers=function(){e(this.tierHolder);e(this.pinnedTierHolder);this.disablePinning&&
(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,c=[],b=[],f=0;f<this.tiers.length;++f){var l=this.tiers[f];l.pinned&&!this.disablePinning?(c.push(l),this.pinnedTierHolder.appendChild(this.tiers[f].row),a=!0):(b.push(l),this.tierHolder.appendChild(this.tiers[f].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var a=0;a<c.length;++a)this.tiers.push(c[a]);for(a=0;a<b.length;++a)this.tiers.push(b[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):
this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};m.prototype.withPreservedSelection=function(a){for(var c=[],b=0;b<this.selectedTiers.length;++b)c.push(this.tiers[this.selectedTiers[b]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=c.indexOf(this.tiers[a])&&this.selectedTiers.push(a)};m.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};m.prototype._ensureTiersGrouped=function(a){for(var c={},b=0;b<this.tiers.length;++b){var e=
this.tiers[b];e.dasSource.tierGroup&&pusho(c,e.dasSource.tierGroup,e)}var l=[];a&&this.tiers.reverse();for(b=0;b<this.tiers.length;++b)if(e=this.tiers[b],e.dasSource.tierGroup){var f=c[e.dasSource.tierGroup];if(f){a&&f.reverse();for(var g=0;g<f.length;++g)l.push(f[g]);c[e.dasSource.tierGroup]=null}}else l.push(e);a&&l.reverse();this.tiers.splice(0,this.tiers.length);for(g=0;g<l.length;++g)this.tiers.push(l[g])};m.prototype.arrangeTiers=function(){for(var a=[],c={},b=0;b<this.tiers.length;++b){var e=
this.tiers[b];e.pinned&&(a.push(e),e.dasSource.tierGroup&&pusho(c,e.dasSource.tierGroup,e))}for(b=0;b<this.tiers.length;++b)e=this.tiers[b],e.pinned||(a.push(e),e.dasSource.tierGroup&&pusho(c,e.dasSource.tierGroup,e));for(var l in c){var e=c[l],g=this.tierGroups[l];g||(g={element:f("div",f("span",l,{className:"tier-group-label"}),{className:"tier-group"})},this.tierGroups[l]=g);g.element.parentNode&&g.element.parentNode.removeChild(g.element);for(var k=e[0].pinned?this.pinnedTierHolder:this.tierHolder,
w=1E7,q=0,b=0;b<e.length;++b)var h=e[b].row,w=Math.min(w,h.offsetTop),q=Math.max(q,h.offsetTop+h.offsetHeight);g.element.style.top=w+"px";g.element.style.left="0px";g.element.style.height=q-w+"px";k.appendChild(g.element)}if(this.tierBackgroundColors)for(b=0;b<a.length;++b)e=a[b],e.setBackground(this.tierBackgroundColors[b%this.tierBackgroundColors.length]),e.label.style.left=e.dasSource.tierGroup?"18px":"2px",e.background=this.tierBackgroundColors[b%this.tierBackgroundColors.length]};m.prototype.refresh=
function(){this.notifyLocation();var a=100/this.scale|0,c=1E3/this.scale|0,b=(this.viewStart+this.viewEnd)/2,e=b-this.origin;this.origin=b;this.scaleAtLastRedraw=this.scale;for(b=0;b<this.tiers.length;++b){var l=e;this.tiers[b].originHaxx&&(l+=this.tiers[b].originHaxx);this.tiers[b].originHaxx=l}e=this.targetQuantRes/this.scale;b=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);l=Math.max(1,(this.viewStart|0)-c);c=Math.min((this.viewEnd|
0)+c,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var f=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new C(this.tiers,this.chr,l,c,e,f)}(f=this.knownSpace.bestCacheOverlapping(this.chr,b,a))&&f.min<=b&&f.max>=a?(this.drawnStart=Math.max(f.min,l),this.drawnEnd=Math.min(f.max,c)):(this.drawnStart=l,this.drawnEnd=c);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,e);this.drawOverlays();
this.positionRuler()};m.prototype.queryRegistry=function(a,c){var b,e;a?(b=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new k),e=this.mappableSources[a]):(b=this.coordSystem,e=this.availableSources);var l=M(u(b));if(c){var f=localStorage["dalliance.registry."+l+".last_queried"];if(f)try{if(n(e,JSON.parse(localStorage["dalliance.registry."+l+".sources"]),a),432E5>(Date.now()|0)-(f|0))return}catch(g){console.log("Bad registry cache: "+g)}}f=this.registry;if(0==f.indexOf("//")){var w=
window.location.protocol;"https:"!=w&&"http:"!=w&&(f="http:"+f)}(new I(f)).sources(function(c){for(var f=[],g=0;g<c.length;++g){var k=c[g];if(k.coords&&0!=k.coords.length){var w=k.coords[0];w.taxon==b.taxon&&w.auth==b.auth&&w.version==b.version&&f.push(k)}}localStorage["dalliance.registry."+l+".sources"]=JSON.stringify(f);localStorage["dalliance.registry."+l+".last_queried"]=""+Date.now();n(e,f,a)},function(a){},b)};m.prototype.move=function(a,c){var b=this.viewEnd-this.viewStart,e=this.viewStart-
1*a/this.scale,l=e+b;c||(0<this.currentSeqMax&&l>this.currentSeqMax&&(l=this.currentSeqMax,e=this.viewEnd-b),1>e&&(e=1,l=e+b));this.setLocation(null,e,l,null,c)};m.prototype.zoomStep=function(a){var c=1*this.zoomSliderValue;a=c+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=c&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};m.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/
2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};m.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|
0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};m.prototype.resizeViewer=function(a){var c=this.tierHolder.getBoundingClientRect().width|0;if(0!=c){var b=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=c|0;b!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/
this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b,c=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-c+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+c-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&
this.setFullScreenHeight()}};m.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};m.prototype.addTier=function(a){a=B(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier();return a};m.prototype.removeTier=function(a,c){var b=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)b=a.index;else for(var e=0;e<
this.tiers.length;++e)if(z(a,this.tiers[e].dasSource)){b=e;break}if(0>b)throw"Couldn't find requested tier";this.tiers.splice(b,1);for(var e=[],l=0;l<this.selectedTiers.length;++l){var f=this.selectedTiers[l];f<b?e.push(f):f>b&&e.push(f-1)}this.selectedTiers=e;this.markSelectedTiers();this.reorderTiers();this.notifyTier()};m.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};m.prototype._getSequenceSource=
function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var b=this.defaultSources[a];if(b.provides_entrypoints||"sequence"==b.tier_type||b.twoBitURI||b.twoBitBlob)return b.twoBitURI||b.twoBitBlob?new c(b):new w(b)}};m.prototype.setLocation=function(a,c,b,e,l){if("number"!==typeof c)throw Error("minimum must be a number (got "+JSON.stringify(c)+")");if("number"!==typeof b)throw Error("maximum must be a number (got "+
JSON.stringify(b)+")");if(c>b){var f=c;c=b;b=f}else c===b&&(b+=1);e||(e=function(a){if(a)throw a;});var g=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,c,b,null,e,l);var k=this.getSequenceSource();if(!k)return e("Need a sequence source");var w=a||this.chr;k.getSeqInfo(w,function(f){if(f)return g._setLocation(a,c,b,f,e,l);var q;q=0==w.indexOf("chr")?w.substr(3):"chr"+w;k.getSeqInfo(q,function(f){return!f&&a?e("Couldn't find sequence '"+a+"'"):f?g._setLocation(q,c,b,
f,e,l):g._setLocation(null,c,b,null,e,l)})})};m.prototype._setLocation=function(a,c,b,e,l,f){var g=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(g=!0),this.chr=a,this.currentSeqMax=e.length);c=parseFloat(c);b=parseFloat(b);a=Math.max(10,b-c+1);f||(f=this.currentSeqMax,0>=f&&(f=1E12),1>c&&(c=1,b=c+a-1),b>f&&(b=f,c=Math.max(1,b-a+1)));this.viewStart=c;this.viewEnd=b;c=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);f=1E-6<Math.abs(c-this.scale);this.scale=c;b=this.zoomSliderValue;
this.zoomSliderValue=c=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(f||g){for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left="5000px",this.tiers[g].overlay.style.left="5000px";this.refresh();this.savedZoom?(c-=this.zoomMin,b-=this.zoomMin,g=c-this.savedZoom,Math.abs(c-b)>Math.abs(g)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=b)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(g=0;g<this.tiers.length;++g)this.tiers[g].viewportHolder.style.left=
""+((-((this.viewStart-this.tiers[g].norigin)*this.scale)|0)-1E3)+"px",this.tiers[g].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return l()};m.prototype.setCenterLocation=function(a,c){var b=(this.viewEnd-this.viewStart)/2;this.setLocation(a,c-b,c+b)};m.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,c=0;c<this.tiers.length;++c)"none"!==this.tiers[c].loaderButton.style.display&&
++a;0==a&&(a=Date.now()|0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};m.prototype.addInitListener=function(a){this.initListeners.push(a)};m.prototype.addFeatureListener=function(a,c){this.featureListeners.push(a)};m.prototype.notifyFeature=function(a,c,b,e){for(var l=0;l<this.featureListeners.length;++l)try{if(this.featureListeners[l](a,c,b,e))break}catch(f){console.log(f.stack)}};m.prototype.addFeatureHoverListener=function(a,c){this.featureHoverListeners.push(a)};
m.prototype.notifyFeatureHover=function(a,c,b,e){for(var l=0;l<this.featureHoverListeners.length;++l)try{this.featureHoverListeners[l](a,c,b,e)}catch(f){console.log(f.stack)}};m.prototype.addViewListener=function(a,c){this.viewListeners.push(a)};m.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),c=this.viewEnd|0;0<this.currentSeqMax&&c>this.currentSeqMax&&(c=this.currentSeqMax);for(var b=0;b<this.viewListeners.length;++b)try{this.viewListeners[b](this.chr,a,c,this.zoomSliderValue,
{current:this.zoomSliderValue,alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(e){console.log(e.stack)}};m.prototype.addTierListener=function(a){this.tierListeners.push(a)};m.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(c){console.log(c.stack)}};m.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};
m.prototype.notifyRegionSelect=function(a,c,b){for(var e=0;e<this.regionSelectListeners.length;++e)try{this.regionSelectListeners[e](a,c,b)}catch(l){console.log(l.stack)}};m.prototype.highlightRegion=function(a,c,b){var e=this;if(a==this.chr)return this._highlightRegion(a,c,b);var l=this.getSequenceSource();if(!l)throw"Need a sequence source";l.getSeqInfo(a,function(f){if(f)return e._highlightRegion(a,c,b);var g;g=0==a.indexOf("chr")?a.substr(3):"chr"+a;l.getSeqInfo(g,function(a){if(a)return e._highlightRegion(g,
c,b)})})};m.prototype._highlightRegion=function(a,c,b){for(var e=0;e<this.highlights.length;++e){var l=this.highlights[e];if(l.chr==a&&l.min==c&&l.max==b)return}this.highlights.push(new p(a,c,b));e=this.viewStart-1E3/this.scale;l=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&c<l&&b>e&&this.drawOverlays();this.notifyLocation()};m.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};m.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};
m.prototype.featuresInRegion=function(a,c,b){var e=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var l=this.tiers[a].currentFeatures||[],f=0;f<l.length;++f){var g=l[f];g.min<=b&&g.max>=c&&e.push(g)}return e};m.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};m.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};m.prototype.markSelectedTiers=function(){for(var a=
0;a<this.tiers.length;++a){var c=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?c.classList.add("active"):c.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};m.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};m.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(c){console.log(c.stack)}};
m.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};m.prototype.notifyTierSelectionWrap=function(a){for(var c=0;c<this.tierSelectionWrapListeners.length;++c)try{this.tierSelectionWrapListeners[c](a)}catch(b){console.log(b.stack)}};m.prototype.positionRuler=function(){var a="none",c="",b="";"center"==this.rulerLocation?(a="block",c=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",c="0px"):"right"==this.rulerLocation?(a="block",b=
"0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=c;this.ruler.style.right=b;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/
2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var e=0;e<this.tiers.length;++e){var l=this.tiers[e],f=l.quantOverlay,g;l.subtiers&&0<l.subtiers.length&&(g=l.subtiers[0].quant);f&&(f.style.display=g?a:"none",f.style.left=c,f.style.right=b)}};m.prototype.featureDoubleClick=function(a,c,b){if(a&&
0!=a.length&&(b=a[a.length-1],b.min&&b.max)){var e=((b.min|0)-(this.viewStart|0))*this.scale,l=(b.max-b.min+1)*this.scale;a=((b.min|0)+(b.max|0))/2;10<l&&(c=1*(c-e)/l,0.3>c?a=b.min|0:0.7<c&&(a=(b.max|0)+1));c=this.viewEnd-this.viewStart;this.setLocation(null,a-c/2,a+c/2)}};m.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};m.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};m.prototype.updateHeight=function(){for(var a=0,c=0;c<this.tiers.length;++c)a+=
this.tiers[c].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="flex"};m.prototype.scrollArrowKey=function(a,c){this.reverseKeyScrolling&&(c=-c);if(a.ctrlKey||a.metaKey){var b=!1;a.shiftKey&&(b=!0);this.leap(c,b)}else if(1<this.scale){var b=(this.viewStart+this.viewEnd)/2,b=b-Math.round(b),e=1;a.shiftKey&&(e*=10);0<c?(e=-e-b,0<b&&(e+=1)):(e-=b,0>b&&(e-=1));this.setLocation(null,this.viewStart+
e,this.viewEnd+e)}else this.move(a.shiftKey?100*c:25*c)};m.prototype.leap=function(a,c){var b=this,e=(b.viewStart+b.viewEnd+1)/2|0;0<a&&1>=b.viewStart?e-=1E8:0>a&&b.viewEnd>=b.currentSeqMax&&(e+=1E8);var l=b.getSelectedTier();0>l||((l=b.tiers[l])&&(l.featureSource&&this.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold||l.featureSource&&this.sourceAdapterIsCapable(l.featureSource,"leap"))?l.findNextFeature(b.chr,e,-a,c,function(l){if(l){var f=l.min,g=l.max;
c&&(0<a?f>e+1?g=f:(g++,f=g):g<e-1?(g++,f=g):g=f);var k=b.viewEnd-b.viewStart+1;parseFloat(k/2)==parseInt(k/2)&&k--;f=(f+g-k)/2+1;b.setLocation(l.segment,f,f+k-1)}else alert("no next feature")}):this.move(100*a))};m.prototype.nameForCoordSystem=function(a){var c=null,b=null;this.assemblyNamePrimary&&(c=""+a.auth,"undefined"!==typeof a.version&&(c+=a.version));this.assemblyNameUcsc&&(b=a.ucscName);return null!=c&&null!=b?c+"/"+b:c||b||"unknown"};m.prototype.makeLoader=function(a){var c=1<window.devicePixelRatio;
return 20>(a||16)?f("img",null,{src:this.resolveURL("$$img/spinner_"+(c?16:32)+".gif"),width:"16",height:"16"}):f("img",null,{src:this.resolveURL("$$img/spinner_"+(c?24:48)+".gif"),width:"24",height:"24"})};m.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};b.prototype.postCommand=function(a,c,b){var e="x"+ ++this.tagSeed;a.tag=
e;this.callbacks[e]=c;this.worker.postMessage(a,b)};if("undefined"!==typeof t){t.exports={Browser:m,sourcesAreEqual:z,sourceDataURI:h};d("./browser-ui");d("./track-adder");d("./feature-popup");d("./tier-actions");d("./domui");d("./search");t=d("./sourceadapters");var c=t.TwoBitSequenceSource,w=t.DASSequenceSource,C=d("./kspace").KnownSpace,I=d("./das").DASRegistry}g.prototype.get=function(a){var c=this.sourcesByURI[h(a)];if(c)for(var b=0;b<c.configs.length;++b)if(r(c.configs[b],a))return c.sources[b]};
g.prototype.put=function(a,c){var b=h(a),e=this.sourcesByURI[b];e||(e={configs:[],sources:[]},this.sourcesByURI[b]=e);e.configs.push(a);e.sources.push(c)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":19,"./kspace":23,"./numformats":26,"./search":30,"./sha1":33,"./sourceadapters":34,"./thub":41,"./tier":44,"./tier-actions":42,"./track-adder":45,"./utils":48,"./version":50,"es6-promise":52}],7:[function(d,t,s){function p(a,b,e,f){"string"==typeof a?(this.uri=a,this.srcTag=
b,this.destTag=e,this.coords=f):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=g(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles={};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new n(this.uri,this.credentials):"alias"==this.type?new z(a):new m(this.uri,this.srcTag,this.destTag)}function m(b,e,f){this.source=new a(b);this.srcTag=e;this.destTag=f}function n(a,b){var g=
this;this.uri=a;this.credentials=b;this.bwg=new u(function(a,b){e(new f(g.uri,{credentials:g.credentials}),function(e,f){e?a(e):b(f)})});this.bwg.then(function(a,b){b&&console.log(b)})}function h(a){return parseInt(a)}function x(a){return 0==a.indexOf("chr")?a.substr(3):a}function r(a){var b={srcChr:x(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:x(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},e=a.srcStarts.split(",").map(h),f=a.destStarts.split(",").map(h);
a=a.blockLens.split(",").map(h);for(var g=0;g<e.length;++g)b.blocks.push([e[g],f[g],a[g]]);return b}function z(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var e=a[b];if(!(2>e.length)){for(var f=[],g=0;g<e.length-1;++g)f.push(e[g]);this.forwardAliases[e[e.length-1]]=f}}}if("undefined"!==typeof d){s=d("./das");var a=s.DASSource,b=s.DASSegment;s=d("./utils");var q=s.pusho,g=s.shallowCopy,k=d("./cigar").parseCigar,f=d("./bin").URLFetchable,e=d("./bigwig").makeBwg,
u=d("es6-promise").Promise}p.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};p.prototype.mapPoint=function(a,b){for(var e=this.chainsBySrc[a]||[],f=0;f<e.length;++f){var g=e[f];if(b>=g.srcMin&&b<=g.srcMax){var k;k="-"==g.srcOri?g.srcMax-b:b-g.srcMin;for(var q=g.blocks,h=0;h<q.length;++h){var u=q[h],c=u[0],w=u[1],u=u[2];if(k>=c&&k<=c+u)return e=k-c,{seq:g.destChr,pos:"-"==g.destOri?g.destMax-
w-e:e+w+g.destMin,flipped:g.srcOri!=g.destOri}}}}return null};p.prototype.mapSegment=function(a,b,e){a=this.chainsBySrc[a]||[];for(var f=[],g=0;g<a.length;++g){var k=a[g];if(e>=k.srcMin&&b<=k.srcMax){var q,h;"-"==k.srcOri?(q=k.srcMax-e,h=k.srcMax-b):(q=b-k.srcMin,h=e-k.srcMin);for(var u=k.blocks,c=0;c<u.length;++c){var w=u[c],C=w[0],r=w[1],w=w[2];if(h>=C&&q<=C+w){var d={segment:k.destChr,flipped:"-"==k.srcOri^"-"==k.destOri};"-"==k.destOri?(q>=C?d.max=k.destMax-r-q+C:(d.max=k.destMax-r,d.partialMax=
C-q),h<=C+w?d.min=k.destMax-r-h+C:(d.min=k.destMax-r-w,d.partialMin=h-C-w)):(q>=C?d.min=k.destMin+r+q-C:(d.min=k.destMin+r,d.partialMin=C-q),h<=C+w?d.max=k.destMin+r+h-C:(d.max=k.destMin+r+w,d.partialMax=h-C-w));f.push(d)}}}}return f};p.prototype.unmapPoint=function(a,b){for(var e=this.chainsByDest[a]||[],f=0;f<e.length;++f){var g=e[f];if(b>=g.destMin&&b<=g.destMax){var k;k="-"==g.srcOri?g.destMax-b:b-g.destMin;for(var q=g.blocks,h=0;h<q.length;++h){var u=q[h],c=u[0],w=u[1],u=u[2];if(k>=w&&k<=w+u)return e=
k-w,f=e+c+g.srcMin,f="-"==g.destOri?g.srcMax-c-e:e+c+g.srcMin,{seq:g.srcChr,pos:f,flipped:g.srcOri!=g.destOri}}}}return null};p.prototype.sourceBlocksForRange=function(a,e,f,g){for(var k=this,h=e/this.granularity|0,u=f/this.granularity|0,d=!1,r=h;r<=u;++r){var c=a+"_"+r;2!=this.fetchedTiles[c]&&(d=!0,1!=this.fetchedTiles[c]&&(this.fetchedTiles[c]=1))}if(d)this.postFetchQueues[a]||this.chainFetcher.fetchChains(a,h*this.granularity,(u+1)*this.granularity-1).then(function(c){k.chainsByDest||(k.chainsByDest[a]=
[]);for(var b=0;b<c.length;++b){var e=c[b],l=k.chainsBySrc[e.srcChr];if(l){for(var f=!1,g=0;g<l.length;++g){var w=l[g];if(w.srcMin==e.srcMin&&w.srcMax==e.srcMax){f=!0;break}}f||l.push(e)}else k.chainsBySrc[e.srcChr]=[e];if(l=k.chainsByDest[e.destChr]){f=!1;for(g=0;g<l.length;++g)if(w=l[g],w.destMin==e.destMin&&w.destMax==e.destMax){f=!0;break}f||l.push(e)}else k.chainsByDest[e.destChr]=[e]}for(c=h;c<=u;++c)k.fetchedTiles[a+"_"+c]=2;if(k.postFetchQueues[a]){c=k.postFetchQueues[a];for(b=0;b<c.length;++b)c[b]();
k.postFetchQueues[a]=null}}).catch(function(a){console.log(a)}),q(this.postFetchQueues,a,function(){k.sourceBlocksForRange(a,e,f,g)});else{d=[];r=this.chainsByDest[a]||[];for(c=0;c<r.length;++c){var w=r[c];if(e<=w.destMax&&f>=w.destMin){var C,m;"-"==w.srcOri?(C=w.destMax-f,m=w.destMax-e):(C=e-w.destMin,m=f-w.destMin);for(var y=w.blocks,n=0;n<y.length;++n){var A=y[n],p=A[0],l=A[1],G=A[2];m>=l&&C<=l+G&&(A=Math.max(C,l)-l,l=Math.min(m,l+G)-l,"-"==w.destOri?d.push(new b(w.srcChr,w.srcMax-p-l,w.srcMax-
p-A)):d.push(new b(w.srcChr,w.srcMin+A+p,w.srcMin+l+p)))}}}g(d)}};m.prototype.fetchChains=function(a,b,e){var f=this;return new u(function(b,e){f.source.alignments(a,{},function(a){for(var e=[],g=0;g<a.length;++g)for(var c=a[g],w=0;w<c.blocks.length;++w){for(var q=c.blocks[w],h,u,d=0;d<q.segments.length;++d){var r=q.segments[d],m=c.objects[r.object];m.dbSource===f.srcTag?h=r:m.dbSource===f.destTag&&(u=r)}if(h&&u){for(var q={srcChr:c.objects[h.object].accession,srcMin:h.min|0,srcMax:h.max|0,srcOri:h.strand,
destChr:c.objects[u.object].accession,destMin:u.min|0,destMax:u.max|0,destOri:u.strand,blocks:[]},d=k(h.cigar),r=k(u.cigar),l=m=0,G=0,n=0;G<d.length&&n<r.length;)if("M"==d[G].op&&"M"==r[n].op){var B=Math.min(d[G].cnt,r[n].cnt);q.blocks.push([m,l,B]);d[G].cnt==B?++G:d[G].cnt-=B;r[n].cnt==B?++n:r[n]-=B;m+=B;l+=B}else"I"==d[G].op?l+=d[G++].cnt:"I"==r[n].op&&(m+=r[n++].cnt);e.push(q)}}b(e)})})};n.prototype.fetchChains=function(a,b,e){return this.bwg.then(function(f,g){if(!f)throw Error("No BWG");return new u(function(g,
k){f.getUnzoomedView().readWigData(a,b,e,function(a){g(a.map(r))})})})};z.prototype.fetchChains=function(a,b,e){b=[];e=this.forwardAliases[a]||[];for(var f=0;f<e.length;++f)b.push({srcChr:e[f],srcMin:1,srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return u.resolve(b)};"undefined"!==typeof t&&(t.exports={Chainset:p})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":48,"es6-promise":52}],8:[function(d,t,s){function p(d){for(var h=[],p;null!=(p=m.exec(d));){var r=
p[1];0==r.length&&(r=1);h.push({cnt:r|0,op:p[2]})}return h}var m=/([0-9]*)([MIDS])/g;"undefined"!==typeof t&&(t.exports={parseCigar:p})},{}],9:[function(d,t,s){function p(a,q,g,k){this.red=a|0;this.green=q|0;this.blue=g|0;k&&(this.name=k)}function m(a){a="00"+a.toString(16);return a.substring(a.length-2)}function n(b){var q=r[b];q||((q=z.exec(b))?q=new p("0x"+q[1]|0,"0x"+q[2]|0,"0x"+q[3]|0,b):(q=a.exec(b))?q=new p(q[1]|0,q[2]|0,q[3]|0,b):(console.log("couldn't handle color: "+b),q=r.black),r[b]=q);
return q}function h(a,q,g){for(var k=[],f=0;f<g.length;++f)k.push(n(g[f]));g=[];f=0;a:for(;f<a;++f){for(var e=q[0]+1*f/(a-1)*(q[q.length-1]-q[0]),h=0;h<q.length-1;++h)if(e>=q[h]&&e<=q[h+1]){var e=(e-q[h])/(q[h+1]-q[h]),d=k[h],h=k[h+1],h=(new p(d.red*(1-e)+h.red*e|0,d.green*(1-e)+h.green*e|0,d.blue*(1-e)+h.blue*e|0)).toSvgString();g.push(h);continue a}throw"Bad step";}return g}function x(a,q,g,k){return k?h(a,[0,0.5,1],[q,g,k]):h(a,[0,1],[q,g])}p.prototype.toSvgString=function(){this.name||(this.name=
"rgb("+this.red+","+this.green+","+this.blue+")");return this.name};p.prototype.toHexString=function(){return"#"+m(this.red)+m(this.green)+m(this.blue)};var r={red:new p(255,0,0,"red"),green:new p(0,255,0,"green"),blue:new p(0,0,255,"blue"),yellow:new p(255,255,0,"yellow"),white:new p(255,255,255,"white"),black:new p(0,0,0,"black"),gray:new p(180,180,180,"gray"),grey:new p(180,180,180,"grey"),lightskyblue:new p(135,206,250,"lightskyblue"),lightsalmon:new p(255,160,122,"lightsalmon"),hotpink:new p(255,
105,180,"hotpink")},z=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,a=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof t&&(t.exports={makeColourSteps:h,makeGradient:x,dasColourForName:n})},{}],10:[function(d,t,s){function p(a,b,c,e){this.name=a;this.start=b;this.end=c;this.description=e}function m(a,b){var c;"string"==typeof a?(this.uri=a,c=b||{}):c=a||{};for(var e in c)"function"!=typeof c[e]&&(this[e]=c[e]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=
this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function n(){}function h(a,b){return a.taxon==b.taxon&&a.auth==b.auth&&a.version==b.version}function x(a,b,c,e,f){this.name=a;this.start=b;this.end=c;this.alphabet=e;this.seq=f}function r(){}function z(a){a&&(this.id=a)}function a(a,b){this.desc=a;this.uri=b}function b(a){this.type=a;this.objects={};this.blocks=[]}function q(){this.styles=[]}function g(){}function k(a,b){b=b||{};this.uri=a;this.opts=b}function f(a,b){var c=
a.getElementsByTagName(b);if(0<c.length&&c[0].firstChild){c=c[0];if(1==c.childNodes.length)return c.firstChild.nodeValue;for(var e="",f=0;f<c.childNodes.length;++f)e+=c.childNodes[f].nodeValue;return e}return null}function e(b){for(var e=[],c=b.getElementsByTagName("LINK"),f=0;f<c.length;++f){var g=c[f];g.parentNode==b&&e.push(new a(g.firstChild?g.firstChild.nodeValue:"Unknown",g.getAttribute("href")))}return e}function u(a){var b=[];a=a.getElementsByTagName("NOTE");for(var c=0;c<a.length;++c)a[c].firstChild&&
b.push(a[c].firstChild.nodeValue);return b}function B(a,b,c,e){if(window.XDomainRequest){var f=new XDomainRequest;f.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(f.responseText);b(a)};f.open("get",a)}else Date.now(),f=new XMLHttpRequest,f.onreadystatechange=function(){4==f.readyState&&(200<=f.status||0==f.status)&&b(f.responseXML,f)},f.open("get",a,!0),c&&(f.withCredentials=!0),e&&f.setRequestHeader("X-DAS-Authorisation",e),f.overrideMimeType("text/xml"),f.setRequestHeader("Accept",
"application/xml,*/*");f.send("")}function Q(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function M(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function H(a){var b=L(a);b.styles=[];for(var c=0;c<a.styles.length;++c){var e=b.styles[c]=L(a.styles[c]);e._methodRE=e._labelRE=e._typeRE=void 0;e.style=L(e.style);e.style.id=void 0;e.style._gradient=void 0}return b}if("undefined"!==typeof d){s=d("./utils");var L=s.shallowCopy,P=s.pusho,v=d("./color").makeColourSteps}p.prototype.toString=
function(){return this.name+":"+this.start+".."+this.end};p.prototype.isBounded=function(){return this.start&&this.end};p.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};m.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var c=[];b=b.getElementsByTagName("SEGMENT");for(var e=0;e<b.length;++e){var f=b[e],g=f.getAttribute("id"),k=f.getAttribute("size"),
q;k?(q=1,k|=0):((q=f.getAttribute("start"))&&(q|=0),(k=f.getAttribute("stop"))&&(k|=0));var h=null;f.firstChild&&(h=f.firstChild.nodeValue);c.push(new p(g,q,k,h))}a(c)})};m.prototype.sequence=function(a,b){var c=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(c,function(a){if(a){var c=[];a=a.getElementsByTagName("SEQUENCE");for(var e=0;e<a.length;++e){var f=a[e],g=f.getAttribute("id"),k=f.getAttribute("start"),q=f.getAttribute("stop"),l=null;if(f.firstChild)for(var f=f.firstChild.nodeValue,
l="",h=0;;){var u=f.indexOf("\n",h);if(0<=u)l+=f.substring(h,u).toUpperCase(),h=u+1;else{l+=f.substring(h).toUpperCase();break}}c.push(new x(g,k,q,"DNA",l))}b(c)}else b([])})};m.prototype.features=function(a,b,c){b=b||{};var g;if(this.features_uri)g=this.features_uri;else{var k=[];if(a)k.push(a.toDASQuery());else if(b.group)if(a=b.group,"string"==typeof a)k.push("group_id="+a);else for(var q=0;q<a.length;++q)k.push("group_id="+a[q]);if(b.adjacent)for(a=b.adjacent,"string"==typeof a&&(a=[a]),q=0;q<
a.length;++q)k.push("adjacent="+a[q]);if(b.type)if("string"==typeof b.type)k.push("type="+b.type);else for(a=0;a<b.type.length;++a)k.push("type="+b.type[a]);b.maxbins&&k.push("maxbins="+b.maxbins);0<k.length?g=this.dasBaseURI+"features?"+k.join(";"):c([],"No filters specified")}this.doCrossDomainRequest(g,function(a,b){if(a){for(var g=[],k={},l=a.getElementsByTagName("SEGMENT"),q=0;q<l.length;++q){var h=l[q],w=h.getAttribute("id");k[w]={min:h.getAttribute("start"),max:h.getAttribute("stop")};for(var h=
h.getElementsByTagName("FEATURE"),d=0;d<h.length;++d){var m=h[d],C=new r;C.segment=w;C.id=m.getAttribute("id");C.label=m.getAttribute("label");var n=f(m,"START"),v=f(m,"END");(n|0)>(v|0)?(C.min=v|0,C.max=n|0):(C.min=n|0,C.max=v|0);n=m.getElementsByTagName("TYPE");0<n.length&&(n=n[0],n.firstChild&&(C.type=n.firstChild.nodeValue),C.typeId=n.getAttribute("id"),C.typeCv=n.getAttribute("cvId"));C.type=f(m,"TYPE");!C.type&&C.typeId&&(C.type=C.typeId);C.method=f(m,"METHOD");(n=f(m,"ORIENTATION"))||(n="0");
C.orientation=n;C.score=f(m,"SCORE");C.links=e(m);C.notes=u(m);n=m.getElementsByTagName("GROUP");for(v=0;v<n.length;++v){var B=n[v],p=new z;p.type=B.getAttribute("type");p.id=B.getAttribute("id");p.links=e(B);p.notes=u(B);C.groups?C.groups.push(p):C.groups=Array(p)}if(C.notes)for(n=0;n<C.notes.length;++n)v=C.notes[n],0==v.indexOf("Genename=")&&(B=new z,B.type="gene",B.id=v.substring(9),C.groups?C.groups.push(B):C.groups=Array(B));n=m.getElementsByTagName("PART");if(0<n.length){B=[];for(v=0;v<n.length;++v)B.push(n[v].getAttribute("id"));
C.parts=B}n=m.getElementsByTagName("PARENT");if(0<n.length){m=[];for(v=0;v<n.length;++v)m.push(n[v].getAttribute("id"));C.parents=m}g.push(C)}}c(g,void 0,k)}else c([],"Failed request: "+(0==b.status?"server may not support CORS":"status="+b.status))},function(a){c([],a)})};m.prototype.alignments=function(a,e,c){var g=this.dasBaseURI+"alignment?query="+a;this.doCrossDomainRequest(g,function(a){if(a){var e=[];a=a.getElementsByTagName("alignment");for(var k=0;k<a.length;++k){for(var q=a[k],h=new b(q.getAttribute("alignType")),
u=q.getElementsByTagName("alignObject"),l=0;l<u.length;++l){var d=u[l],d={id:d.getAttribute("intObjectId"),accession:d.getAttribute("dbAccessionId"),version:d.getAttribute("objectVersion"),dbSource:d.getAttribute("dbSource"),dbVersion:d.getAttribute("dbVersion")};h.objects[d.id]=d}q=q.getElementsByTagName("block");for(u=0;u<q.length;++u){for(var d=q[u],l={order:d.getAttribute("blockOrder"),segments:[]},d=d.getElementsByTagName("segment"),r=0;r<d.length;++r){var n=d[r],n={object:n.getAttribute("intObjectId"),
min:n.getAttribute("start"),max:n.getAttribute("end"),strand:n.getAttribute("strand"),cigar:f(n,"cigar")};l.segments.push(n)}h.blocks.push(l)}e.push(h)}c(e)}else c([],"Failed request "+g)})};q.prototype.pushStyle=function(a,b,c){a||(a={type:"default"});a=L(a);b&&(a.zoom=b);a.style=c;this.styles.push(a)};m.prototype.stylesheet=function(a,b){var c,e=this.credentials;this.stylesheet_uri?(c=this.stylesheet_uri,e=!1):c=this.dasBaseURI+"stylesheet";B(c,function(c){if(c){var e=new q;c=c.getElementsByTagName("TYPE");
for(var f=0;f<c.length;++f){var k=c[f],h={};h.type=k.getAttribute("id");h.label=k.getAttribute("label");h.method=k.getAttribute("method");for(var k=k.getElementsByTagName("GLYPH"),w=0;w<k.length;++w){var l=k[w],u=l.getAttribute("zoom"),d;a:{if(l.hasChildNodes()){l=l.firstChild;do{if(l.nodeType==Node.ELEMENT_NODE){d=l;break a}l=l.nextSibling}while(null!=l)}d=null}l=new g;l.glyph=d.localName;for(d=d.firstChild;d;){if(d.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==d.localName){var r=l,n=d.localName,m,B=
d;m=(m=B.getAttribute("steps"))?m|0:50;for(var p=[],z=[],B=B.getElementsByTagName("STOP"),H=0;H<B.length;++H){var x=B[H];p.push(1*x.getAttribute("score"));z.push(x.firstChild.nodeValue)}m=v(m,p,z);r[n]=m}else l[d.localName]=d.firstChild.nodeValue;d=d.nextSibling}e.pushStyle(h,u,l)}}a(e)}else b&&b()},e)};k.prototype.sources=function(a,b,c){c||(c={});var e=[];c.taxon&&e.push("organism="+c.taxon);c.auth&&e.push("authority="+c.auth);c.version&&e.push("version="+c.version);c=this.uri;0<e.length&&(c=c+
"?"+e.join("&"));B(c,function(c){if(!c&&b)b();else{var e=[];c=c.getElementsByTagName("SOURCE");for(var f=0;f<c.length;++f){var g=c[f],k=g.getElementsByTagName("VERSION");if(!(1>k.length)){for(var q=k[0],l=q.getElementsByTagName("COORDINATES"),k=[],h=0;h<l.length;++h){var w=l[h],d=new n;d.auth=w.getAttribute("authority");d.taxon=w.getAttribute("taxid");d.version=w.getAttribute("version");k.push(d)}for(var l=[],w=q.getElementsByTagName("CAPABILITY"),u,h=0;h<w.length;++h)d=w[h],l.push(d.getAttribute("type")),
"das1:features"==d.getAttribute("type")&&(u=d.getAttribute("query_uri"),u=u.substring(0,u.length-8));h={};q=q.getElementsByTagName("PROP");for(w=0;w<q.length;++w)P(h,q[w].getAttribute("name"),q[w].getAttribute("value"));u&&(g=new m(u,{source_uri:g.getAttribute("uri"),name:g.getAttribute("title"),desc:g.getAttribute("description"),coords:k,props:h,capabilities:l}),e.push(g))}}a(e)}})};m.prototype.doCrossDomainRequest=function(a,b,c){var e;this.xUser&&(e="Basic "+btoa(this.xUser+":"+this.xPass));try{return B(a,
b,this.credentials,e)}catch(f){if(c)c(f);else throw f;}};"undefined"!==typeof t&&(t.exports={DASGroup:z,DASFeature:r,DASStylesheet:q,DASStyle:g,DASSource:m,DASSegment:p,DASRegistry:k,DASSequence:x,DASLink:a,isDasBooleanTrue:Q,isDasBooleanNotFalse:M,copyStylesheet:H,coordsMatch:h})},{"./color":9,"./utils":48}],11:[function(d,t,s){function p(h,d,m){function a(){m?(b.className="fa fa-caret-down",d.style.display="table"):(b.className="fa fa-caret-right",d.style.display="none")}var b=n("i");a();b.addEventListener("click",
function(b){b.preventDefault();b.stopPropagation();m=!m;a()},!1);h=n("h6",[b," ",h],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return n("div",[h,d],{})}if("undefined"!==typeof d){var m=d("./cbrowser").Browser;d=d("./utils");var n=d.makeElement,h=d.removeChildren}m.prototype.removeAllPopups=function(){h(this.hPopupHolder);h(this.popupHolder)};m.prototype.makeTooltip=function(h,d){var m=!1,a=this,b=null,q;q=function(a){m=!1;b&&(clearTimeout(b),
b=null);h.removeEventListener("mouseout",q,!1)};var g=function(k){var f=k.clientX+window.scrollX,e=k.clientY+window.scrollY;b||(b=setTimeout(function(){var k;k="function"===typeof d?d():d;var q=n("div",[n("div",null,{className:"tooltip-arrow"}),n("div",k,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(e+20)+"px",left:""+Math.max(f-30,20)+"px"});a.hPopupHolder.appendChild(q);var p;p=function(b){try{a.hPopupHolder.removeChild(q)}catch(e){}window.removeEventListener("mousemove",
p,!1);m&&null!=h.offsetParent&&g(b)};window.addEventListener("mousemove",p,!1);b=null},1E3))};h.addEventListener("mouseover",function(a){m=!0;h.addEventListener("mouseout",q,!1);g(a)},!1);h.addEventListener("DOMNodeRemovedFromDocument",function(a){m=!1;b&&(clearTimeout(b),b=null)},!1)};m.prototype.popit=function(h,d,m,a){var b=this;a||(a={});h||(h={});var q=a.width||200,g;h.clientX?(a=h.clientX,g=h.clientY):(a=500,g=50);a+=document.documentElement.scrollLeft||document.body.scrollLeft;g+=document.documentElement.scrollTop||
document.body.scrollTop;var k=window.innerWidth,f=g,e=Math.min(a-q/2-4,k-q-30),u=n("div");u.className="popover fade "+(h.clientX?"bottom ":"")+"in";u.style.display="block";u.style.position="absolute";u.style.top=""+f+"px";u.style.left=""+e+"px";u.style.width=q+"px";276<q&&(u.style.maxWidth=q+"px");u.appendChild(n("div",null,{className:"arrow"}));if(d){var B=n("button","",{className:"close"});B.innerHTML="&times;";B.addEventListener("mouseover",function(a){B.style.color="red"},!1);B.addEventListener("mouseout",
function(a){B.style.color="black"},!1);B.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();b.removeAllPopups()},!1);h=n("h4",[n("span",d,null,{maxWidth:"200px"}),B],{},{paddingLeft:"10px",paddingRight:"10px"});var p,M,H,L;H=function(a){a.stopPropagation();a.preventDefault();e+=a.clientX-p;8>e&&(e=8);e>k-q-32&&(e=k-q-26);f+=a.clientY-M;f=Math.max(10,f);u.style.top=""+f+"px";u.style.left=""+Math.min(e,k-q-10)+"px";p=a.clientX;M=a.clientY};L=function(a){a.stopPropagation();
a.preventDefault();window.removeEventListener("mousemove",H,!1);window.removeEventListener("mouseup",L,!1)};h.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();p=a.clientX;M=a.clientY;window.addEventListener("mousemove",H,!1);window.addEventListener("mouseup",L,!1)},!1);u.appendChild(h)}u.appendChild(n("div",m,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(u);var P={node:u,displayed:!0};u.addEventListener("DOMNodeRemoved",function(a){a.target==
u&&(P.displayed=!1)},!1);return P};"undefined"!==typeof t&&(t.exports={makeTreeTableSection:p})},{"./cbrowser":6,"./utils":48}],12:[function(d,t,s){function p(d,r){0>d.indexOf("?")&&(d+="?soft=true");return new h(function(h,a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState)if(300<=b.status)a("Error code "+b.status);else{var q=JSON.parse(b.response);h(r?q:q.location)}};b.open("GET",d,!0);b.setRequestHeader("Accept","application/json");b.responseType="text";b.send("")})}
function m(h){this.rawurl=h}function n(h,d,n,a){a||("object"===typeof d?(a=d,d=void 0):a={});this.url="string"===typeof h?new m(h):h;this.start=d||0;n&&(this.end=n);this.opts=a}if("undefined"!==typeof d)var h=d("es6-promise").Promise;m.prototype.getURLPromise=function(){this.urlPromise&&this.urlPromiseValidity>Date.now()||(this.urlPromise=p(this.rawurl,!0).then(function(h){return h.location}),this.urlPromiseValidity=Date.now()+432E5);return this.urlPromise};n.prototype.slice=function(h,d){if(0>h)throw"Bad slice "+
h;var m=this.start,a=this.end,m=m&&h?m+h:h||m;return new n(this.url,m,d&&m?m+d-1:a||d-1,this.opts)};n.prototype.fetchAsText=function(h){var d=this,m=new XMLHttpRequest;d.url.getURLPromise().then(function(a){m.open("GET",a,!0);if(d.end){if(1E8<d.end-d.start)throw"Monster fetch!";m.setRequestHeader("Range","bytes="+d.start+"-"+d.end)}m.onreadystatechange=function(){if(4==m.readyState)return 200==m.status||206==m.status?h(m.responseText):h(null)};d.opts.credentials&&(m.withCredentials=!0);m.send("")}).catch(function(a){console.log(a);
return h(null)})};n.prototype.salted=function(){return this};n.prototype.fetch=function(h,d,m){var a=this;d=d||1;if(3<d)return h(null);a.url.getURLPromise().then(function(b){var q=new XMLHttpRequest,g;q.open("GET",b,!0);q.overrideMimeType("text/plain; charset=x-user-defined");if(a.end){if(1E8<a.end-a.start)throw"Monster fetch!";q.setRequestHeader("Range","bytes="+a.start+"-"+a.end);g=a.end-a.start+1}q.responseType="arraybuffer";q.onreadystatechange=function(){if(4==q.readyState){if(200==q.status||
206==q.status){if(q.response){var b=q.response.byteLength;return!g||g==b||m&&b==m?h(q.response):a.fetch(h,d+1,b)}if(q.mozResponseArrayBuffer)return h(q.mozResponseArrayBuffer);b=q.responseText;if(!g||g==b.length||m&&b.length==m){if(b=q.responseText){for(var f=new Uint8Array(b.length),e=0;e<f.length;++e)f[e]=b.charCodeAt(e);b=f.buffer}else b=null;return h(b)}return a.fetch(h,d+1,b.length)}return a.fetch(h,d+1)}};a.opts.credentials&&(q.withCredentials=!0);q.send("")}).catch(function(a){console.log(a)})};
"undefined"!==typeof t&&(t.exports={lookupEncodeURI:p,EncodeFetchable:n})},{"es6-promise":52}],13:[function(d,t,s){function p(h){this.source=h;this.base=h.uri||"//rest.ensembl.org";if(0===this.base.indexOf("//")){var a=window.location.protocol;"http:"!=a&&"https:"!=a&&(this.base="http:"+this.base)}this.species=h.species||"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof h.type?[h.type]:h.type||["regulatory"]}if("undefined"!==typeof d){var m=d("./sourceadapters").registerSourceAdapterFactory;
d=d("./das");var n=d.DASStylesheet,h=d.DASStyle,x=d.DASFeature,r=d.DASGroup}p.prototype.addActivityListener=function(h){this.activityListeners.push(h)};p.prototype.notifyActivity=function(){for(var h=0;h<this.activityListeners.length;++h)try{this.activityListeners[h](this.busy)}catch(a){console.log(a)}};p.prototype.getStyleSheet=function(d){var a=new n,b=new h;b.glyph="__NONE";0<=this.type.indexOf("exon")&&a.pushStyle({type:"transcript"},null,b);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&
a.pushStyle({type:"gene"},null,b);b=new h;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="red";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=10;a.pushStyle({type:"cds"},null,b);b=new h;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:".+_UTR_variant"},null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"missense_variant"},null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";
b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"splice_.+_variant"},null,b);b=new h;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.FGCOLOR="blue";a.pushStyle({type:"variation",method:"regulatory_region_variant"},null,b);b=new h;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.FGCOLOR="rgb(50,80,255)";b.STROKECOLOR="black";a.pushStyle({type:"variation"},null,b);b=new h;b.glyph="SQUARE";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",
method:".+_UTR_variant"},null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="S";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"missense_variant"},null,b);b=new h;b.glyph="TRIANGLE";b.DIRECTION="N";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"splice_.+_variant"},null,b);b=new h;b.glyph="STAR";b.POINTS=6;b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";a.pushStyle({type:"indel",method:"regulatory_region_variant"},
null,b);b=new h;b.glyph="PLIMSOLL";b.BUMP="yes";b.LABEL="no";b.BGCOLOR="#888888";b.FGCOLOR="red";b.STROKECOLOR="black";a.pushStyle({type:"indel"},null,b);b=new h;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="orange";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;a.pushStyle({type:"default"},null,b);return d(a)};p.prototype.getScales=function(){return[]};p.prototype.fetch=function(h,a,b,q,g,k,f){var e=this;a=this.base+"/overlap/region/"+this.species+"/"+h+":"+a+"-"+b;b=[];for(q=0;q<this.type.length;++q)b.push("feature="+
this.type[q]);b.push("content-type=application/json");a=a+"?"+b.join(";");var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState)if(e.busy--,e.notifyActivity(),300<=d.status){var a="Error code "+d.status;try{var b=JSON.parse(d.response);b.error&&(a=b.error)}catch(g){}f(a,null)}else{for(var a=JSON.parse(d.response),b=[],k=0;k<a.length;++k){var q=a[k],m=[],n=new x;n.segment=h;n.min=q.start|0;n.max=q.end|0;n.type=q.feature_type||"unknown";n.id=q.ID;if(q.Parent){var p=new r;p.id=
q.Parent;n.groups=[p]}q.strand&&(0>q.strand?n.orientation="-":0<q.strand&&(n.orientation="+"));q.consequence_type&&(n.method=q.consequence_type);q.alt_alleles&&(m.push("Alleles="+q.alt_alleles.join("/")),1<q.alt_alleles.length&&(q.alt_alleles[1].length!=q.alt_alleles[0].length||"-"==q.alt_alleles[1])&&(n.type="indel"));0<m.length&&(n.notes=m);b.push(n)}f(null,b)}};e.busy++;e.notifyActivity();d.open("GET",a,!0);d.responseType="text";d.send("")};m("ensembl",function(h){return{features:new p(h)}})},
{"./das":10,"./sourceadapters":34}],14:[function(d,t,s){if("undefined"!==typeof d)var p=d("./cbrowser").Browser,m=d("./utils").shallowCopy,n=d("./sha1").hex_sha1,h=d("./das").copyStylesheet;p.prototype.exportFullConfig=function(h){h={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+n(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(h.prefix=this.prefix);return h};p.prototype.exportChains=function(){var h=
{},d=this.chains||{},m;for(m in d)h[m]=d[m].exportConfig();return h};p.prototype.exportSourceConfig=function(d){d=[];for(var n=0;n<this.tiers.length;++n){var p=this.tiers[n],a=m(p.dasSource);a.noPersist||(a.coords=void 0,a.props=void 0,a.disabled||(a.disabled=void 0),p.config.stylesheet?(a.style=h(p.config.stylesheet).styles,a.stylesheet_uri=void 0):a.style&&(a.style=h({styles:a.style}).styles),"string"===typeof p.config.name&&(a.name=p.config.name),void 0!==p.config.height&&(a.forceHeight=p.config.height),
void 0!==p.config.forceMin&&(a.forceMin=p.config.forceMin),p.config.forceMinDynamic&&(a.forceMinDynamic=p.config.forceMinDynamic),void 0!==p.config.forceMax&&(a.forceMax=p.config.forceMax),void 0!==p.config.bumped&&(a.bumped=p.config.bumped),p.config.forceMaxDynamic&&(a.forceMaxDynamic=p.config.forceMaxDynamic),d.push(a))}return d};p.prototype.exportPageTemplate=function(h){h=h||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+
JSON.stringify(this.exportFullConfig(h),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":33,"./utils":48}],15:[function(d,t,s){if("undefined"!==typeof d)var p=d("./cbrowser").Browser,m=d("./glyphs").OverlayLabelCanvas,n=d("./numformats").formatQuantLabel,h=d("./sequence-draw").drawSeqTierGC;p.prototype.exportImage=function(d){d=d||{};for(var r=this.featurePanelWidth,p=0,a=0;a<this.tiers.length;++a){0<
a&&(p+=3);var b=this.tiers[a];void 0!==b.layoutHeight&&(p+=b.layoutHeight)}var q=d.resolutionMultiplier||1,a=(r+200)*q|0,b=p*q|0,p=makeElement("canvas",null,{width:a,height:b}),g=p.getContext("2d");g.fillStyle="white";g.fillRect(0,0,a,b);g.scale(q,q);for(a=q=0;a<this.tiers.length;++a){var b=this.tiers[a],k=(b.glyphCacheOrigin-this.viewStart)*this.scale,f=new m;g.save();g.translate(0,q);g.save();g.beginPath();g.moveTo(200,0);g.lineTo(200+r,0);g.lineTo(200+r,b.layoutHeight);g.lineTo(200,b.layoutHeight);
g.closePath();g.clip();g.translate(200,0);g.save();g.translate(k,0);b.subtiers?b.paintToContext(g,f,k+1E3):h(b,b.currentSequence,g);g.restore();g.save();g.translate(k,0);f.draw(g,-k,r-k);g.restore();g.restore();for(var f=!1,e=0,u=b.subtiers||[],B=0;B<u.length;++B){var Q=u[B];if(Q.quant){var f=!0,M=Q.quant,H=Q.height,L=2;40<H&&(L=1+(H/20|0));var H=H/(L-1),P=(M.max-M.min)/(L-1);g.beginPath();g.moveTo(205,e);g.lineTo(200,e);g.lineTo(200,e+Q.height);g.lineTo(205,e+Q.height);for(var v=1;v<L-1;++v){var F=
v*H;g.moveTo(200,e+F);g.lineTo(203,e+F)}g.strokeStyle="black";g.strokeWidth=2;g.stroke();g.fillStyle="black";var v=n(M.max),E=e+7;g.fillText(v,197-g.measureText(v).width,E);v=n(M.min);E=e+Q.height;g.fillText(v,197-g.measureText(v).width,E);for(v=1;v<L-1;++v)F=v*H,E=n(1*M.max-v*P),F=e+F+3,g.fillText(E,197-g.measureText(E).width,F)}e+=Q.height+3}e="string"===typeof b.config.name?b.config.name:b.dasSource.name;u=g.measureText(e).width;g.fillStyle="black";g.fillText(e,200-(f?22:12)-u,(b.layoutHeight+
6)/2);g.restore();q+=b.layoutHeight+3}if(d.highlights){g.save();g.beginPath();g.moveTo(200,0);g.lineTo(200+r,0);g.lineTo(200+r,q);g.lineTo(200,q);g.closePath();g.clip();g.translate(200+k,0);k=r=this.viewStart;a=this.viewEnd;for(b=0;b<this.highlights.length;++b)H=this.highlights[b],(H.chr===this.chr||H.chr==="chr"+this.chr)&&H.min<a&&H.max>k&&(g.globalAlpha=this.defaultHighlightAlpha,g.fillStyle=this.defaultHighlightFill,g.fillRect((H.min-r)*this.scale,0,(H.max-H.min)*this.scale,q));g.restore()}r=
-1;"center"==d.ruler?r=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==d.ruler?r=200:"right"==d.ruler&&(r=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=r&&(g.strokeStyle="blue",g.beginPath(),g.moveTo(r,0),g.lineTo(r,q),g.stroke());return p.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":21,"./numformats":26,"./sequence-draw":31}],16:[function(d,t,s){if("undefined"!==typeof d){var p=d("./cbrowser").Browser;d=d("./utils");var m=d.makeElement,n=d.removeChildren}p.prototype.openExportPanel=
function(){var h=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var d=m("div",null,{className:"export-form"}),r=m("select");r.appendChild(m("option","SVG",{value:"svg"}));r.appendChild(m("option","Image",{value:"png"}));r.appendChild(m("option","Dalliance config",{value:"config"}));r.appendChild(m("option","Dalliance sources",{value:"sources"}));r.appendChild(m("option","Dalliance page",{value:"page"}));r.value="svg";r.addEventListener("change",function(a){n(g);B()},
!1);d.appendChild(m("p",["Export as: ",r]));var p=m("input",null,{type:"checkbox",checked:this.exportHighlights});p.addEventListener("change",function(a){h.exportHighlights=p.checked;h.storeStatus()},!1);var a=m("input",null,{type:"checkbox",checked:this.exportRuler});a.addEventListener("change",function(b){h.exportRuler=a.checked;h.storeStatus()},!1);var b=m("input",null,{type:"text",value:"1.0"}),q=m("button","Export",{className:"btn btn-primary"});q.addEventListener("click",function(e){n(g);var f,
k,q,d;if("svg"===r.value)f=URL.createObjectURL(h.makeSVG({highlights:p.checked,ruler:a.checked?h.rulerLocation:"none"})),k="SVG",q="image/svg",d="dalliance-view.svg";else if("png"===r.value){q=parseFloat(b.value);if(0.1>q||10<q){alert("bad scale "+q);return}f=h.exportImage({highlights:p.checked,ruler:a.checked?h.rulerLocation:"none",resolutionMultiplier:q});k="Image";q="image/png";d="dalliance-view.png"}else"config"===r.value?(q=JSON.stringify(h.exportFullConfig(),null,2),k=new Blob([q],{type:"text/plain"}),
f=URL.createObjectURL(k),k="Configuration",q="text/plain",d="dalliance-config.json"):"sources"===r.value?(q=JSON.stringify(h.exportSourceConfig(),null,2),k=new Blob([q],{type:"text/plain"}),f=URL.createObjectURL(k),k="Source array",q="text/plain",d="dalliance-sources.json"):"page"===r.value&&(k=h.exportPageTemplate(),q="text/html",k=new Blob([k],{type:q}),f=URL.createObjectURL(k),k="Page template",d="dalliance-view.html");f&&(e=m("a","[Download]",{href:f,download:d,type:q}),q=m("a","[Preview in browser]",
{href:f,type:q,target:"_new"}),g.appendChild(m("p",[""+k+" created: ",e,q])))},!1);h.addViewListener(function(){n(g)});h.addTierListener(function(){n(g)});var g=m("p",""),k=m("tr",[m("th","Include highlights",{},{width:"200px",textAlign:"right"}),m("td",p)]),f=m("tr",[m("th","Include vertical guideline"),m("td",a)]),e=m("tr",[m("th","Scale multiplier"),m("td",b)]),u=m("table",[k,f,e]),B=function(){var a=r.value;k.style.display="svg"==a||"png"==a?"table-row":"none";f.style.display="svg"==a||"png"==
a?"table-row":"none";e.style.display="png"==a?"table-row":"none"};B();d.appendChild(u);d.appendChild(q);d.appendChild(g);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(d,this.svgHolder);this.activeToolPanel=d;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":48}],17:[function(d,t,s){t=d("./cbrowser");s=d("./chainset");var p=d("./sourceadapters"),m=d("./utils");d=d("./das");window.Browser=t.Browser;window.sourcesAreEqual=t.sourcesAreEqual;window.Chainset=s.Chainset;
window.makeElement=m.makeElement;window.dalliance_registerSourceAdapterFactory=p.registerSourceAdapterFactory;window.dalliance_registerParserFactory=p.registerParserFactory;window.dalliance_makeParser=p.makeParser;window.DASSequence=d.DASSequence;window.DASFeature=d.DASFeature;window.DASGroup=d.DASGroup;window.DASStylesheet=d.DASStylesheet;window.DASStyle=d.DASStyle;window.DASSource=d.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":34,"./utils":48}],18:[function(d,t,s){function p(){this.glyphs=
[];this.height=0;this.quant=null}function m(c){Date.now();X=c.viewport.getContext("2d");b(c);c.padding="number"===typeof c.dasSource.padding?c.dasSource.padding:ca;var e=[],l={},f={},g;for(g in c.ungroupedFeatures)for(var k=c.ungroupedFeatures[g],q=0;q<k.length;++q){var d=k[q];if(!d.parts){var w=c.styleForFeature(d);if(w)if("LINEPLOT"==w.glyph)a(l,w.id,d),f[w.id]=w;else{var u=h(d,0,w,c);u&&e.push(u)}}}for(var m in l)g=l[m],w=f[m],"LINEPLOT"==w.glyph&&e.push(x(g,w,c));if(c.dasSource.collapseSuperGroups&&
!c.bumped)for(var r in c.superGroups){l=c.superGroups[r];c.groups[r]=z(c.groups[r]);c.groups[r].isSuperGroup=!0;f={};m=1E10;k=-1E10;q=null;for(u=0;u<l.length;++u)if(g=c.groupedFeatures[l[u]]){for(w=0;w<g.length;++w)d=g[w],a(f,d.type,d),m=Math.min(d.min,m),k=Math.max(d.max,k),d.segment&&!q&&(q=d.segment);if(c.groups[r]&&!c.groups[r].links||0==c.groups[r].links.length)c.groups[r].links=c.groups[l[0]].links;delete c.groupedFeatures[l[u]]}c.groups[r].max=k;c.groups[r].min=m;c.groups[r].segment=q;for(var G in f){g=
f[G];m=g[0];k=null;for(w=0;w<g.length;++w)d=g[w],d=new S(d.min,d.max),k=k?K(k,d):d;k=k.ranges();for(q=0;q<k.length;++q){for(var C=k[q],y=((C.max()|0)-(C.min()|0)+1)*l.length,B=0,w=0;w<g.length;++w)if(d=g[w],(d.min|0)<=C.max()&&(d.max|0)>=C.min())var v=Math.max(d.min|0,C.min()),d=Math.min(d.max|0,C.max()),B=B+(d-v+1);var d=new R,A;for(A in m)d[A]=m[A];d.min=C.min();d.max=C.max();d.label&&1<l.length&&(d.label+=" ("+l.length+" vars)");d.visualWeight=1*B/y;a(c.groupedFeatures,r,d)}}delete c.superGroups[r]}A=
[];for(var I in c.groupedFeatures)A.push(I);A.sort(function(a,b){var e=c.groupedFeatures[a][0].score-c.groupedFeatures[b][0].score;return 0<e?-1:0==e?0:1});G={};for(d=0;d<A.length;++d)if(I=A[d],u=n(c.groupedFeatures[I],0,c.groups[I],c,c.dasSource.collapseSuperGroups&&!c.bumped?"collapsed_gene":"tent"))u.group=c.groups[I],G[I]=u;for(r in c.superGroups){l=c.superGroups[r];I=[];m=1E10;k=-1E10;for(A=0;A<l.length;++A)d=G[l[A]],G[l[A]]=null,d&&(I.push(d),m=Math.min(m,d.min()),k=Math.max(k,d.max()));for(A=
0;A<I.length;++A)d=I[A],e.push(new M(d,m,k))}for(u in G)(d=G[u])&&e.push(d);r=new p;I=[];G=c.subtierMax||c.dasSource.subtierMax||c.browser.defaultSubtierMax;A=!1;d=0;a:for(;d<e.length;++d)if(u=e[d],u.bump&&(c.bumped||c.dasSource.collapseSuperGroups)){for(l=0;l<I.length;++l)if(f=I[l],f.hasSpaceFor(u)){f.add(u);continue a}I.length>=G?A=!0:(f=new p,f.add(u),I.push(f))}else r.add(u);0<r.glyphs.length&&(I=[r].concat(I));for(l=0;l<I.length;++l)f=I[l],f.quant&&f.glyphs.unshift(new D(f.height));for(l=0;l<
I.length;++l)f=I[l],f.glyphs.sort(function(a,c){return(a.zindex||0)-(c.zindex||0)});c.subtiers=I;c.glyphCacheOrigin=c.browser.viewStart;A?c.updateStatus("Bumping limit exceeded, use the track editor to see more features"):c.updateStatus()}function n(a,c,b,e,l){l=e.styleForFeature(b);var k,d=!1,q=[];c=null;for(var w=0;w<a.length;++w){var u=a[w];u.orientation&&null==c&&(c=u.orientation);!k&&u.label&&(k=u.label);var m=e.styleForFeature(u);m&&!u.parts&&(V(m.LABEL)&&(d=!0),(u=h(u,0,m,e,null,!0))&&q.push(u))}if(0==
q.length)return null;a="flat";l&&"LINE"===l.glyph||(e.dasSource.collapseSuperGroups&&!e.bumped?"+"===c?a="collapsed+":"-"===c&&(a="collapsed-"):"+"===c?a="hat+":"-"===c&&(a="hat-"));e=null;if(k&&d||l&&(V(l.LABEL)||V(l.LABELS)))e=b.label||k;b=new g(q,a);e&&("+"===c?e=">"+e:"-"===c&&(e="<"+e),b=new f(X,b,e,!1));b.bump=!0;return b}function h(a,b,l,k,d,h){function m(a,c,b){var l=null;if(a.currentSequence){var e=a.currentSequence.start|0,f=a.currentSequence.end|0;if(e<=b&&f>=c){for(var g=Math.max(c,e),
f=Math.min(b,f),l=a.currentSequence.seq.substr(g-e,f-g+1);c<g;)l="N"+l,g--;for(;b>f;)l+="N",f++}}return l}var r=k.browser.scale,n=k.browser.viewStart,p=l.glyph||"BOX",z=a.min,D=a.max,s=a.orientation,K=a.score,N=a.label||a.id,x=(z-n)*r,S=Math.max((D-n+1)*r,x+1),R=k.forceHeight||l.HEIGHT||d||12,t=R*=1,n=l.BUMP&&V(l.BUMP),T;if("CROSS"===p||"EX"===p||"TRIANGLE"===p||"DOT"===p||"SQUARE"===p||"STAR"===p||"PLIMSOLL"===p){var W=l.FGCOLOR||"black",O=l.BGCOLOR||"none",z=l.STROKECOLOR;l.BGITEM&&a.itemRgb?W=
a.itemRgb:V(l.COLOR_BY_SCORE2)&&(r=l.BGGRAD||l._gradient,r||(r=G(50,l.COLOR1,l.COLOR2,l.COLOR3),l._gradient=r),R=a.score2,void 0==R&&W||(t=l.MIN2?1*l.MIN2:0,D=(1*(R||0)-t)/((l.MAX2?1*l.MAX2:1)-t)*r.length|0,0>D&&(D=0),D>=r.length&&(D=r.length-1),W=r[D]));R=k.forceHeight||l.HEIGHT||d||12;t=R*=1;D=l.SIZE||R;l.RSIZE&&(D=1*l.RSIZE*R);l.STROKETHRESHOLD&&D<1*l.STROKETHRESHOLD&&(z=null);D*=1;R=(x+S)/2;r=D/2;"EX"===p?z=new u(R,D,W):"TRIANGLE"===p?z=new B(R,D,l.DIRECTION||"N",l.LINEWIDTH||D,W,z):"DOT"===p?
z=new Q(R,D,W,z):"PLIMSOLL"===p?z=new J(R,D,0.2*D,W,z):"SQUARE"===p?z=new q(R-r,0,D,D,W,z):"STAR"===p?(p=5,l.POINTS&&(p=l.POINTS|0),z=new A(R,r,p,W,z)):z=new e(R,D,W);O&&"none"!=O&&5<S-x&&(x=new q(x,0,S-x,D,O),z=new g([x,z]));if(V(l.SCATTER)){O=k.quantMin(l);(D=k.quantMax(l))||(D=0>O?0:10);O||(O=0);k=(1*K-O)/(D-O);K=-1*O/(D-O);if(0>k||1<k)return null;k>=K?(R=Math.max(1,(k-K)*t),b=b+(1-K)*t-R):(R=Math.max(1,(k-K)*t),b+=(1-K)*t);T={min:O,max:D};x=0;S="undefined"!==typeof a.forceLabel?a.forceLabel:l.LABEL;
Z(S)&&N&&!h&&(z=new f(X,z,N,!0,null,"above"==S?"above":"below"),"above"==S&&(x=z.textHeight+2),h=!0);z=new I(z,0,b-r-x,t)}}else if("HISTOGRAM"===p||"GRADIENT"===p&&"undefined"!==K)O=k.quantMin(l),(D=k.quantMax(l))||(D=0>O?0:10),O||(O=0),1*K<1*O&&(K=O),1*K>1*D&&(K=D),k=(1*K-O)/(D-O),K=-1*O/(D-O),"HISTOGRAM"===p&&(k>=K?(R=(k-Math.max(0,K))*t,b=b+(1-Math.max(0,K))*t-R):(R=(Math.max(0,K)-k)*t,b+=(1-Math.max(0,K))*t),T={min:O,max:D}),W=l.FGCOLOR||null,O=l.BGCOLOR||l.COLOR1||"green",l.BGITEM&&a.itemRgb&&
(O=a.itemRgb),K=l.ALPHA?1*l.ALPHA:null,l.BGGRAD&&(r=l.BGGRAD,D=k*r.length|0,0>D&&(D=0),D>=r.length&&(D=r.length-1),O=r[D]),l.COLOR2&&(r=l._gradient,r||(r=G(50,l.COLOR1,l.COLOR2,l.COLOR3),l._gradient=r),D=k*r.length|0,0>D&&(D=0),D>=r.length&&(D=r.length-1),O=r[D]),z=new q(x,b,S-x,R,O,W,K),z=new I(z,0,0,t);else if("HIDDEN"===p)z=new M(null,x,S),h=!0;else if("ARROW"===p)k=l.FGCOLOR||"purple",b=V(l.PARALLEL),t=V(l.SOUTHWEST),K=V(l.NORTHEAST),z=new F(x,S,R,k,b,t,K);else if("ANCHORED_ARROW"===p)W=l.FGCOLOR||
"none",O=l.BGCOLOR||"green",z=new H(x,S,R,O,W,s),z.bump=!0;else if("SPAN"===p)W=l.FGCOLOR||"black",z=new L(x,S,R,W);else if("LINE"===p)W=l.FGCOLOR||"black",z=new P(x,S,R,l.STYLE||"solid",s,W);else if("PRIMERS"===p)W=l.FGCOLOR||"black",O=l.BGCOLOR||"red",z=new v(x,S,R,O,W);else if("TEXT"===p)k=l.STRING||"text",O=l.FGCOLOR||"black",z=new c(X,x,S,R,O,k);else if("TOOMANY"===p)W=l.FGCOLOR||"gray",O=l.BGCOLOR||"orange",z=new E(x,S,R,O,W);else if("POINT"===p)R=k.forceHeight||l.HEIGHT||30,O=k.quantMin(l),
D=k.quantMax(l),k=(1*K-O)/(D-O),b=1*R/(D-O)*(K-1*O)|0,T={min:O,max:D},O=l.FGCOLOR||l.COLOR1||"black",l.COLOR2&&(r=l._gradient,r||(r=G(50,l.COLOR1,l.COLOR2,l.COLOR3),l._gradient=r),D=k*r.length|0,0>D&&(D=0),D>=r.length&&(D=r.length-1),O=r[D]),z=new y((x+S)/2,R-b,R,O);else if("__SEQUENCE"===p){K=p=a.seq;O=W=a.quals;b=V(l.__INSERTIONS);t=[];if(a.cigar){d=ja(a.cigar);for(var O=K="",ca=s=0;ca<d.length;++ca){var aa=d[ca];if("M"==aa.op)K+=p.substr(s,aa.cnt),O+=W.substr(s,aa.cnt),s+=aa.cnt;else if("D"==aa.op)for(var ia=
0;ia<aa.cnt;++ia)K+="-",O+="Z";else if("I"==aa.op){var ba=p.substr(s,aa.cnt),ia=new B(x+K.length*r,5,"S",5,k.browser.baseColors.I);b&&(ia=new f(X,ia,ba,!1,"center","above","7px sans-serif"));ia.feature={label:"Insertion: "+ba,type:"insertion",method:"insertion"};t.push(ia);s+=aa.cnt}else"S"==aa.op?s+=aa.cnt:console.log("unknown cigop"+aa.op)}}r=m(k,z,D);if(K&&r&&("mismatch"===l.__SEQCOLOR||"mismatch-all"===l.__SEQCOLOR)){z=[];D="-"===a.orientation?",":".";for(p=0;p<K.length;++p)z.push(K[p]==r[p]?
D:K[p]);K=z.join("")}z="-"===a.orientation?l._minusColor||"lightskyblue":l._plusColor||"lightsalmon";l.__disableQuals&&(O=!1);z=new w(k.browser.baseColors,z,x,S,R,K,r,l.__SEQCOLOR,O,!V(l.__CLEARBG));b&&(z=new I(z,0,7));0<t.length&&(t.splice(0,0,z),z=new g(t))}else if("__INSERTION"===p)ia=new B(x,5,"S",5,k.browser.baseColors.I),z=new f(X,ia,a.insertion||a.altAlleles[0],!1,"center","above","7px sans-serif"),1<S-x&&(O=l.BGCOLOR||l.COLOR1||"green",x=new q(x,5,S-x,R,O,W),z=new g([x,z]));else{if("__NONE"===
p)return null;W=l.FGCOLOR||null;O=l.BGCOLOR||l.COLOR1||"green";l.BGITEM&&a.itemRgb&&(O=a.itemRgb);r=(S-x)/(D-z);"translation"==a.type&&("protein_coding"==a.method||a.readframeExplicit)&&(!a.tags||0>a.tags.indexOf("cds_start_NF")||a.readframeExplicit)&&(!k.dasSource.collapseSuperGroups||k.bumped)&&0.5<=r?(r=m(k,z,D),z=new C(x,S,R,O,r,a.orientation,a.readframe)):z=new q(x,0,S-x,R,O,W)}(V(l.LABEL)||a.forceLabel)&&N&&!h&&(z=new f(X,z,N,!1));n&&(z.bump=!0);z.feature=a;T&&(z.quant=T);l.ZINDEX&&(z.zindex=
l.ZINDEX|0);return z}function x(a,c,b){var l=b.browser.viewStart,e=b.browser.scale,f=b.forceHeight||c.HEIGHT||30,g=b.quantMin(c);b=b.quantMax(c);for(var d=1*f/(b-g),h=c.FGCOLOR||c.COLOR1||"black",q=[],w=0;w<a.length;++w){var u=a[w],r=f-((u.score-1*g)*d|0);q.push((((u.min|0)+(u.max|0))/2-l)*e);q.push(r)}a=new k(q,h,f);a.quant={min:g,max:b};c.ZINDEX&&(a.zindex=c.ZINDEX|0);return a}if("undefined"!==typeof d){var r=d("./utils"),z=r.shallowCopy,a=r.pusho,r=d("./tier").DasTier,b=d("./features").sortFeatures;
s=d("./glyphs");var q=s.BoxGlyph,g=s.GroupGlyph,k=s.LineGraphGlyph,f=s.LabelledGlyph,e=s.CrossGlyph,u=s.ExGlyph,B=s.TriangleGlyph,Q=s.DotGlyph,M=s.PaddedGlyph,H=s.AArrowGlyph,L=s.SpanGlyph,P=s.LineGlyph,v=s.PrimersGlyph,F=s.ArrowGlyph,E=s.TooManyGlyph,c=s.TextGlyph,w=s.SequenceGlyph,C=s.AminoAcidGlyph,I=s.TranslatedGlyph,y=s.PointGlyph,D=s.GridGlyph,A=s.StarGlyph,J=s.PlimsollGlyph,l=s.OverlayLabelCanvas,G=d("./color").makeGradient;s=d("./spans");var S=s.Range,K=s.union;s=d("./das");var R=s.DASFeature,
V=s.isDasBooleanTrue,Z=s.isDasBooleanNotFalse,ja=d("./cigar").parseCigar,T=d("./numformats").formatQuantLabel}var ca=3;p.prototype.indexFor=function(a){a=a.min();for(var c=0,b=this.glyphs.length;b>c;){var l=(c+b)/2|0;if(l>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[l].min()?b=l:c=l+1}return b};p.prototype.add=function(a){var c=this.indexFor(a);this.glyphs.splice(c,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};p.prototype.hasSpaceFor=
function(a){var c=this.indexFor(a);return 0<c&&this.glyphs[c-1].max()>=a.min()||c<this.glyphs.length&&this.glyphs[c].min()<=a.max()?!1:!0};var X;r.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,c=this.subtiers;if(c){var b=this.browser.featurePanelWidth+2E3;a&&(b*=2);var e=this.viewport.width|0;e<b-50&&(this.viewport.width=e=b);for(var b=this.padding,f=0;f<c.length;++f)b=b+c[f].height+this.padding;f=b=Math.max(b+6,this.browser.minTierHeight);a&&(f*=2);f!=this.viewport.height&&
(this.viewport.height=f);Math.max(b,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+e/2+"px":""+e+"px";this.viewport.style.height=""+b+"px";this.layoutHeight=Math.max(b,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;c=this.viewport.getContext("2d");c.clearRect(0,0,e,f);c.save();a&&c.scale(2,2);e=this.browser.viewStart-1E3/this.browser.scale;f=this.browser.viewEnd+1E3/this.browser.scale;a=[];if(this.knownCoverage)for(var g=
this.knownCoverage.ranges(),k=0;k<g.length;++k){var d=g[k];0==k?d.min()>e&&a.push({min:e,max:d.min()-1}):a.push({min:g[k-1].max()+1,max:d.min()-1});k==g.length-1&&d.max()<f&&a.push({min:d.max()+1,max:f})}if(0<a.length)for(c.fillStyle="gray",e=0;e<a.length;++e)f=a[e],g=(f.min-this.browser.viewStart)*this.browser.scale+1E3,c.fillRect(g,0,(f.max-this.browser.viewStart)*this.browser.scale+1E3-g,b);b=new l;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;c.translate(a,this.padding);
b.translate(0,this.padding);this.paintToContext(c,b,a);this.overlayLabelCanvas=0<b.glyphs.length?b:null;c.restore();this.drawOverlay();this.paintQuant()}};r.prototype.paintToContext=function(a,c,b){var l=this.subtiers,e=this.viewport.width|0;a.save();for(var f=0;f<l.length;++f){for(var g=null,k=l[f].glyphs,d=0;d<k.length;++d){var h=k[d];h.min()<e-b&&h.max()>-b&&(h=k[d],h.draw(a,c),h.quant&&(g=h.quant))}a.translate(0,l[f].height+this.padding);c.translate(0,l[f].height+this.padding)}a.restore();g&&
this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(c=l[0].height*(1-(this.quantLeapThreshold-g.min)/(g.max-g.min)),a.save(),a.strokeStyle="red",a.lineWidth=0.3,a.beginPath(),a.moveTo(-1E3,c),a.lineTo(e+1E3,c),a.stroke(),a.restore())};r.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,c;this.subtiers&&0<this.subtiers.length&&(c=this.subtiers[0].quant);if(c){var b=this.subtiers[0].height;
this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var l=this.quantOverlay.getContext("2d");a&&l.scale(2,2);a=2;40<b&&(a=1+(b/20|0));var e=(b+2*this.padding)/(a-1),f=(c.max-c.min)/(a-1);l.fillStyle="white";l.globalAlpha=0.6;"right"==this.browser.rulerLocation?l.fillRect(20,0,30,b+2*this.padding):l.fillRect(0,
0,30,b+2*this.padding);l.globalAlpha=1;l.strokeStyle="black";l.lineWidth=1;l.beginPath();if("right"==this.browser.rulerLocation){l.moveTo(42,this.padding);l.lineTo(50,this.padding);l.lineTo(50,b+this.padding);l.lineTo(42,b+this.padding);for(var g=1;g<a-1;++g){var k=g*e;l.moveTo(50,k);l.lineTo(45,k)}}else for(l.moveTo(8,this.padding),l.lineTo(0,this.padding),l.lineTo(0,b+this.padding),l.lineTo(8,b+this.padding),g=1;g<a-1;++g)k=g*e,l.moveTo(0,k),l.lineTo(5,k);l.stroke();l.fillStyle="black";if("right"==
this.browser.rulerLocation)for(l.textAlign="right",l.fillText(T(c.max),41,8),l.fillText(T(c.min),41,b+this.padding),g=1;g<a-1;++g)k=g*e,l.fillText(T(1*c.max-g*f),41,k+3);else for(l.textAlign="left",l.fillText(T(c.max),9,8),l.fillText(T(c.min),9,b+this.padding),g=1;g<a-1;++g)k=g*e,l.fillText(T(1*c.max-g*f),9,k+3)}else this.quantOverlay.style.display="none"}};r.prototype.styleForFeature=function(a){var c=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;for(var b=null,l=this.stylesheet.styles,
e=0;e<l.length;++e){var f=l[e];if(!(f.zoom&&f.zoom!=c||f.orientation&&f.orientation!=a.orientation)){var g=f._labelRE;g&&g.test||(g=new RegExp("^"+f.label+"$"),f._labelRE=g);if(!f.label||g.test(a.label))if(g=f._methodRE,g&&g.test||(g=new RegExp("^"+f.method+"$"),f._methodRE=g),!f.method||g.test(a.method)){if(f.type)if("default"==f.type){b||(b=f.style);continue}else if(g=f._typeRE,g&&g.test||(g=new RegExp("^"+f.type+"$"),f._typeRE=g),!g.test(a.type))continue;return f.style}}}return b};r.prototype.quantMin=
function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};r.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof t&&(t.exports={drawFeatureTier:m})},{"./cigar":8,"./color":9,"./das":10,"./features":20,"./glyphs":21,"./numformats":26,"./spans":35,"./tier":44,
"./utils":48}],19:[function(d,t,s){function p(a,b,d){var g=h(d.type,b.type),k=h(d.label,b.label,d.id,b.id);k&&0!=k.indexOf("__dazzle")&&(g=g+": "+k);this.hit=a;this.feature=b;this.group=d;this.title=g;this.sections=[]}function m(a,b){var d=[];if(a)for(var g=0;g<a.length;++g)x(d,a[g]);if(b)for(g=0;g<b.length;++g)x(d,b[g]);return d}if("undefined"!==typeof d){var n=d("./cbrowser").Browser;d=d("./utils");var h=d.pick,x=d.pushnew,r=d.makeElement}var z=/^([A-Za-z_-]+)=(.+)/;n.prototype.addFeatureInfoPlugin=
function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};p.prototype.setTitle=function(a){this.title=a};p.prototype.add=function(a,b){"string"===typeof b&&(b=r("span",b));this.sections.push({label:a,info:b})};n.prototype.featurePopup=function(a,b,d,g){var k=d.length;b=0<=--k?d[k]:{};var f=0<=--k?d[k]:{};d=new p(d,b,f);d.tier=g;for(var k=this.featureInfoPlugins||[],e=0;e<k.length;++e)try{k[e](b,d)}catch(h){console.log(h.stack||h)}k=g.featureInfoPlugins||[];
for(e=0;e<k.length;++e)try{k[e](b,d)}catch(n){console.log(n.stack||n)}this.removeAllPopups();g=r("table",null,{className:"table table-striped table-condensed"});g.style.width="100%";g.style.margin="0px";k=0;b.method&&(e=r("tr",[r("th","Method"),r("td",b.method)]),g.appendChild(e),++k);e=f.segment?f:b;e=r("tr",[r("th","Location"),r("td",e.segment+":"+e.min+"-"+e.max,{},{minWidth:"200px"})]);g.appendChild(e);++k;void 0===b.score||null===b.score||"-"==b.score||b.suppressScore||(e=r("tr",[r("th","Score"),
r("td",""+b.score)]),g.appendChild(e),++k);(e=m(f.links,b.links))&&0<e.length&&(e=r("tr",[r("th","Links"),r("td",e.map(function(a){return r("div",r("a",a.desc,{href:a.uri,target:"_new"}))}))]),g.appendChild(e),++k);b=m(f.notes,b.notes);for(f=0;f<b.length;++f){var e="Note",x=b[f],M=x.match(z);M&&(e=M[1],x=M[2]);e=r("tr",[r("th",e),r("td",x)]);g.appendChild(e);++k}for(b=0;b<d.sections.length;++b)k=d.sections[b],g.appendChild(r("tr",[r("th",k.label),r("td",k.info)]));this.popit(a,d.title||"Feature",
g,{width:450})}},{"./cbrowser":6,"./utils":48}],20:[function(d,t,s){function p(d){for(var p=d.browser.drawnStart,r=d.browser.drawnEnd,z={},a={},b={},q={},g={},k={},f={},e={},u=[],B,Q,M,H=function(){M={};for(var a=0;a<d.currentFeatures.length;++a){var c=d.currentFeatures[a];c.id&&(M[c.id]=c)}},L=function(a){var c=[];if(a.parents)for(var b=0;b<a.parents.length;++b){var e=a.parents[b],f=M[e];f&&"SO:0000704"==f.typeCv&&pushnew(c,e)}return c},P=0;P<d.currentFeatures.length;++P){var v=d.currentFeatures[P];
if(!v.parts){var F=v.min<=r&&v.max>=p;if(v.min&&v.max){if(v.score&&"."!=v.score&&"-"!=v.score){var s=1*v.score;if(!B||s<B)B=s;if(!Q||s>Q)Q=s}var s=[],c=null;if(v.groups)for(var w=0;w<v.groups.length;++w){var C=v.groups[w],I=C.id;if("gene"==C.type)c=I,k[I]=C;else if("translation"!=C.type){m(a,I,v);k[I]=C;s.push(I);C=q[I];if(!C||v.min<C)q[I]=v.min;C=g[I];if(!C||v.max>C)g[I]=v.max}}if(v.parents)for(M||H(),w=0;w<v.parents.length;++w){var y=v.parents[w],D=M[y];if(D){D.parts||(D.parts=[v]);n(a,y,D);m(a,
y,v);k[y]||(k[y]={type:D.type,id:D.id,label:D.label||D.id});s.push(y);C=q[y];if(!C||v.min<C)q[y]=v.min;C=g[y];if(!C||v.max>C)g[y]=v.max;C=L(D);0<C.length&&(c=C[0],y=M[C[0]],k[C[0]]={type:y.type,id:y.id,label:y.label||y.id},d.dasSource.collapseSuperGroups||(d.dasSource.collapseSuperGroups=!0))}}if(0==s.length)F&&m(z,v.type,v);else if(c)for(C=0;C<s.length;++C)I=s[C],n(f,c,I),e[I]=c}else u.push(v)}}for(I in a)u=k[I],"number"!==typeof u.min&&(u.min=q[I]),"number"!==typeof u.max&&(u.max=g[I]),g[I]>=p&&
q[I]<=r&&(b[I]=a[I]);d.ungroupedFeatures=z;d.groupedFeatures=b;d.groups=k;d.superGroups=f;d.groupsToSupers=e;B&&(0<B?B=0:0>Q&&(Q=0),d.currentFeaturesMinScore=B,d.currentFeaturesMaxScore=Q)}if("undefined"!==typeof d){d=d("./utils");var m=d.pusho,n=d.pushnewo}"undefined"!==typeof t&&(t.exports={sortFeatures:p})},{"./utils":48}],21:[function(d,t,s){function p(a,c){this._stroke=a;this._fill=c}function m(a,c,b,e,f,g,k,d){this.x=a;this.y=c;this._width=b;this._height=e;this.fill=f;this.stroke=g;this._alpha=
k;this._radius=d||0}function n(a,c){this.glyphs=a;this.connector=c;this.h=a[0].height();for(var b=[],e=0;e<a.length;++e){var f=a[e];b.push(new I(f.min(),f.max()));this.h=Math.max(this.h,f.height())}this.coverage=C(b)}function h(a,c,b){this.points=a;this.color=c;this._height=b||50}function x(a,c,b,e,f,g,k){this.glyph=c;this.text=b;this.anchor=f||"left";this.align=g||"below";k&&(this.font=k);this.font&&(a.save(),a.font=this.font);b=a.measureText(b);this.font&&a.restore();this.textLen=b.width;this.textHeight=
5;this.bump=c.bump;this.measured=!e}function r(a,c,b){this._x=a;this._height=c;this._stroke=b}function z(a,c,b){this._x=a;this._height=c;this._stroke=b}function a(a,c,b,e,f,g){p.call(this,g,f);this._x=a;this._height=c;this._dir=b;this._width=e}function b(a,c,b,e){this._x=a;this._height=c;this._fill=b;this._stroke=e}function q(a,c,b){this.glyph=a;this._min=c;this._max=b;a&&(this.bump=a.bump)}function g(a,c,b,e,f,g){p.call(this,f,e);this._min=a;this._max=c;this._height=b;this._ori=g}function k(a,c,
b,e){p.call(this,e,null);this._min=a;this._max=c;this._height=b}function f(a,c,b,e,f,g){this._min=a;this._max=c;this._height=b;this._style=e;this._strand=f;this._stroke=g}function e(a,c,b,e,f){this._min=a;this._max=c;this._height=b;this._fill=e;this._stroke=f}function u(a,c,b,e,f,g,k){p.call(this,null,e);this._min=a;this._max=c;this._height=b;this._color=e;this._parallel=f;this._sw=g;this._ne=k}function B(a,c,b,e,f){this._min=a;this._max=c;this._height=b;this._fill=e;this._stroke=f}function Q(a,c,
b,e,f,g){this._min=c;this._max=b;this._height=e;this._fill=f;this._string=g;this._textLen=a.measureText(g).width}function M(a,c,b){var e={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[b.toLowerCase()];b=e?[b,e]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":b[c%2]}function H(a){var c={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var b=[],e=0;e<a.length;++e){var f=a.substr(e,1).toUpperCase();b.push(f in c?c[f]:
"N")}return b.join("")}function L(a,c,b,e,f,g,k){this._min=a;this._max=c;this._height=b;this._fill=e;this._seq=f;this._orientation=g;this._readframe=k}function P(a,c,b,e){this.glyph=a;this._height=e;this._x=c;this._y=b}function v(a,c,b,e){this._x=a;this._y=c;this._height=b;this._fill=e}function F(a){this._height=a||50}function E(a,c,b,e,f){p.call(this,f,e);this._x=a;this._r=c;this._points=b}function c(a,c,b,e,f){this._x=a;this._height=c;this._overhang=b;this._fill=e;this._stroke=f;this._hh=c/2}function w(){this.oy=
this.ox=0;this.glyphs=[]}if("undefined"!==typeof d){s=d("./spans");var C=s.union,I=s.Range;s=d("./utils");var y=s.makeElementNS,D=s.AMINO_ACID_TRANSLATION;d=d("./svg-utils");var A=d.NS_SVG,J=d.SVGPath}p.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};p.prototype.toSVG=function(){var a=new J;this.drawPath(a);return y(A,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||
"none"})};p.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};m.prototype.draw=function(a){var c=this._radius;0<c?(a.beginPath(),a.moveTo(this.x+c,this.y),a.lineTo(this.x+this._width-c,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+c,c),a.lineTo(this.x+this._width,this.y+this._height-c),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-c,this.y+this._height,c),a.lineTo(this.x+c,this.y+this._height),a.arcTo(this.x,this.y+
this._height,this.x,this.y+this._height-c,c),a.lineTo(this.x,this.y+c),a.arcTo(this.x,this.y,this.x+c,this.y,c),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,
this.y,this._width,this._height)));null!=this._alpha&&a.restore()};m.prototype.toSVG=function(){var a=y(A,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};m.prototype.min=function(){return this.x};m.prototype.max=function(){return this.x+this._width};m.prototype.height=function(){return this.y+this._height};n.prototype.drawConnectors=function(a){for(var c=
this.coverage.ranges(),b=1;b<c.length;++b){var e=c[b],f=c[b-1];if(f&&e.min()>f.max()){var f=f.max(),e=e.min(),g=(f+e)/2;"hat+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(g,0),a.lineTo(e,this.h/2)):"hat-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(g,this.h),a.lineTo(e,this.h/2)):"collapsed+"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(e,this.h/2),4<e-f&&(a.moveTo(g-2,this.h/2-3),a.lineTo(g+2,this.h/2),a.lineTo(g-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(f,this.h/2),a.lineTo(e,
this.h/2),4<e-f&&(a.moveTo(g+2,this.h/2-3),a.lineTo(g-2,this.h/2),a.lineTo(g+2,this.h/2+3))):(a.moveTo(f,this.h/2),a.lineTo(e,this.h/2))}}};n.prototype.draw=function(a,c){for(var b=0;b<this.glyphs.length;++b)this.glyphs[b].draw(a,c);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};n.prototype.toSVG=function(){for(var a=y(A,"g"),c=0;c<this.glyphs.length;++c)a.appendChild(this.glyphs[c].toSVG());c=new J;this.drawConnectors(c);0<c.toPathData().length&&(c=y(A,"path",null,{d:c.toPathData(),
fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(c));return a};n.prototype.min=function(){return this.coverage.min()};n.prototype.max=function(){return this.coverage.max()};n.prototype.height=function(){return this.h};h.prototype.min=function(){return this.points[0]};h.prototype.max=function(){return this.points[this.points.length-2]};h.prototype.height=function(){return this._height};h.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var c=0;c<
this.points.length;c+=2){var b=this.points[c],e=this.points[c+1];0==c?a.moveTo(b,e):a.lineTo(b,e)}a.stroke();a.restore()};h.prototype.toSVG=function(){for(var a=new J,c=0;c<this.points.length;c+=2){var b=this.points[c],e=this.points[c+1];0==c?a.moveTo(b,e):a.lineTo(b,e)}return y(A,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};x.prototype.toSVG=function(){var a=this.glyph.toSVG(),c={};"above"==this.align?(a=y(A,"g",a,{transform:"translate(0, "+(this.textHeight|2)+
")"}),c.y=this.textHeight):c.y=this.glyph.height()+15;this.font&&(c.fontSize=7);c.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return y(A,"g",[a,y(A,"text",this.text,c)])};x.prototype.min=function(){return this.glyph.min()};x.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};x.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+
2):a+20);return a};x.prototype.draw=function(a,c){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();c.registerGlyph(this)};x.prototype.drawOverlay=function(a,c,b){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?b=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(b=this.glyph.min(),b<c&&(b=Math.min(c,this.glyph.max()-this.textLen)));a.fillText(this.text,b,"above"==this.align?this.textHeight:this.glyph.height()+
15);this.font&&a.restore()};r.prototype.draw=function(a){var c=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-c,c);a.lineTo(this._x+c,c);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};r.prototype.toSVG=function(){var a=this._height/2,c=new J;c.moveTo(this._x,0);c.lineTo(this._x,this._height);c.moveTo(this._x-a,a);c.lineTo(this._x+a,a);return y(A,"path",null,{d:c.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};r.prototype.min=
function(){return this._x-this._height/2};r.prototype.max=function(){return this._x+this._height/2};r.prototype.height=function(){return this._height};z.prototype.draw=function(a){var c=this._height/2;a.beginPath();a.moveTo(this._x-c,0);a.lineTo(this._x+c,this._height);a.moveTo(this._x-c,this._height);a.lineTo(this._x+c,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};z.prototype.toSVG=function(){var a=this._height/2,c=new J;c.moveTo(this._x-a,0);c.lineTo(this._x+a,this._height);c.moveTo(this._x-
a,this._height);c.lineTo(this._x+a,0);return y(A,"path",null,{d:c.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};z.prototype.min=function(){return this._x-this._height/2};z.prototype.max=function(){return this._x+this._height/2};z.prototype.height=function(){return this._height};a.prototype=Object.create(p.prototype);a.prototype.drawPath=function(a){var c=this._height/2,b=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-b,0),a.lineTo(this._x+b,0)):
"W"===this._dir?(a.moveTo(this._x+b,c),a.lineTo(this._x-b,0),a.lineTo(this._x-b,this._height)):"E"===this._dir?(a.moveTo(this._x-b,c),a.lineTo(this._x+b,0),a.lineTo(this._x+b,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+b,this._height),a.lineTo(this._x-b,this._height));a.closePath()};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=function(){return this._height};b.prototype.draw=function(a){var c=this._height/
2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,c,c,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};b.prototype.toSVG=function(){var a=this._height/2;return y(A,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=function(){return this._x+this._height/2};b.prototype.height=function(){return this._height};
q.prototype.draw=function(a,c){this.glyph&&this.glyph.draw(a,c)};q.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():y(A,"g")};q.prototype.min=function(){return this._min};q.prototype.max=function(){return this._max};q.prototype.height=function(){return this.glyph?this.glyph.height():1};g.prototype=Object.create(p.prototype);g.prototype.min=function(){return this._min};g.prototype.max=function(){return this._max};g.prototype.height=function(){return this._height};g.prototype.drawPath=
function(a){var c=this._max,b=this._min,e=this._height,f=0,g=0,k=this._height+2,d=0.333333*this._height;this._ori&&("+"===this._ori?g=0.5*this._height:"-"===this._ori&&(f=0.5*this._height));c-b<k&&(b=(c+b-k)/2,c=b+k);a.moveTo(b+f,0+d);a.lineTo(c-g,0+d);a.lineTo(c-g,0);a.lineTo(c,0+this._height/2);a.lineTo(c-g,0+e);a.lineTo(c-g,0+d+d);a.lineTo(b+f,0+d+d);a.lineTo(b+f,0+e);a.lineTo(b,0+e/2);a.lineTo(b+f,0);a.lineTo(b+f,0+d)};k.prototype=Object.create(p.prototype);k.prototype.min=function(){return this._min};
k.prototype.max=function(){return this._max};k.prototype.height=function(){return this._height};k.prototype.drawPath=function(a){var c=this._min,b=this._max,e=this._height,f=e/2;a.moveTo(c,f);a.lineTo(b,f);a.moveTo(c,0);a.lineTo(c,e);a.moveTo(b,0);a.lineTo(b,e)};f.prototype.min=function(){return this._min};f.prototype.max=function(){return this._max};f.prototype.height=function(){return this._height};f.prototype.drawPath=function(a){var c=this._min,b=this._max,e=this._height,f=e/2;"hat"===this._style?
(a.moveTo(c,f),a.lineTo((c+b)/2,"-"===this._strand?e:0)):a.moveTo(c,f);a.lineTo(b,f)};f.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};f.prototype.toSVG=function(){var a=new J;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return y(A,"path",null,a)};e.prototype.min=function(){return this._min};
e.prototype.max=function(){return this._max};e.prototype.height=function(){return this._height};e.prototype.drawStemPath=function(a){var c=this._max,b=this._height/2;a.moveTo(this._min,b);a.lineTo(c,b)};e.prototype.drawTrigsPath=function(a){var c=this._min,b=this._max,e=this._height,f=e/2;a.moveTo(c,0);a.lineTo(c+e,f);a.lineTo(c,e);a.lineTo(c,0);a.moveTo(b,0);a.lineTo(b-e,f);a.lineTo(b,e);a.lineTo(b,0)};e.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();
a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};e.prototype.toSVG=function(){var a=new J;this.drawStemPath(a);var c=new J;this.drawTrigsPath(c);return y(A,"g",[y(A,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),y(A,"path",null,{d:c.toPathData(),fill:this._fill||"none"})])};u.prototype=Object.create(p.prototype);u.prototype.min=function(){return this._min};u.prototype.max=function(){return this._max};u.prototype.height=function(){return this._height};u.prototype.drawPath=
function(a){var c=this._min,b=this._max,e=this._height;if(this._parallel){var f=e/2,g=0.4*e;this._sw?(a.moveTo(c+f,e-g),a.lineTo(c+f,e),a.lineTo(c,f),a.lineTo(c+f,0),a.lineTo(c+f,g)):(a.moveTo(c,e-g),a.lineTo(c,g));this._ne?(a.lineTo(b-f,g),a.lineTo(b-f,0),a.lineTo(b,f),a.lineTo(b-f,e),a.lineTo(b-f,e-g)):(a.lineTo(b,g),a.lineTo(b,e-g))}else{var f=(c+b)/2,g=0.4*(b-c),k=e/3;this._ne?(a.moveTo(c+g,k),a.lineTo(c,k),a.lineTo(f,0),a.lineTo(b,k),a.lineTo(b-g,k)):(a.moveTo(c+g,0),a.lineTo(b-g,0));this._sw?
(a.lineTo(b-g,e-k),a.lineTo(b,e-k),a.lineTo(f,e),a.lineTo(c,e-k),a.lineTo(c+g,e-k)):(a.lineTo(b-g,e),a.lineTo(c+g,e))}a.closePath()};B.prototype.min=function(){return this._min};B.prototype.max=function(){return this._max};B.prototype.height=function(){return this._height};B.prototype.toSVG=function(){return y(A,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};B.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,
a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var c=2;c<this._height;c+=3)a.moveTo(this._min,c),a.lineTo(this._max,c);a.stroke()}};Q.prototype.min=function(){return this._min};Q.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};Q.prototype.height=function(){return this._height};Q.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,
this._min,this._height-4)};Q.prototype.toSVG=function(){return y(A,"text",this._string,{x:this._min,y:this._height-4})};L.prototype.min=function(){return this._min};L.prototype.max=function(){return this._max};L.prototype.height=function(){return this._height};L.prototype.draw=function(a){var c=this._seq,b=this._fill;if(c){var e=(this._max-this._min+1)/c.length,f=(3-this._readframe)%3,g=(c.length-f)%3,f="+"==this._orientation?f:g;0<f&&(a.fillStyle=b,a.fillRect(this._min,0,e*f,this._height));for(;f<
c.length;f+=3){g=c.substr(f,3).toUpperCase();"-"==this._orientation&&(g=H(g));var k=g in D?D[g]:"?",b=3==g.length?M(k,f,this._fill):this._fill;a.fillStyle=b;a.fillRect(this._min+f*e,0,e*g.length,this._height);8<=e&&3==g.length&&(a.fillStyle="white",a.fillText(k,this._min+(f+1)*e,this._height))}}};L.prototype.toSVG=function(){var a=y(A,"g"),c=this._seq,b=this._fill;if(!c)return a;var e=(this._max-this._min+1)/c.length,f=(3-this._readframe)%3,g=(c.length-f)%3,f="+"==this._orientation?f:g;for(0<f&&a.appendChild(y(A,
"rect",null,{x:this._min,y:0,width:e*f,height:this._height,fill:b}));f<c.length;f+=3){g=c.substr(f,3).toUpperCase();"-"==this._orientation&&(g=H(g));var k=g in D?D[g]:"?",b=3==g.length?M(k,f,this._fill):this._fill;a.appendChild(y(A,"rect",null,{x:this._min+f*e,y:0,width:e*g.length,height:this._height,fill:b}));8<=e&&3==g.length&&a.appendChild(y(A,"text",k,{x:this._min+(f+1)*e,y:this._height,fill:"white"}))}return a};(function(a){function c(a,b,e,f,g,l,k,d,h,q){this.baseColors=a;this._strandColor=
b;this._min=e;this._max=f;this._height=g;this._seq=l;this._ref=k;this._scheme=d;this._quals=h;this._fillbg=q}var b=1<window.devicePixelRatio,e={},f=/^[ACGT-]$/;c.prototype.min=function(){return this._min};c.prototype.max=function(){return this._max};c.prototype.height=function(){return this._height};c.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};c.prototype.draw=function(a){var c=this._seq,g=this._ref,l="mismatch-all"===this._scheme,k=c?c.length:this._max-this._min+
1,d=(this._max-this._min+1)/k;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=d||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var h=0;h<k;++h){var q=c?c.substr(h,1).toUpperCase():"N";if(f.test(q)||8<=d){var w=this.baseColors[q];if(this._quals){var u=this._quals.charCodeAt(h)-33,r=a.globalAlpha;a.globalAlpha=this.alphaForQual(u)}w||(u=g?g.substr(h,1).toUpperCase():"N",w="N"==q||"N"==u?"gray":this._strandColor,l&&(q=u));a.fillStyle=
w;u=f.test(q);!this._fillbg&&8<=d&&u||a.fillRect(this._min+h*d,0,d,this._height);if(8<=d&&u){var u=w+"_"+q,m=e[u];if(!m){m=document.createElement("canvas");b?(m.width=16,m.height=20):(m.width=8,m.height=10);var n=m.getContext("2d");b&&n.scale(2,2);n.fillStyle=this._fillbg?"black":w;w=n.measureText(q).width;n.fillText(q,0.5*(8-w),8);e[u]=m}b?a.drawImage(m,this._min+h*d+0.5*(d-8),0,8,10):a.drawImage(m,this._min+h*d+0.5*(d-8),0)}this._quals&&(a.globalAlpha=r)}}};c.prototype.toSVG=function(){for(var a=
this._seq,c=this._ref,b="mismatch-all"===this._scheme,e=(this._max-this._min+1)/this._seq.length,g=y(A,"g"),l=0;l<a.length;++l){var k=a?a.substr(l,1).toUpperCase():"N",d=this.baseColors[k];if(!d){var h=c?c.substr(l,1).toUpperCase():"N",d="N"==k||"N"==h?"gray":this._strandColor;b&&(k=h)}h=1;this._quals&&(h=this._quals.charCodeAt(l)-33,h=this.alphaForQual(h));var q=f.test(k);!this._fillbg&&8<=e&&q||g.appendChild(y(A,"rect",null,{x:this._min+l*e,y:0,width:e,height:this._height,fill:d,fillOpacity:h}));
8<=e&&q&&g.appendChild(y(A,"text",k,{x:this._min+(0.5+l)*e,y:8,textAnchor:"middle",fill:this._fillbg?"black":d,fillOpacity:h}))}return g};a.SequenceGlyph=c})(this);P.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};P.prototype.min=function(){return this.glyph.min()+this._x};P.prototype.max=function(){return this.glyph.max()+this._x};P.prototype.minY=function(){return this._y};P.prototype.maxY=function(){return this._y+this.glyph.height()};P.prototype.draw=
function(a,c){a.save();a.translate(this._x,this._y);this.glyph.draw(a,c);a.restore()};P.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};v.prototype.min=function(){return this._x-2};v.prototype.max=function(){return this._x+2};v.prototype.height=function(){return this._height};v.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};
v.prototype.toSVG=function(){return y(A,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};F.prototype.notSelectable=!0;F.prototype.min=function(){return-1E5};F.prototype.max=function(){return 1E5};F.prototype.height=function(){return this._height};F.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var c=0;c<=this._height;c+=10)a.moveTo(-5E3,c),a.lineTo(5E3,c);a.stroke();a.restore()};F.prototype.toSVG=function(){for(var a=new J,c=0;c<=
this._height;c+=10)a.moveTo(-5E3,c),a.lineTo(5E3,c);return y(A,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};E.prototype=Object.create(p.prototype);E.prototype.min=function(){return this._x-this._r};E.prototype.max=function(){return this._x+this._r};E.prototype.height=function(){return 2*this._r};E.prototype.drawPath=function(a){for(var c=this._x,b=this._r,e=this._r,f=0;f<this._points;++f){var g=6.28*f/this._points,k=c+e*Math.sin(g),g=b-e*Math.cos(g);0==f?a.moveTo(k,
g):a.lineTo(k,g);g=6.28*(f+0.5)/this._points;k=c+0.4*e*Math.sin(g);g=b-0.4*e*Math.cos(g);a.lineTo(k,g)}a.closePath()};c.prototype.draw=function(a){var c=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,c,c-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};c.prototype.toSVG=function(){var a=this._hh;return y(A,"g",[y(A,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),
y(A,"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};c.prototype.min=function(){return this._x-this._hh};c.prototype.max=function(){return this._x+this._hh};c.prototype.height=function(){return this._height};w.prototype.translate=function(a,c){this.ox+=a;this.oy+=c};w.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};w.prototype.draw=function(a,c,b){for(var e=0;e<this.glyphs.length;++e){var f=
this.glyphs[e];a.save();a.translate(f.x,f.y);f.glyph.drawOverlay(a,c,b);a.restore()}};"undefined"!==typeof t&&(t.exports={BoxGlyph:m,GroupGlyph:n,LineGraphGlyph:h,LabelledGlyph:x,CrossGlyph:r,ExGlyph:z,TriangleGlyph:a,DotGlyph:b,PaddedGlyph:q,AArrowGlyph:g,SpanGlyph:k,LineGlyph:f,PrimersGlyph:e,ArrowGlyph:u,TooManyGlyph:B,TextGlyph:Q,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:L,TranslatedGlyph:P,GridGlyph:F,StarGlyph:E,PointGlyph:v,PlimsollGlyph:c,OverlayLabelCanvas:w})},{"./spans":35,"./svg-utils":38,
"./utils":48}],22:[function(d,t,s){function p(d,h){this.base=d;this.query=h}if("undefined"!==typeof d)var m=d("./das").DASFeature;p.prototype.features=function(d,h,p){url=this.base+"/features/"+d.name;h=[];this.query&&h.push(this.query);d.isBounded&&(h.push("start="+d.start),h.push("end="+d.end));0<h.length&&(url=url+"?"+h.join("&"));var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(300<=r.status)p(null,"Error code "+r.status);else{var h=JSON.parse(r.response).features,
a=[];for(fi=0;fi<h.length;++fi){var b=h[fi],q=new m;q.segment=d;q.min=(b.start|0)+1;q.max=b.end|0;b.name&&(q.label=b.name);q.type=b.type||"unknown";a.push(q)}p(a)}};r.open("GET",url,!0);r.responseType="text";r.send("")};"undefined"!==typeof t&&(t.exports={JBrowseStore:p})},{"./das":10}],23:[function(d,t,s){function p(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new P(function(b,e){a.notifyRequestsIssued=b})}function m(a,b,e,c,f,g,k){this.chr=a;this.min=b;this.max=e;this.coverage=
k;this.scale=c;this.features=f||[];this.status=g}function n(a,b,e,c,g,k){this.tierMap=a;this.chr=b;this.min=e;this.max=c;this.scale=g;this.seqSource=k||new f;this.viewCount=0;this.featureCache={};this.latestViews={}}function h(a,b,e){for(var c=[],f={},g=0;g<a.length;++g){var k=a[g];k.min&&k.max?k.groups&&0<k.groups.length?r(f,k.groups[0].id,k):k.min<=e&&k.max>=b&&c.push(k):c.push(k)}for(var d in f){a=f[d];for(var h=1E11,q=-1E11,g=0;g<a.length;++g)k=a[g],h=Math.min(h,k.min),q=Math.max(q,k.max);if(h<=
e||q>=b)for(g=0;g<a.length;++g)c.push(a[g])}return c}if("undefined"!==typeof d){s=d("./utils");var x=s.Awaited,r=s.pusho;s=d("./sourceadapters");var z=s.MappedFeatureSource,a=s.CachingFeatureSource,b=s.BWGFeatureSource,q=s.RemoteBWGFeatureSource,g=s.BAMFeatureSource,k=s.RemoteBAMFeatureSource,f=s.DummySequenceSource,e=s.DummyFeatureSource,u=d("./overlay").OverlayFeatureSource;s=d("./spans");var B=s.Range,Q=s.intersection;s=d("./sample");var M=s.downsample,H=s.getBaseCoverage,L=d("./das").DASSequence,
P=d("es6-promise").Promise}p.prototype.addRequest=function(a){this.reqs.push(a)};p.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};m.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};n.prototype.cancel=function(){this.cancelled=!0};n.prototype.bestCacheOverlapping=function(a,b,e){return(a=this.featureCache[this.tierMap[0]])?a:null};n.prototype.viewFeatures=function(a,b,e,c){if(c!=c)throw"viewFeatures called with silly scale";
if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>b&&(b=1);this.min=b;this.max=e;this.scale=c;this.pool&&this.pool.abortAll();this.pool=new p;this.awaitedSeq=new x;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap);this.pool.notifyRequestsIssued()};n.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};n.prototype.startFetchesForTiers=function(a){for(var b=this,e=this.awaitedSeq,c=!1,f,g=0;g<a.length;++g)try{this.startFetchesFor(a[g],
e)&&(c=!0)}catch(k){f=a[g],f.currentFeatures=[],f.currentSequence=null,f.draw(),f.updateHeight(),f.updateStatus(k),console.log("Error fetching tier source"),console.log(k),f=k}if(c&&!this.seqWasFetched){this.seqWasFetched=!0;var d=this.min,h=this.max;if(this.cs&&this.cs.start<=d&&this.cs.end>=h)return a=this.cs.start==d&&this.cs.end==h?this.cs:new L(this.cs.name,d,h,this.cs.alphabet,this.cs.seq.substring(d-this.cs.start,h+1-this.cs.start)),e.provide(a);this.seqSource.fetch(this.chr,d,h,this.pool,
function(a,c){if(c){if(!b.cs||d<=b.cs.start&&h>=b.cs.end||d>=b.cs.end||h<=b.cs.start||h-d>b.cs.end-b.cs.start)b.cs=c;e.provide(c)}else console.log("Sequence loading failed",a),e.provide(null)})}if(f)throw f;};n.prototype.startFetchesFor=function(a,b){var f=this,c=this.viewCount,g=a.getSource()||new e,k=a.needsSequence(this.scale),d=f.featureCache[a],q=a.getActiveStyleFilters(this.scale),u;q&&(u=q.typeList());var r=this.chr,n=this.min,l=this.max;if(void 0===u)return!1;if(d&&d.chr===this.chr&&d.min<=
n&&d.max>=l){var p=d.features;if(d.min<n||d.max>l)p=h(p,n,l);f.provision(a,d.chr,Q(d.coverage,new B(n,l)),d.scale,u,p,d.status,k?b:null);p=g.getScales();if(d.scale<=this.scale||!p)return k}g.instrument&&console.log("Starting  fetch "+c+" ("+n+", "+l+")");g.fetch(r,n,l,this.scale,u,this.pool,function(e,h,q,p){g.instrument&&console.log("Finishing fetch "+c);var y=f.latestViews[a]||-1;if(!(f.cancelled||y>c)){p||(p=new B(n,l));if(!d||n<d.min||l>d.max)f.featureCache[a]=new m(r,n,l,q,h,e,p);f.latestViews[a]=
c;f.provision(a,r,p,q,u,h,e,k?b:null)}},q);return k};n.prototype.provision=function(e,f,d,c,h,r,m,n){m&&(e.currentFeatures=[],e.currentSequence=null,e.draw(),e.updateHeight());e.updateStatus(m);if(!m){for(var p=m=!1,B=e.getSource();z.prototype.isPrototypeOf(B)||a.prototype.isPrototypeOf(B)||u.prototype.isPrototypeOf(B);)B=u.prototype.isPrototypeOf(B)?B.sources[0]:B.source;if(b.prototype.isPrototypeOf(B)||q.prototype.isPrototypeOf(B)||g.prototype.isPrototypeOf(B)||k.prototype.isPrototypeOf(B))m=!0;
B.opts&&(B.opts.forceReduction||B.opts.noDownsample)||m&&h&&1==h.length&&0<=h.indexOf("density")&&(r=M(r,this.scale));h&&1==h.length&&0<=h.indexOf("base-coverage")&&(p=!0);n?n.await(function(a){p&&(r=H(r,a,e.browser.baseColors));e.viewFeatures(f,d,c,r,a)}):e.viewFeatures(f,d,c,r)}};"undefined"!==typeof t&&(t.exports={KnownSpace:n})},{"./das":10,"./overlay":27,"./sample":29,"./sourceadapters":34,"./spans":35,"./utils":48,"es6-promise":52}],24:[function(d,t,s){function p(a,d){this.block=a;this.offset=
d}function m(a,d){var g=4294967296*(a[d+6]&255)+16777216*(a[d+5]&255)+65536*(a[d+4]&255)+256*(a[d+3]&255)+(a[d+2]&255),k=a[d+1]<<8|a[d];return 0==g&&0==k?null:new p(g,k)}function n(b,d){d=Math.min(d||1,b.byteLength-50);for(var g=[],k=[0],f=0;k[0]<d;){var e=new Uint8Array(b,k[0],12),e=e[11]<<8|e[10],e=z(b,12+e+k[0],Math.min(65536,b.byteLength-12-e-k[0]),k);k[0]+=8;f+=e.byteLength;g.push(e)}if(1==g.length)return g[0];k=new Uint8Array(f);for(e=f=0;e<g.length;++e){var h=new Uint8Array(g[e]);a(h,0,k,f,
h.length);f+=h.length}return k.buffer}function h(a,d){this.minv=a;this.maxv=d}function x(a,d){--d;return a>>14==d>>14?4681+(a>>14):a>>17==d>>17?585+(a>>17):a>>20==d>>20?73+(a>>20):a>>23==d>>23?9+(a>>23):a>>26==d>>26?1+(a>>26):0}function r(a,d){var g,k=[];--d;k.push(0);for(g=1+(a>>26);g<=1+(d>>26);++g)k.push(g);for(g=9+(a>>23);g<=9+(d>>23);++g)k.push(g);for(g=73+(a>>20);g<=73+(d>>20);++g)k.push(g);for(g=585+(a>>17);g<=585+(d>>17);++g)k.push(g);for(g=4681+(a>>14);g<=4681+(d>>14);++g)k.push(g);return k}
if("undefined"!==typeof d){d=d("jszlib");var z=d.inflateBuffer,a=d.arrayCopy}p.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof t&&(t.exports={unbgzf:n,readVob:m,reg2bin:x,reg2bins:r,Chunk:h})},{jszlib:64}],25:[function(d,t,s){function p(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function m(a){this.source=a;x.call(this);this.storeHolder=new r;this.parser=h(a.payload);if(!this.parser)throw"Unsupported memstore payload: "+a.payload;var b=this;this._load(function(a,
g){if(a){for(var k=new p,f=[],e=a.split("\n"),d=b.parser.createSession(function(a){f.push(a)}),h=0;h<e.length;++h){var r=e[h];0<r.length&&d.parse(r)}d.flush();k.addFeatures(f);b.storeHolder.provide(k)}else b.error=g||"No data",b.storeHolder.provide(null)})}if("undefined"!==typeof d){t=d("./sourceadapters");var n=t.registerSourceAdapterFactory,h=t.makeParser,x=t.FeatureSourceBase;d("./das");d=d("./utils");var r=d.Awaited,z=d.textXHR}p.prototype.addFeatures=function(a){for(var b={},d=0;d<a.length;++d){var g=
a[d],k=g.segment||g.chr,f=this.featuresByChr[k];f||(f=[],this.featuresByChr[k]=f);f.push(g);b[k]=!0;g=g.max-g.min+1;g>this.maxLength&&(this.maxLength=g)}for(k in b)f=this.featuresByChr[k],f.sort(function(a,b){var f=a.min-b.min;return 0!=f?f:a.max-b.max});this.chrRing=null};p.prototype._indexFor=function(a,b){for(var d=0,g=a.length;g>d;){var k=(d+g)/2|0;if(k>=a.length)return a.length;b<a[k].min?g=k:d=k+1}return g};p.prototype.fetch=function(a,b,d){var g=this.featuresByChr[a];g||(g=0==a.indexOf("chr")?
this.featuresByChr[a.substring(3)]:this.featuresByChr["chr"+a]);if(!g)return[];var k=Math.max(0,this._indexFor(g,b-this.maxLength-1));a=Math.min(g.length-1,this._indexFor(g,d));for(var f=[];k<=a;++k){var e=g[k];e.min<=d&&e.max>=b&&f.push(e)}return f};p.prototype.findNextFeature=function(a,b,d){if(null==this.chrRing){this.chrRing=[];for(a in this.featuresByChr)this.chrRing.push(a);this.chrRing.sort()}var g=this.featuresByChr[a];g||(a=0==a.indexOf("chr")?a.substring(3):"chr"+a,g=this.featuresByChr[a]);
if(!g)return null;var k=Math.max(0,Math.min(this._indexFor(g,b),g.length-1));if(0<d){for(;k<g.length;){var f=g[k++];if(f.min>b)return f}a=this.chrRing.indexOf(a)+1;a>=this.chrRing.length&&(a=0);return this.findNextFeature(this.chrRing[a],0,d)}for(;0<=k;)if(f=g[k--],f.max<b)return f;a=this.chrRing.indexOf(a)-1;0>a&&(a=this.chrRing.length-1);return this.findNextFeature(this.chrRing[a],1E10,d)};m.prototype=Object.create(x.prototype);m.prototype._load=function(a){if(this.source.blob){var b=new FileReader;
b.onloadend=function(){return a(b.result,b.error)};b.readAsText(this.source.blob)}else{if(this.source.credentials)var d={credentials:this.source.credentials};z(this.source.uri,a,d)}};m.prototype.fetch=function(a,b,d,g,k,f,e){var h=this;this.storeHolder.await(function(f){return f?(f=f.fetch(a,b,d),e(null,f,1E8)):e(h.error)})};m.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};m.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&
this.parser.getDefaultFIPs(a)};m.prototype.getScales=function(){return 1E8};m.prototype.findNextFeature=function(a,b,d,g){var k=this;this.storeHolder.await(function(f){return f?g(f.findNextFeature(a,b,d)):g(null,k.error)})};m.prototype.capabilities=function(){return{leap:!0}};n("memstore",function(a){return{features:new m(a)}})},{"./das":10,"./sourceadapters":34,"./utils":48}],26:[function(d,t,s){function p(d){return(d|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function m(d){d=""+d;var h=
d.indexOf(".");if(0>h)return d;var m=2;"-"==d.substring(0,1)&&++m;return h>=m?d.substring(0,h):d.substring(0,h+2)}"undefined"!==typeof t&&(t.exports={formatLongInt:p,formatQuantLabel:m})},{}],27:[function(d,t,s){function p(d,m){this.sources=d;this.opts=m||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var a=0;a<this.sources.length;++a)this.initN(a);"function"===typeof m.merge?this.merge=m.merge:"concat"==m.merge?this.merge=h:
"alternates"==m.merge?(this.merge=h,this.filterDispatchOnMethod=!0):this.merge=n}function m(d,h,a){this.source=d;this.callback=h;this.sources=a;this.count=a.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function n(d){for(var h=[],a=1;a<d.length;++a){for(var b={},q=d[a],g=0;g<q.length;++g)b[this.keyForFeature(q[g])]=q[g];h.push(b)}a=[];d=d[0];for(g=0;g<d.length;++g){for(var k=d[g],f=0;f<h.length;++f)if(b=h[f],q=b[this.keyForFeature(k)])for(var e in q)"score"===
e?k.score2=q.score:"min"!==e&&"max"!==e&&"segment"!==e&&"_cachedStyle"!==e&&(k[e]=q[e]);a.push(k)}return a}function h(d,h){for(var a=[],b=0;b<d.length;++b)for(var q=d[b],g=h[b].name,k=0;k<q.length;++k){var f=q[k];f.method=g;a.push(f)}return a}if("undefined"!==typeof d)var x=d("./utils").shallowCopy;p.prototype.initN=function(d){var h=this.sources[d],a=this;this.business[d]=0;h.addActivityListener&&h.addActivityListener(function(b){a.business[d]=b;a.notifyActivity()});h.addChangeListener&&h.addChangeListener(function(){a.notifyChange()});
h.addReadinessListener&&h.addReadinessListener(function(b){a.readiness[d]=b;a.notifyReadiness()})};p.prototype.addReadinessListener=function(d){this.readinessListeners.push(d);this.notifyReadinessListener(d)};p.prototype.notifyReadiness=function(){for(var d=0;d<this.readinessListeners.length;++d)this.notifyReadinessListener(this.readinessListeners[d])};p.prototype.notifyReadinessListener=function(d){for(var h=null,a=0;a<this.readiness.length;++a)if(null!=this.readiness[a]){h=this.readiness[a];break}try{d(h)}catch(b){console.log(b)}};
p.prototype.addActivityListener=function(d){this.activityListeners.push(d)};p.prototype.notifyActivity=function(){for(var d=0,h=0;h<this.business.length;++h)d+=this.business[h];for(h=0;h<this.activityListeners.length;++h)try{this.activityListeners[h](d)}catch(a){console.log(a)}};p.prototype.addChangeListener=function(d){this.changeListeners.push(d)};p.prototype.notifyChange=function(){for(var d=0;d<this.changeListeners.length;++d)try{this.changeListeners[d](this.busy)}catch(h){console.log(h)}};p.prototype.getScales=
function(){return this.sources[0].getScales()};p.prototype.getStyleSheet=function(d){return this.sources[0].getStyleSheet(d)};p.prototype.capabilities=function(){var d={},h=this.sources[0];h.capabilities&&(d=x(h.capabilities()));for(h=1;h<this.sources.length;++h){var a=this.sources[h];a.capabilities&&(a=a.capabilities(),a.search&&(d.search=a.search))}return d};p.prototype.search=function(d,h){for(var a=0;a<this.sources.length;++a){var b;b=this.sources[a];b=b.capabilities?b.capabilities().search:!1;
if(b)return this.sources[a].search(d,h)}};p.prototype.fetch=function(d,h,a,b,q,g,k,f){var e;if(this.filterDispatchOnMethod){e=[];for(var u=f.list(),p=0;p<this.sources.length;++p)for(var n=this.sources[p],M=0;M<u.length;++M){var H=u[M];if(!H.method||H.method==n.name){e.push(n);break}}}else e=this.sources;k=new m(this,k,e);for(p=0;p<e.length;++p)this.fetchN(k,p,e[p],d,h,a,b,q,g,f)};p.prototype.fetchN=function(d,h,a,b,q,g,k,f,e,u){a.fetch(b,q,g,k,f,e,function(a,b,e){return d.completed(h,a,b,e)},u)};
p.prototype.quantFindNextFeature=function(d,h,a,b,q){return this.sources[0].quantFindNextFeature(d,h,a,b,q)};p.prototype.findNextFeature=function(d,h,a,b){return this.sources[0].findNextFeature(d,h,a,b)};m.prototype.completed=function(d,h,a,b){if(null==this.scale||0==d)this.scale=b;if(this.returns[d])throw"Multiple returns for source "+d;this.returns[d]=!0;this.returnCount++;this.features[d]=a;h&&(this.statuses[d]=h,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){d="";
for(h=0;h<this.count;++h)if(a=this.statuses[h])0<d.length&&(d+=", "),d+=a;return this.callback(d,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};p.prototype.getDefaultFIPs=function(d){for(var h=0;h<this.sources.length;++h){var a=this.sources[h];a.getDefaultFIPs&&a.getDefaultFIPs(d)}};p.prototype.keyForFeature=function(d){return""+d.min+".."+d.max};"undefined"!==typeof t&&(t.exports={OverlayFeatureSource:p})},{"./utils":48}],28:[function(d,t,s){function p(f,
e,d){var B=/^\w+\s[0-9]+\s[0-9]+.*$/,s=/([^=]+)=\"?([^\"]+)\"?/,M=/^##\s*fileformat=VCFv4\..+/;(f.blob?new h(f.blob):"encode"==f.transport?new k(f.uri):new n(f.uri,{credentials:f.credentials})).slice(0,65536).salted().fetch(function(k,h){if(!k)return d||(f.credentials=!0,p(f,e,!0)),e(f,"Couldn't fetch data");var n=new Uint8Array(k),v=(new Uint32Array(k,0,1))[0];if(v==r||v==z){f.tier_type="bwg";n=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(n=n.exec(f.uri||f.blob.name))f.name=n[1];return e(f,null)}if(v==
q)return f.tier_type="bai",e(f,null);if(31==n[0]||139==n[1]){n=a(k);n=new Uint8Array(n);v=x(n,0);if(v==b){f.tier_type="bam";n=/\/?([^/]+?)(.bam)?$/;if(n=n.exec(f.uri||f.blob.name))f.name=n[1];return e(f,null)}if(v==g)return f.tier_type="tabix-index",e(f,null);if(1768301347==v){f.tier_type="tabix";f.payload="vcf";n=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(n=n.exec(f.uri||f.blob.name))f.name=n[1];return e(f,null)}console.log("magic = "+v.toString(16));return e(f,"Unsupported format")}n=String.fromCharCode.apply(null,
n).split("\n");if(0<n.length&&M.test(n[0]))return f.tier_type="memstore",f.payload="vcf",n=/\/?([^/]+?)(.vcf)?$/,(n=n.exec(f.uri||f.blob.name))&&!f.name&&(f.name=n[1]),e(f,null);for(var F=0;F<n.length;++F)if(v=n[F].replace("\r",""),0!=v.length&&0!=v.indexOf("browser")){if(0==v.indexOf("track")){n="bed";v=v.split(/\s/);for(F=1;F<v.length;++F){var t=s.exec(v[F]);t&&("type"==t[1]&&"wiggle_0"==t[2]?n="wig":"name"==t[0]&&(f.name=t[2]))}m(f,n);return e(f,null)}if(0==v.indexOf("fixedStep")||0==v.indexOf("variableStep"))return m(f,
"wig"),e(f,null);if(B.test(v))return m(f,null),e(f,null);break}return e(f,"Unsupported format")})}function m(a,b){a.tier_type="memstore";var g=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);g&&(a.name||(a.name=g[1]),!b&&g[3]&&(b=g[3]));a.payload=b||"bed"}if("undefined"!==typeof d){s=d("./bin");var n=s.URLFetchable,h=s.BlobFetchable,x=s.readInt;s=d("./bigwig");var r=s.BIG_WIG_MAGIC,z=s.BIG_BED_MAGIC,a=d("./lh3utils").unbgzf;s=d("./bam");var b=s.BAM_MAGIC,q=s.BAI_MAGIC,g=d("./tabix").TABIX_MAGIC,
k=d("./encode").EncodeFetchable}"undefined"!==typeof t&&(t.exports={probeResource:p})},{"./bam":1,"./bigwig":3,"./bin":4,"./encode":12,"./lh3utils":24,"./tabix":40}],29:[function(d,t,s){function p(a){return q[a%q.length]*Math.pow(10,a/q.length|0)}function m(a,b,f){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=f;this.features=[]}function n(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function h(a,b){for(var f=0;p(f+1)<b;)++f;for(var f=p(f),e=[],d=
-1E10,h=1E10,q=0;q<a.length;++q){var n=a[q];if(n.groups&&0<n.groups.length)return a;for(var r=n.min/f|0,s=n.max/f|0,d=Math.max(d,s),h=Math.min(h,r);r<=s;++r){var x=e[r];x||(x=new m(f,r*f,(r+1)*f-1),e[r]=x);x.feature(n)}}q=[];for(r=h;r<=d;++r)if(x=e[r])n=new z,n.segment=a[0].segment,n.min=r*f+1,n.max=(r+1)*f,n.score=x.score(),n.type="density",q.push(n);Date.now();return q}function x(a){this._pos=a;this._bases={};this._totalCount=0}function r(g,d,f){for(var e,h,q=null,m=null,n=[],p=0;p<g.length;++p){var r=
g[p];if(r.groups&&0<r.groups.length)return g;e=r.seq;var s=r.quals,v=a(r.cigar),F=[];h=[];for(var t=0,c=0;c<v.length;++c){var w=v[c];if("M"==w.op)F.push(e.substr(t,w.cnt)),h.push(s.substr(t,w.cnt)),t+=w.cnt;else if("D"==w.op)for(var C=0;C<w.cnt;++C)F.push("-"),h.push("Z");else"I"==w.op?t+=w.cnt:"S"==w.op?t+=w.cnt:console.log("unknown cigop"+w.op)}e=F.join("");h=h.join("");F=e;t=h;c=r.orientation;w=r.min||0;r=r.max||0;h=0;for(e=w;e<=r;++e)v=n[e],v||(v=new x(e),n[e]=v),s=F.charAt(h),C=t.charCodeAt(h)-
33,v.recordBase(s,C,c),h++;q=q?Math.min(q,w):w;m=m?Math.max(m,r):r}r=q;p=m;h=[];if(d&&(e=d.start|0,v=d.end|0,e<=p&&v>=r)){s=Math.max(r,e);v=Math.min(p,v);for(F=0;F<s-r;F++)h.push("N");h.push(d.seq.substr(s-e,v-s+1));for(F=0;F<p-v;F++)h.push("N")}d=h.join("");p=[];h=0;for(e=q;e<=m;++e){if(v=n[e])if(r=new z,r.segment=g[0].segment,r.min=v.pos(),r.max=r.min,r.notes=[],r.notes=r.notes.concat(v.infoList()),r.type="base-coverage",r.suppressScore=!0,d)for(q=d.charAt(h),r.notes.unshift("Ref="+q),v=v.baseScoreList(q,
0.2),F=0;F<v.length;F++){s=v[F].base;t=v[F].score;c=b(r);c.score=t;if(1<v.length||s!=q)c.itemRgb=f[s];p.push(c)}else p.push(r);h++}return p}if("undefined"!==typeof d)var z=d("./das").DASFeature,a=d("./cigar").parseCigar,b=d("./utils").shallowCopy;var q=[1,2,5];m.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(n);for(var b=-1E10,f=0,e=0,d=1;d<a.length;++d){var h=a[d],q=Math.max(h.min,this.min),h=Math.min(h.max,this.max),e=e+(h-
q+1);q>b?(f+=h-q+1,b=h):h>b&&(f+=h-b,b=h)}return 0<f?1*e/f:0};m.prototype.feature=function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};x.prototype.recordBase=function(a,b,f){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[f]++;else{var e={"+":0,"-":0};e[f]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:e}}this._totalCount++};x.prototype.totalCount=function(){return this._totalCount};x.prototype.pos=function(){return this._pos};x.prototype.infoList=
function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());for(var f in this._bases){var e=this._bases[f],d=e.cnt,h=e.strandCnt["+"],q=e.strandCnt["-"],e=e.totalQual/d,d=[f,"=",d," (",(100*d/b).toFixed(0),"%, ",h," +, ",q," -, Qual: ",e.toFixed(0),")"];a.push(d.join(""))}return a};x.prototype.baseScoreList=function(a,b){var f=[],e=this._totalCount,d=b*e,h;for(h in this._bases){var q=this._bases[h].cnt;q<d||h==a||(f.push({base:h,score:e}),e-=q)}f.push({base:a,score:e});return f};"undefined"!==
typeof t&&(t.exports={downsample:h,getBaseCoverage:r})},{"./cigar":8,"./das":10,"./utils":48}],30:[function(d,t,s){function p(d,h){var a=parseFloat(d.replace(/,/g,""));return"k"===h||"K"===h?1E3*a|0:"m"==h||"M"===h?1E6*a|0:a|0}if("undefined"!==typeof d)var m=d("./cbrowser").Browser,n=d("./bin").URLFetchable,h=d("./trix").connectTrix;var x=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;m.prototype.search=function(d,m){var a=this,b=x.exec(d);if(b){var q=b[1],g;if(b[6])g=
p(b[2],b[3]),b=p(b[6],b[7]);else{var k=this.viewEnd-this.viewStart+1;g=p(b[2],b[3])-k/2|0;b=g+k-1}this.setLocation(q,g,b,m)}else{if(!d||0==d.length)return!1;var f=0,e=!1,u=function(b,g){--f;if(g)return m(g);b||(b=[]);for(var k=5E8,h=-1E8,q=null,n=0;n<b.length;++n){var u=b[n];null==q&&(q=u.segment);k=Math.min(k,u.min);h=Math.max(h,u.max)}if(q)e=!0,a.highlightRegion(q,k,h),n=Math.max(2500,0.3*(h-k+1)|0),a.setLocation(q,k-n,h+n,m);else if(0==f&&!e)return m("no match for '"+d+"'")},B=function(a,b){b.lookup(d,
function(b,e){if(null==b||2>b.length)return a.featureSource.search(d,u);var f=b[1].split(",")[0];return a.featureSource.search(f,u)})};if(this.searchEndpoint)return f=1,this.doDasSearch(a.searchEndpoint,d,u);for(q=0;q<this.tiers.length;++q)(function(b){a.sourceAdapterIsCapable(b.featureSource,"search")?b.dasSource.trixURI?(++f,b.trix?B(b,b.trix):h(new n(b.dasSource.trixURI),new n(b.dasSource.trixURI+"x"),function(a){b.trix=a;B(b,a)})):(++f,b.featureSource.search(d,u)):b.dasSource.provides_search&&
(++f,a.doDasSearch(b.dasSource,d,u))})(this.tiers[q])}};m.prototype.doDasSearch=function(d,h,a){d.features(null,{group:h,type:"transcript"},function(b){b||(b=[]);for(var d=[],g=0;g<b.length;++g){var k=b[g];k.label.toLowerCase()==h.toLowerCase()&&d.push(k)}return a(d)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":46}],31:[function(d,t,s){function p(d,g){g||(g=a);for(var k=b.length;d*b[k%b.length]*Math.pow(10,k/b.length|0)<g;)++k;return b[k%b.length]*Math.pow(10,k/b.length|0)}function m(a,b){var d=a.viewport.getContext("2d"),
f=a.browser.retina&&1<window.devicePixelRatio,e=a.browser.featurePanelWidth+2E3;f&&(e*=2);var h=a.viewport.width|0;h<e-50&&(a.viewport.width=h=e);e=50;b&&b.seq&&(e+=25);var m=e;f&&(m*=2);a.viewport.height=m;a.viewport.style.height=""+e+"px";a.viewport.style.width=f?""+h/2+"px":""+h+"px";a.layoutHeight=e;a.updateHeight();a.background&&(d.fillStyle=a.background,d.fillRect(0,0,h,a.viewport.height));f&&d.scale(2,2);d.translate(1E3,0);n(a,b,d);a.norigin=a.browser.viewStart;a.viewportHolder.style.left=
"-1000px"}function n(a,b,d){var f=a.browser.scale,e=a.browser.viewStart-1E3/f|0,h=a.browser.viewEnd+2E3/f,m=a.browser.currentSeqMax,n=h;0<m&&m<h&&(n=m);for(var r=p(f),s=Math.max(0,(e/r|0)*r),m=a.browser.viewStart;s<=n;)d.fillStyle=0==s/r%2?"white":"black",d.strokeStyle="black",d.fillRect((s-m)*f,8,r*f,3),d.strokeRect((s-m)*f,8,r*f,3),d.fillStyle="black",d.fillText(x(s),(s-m)*f,22),s+=r;if(b&&b.seq)for(;e<=h;++e)e>=b.start&&e<=b.end&&(n=b.seq.substr(e-b.start,1).toUpperCase(),(r=a.browser.baseColors[n])||
(r="gray"),d.fillStyle=r,8<=f?(r=d.measureText(n).width,d.fillText(n,(e-m)*f+0.5*(f-r),52)):d.fillRect((e-m)*f,42,f,12))}function h(a,b){var d=a.browser.scale,f=a.browser.viewStart-1E3/d|0,e=a.browser.viewEnd+2E3/d,h=a.browser.currentSeqMax,m=e;0<h&&h<e&&(m=h);for(var n=p(d),s=Math.max(0,(f/n|0)*n),h=a.browser.viewStart,H=r(z,"g",[],{fontSize:"8pt"});s<=m;)H.appendChild(r(z,"rect",null,{x:(s-h)*d,y:8,width:n*d,height:3,fill:0==s/n%2?"white":"black",stroke:"black"})),H.appendChild(r(z,"text",x(s),
{x:(s-h)*d,y:28,fill:"black",stroke:"none"})),s+=n;if(b&&b.seq)for(;f<=e;++f)f>=b.start&&f<=b.end&&(m=b.seq.substr(f-b.start,1).toUpperCase(),(n=a.browser.baseColors[m])||(n="gray"),8<=d?H.appendChild(r(z,"text",m,{x:(0.5+f-h)*d,y:52,textAnchor:"middle",fill:n})):H.appendChild(r(z,"rect",null,{x:(f-h)*d,y:42,width:d,height:12,fill:n})));return H}if("undefined"!==typeof d){s=d("./utils");var x=s.formatLongInt,r=s.makeElementNS,z=d("./svg-utils").NS_SVG,x=d("./numformats").formatLongInt}var a=100,b=
[1,2,5],z="http://www.w3.org/2000/svg";"undefined"!==typeof t&&(t.exports={drawSeqTier:m,drawSeqTierGC:n,svgSeqTier:h})},{"./numformats":26,"./svg-utils":38,"./utils":48}],32:[function(d,t,s){if("undefined"!=typeof d){t=d("./cbrowser");var p=t.Browser,m=t.sourceDataURI,n=t.sourcesAreEqual,h=d("./version"),x=d("./utils").miniJSONify,r=d("./sha1").hex_sha1}p.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];
delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];
delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};p.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};p.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=
this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};p.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var d=[],a=0;a<this.tiers.length;++a){var b=this.tiers[a];b.dasSource.noPersist||d.push({source:b.dasSource,config:b.config||{}})}localStorage["dalliance."+
this.cookieKey+".sources"]=JSON.stringify(d);d={};a=[];for(b=0;b<this.hubObjects.length;++b){var q=this.hubObjects[b],g={url:q.hub.url,genome:q.genome};q.credentials&&(g.credentials=q.credentials);q.mapping&&(g.mapping=q.mapping);d[g.url]=!0;a.push(g)}for(b=0;b<this.hubs.length;++b)g=this.hubs[b],"string"===typeof g&&(g={url:g}),d[g.url]||a.push(g);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(a);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;
localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=h.CONFIG}};p.prototype.restoreStatus=
function(){if(!this.noPersist){var d=localStorage["dalliance."+this.cookieKey+".version"];if(h.CONFIG==(d?d|0:-100)){var d=localStorage["dalliance."+this.cookieKey+".configHash"]||"",a=r(x({sources:this.sources,hubs:this.hubs}));if(a!=d)localStorage["dalliance."+this.cookieKey+".configHash"]=a;else{d={};for(a=0;a<this.sources.length;++a){var b=this.sources[a];if(b){var q=m(b),g=d[q];g||(d[q]=g=[]);g.push(b)}}if(!this.noPersistView&&(a=localStorage["dalliance."+this.cookieKey+".view-chr"],b=localStorage["dalliance."+
this.cookieKey+".view-start"]|0,g=localStorage["dalliance."+this.cookieKey+".view-end"]|0,a&&b&&g)){this.chr=a;this.viewStart=b;this.viewEnd=g;if(a=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=a|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];a=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof a||isNaN(a)||(this.savedZoom=a)}this.reverseScrolling=(a=localStorage["dalliance."+this.cookieKey+
".reverse-scrolling"])&&"true"==a;this.reverseKeyScrolling=(a=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==a;this.singleBaseHighlight=(a=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==a;if(a=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=a;if(a=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===a;if(a=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights=
"true"===a;if(a=localStorage["dalliance."+this.cookieKey+".sources"]){var k=JSON.parse(a);this.sources=[];this.restoredConfigs=[];for(a=0;a<k.length;++a)for(b=this.sources[a]=k[a].source,this.restoredConfigs[a]=k[a].config,q=m(b),g=d[q]||[],q=0;q<g.length;++q){var f=g[q];if(n(b,f))for(var e in f)f.hasOwnProperty(e)&&("function"===typeof f[e]||f[e]instanceof Blob)&&(b[e]=f[e])}}if(e=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(e);return!0}}}};p.prototype.reset=function(){for(var d=
this.tiers.length-1;0<=d;--d)this.removeTier({index:d},!0);for(d=0;d<this.defaultSources.length;++d)this.defaultSources[d].disabled||this.addTier(this.defaultSources[d]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":33,"./utils":48,"./version":50}],33:[function(d,t,s){function p(a){a=n(h(a));for(var b=r?"0123456789ABCDEF":"0123456789abcdef",d="",g,k=0;k<a.length;k++)g=a.charCodeAt(k),d+=b.charAt(g>>>
4&15)+b.charAt(g&15);return d}function m(a){a=n(h(a));for(var b="",d=a.length,g=0;g<d;g+=3)for(var k=a.charCodeAt(g)<<16|(g+1<d?a.charCodeAt(g+1)<<8:0)|(g+2<d?a.charCodeAt(g+2):0),f=0;4>f;f++)b=8*g+6*f>8*a.length?b+z:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6*(3-f)&63);return b}function n(a){for(var b=Array(a.length>>2),d=0;d<b.length;d++)b[d]=0;for(d=0;d<8*a.length;d+=8)b[d>>5]|=(a.charCodeAt(d/8)&255)<<24-d%32;a=8*a.length;b[a>>5]|=128<<24-a%32;b[(a+64>>9<<
4)+15]=a;a=Array(80);for(var d=1732584193,g=-271733879,k=-1732584194,f=271733878,e=-1009589776,h=0;h<b.length;h+=16){for(var m=d,n=g,r=k,p=f,s=e,t=0;80>t;t++){if(16>t)a[t]=b[h+t];else{var v=a[t-3]^a[t-8]^a[t-14]^a[t-16];a[t]=v<<1|v>>>31}var v=d<<5|d>>>27,F;F=20>t?g&k|~g&f:40>t?g^k^f:60>t?g&k|g&f|k&f:g^k^f;v=x(x(v,F),x(x(e,a[t]),20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514));e=f;f=k;k=g<<30|g>>>2;g=d;d=v}d=x(d,m);g=x(g,n);k=x(k,r);f=x(f,p);e=x(e,s)}b=[d,g,k,f,e];a="";for(d=0;d<32*b.length;d+=
8)a+=String.fromCharCode(b[d>>5]>>>24-d%32&255);return a}function h(a){for(var b="",d=-1,g,k;++d<a.length;)g=a.charCodeAt(d),k=d+1<a.length?a.charCodeAt(d+1):0,55296<=g&&56319>=g&&56320<=k&&57343>=k&&(g=65536+((g&1023)<<10)+(k&1023),d++),127>=g?b+=String.fromCharCode(g):2047>=g?b+=String.fromCharCode(192|g>>>6&31,128|g&63):65535>=g?b+=String.fromCharCode(224|g>>>12&15,128|g>>>6&63,128|g&63):2097151>=g&&(b+=String.fromCharCode(240|g>>>18&7,128|g>>>12&63,128|g>>>6&63,128|g&63));return b}function x(a,
b){var d=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(d>>16)<<16|d&65535}var r=0,z="";"undefined"!==typeof t&&(t.exports={b64_sha1:m,hex_sha1:p})},{}],34:[function(d,t,s){function p(a,c){ka[a]=c}function m(a,c){ga[a]=c}function n(a){if(ga[a])return ga[a](a)}function h(a){var c=this;this.source=a;this.cfsid="cfs"+ ++la;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){c.cfsid="cfs"+ ++la})}function x(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=
null}function r(a){this.dasSource=new w(a);this.busy=0;this.activityListeners=[]}function z(a){this.dasSource=new w(a);this.awaitedEntryPoints=new L;var c=this;this.dasSource.entryPoints(function(a){c.awaitedEntryPoints.provide(a)})}function a(a){var c=this;this.source=a;this.twoBit=new L;if(a.twoBitURI)a=new A(a.twoBitURI);else if(a.twoBitBlob)a=new J(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");l(a,function(a,b){b?console.log(b):c.twoBit.provide(a)})}function b(a){x.call(this);
var c=this;this.readiness="Connecting";this.bwgSource=this.opts=a;c.bwgHolder=new L;if(this.opts.preflight){var b=ea[this.opts.preflight];if(!b){b=new L;ea[this.opts.preflight]=b;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?b.provide("success"):b.provide("failure"))};e.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(e.withCredentials=!0);e.send("")}b.await(function(a){"success"===a&&c.init()})}else c.init()}function q(a,
c){x.call(this);this.worker=c;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new L;this.init()}function g(a,c){if(!(a.flag&K.SEGMENT_UNMAPPED)){var b;b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var e=Z(a.cigar),f=0;f<e.length;++f){var d=e[f];if("M"==d.op||"D"==d.op)b+=d.cnt}}e=new I;e.min=a.pos+1;e.max=a.pos+b;e.segment=a.segment;e.type="bam";e.id=a.readName;e.notes=["MQ="+a.mq];e.cigar=a.cigar;e.seq=a.seq;e.quals=a.quals;e.orientation=a.flag&K.REVERSE_COMPLEMENT?"-":
"+";e.bamRecord=a;c&&a.flag&K.MULTIPLE_SEGMENTS&&(e.groups=[{id:a.readName,type:"readpair"}]);return e}}function k(a){x.call(this);var c=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new L;if(this.opts.preflight){var b=ea[this.opts.preflight];if(!b){b=new L;ea[this.opts.preflight]=b;var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(200==e.status?b.provide("success"):b.provide("failure"))};e.open("get",
this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(e.withCredentials="true");e.send("")}b.await(function(a){"success"===a&&c.init()})}else c.init()}function f(a,c){x.call(this);this.bamSource=a;this.worker=c;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new L;this.init()}function e(a,c){this.source=a;this.mapping=c;this.activityListeners=[];this.busy=0}function u(){}function B(){}function Q(a){this.store=new T(a.jbURI,a.jbQuery)}
if("undefined"!==typeof d){var M=d("./cbrowser").Browser,H=d("./tier").DasTier;s=d("./utils");var L=s.Awaited,P=s.arrayIndexOf,v=s.shallowCopy,F=s.resolveUrlToPage;s=d("./das");var E=s.DASStylesheet,c=s.DASStyle,w=s.DASSource,C=s.DASSegment,I=s.DASFeature,y=s.DASSequence,D=s.DASLink;s=d("./bin");var A=s.URLFetchable,J=s.BlobFetchable,l=d("./twoBit").makeTwoBit,G=d("./bigwig").makeBwg;s=d("./bam");var S=s.makeBam,K=s.BamFlags;s=d("./spans");var R=s.Range,V=s.union,Z=d("./cigar").parseCigar,ja=d("./overlay").OverlayFeatureSource,
T=d("./jbjson").JBrowseStore,ca=d("./chainset").Chainset;d("./style");var X=d("./encode").EncodeFetchable}var ka={},ga={};H.prototype.initSources=function(){var a=this,c=this.browser.createSources(this.dasSource);this.featureSource=c.features||new u;this.sequenceSource=c.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};M.prototype.createSources=function(c){var d=this.sourceCache.get(c);if(d)return d;var g,
l;if("sequence"==c.tier_type||c.twoBitURI||c.twoBitBlob)l=c.twoBitURI||c.twoBitBlob?new a(c):new z(c);else if(c.tier_type&&ka[c.tier_type])l=(0,ka[c.tier_type])(c),g=l.features,l=l.sequence;else if(c.bwgURI||c.bwgBlob)g=(g=this.getWorker())?new q(c,g):new b(c);else if(c.bamURI||c.bamBlob)g=(g=this.getWorker())?new f(c,g):new k(c);else if(c.jbURI)g=new Q(c);else if(c.uri||c.features_uri)g=new r(c);if(c.overlay){d=[];g&&d.push(new h(g));for(g=0;g<c.overlay.length;++g){var m=this.createSources(c.overlay[g]);
m&&m.features&&d.push(m.features)}g=new ja(d,c)}c.sequenceAliases&&(g=new e(g,new ca({type:"alias",sequenceAliases:c.sequenceAliases})));c.mapping&&(g=new e(g,this.chains[c.mapping]));c.name&&g&&!g.name&&(g.name=c.name);null!=g&&(g=new h(g));if(null!=g||null!=l)d={features:g,sequence:l},this.sourceCache.put(c,d);return d};H.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||
this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?new r(this.dasSource):this.getSource()).getStyleSheet(a)};var la=0;h.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};h.prototype.search=function(a,c){if(this.source.search)return this.source.search(a,c)};h.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};h.prototype.getStyleSheet=
function(a){this.source.getStyleSheet(a)};h.prototype.getScales=function(){return this.source.getScales()};h.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};h.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};h.prototype.findNextFeature=function(a,c,b,e){this.source.findNextFeature(a,c,b,e)};h.prototype.quantFindNextFeature=function(a,c,b,e,f){this.source.quantFindNextFeature(a,c,
b,e,f)};h.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};h.prototype.fetch=function(a,c,b,e,f,g,d,k){if(!g)throw Error("Fetch pool is null");var l=this,h=this.cfsid,q=g.awaitedFeatures[h];if(q&&q.started){if(q.styleFilters.doesNotContain(k)){l.source.fetch(a,c,b,e,f,g,d,k);return}}else q?q.styleFilters.addAll(k):(q=new L,q.styleFilters=k,g.awaitedFeatures[h]=q,g.requestsIssued.then(function(){q.started=!0;l.source.fetch(a,c,b,e,q.styleFilters.typeList(),
g,function(a,c,b,e){q.res||q.provide({status:a,features:c,scale:b,coverage:e})},q.styleFilters)}).catch(function(a){console.log(a)}));q.await(function(a){d(a.status,a.features,a.scale,a.coverage)})};x.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};x.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(c){console.log(c)}};x.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
x.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(c){console.log(c)}};x.prototype.getScales=function(){return null};x.prototype.fetch=function(a,c,b,e,f,g,d){return d(null,[],1E9)};x.prototype.getStyleSheet=function(a){var b=new E,e=new c;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);return a(b)};r.prototype.addActivityListener=function(a){this.activityListeners.push(a)};r.prototype.notifyActivity=
function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(c){console.log(c)}};r.prototype.getStyleSheet=function(a){this.dasSource.stylesheet(function(c){a(c)},function(){a(null,"Couldn't fetch DAS stylesheet")})};r.prototype.fetch=function(a,c,b,e,f,g,d){if(f&&0==f.length)d(null,[],e);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return d(null,this.cachedStaticFeatures,this.cachedStaticScale);
var k=!1!==this.dasSource.maxbins;f={type:f};k&&(f.maxbins=1+((b-c)/e|0));var l=this;l.busy++;l.notifyActivity();this.dasSource.features(new C(a,c,b),f,function(a,c){l.busy--;l.notifyActivity();var b=e;k||(b=0.1);!c&&l.dasSource.dasStaticFeatures&&(l.cachedStaticFeatures=a,l.cachedStaticScale=b);d(c,a,b)})}};r.prototype.findNextFeature=this.sourceFindNextFeature=function(a,c,b,e){if(this.dasSource.capabilities&&0<=P(this.dasSource.capabilities,"das1:adjacent-feature")){var f=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");
this.dasAdjLock=!0;a={adjacent:a+":"+(c|0)+":"+(0<b?"F":"B")};if(c=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=c;thisTier.dasSource.features(null,a,function(a){f.dasAdjLock=!1;0<a.length&&null!=a[0]&&e(a[0])})}};z.prototype.fetch=function(a,c,b,e,f){this.dasSource.sequence(new C(a,c,b),function(a){return 1==a.length?f(null,a[0]):f("Didn't get sequence")})};z.prototype.getSeqInfo=function(a,c){this.awaitedEntryPoints.await(function(b){for(var e=0;e<b.length;++e)if(b[e].name==a)return c({length:b[e].end});
return c()})};a.prototype.fetch=function(a,c,b,e,f){this.twoBit.await(function(e){e.fetch(a,c,b,function(e,g){if(g)return f(g,null);var d=new y(a,c,b,"DNA",e);return f(null,d)})})};a.prototype.getSeqInfo=function(a,c){this.twoBit.await(function(b){b.getSeq(a)?b.getSeq(a).length(function(a){c({length:a})}):c()})};r.prototype.getScales=function(){return[]};var ea={};b.prototype=Object.create(x.prototype);b.prototype.init=function(){var a=this,c;c=(c=this.bwgSource.uri||this.bwgSource.bwgURI)?"encode"===
this.bwgSource.transport?new X(c,{credentials:this.opts.credentials}):new A(c,{credentials:this.opts.credentials}):new J(this.bwgSource.bwgBlob);G(c,function(c,b){b?(a.error=b,a.readiness=null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(c),a.readiness=null,a.notifyReadiness(),"bigbed"==c.type&&c.getExtraIndices(function(c){a.extraIndices=c}))})};b.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&
0<this.extraIndices.length){a.search=[];for(var c=0;c<this.extraIndices.length;++c)a.search.push(this.extraIndices[c].field)}return a};b.prototype.fetch=function(a,c,b,e,f,g,d){var l=this;this.bwgHolder.await(function(g){if(null==g)return d(l.error||"Can't access binary file",null,null);var k;k=!f||0==f.length||0<=P(f,"density");l.opts.clientBin&&(k=!1);if("bigwig"==g.type||k||"undefined"!==typeof l.opts.forceReduction){k=-1;for(var h=0;h<g.zoomLevels.length;++h)if(g.zoomLevels[h].reduction<=e)k=
h;else break;"undefined"!==typeof l.opts.forceReduction&&(k=l.opts.forceReduction);k=0>k?g.getUnzoomedView():g.getZoomedView(k)}else k=g.getUnzoomedView();l.busy++;l.notifyActivity();k.readWigData(a,c,b,function(a){l.busy--;l.notifyActivity();var e=1E9;if("bigwig"===g.type){var f=(b-c)/a.length/2;f<e&&(e=f)}if(l.opts.link)for(f=0;f<a.length;++f){var k=a[f];k.label&&(k.links=[new D("Link",l.opts.link.replace(/\$\$/,k.label))])}d(null,a,e)})})};b.prototype.quantFindNextFeature=function(a,c,b,e,f){var g=
this;g.busy++;g.notifyActivity();this.bwgHolder.res.thresholdSearch(a,c,b,e,function(a,c){g.busy--;g.notifyActivity();return f(a,c)})};b.prototype.findNextFeature=function(a,c,b,e){var f=this;f.busy++;f.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,c,b,function(a){f.busy--;f.notifyActivity();0<a.length&&null!=a[0]&&e(a[0])})};b.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var c=[1],b=0;b<a.zoomLevels.length;++b)c.push(a.zoomLevels[b].reduction);return c}return null};
b.prototype.search=function(a,c){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,c):c(null,"No indices available")};b.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(c){c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,b){for(var e=0;e<b.hit.length;++e)if(b.hit[e].isSuperGroup)return;for(e=c.definedFieldCount;e<c.schema.fields.length;++e){var f=c.schema.fields[e];b.add(f.comment,a[f.name])}})})};
b.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var e=new E;if("bigbed"==b.type){var f=new c;f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="blue";f.HEIGHT=8;f.BUMP=!0;f.LABEL=!0;f.ZINDEX=20;e.pushStyle({type:"bigwig"},null,f);f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="red";f.HEIGHT=10;f.BUMP=!0;f.ZINDEX=20;e.pushStyle({type:"translation"},null,f);f=new c;f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="white";f.HEIGHT=10;f.ZINDEX=10;f.BUMP=!0;f.LABEL=
!0;e.pushStyle({type:"transcript"},null,f);f=new c;f.glyph="HISTOGRAM";f.COLOR1="white";f.COLOR2="black";f.HEIGHT=30;e.pushStyle({type:"density"},null,f)}else f=new c,f.glyph="HISTOGRAM",f.COLOR1="white",f.COLOR2="black",f.HEIGHT=30,e.pushStyle({type:"default"},null,f);12==b.definedFieldCount&&14<=b.fieldCount&&(e.geneHint=!0);return a(e)})};q.prototype=Object.create(x.prototype);q.prototype.init=function(){var a=this,c=this.uri||this.bwgSource.uri||this.bwgSource.bwgURI,b=this.bwgSource.blob||this.bwgSource.bwgBlob,
e=function(c,b){a.readiness=null;a.notifyReadiness();c?a.worker.postCommand({command:"meta",connection:c},function(b,e){e?(a.error=e,a.keyHolder.provide(null)):(a.meta=b,a.keyHolder.provide(c))}):(a.error=b,a.keyHolder.provide(null))};b?this.worker.postCommand({command:"connectBBI",blob:b},e):this.worker.postCommand({command:"connectBBI",uri:F(c),transport:this.bwgSource.transport,credentials:this.bwgSource.credentials},e)};q.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==
this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var c=0;c<this.meta.extraIndices.length;++c)a.search.push(this.meta.extraIndices[c].field)}return a};q.prototype.fetch=function(a,c,b,e,f,g,d){var k=this;k.busy++;k.notifyActivity();this.keyHolder.await(function(g){if(!g)return k.busy--,k.notifyActivity(),d(k.error||"Can't access binary file",null,null);var l=-1,h=!f||0==f.length||0<=P(f,"density");k.opts.clientBin&&(h=!1);if("bigwig"==
k.meta.type||h||"undefined"!==typeof k.opts.forceReduction){for(h=1;h<k.meta.zoomLevels.length;++h)if(k.meta.zoomLevels[h]<=e)l=h-1;else break;"undefined"!==typeof k.opts.forceReduction&&(l=k.opts.forceReduction)}k.worker.postCommand({command:"fetch",connection:g,chr:a,min:c,max:b,zoom:l},function(a,e){k.busy--;k.notifyActivity();var f=1E9;if("bigwig"===k.meta.type){var g=(b-c)/a.length/2;g<f&&(f=g)}if(k.opts.link)for(g=0;g<a.length;++g){var l=a[g];l.label&&(l.links=[new D("Link",k.opts.link.replace(/\$\$/,
l.label))])}d(e,a,f)})})};q.prototype.quantFindNextFeature=function(a,c,b,e,f){var g=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:c,dir:b,threshold:e,under:!1},function(a,c){console.log(a,c);g.busy--;g.notifyActivity();return f(a,c)})};q.prototype.findNextFeature=function(a,c,b,e){var f=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:c,dir:b},function(a,
c){f.busy--;f.notifyActivity();0<a.length&&null!=a[0]&&e(a[0])})};q.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};q.prototype.search=function(a,c){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return c(null,"No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,e){b.busy--;b.notifyActivity();c(a,e)})};q.prototype.getDefaultFIPs=
function(a){if(this.opts.noExtraFeatureInfo)return!0;var c=this;this.keyHolder.await(function(b){var e=c.meta;e&&e.schema&&e.definedFieldCount<e.schema.fields.length&&a(function(a,c){for(var b=0;b<c.hit.length;++b)if(c.hit[b].isSuperGroup)return;for(b=e.definedFieldCount;b<e.schema.fields.length;++b){var f=e.schema.fields[b];c.add(f.comment,a[f.name])}})})};q.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(e){e=b.meta;if(!e)return a(null,"bbi error");var f=new E;if("bigbed"==
e.type){var g=new c;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="blue";g.HEIGHT=8;g.BUMP=!0;g.LABEL=!0;g.ZINDEX=20;f.pushStyle({type:"bigwig"},null,g);g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="red";g.HEIGHT=10;g.BUMP=!0;g.ZINDEX=20;f.pushStyle({type:"translation"},null,g);g=new c;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="white";g.HEIGHT=10;g.ZINDEX=10;g.BUMP=!0;g.LABEL=!0;f.pushStyle({type:"transcript"},null,g);g=new c;g.glyph="HISTOGRAM";g.COLOR1="white";g.COLOR2="black";g.HEIGHT=30;f.pushStyle({type:"density"},
null,g)}else g=new c,g.glyph="HISTOGRAM",g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,f.pushStyle({type:"default"},null,g);12==e.definedFieldCount&&14<=e.fieldCount&&(f.geneHint=!0);return a(f)})};k.prototype=Object.create(x.prototype);k.prototype.init=function(){var a=this,c,b;this.bamSource.bamBlob?(c=new J(this.bamSource.bamBlob),b=new J(this.bamSource.baiBlob)):(c=new A(this.bamSource.bamURI,{credentials:this.opts.credentials}),b=new A(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));
S(c,b,null,function(c,b){a.readiness=null;a.notifyReadiness();c?a.bamHolder.provide(c):(a.error=b,a.bamHolder.provide(null))})};k.prototype.fetch=function(a,c,b,e,f,d,k){var l=f&&1==f.length&&"density"==f[0],h=this;h.busy++;h.notifyActivity();this.bamHolder.await(function(e){if(!e)return h.busy--,h.notifyActivity(),k(h.error||"Couldn't fetch BAM");e.fetch(a,c,b,function(a,c){h.busy--;h.notifyActivity();if(c)k(c,null,null);else{for(var b=[],e=0;e<a.length;++e){var f=g(a[e],h.opts.bamGroup);f&&b.push(f)}k(null,
b,1E9)}},{light:l})})};k.prototype.getScales=function(){return 1E9};k.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new E;var e=new c;e.glyph="HISTOGRAM";e.COLOR1="black";e.COLOR2="red";e.HEIGHT=30;b.pushStyle({type:"density"},"low",e);b.pushStyle({type:"density"},"medium",e);e=new c;e.glyph="__SEQUENCE";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!1;e.ZINDEX=20;b.pushStyle({type:"bam"},"high",e);return a(b)})};f.prototype=Object.create(x.prototype);f.prototype.init=
function(){var a=this,c=this.bamSource.uri||this.bamSource.bamURI,b=this.bamSource.indexUri||this.bamSource.baiURI||c+".bai",e=this.bamSource.bamBlob||this.bamSource.blob,f=this.bamSource.baiBlob||this.bamSource.indexBlob,g=function(c,b){a.readiness=null;a.notifyReadiness();c?a.keyHolder.provide(c):(a.error=b,a.keyHolder.provide(null))};e?this.worker.postCommand({command:"connectBAM",blob:e,indexBlob:f},g):this.worker.postCommand({command:"connectBAM",uri:F(c),indexUri:F(b),credentials:this.bamSource.credentials,
indexChunks:this.bamSource.indexChunks},g)};f.prototype.fetch=function(a,c,b,e,f,d,k){var l=f&&1==f.length&&"density"==f[0],h=this;h.busy++;h.notifyActivity();this.keyHolder.await(function(e){if(!e)return h.busy--,h.notifyActivity(),k(h.error||"Couldn't fetch BAM");h.worker.postCommand({command:"fetch",connection:e,chr:a,min:c,max:b,opts:{light:l}},function(a,c){h.busy--;h.notifyActivity();if(c)k(c,null,null);else{for(var b=[],e=0;e<a.length;++e){var f=g(a[e],h.opts.bamGroup);f&&b.push(f)}k(null,
b,1E9)}})})};f.prototype.getScales=function(){return 1E9};f.prototype.getStyleSheet=function(a){this.keyHolder.await(function(b){b=new E;var e=new c;e.glyph="HISTOGRAM";e.COLOR1="black";e.COLOR2="red";e.HEIGHT=30;b.pushStyle({type:"density"},"low",e);b.pushStyle({type:"density"},"medium",e);e=new c;e.glyph="__SEQUENCE";e.FGCOLOR="black";e.BGCOLOR="blue";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!1;e.ZINDEX=20;b.pushStyle({type:"bam"},"high",e);return a(b)})};e.prototype.addActivityListener=function(a){this.activityListeners.push(a)};
e.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(c){console.log(c)}};e.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};e.prototype.getScales=function(){return this.source.getScales()};e.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};e.prototype.simplifySegments=function(a,c){if(0==a.length)return a;a.sort(function(a,c){var b=a.name-
c.name;return b?b:(b=a.start-c.start)?b:a.end-c.end});for(var b=[],e=a[0],f=0;f<a.length;++f){var g=a[f];g.name!=e.name||g.start>e.end+c?(b.push(e),e=g):e=new C(e.name,Math.min(e.start,g.start),Math.max(e.end,g.end))}b.push(e);return b};e.prototype.fetch=function(a,c,b,e,f,g,d,k){var l=this,h=b-c+1;l.busy++;l.notifyActivity();this.mapping.sourceBlocksForRange(a,c,b,function(a){if(0==a.length)l.busy--,l.notifyActivity(),d("No mapping available for this regions",[],e);else{a=l.simplifySegments(a,Math.max(100,
0.05*h));var c=[],b=null,q=a.length,m;a.map(function(a){l.source.fetch(a.name,a.start,a.end,e,f,g,function(e,f,g){e&&!m&&(m=e);if(f)for(e=0;e<f.length;++e){var k=f[e],h=k.segment;0==h.indexOf("chr")&&(h=h.substr(3));h=l.mapping.mapSegment(h,k.min,k.max);if(0==h.length)k.parts&&0<k.parts.length&&c.push(k);else for(var n=0;n<h.length;++n){var w=h[n],r=v(k);r.segment=w.segment;r.min=w.min;r.max=w.max;w.partialMin&&(r.partialMin=w.partialMin);w.partialMax&&(r.partialMax=w.partialMax);w.flipped&&("-"==
k.orientation?r.orientation="+":"+"==k.orientation&&(r.orientation="-"));c.push(r)}}f=l.mapping.mapPoint(a.name,a.start);e=l.mapping.mapPoint(a.name,a.end);f&&e&&(f=new R(f.pos,e.pos),b=b?V(b,f):f);--q;0==q&&(l.busy--,l.notifyActivity(),d(m,c,g,b))},k)})}})};u.prototype.getScales=function(){return null};u.prototype.fetch=function(a,c,b,e,f,g,d){return d(null,[],1E9)};u.prototype.getStyleSheet=function(a){var b=new E,e=new c;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},
null,e);return a(b)};B.prototype.fetch=function(a,c,b,e,f){return f(null,null)};Q.prototype.getScales=function(){return null};Q.prototype.getStyleSheet=function(a){var b=new E,e=new c;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="green";e.HEIGHT=8;e.BUMP=!0;e.LABEL=!0;e.ZINDEX=20;b.pushStyle({type:"default"},null,e);return a(b)};Q.prototype.fetch=function(a,c,b,e,f,g,d){f&&0==f.length?d(null,[],e):this.store.features(new C(a,c,b),{},function(a,c){d(c,a,1E5)})};M.prototype.sourceAdapterIsCapable=function(a,
c){return a.capabilities?a.capabilities()[c]:!1};"undefined"!==typeof t&&(t.exports={FeatureSourceBase:x,TwoBitSequenceSource:a,DASSequenceSource:z,MappedFeatureSource:e,CachingFeatureSource:h,BWGFeatureSource:b,RemoteBWGFeatureSource:q,BAMFeatureSource:k,RemoteBAMFeatureSource:f,DummyFeatureSource:u,DummySequenceSource:B,registerSourceAdapterFactory:p,registerParserFactory:m,makeParser:n},d("./ensembljson"),d("./tabix-source"),d("./memstore"),d("./bedwig"),d("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,
"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./encode":12,"./ensembljson":13,"./jbjson":22,"./memstore":25,"./overlay":27,"./spans":35,"./style":36,"./tabix-source":39,"./tier":44,"./twoBit":47,"./utils":48,"./vcf":49}],35:[function(d,t,s){function p(a,b){if("number"!=typeof a||"number"!=typeof b)throw"Bad range "+a+","+b;this._min=a;this._max=b}function m(a){this._ranges=a}function n(a,b){a instanceof Array||(a=[a],b&&a.push(b));if(0==a.length)return null;if(1==a.length)return a[0];
for(var d=[],g=0;g<a.length;++g)a[g]._pushRanges(d);for(var d=d.sort(z),g=[],k=d[0],k=new p(k._min,k._max),f=1;f<d.length;++f){var e=d[f];e._min>k._max+1?(g.push(k),k=new p(e._min,e._max)):e._max>k._max&&(k._max=e._max)}g.push(k);return 1==g.length?g[0]:new m(g)}function h(a,b){for(var d=a.ranges(),g=b.ranges(),k=d.length,f=g.length,e=0,h=0,n=[];e<k&&h<f;){a=d[e];b=g[h];var r=Math.max(a.min(),b.min()),s=Math.min(a.max(),b.max());s>=r&&n.push(new p(r,s));a.max()>b.max()?++h:++e}return 0==n.length?
null:1==n.length?n[0]:new m(n)}function x(a){var b=0;a=a.ranges();for(var d=0;d<a.length;++d)var g=a[d],b=b+(g.max()-g.min()+1);return b}function r(a,b){return a.min()<b.min()?-1:a.min()>b.min()?1:a.max()<b.max()?-1:b.max()>a.max()?1:0}function z(a,b){return a._min<b._min?-1:a._min>b._min?1:a._max<b._max?-1:b._max>a._max?1:0}p.prototype.min=function(){return this._min};p.prototype.max=function(){return this._max};p.prototype.contains=function(a){return a>=this._min&&a<=this._max};p.prototype.isContiguous=
function(){return!0};p.prototype.ranges=function(){return[this]};p.prototype._pushRanges=function(a){a.push(this)};p.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};m.prototype.min=function(){return this._ranges[0].min()};m.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};m.prototype.contains=function(a){for(var b=0;b<this._ranges.length;++b)if(this._ranges[b].contains(a))return!0;return!1};m.prototype.isContiguous=function(){return 1<this._ranges.length};
m.prototype.ranges=function(){return this._ranges};m.prototype._pushRanges=function(a){for(var b=0;b<this._ranges.length;++b)a.push(this._ranges[b])};m.prototype.toString=function(){for(var a="",b=0;b<this._ranges.length;++b)0<b&&(a+=","),a+=this._ranges[b].toString();return a};"undefined"!==typeof t&&(t.exports={Range:p,union:n,intersection:h,coverage:x,rangeOver:r,_rangeOrder:z})},{}],36:[function(d,t,s){function p(d,h,m){this.type=d;this.method=h;this.label=m}function m(d){this._filters={};if(d)for(var h=
0;h<d.length;++h)this.add(d[h])}p.prototype.equals=function(d){return this.type==d.type&&this.method==d.method&&this.label==d.label};p.prototype.toString=function(){var d=[];this.type&&d.push("type="+this.type);this.method&&d.push("method="+this.method);this.label&&d.push("label="+this.label);return"StyleFilter<"+d.join(";")+">"};m.prototype.add=function(d){var h=d.toString();this._filters[h]||(this._filters[h]=d,this._list=null)};m.prototype.addAll=function(d){d=d.list();for(var h=0;h<d.length;++h)this.add(d[h])};
m.prototype.doesNotContain=function(d){d=d.list();for(var h=0;h<d.length;++h)if(!this._filters[h.toString()])return!0;return!1};m.prototype.list=function(){if(!this._list){this._list=[];for(var d in this._filters)this._filters.hasOwnProperty(d)&&this._list.push(this._filters[d])}return this._list};m.prototype.typeList=function(){for(var d=[],h=this.list(),m=0;m<h.length;++m){var r=h[m].type;if(!r||"default"==r)return null;0>d.indexOf(r)&&d.push(r)}return d};"undefined"!==typeof t&&(t.exports={StyleFilter:p,
StyleFilterSet:m})},{}],37:[function(d,t,s){if("undefined"!==typeof d){var p=d("./cbrowser").Browser,m=d("./utils").makeElementNS,n=d("./version"),h=d("./sequence-draw").svgSeqTier;t=d("./svg-utils");var x=t.NS_SVG,r=t.NS_XLINK,z=t.SVGPath,a=d("./numformats").formatQuantLabel}p.prototype.makeSVG=function(b){b=b||{};var d=b.minTierHeight||20,g=document.implementation.createDocument(x,"svg",null),k=m(x,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});g.documentElement.appendChild(k);var f=m(x,"a",
m(x,"text","Graphics from Dalliance "+n,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));f.setAttribute("xmlns:xlink",r);f.setAttribute("xlink:href","http://www.biodalliance.org/");k.appendChild(f);f=m(x,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});f=m(x,"clipPath",f,{id:"featureClip"});k.appendChild(f);for(var f=70,e=m(x,"g",null,{}),p=0;p<this.tiers.length;++p){var B=this.tiers[p],s=m(x,"g",null,{clipPath:"url(#featureClip)",
clipRule:"nonzero"}),t=m(x,"g"),H=f,L=m(x,"rect",null,{x:0,y:H,width:"10000",height:50,fill:B.background});s.appendChild(L);if(B.sequenceSource){var P=h(B,B.currentSequence);s.appendChild(m(x,"g",P,{transform:"translate(200, "+f+")"}));f+=80}else{if(!B.subtiers)continue;for(var P=(B.glyphCacheOrigin-this.viewStart)*this.scale,v=!1,F=0;F<B.subtiers.length;++F){for(var f=f+3,E=B.subtiers[F],c=[],w=0;w<E.glyphs.length;++w)c.push(E.glyphs[w].toSVG());s.appendChild(m(x,"g",c,{transform:"translate("+(200+
P)+", "+f+")"}));if(E.quant){var v=!0,c=E.quant,C=E.height,w=2;40<C&&(w=1+(C/20|0));var C=C/(w-1),I=(c.max-c.min)/(w-1),y=new z;y.moveTo(205,f);y.lineTo(200,f);y.lineTo(200,f+E.height);y.lineTo(205,f+E.height);for(var D=1;D<w-1;++D){var A=D*C;y.moveTo(200,f+A);y.lineTo(203,f+A)}t.appendChild(m(x,"path",null,{d:y.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));t.appendChild(m(x,"text",a(c.max),{x:197,y:f+7,textAnchor:"end"}));t.appendChild(m(x,"text",a(c.min),{x:197,y:f+E.height,textAnchor:"end"}));
for(D=1;D<w-1;++D)A=D*C,t.appendChild(m(x,"text",a(1*c.max-D*I),{x:197,y:f+A+3,textAnchor:"end"}))}f+=E.height+3}f-H<d&&(f=H+d)}t.appendChild(m(x,"text","string"===typeof B.config.name?B.config.name:B.dasSource.name,{x:200-(v?20:12),y:(f+H+8)/2,fontSize:"10pt",textAnchor:"end"}));L.setAttribute("height",f-H);e.appendChild(m(x,"g",[s,t]))}if(b.highlights)for(d=this.highlights||[],v=0;v<d.length;++v)C=d[v],(C.chr==this.chr||C.chr=="chr"+this.chr)&&C.min<this.viewEnd&&C.max>this.viewStart&&(p=(Math.max(C.min,
this.viewStart)-this.viewStart)*this.scale,B=(Math.min(C.max,this.viewEnd)-this.viewStart)*this.scale,e.appendChild(m(x,"rect",null,{x:200+p,y:70,width:B-p,height:f-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));d=-1;"center"==b.ruler?d=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==b.ruler?d=200:"right"==b.ruler&&(d=200+(this.viewEnd-this.viewStart)*this.scale);0<=d&&e.appendChild(m(x,"line",null,{x1:d,y1:70,x2:d,y2:f,stroke:"blue"}));k.appendChild(e);
g.documentElement.setAttribute("width",this.featurePanelWidth+20+200);g.documentElement.setAttribute("height",f+50);return new Blob([(new XMLSerializer).serializeToString(g)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":26,"./sequence-draw":31,"./svg-utils":38,"./utils":48,"./version":50}],38:[function(d,t,s){function p(){this.ops=[]}p.prototype.moveTo=function(d,n){this.ops.push("M "+d+" "+n)};p.prototype.lineTo=function(d,n){this.ops.push("L "+d+" "+n)};p.prototype.closePath=function(){this.ops.push("Z")};
p.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof t&&(t.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:p})},{}],39:[function(d,t,s){function p(b){h.call(this);this.readiness="Connecting";this.source=b;this.tabixHolder=new z;var d=this,g=n(b.payload);if(g)this.parser=g;else throw"Unsuported tabix payload "+b.payload;var k;this.source.blob?(b=new r(this.source.blob),k=new r(this.source.indexBlob)):(b=new x(this.source.uri,
{credentials:this.source.credentials}),k=new x(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));a(b,k,function(a,b){d.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var e=g.createSession(function(){}),f=0;f<a.length;++f)e.parse(a[f]);e.flush()}});d.readiness=null;d.notifyReadiness()})}if("undefined"!==typeof d){t=d("./sourceadapters");var m=t.registerSourceAdapterFactory,n=t.makeParser,h=t.FeatureSourceBase;t=d("./bin");var x=t.URLFetchable,r=t.BlobFetchable,
z=d("./utils").Awaited,a=d("./tabix").connectTabix}p.prototype=Object.create(h.prototype);p.prototype.fetch=function(a,d,g,k,f,e,h){var m=this;m.busy++;m.notifyActivity();this.tabixHolder.await(function(e){e.fetch(a,d,g,function(a,b){m.busy--;m.notifyActivity();for(var e=[],f=m.parser.createSession(function(a){e.push(a)}),d=0;d<a.length;++d)f.parse(a[d]);f.flush();h(null,e,1E9)})})};p.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};p.prototype.getDefaultFIPs=
function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};m("tabix",function(a){return{features:new p(a)}})},{"./bin":4,"./sourceadapters":34,"./tabix":40,"./utils":48}],40:[function(d,t,s){function p(){}function m(a,d,g){var k=new p;k.data=a;k.tbi=d;k.tbi.fetch(function(a){if(!a)return g(null,"Couldn't access Tabix");a=r(a,a.byteLength);var b=new Uint8Array(a);if(h(b,0)!=n)return g(null,"Not a tabix index");var d=h(b,4);k.format=h(b,8);k.colSeq=h(b,12);k.colStart=h(b,16);
k.colEnd=h(b,20);k.meta=h(b,24);k.skip=h(b,28);h(b,32);k.indices=[];var m=36;k.chrToIndex={};k.indexToChr=[];for(var q=0;q<d;++q){for(var p="";;){var s=b[m++];if(0==s)break;p+=String.fromCharCode(s)}k.chrToIndex[p]=q;0==p.indexOf("chr")?k.chrToIndex[p.substring(3)]=q:k.chrToIndex["chr"+p]=q;k.indexToChr.push(p)}p=1E9;for(s=0;s<d;++s){for(var t=m,z=h(b,m),m=m+4,q=0;q<z;++q){h(b,m);var v=h(b,m+4),m=m+(8+16*v)}for(var v=h(b,m),F=m+=4,q=0;q<v;++q){var E=x(b,F),F=F+8;if(E){q=E.block;0<E.offset&&(q+=65536);
q<p&&(p=q);break}}m+=8*v;0<z&&(k.indices[s]=new Uint8Array(a,t,m-t))}k.headerMax=p;g(k)})}var n=21578324;if("undefined"!==typeof d){d("./spans");var h=d("./bin").readInt;d=d("./lh3utils");var x=d.readVob,r=d.unbgzf,z=d.reg2bins,a=d.Chunk}p.prototype.blocksForRange=function(b,d,g){var k=this.indices[b];if(!k)return[];b=z(d,g);for(var f=[],e=0;e<b.length;++e)f[b[e]]=!0;b=[];for(var m=[],e=h(k,0),n=4,p=0;p<e;++p){var r=h(k,n),s=h(k,n+4),n=n+8;if(f[r])for(var t=0;t<s;++t){var P=x(k,n),v=x(k,n+8);(4681>
r?m:b).push(new a(P,v));n+=16}else n+=16*s}e=h(k,n);f=null;d=Math.min(d>>14,e-1);g=Math.min(g>>14,e-1);for(e=d;e<=g;++e)(d=x(k,n+4+8*e))&&(!f||d.block<f.block||d.offset<f.offset)&&(f=d);k=[];if(null!=f)for(e=0;e<m.length;++e)g=m[e],g.maxv.block>=f.block&&g.maxv.offset>=f.offset&&k.push(g);m=k;k=[];for(e=0;e<m.length;++e)k.push(m[e]);for(e=0;e<b.length;++e)k.push(b[e]);k.sort(function(a,b){var c=a.minv.block-b.minv.block;return 0!=c?c:a.minv.offset-b.minv.offset});b=[];if(0<k.length){m=k[0];for(e=
1;e<k.length;++e)g=k[e],g.minv.block==m.maxv.block?m=new a(m.minv,g.maxv):(b.push(m),m=g);b.push(m)}return b};p.prototype.fetch=function(a,d,g,k){function f(){if(p>=m.length)return k(n);if(s){var a=new Uint8Array(s);e.readRecords(a,m[p].minv.offset,n,d,g,h);s=null;++p;return f()}var b=m[p],a=b.minv.block;e.data.slice(a,b.maxv.block+65536-a).fetch(function(a){s=r(a,b.maxv.block-b.minv.block+1);return f()})}var e=this;a=this.chrToIndex[a];if(void 0==a)return k([]);var h=this.indexToChr[a],m;void 0===
a?m=[]:(m=this.blocksForRange(a,d,g))||k(null,"Error in index fetch");var n=[],p=0,s;f()};p.prototype.readRecords=function(a,d,g,k,f,e){a:for(;;){for(var h="";d<a.length;){var m=a[d++];if(10==m){m=h.split("\t");if(m[this.colSeq-1]==e){var n=parseInt(m[this.colStart-1]),p=n;0<this.colEnd&&(p=parseInt(m[this.colEnd-1]));this.format&65536&&++n;n<=f&&p>=k&&g.push(h)}continue a}else h+=String.fromCharCode(m)}break}};p.prototype.fetchHeader=function(a){var d=this;d.data.slice(0,d.headerMax).fetch(function(g){if(!g)return a(null,
"Fetch failed");g=new Uint8Array(r(g,g.byteLength));for(var k=0,f="",e=[];k<g.length;){var h=g[k++];if(10==h)if(f.charCodeAt(0)==d.meta)e.push(f),f="";else return a(e);else f+=String.fromCharCode(h)}a(e)})};"undefined"!==typeof t&&(t.exports={connectTabix:m,TABIX_MAGIC:n})},{"./bin":4,"./lh3utils":24,"./spans":35}],41:[function(d,t,s){function p(a){this.genomes={};this.url=a}function m(){}function n(a){this.hub=a}function h(a,b,f){f=f||{};f.salt=!0;r(a,function(d,h){if(h)return b(null,h);var m=d.split(k),
q=new p(a);f.credentials&&(q.credentials=f.credentials);for(var s=0;s<m.length-2;s+=3)q[m[s+1]]=m[s+2];if(q.genomesFile){var v=z(a,q.genomesFile);r(v,function(a,e){if(e)return b(null,e);for(var c=a.split(g),d=0;d<c.length;++d){var h=c[d].split(k),m=new n(q);f.credentials&&(m.credentials=f.credentials);for(var p=0;p<h.length-2;p+=3)m[h[p+1]]=h[p+2];m.twoBitPath&&(m.twoBitPath=z(v,m.twoBitPath));m.genome&&m.trackDb&&(m.absURL=z(v,m.trackDb),q.genomes[m.genome]=m)}b(q)},f)}else b(null,"No genomesFile")},
f)}function x(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==typeof d){s=d("./utils");var r=s.textXHR,z=s.relativeURL,a=s.shallowCopy;d=d("./das");var b=d.DASStylesheet,q=d.DASStyle}var g=/\n\s*\n/,k=/(\w+) +(.+)\n?/,f=/subGroup[1-9]/;m.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};n.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);
r(this.absURL,function(d,h){if(h)return a(null,h);d=d.replace("\\\n"," ");for(var q=[],n={},p=d.split(g),r=0;r<p.length;++r){var s=p[r].replace(/\#.*/g,"").split(k),t=new m;t._db=b;for(var x=0;x<s.length-2;x+=3){var c=s[x+1],w=s[x+2];if(c.match(f)){t.subgroups||(t.subgroups={});for(var c=w.split(/\s/),w=c[0],C={name:c[1],tags:[],titles:[]},I=2;I<c.length;++I){var y=c[I].split(/=/);C.tags.push(y[0]);C.titles.push(y[1])}t.subgroups[w]=C}else if("subGroups"===c)for(c=w.split(/(\w+)=(\w+)/),t.sgm={},
I=0;I<c.length-2;I+=3)t.sgm[c[I+1]]=c[I+2];else t[s[x+1]]=s[x+2]}t.track&&(t.type||t.container||t.view||t.bigDataUrl)&&(q.push(t),n[t.track]=t)}p=[];r=[];for(c=0;c<q.length;++c)t=q[c],s=!0,t.parent&&(x=t.parent.split(/\s+/),(w=n[x[0]])?(t._parent=w,w.children||(w.children=[]),w.children.push(t),w&&(s=!1)):console.log("Couldn't find parent "+x[0]+"("+t.parent+")")),t.compositeTrack?r.push(t):s&&p.push(t);for(q=0;q<r.length;++q)if(n=r[q],n.children){t=!1;for(s=0;s<n.children.length;++s)c=n.children[s],
c.view&&(c.shortLabel=n.shortLabel+": "+c.shortLabel,p.push(c),t=!0);t||p.push(n)}b._tracks=p;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};m.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=z(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";
a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var f=0;f<b.length;++f){var d=b[f],g=d.toDallianceSource();a.overlay.push(g);if(g.style)for(var h=0;h<g.style.length;++h){var k=g.style[h];k.method=d.shortLabel;"transparentOverlay"==this.aggregate&&(k.style.ALPHA=0.5);a.style.push(k)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){f=b.split(/\s+/);if("bigBed"==f[0]&&this.bigDataUrl)return b=f[1]|0,f="+"==f[2],a.bwgURI=z(this._db.absURL,this.bigDataUrl),
a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&f&&(a.collapseSuperGroups=!0),a;if("bigWig"==f[0]&&this.bigDataUrl)return a.bwgURI=z(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==f[0]&&this.bigDataUrl)return a.bamURI=z(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=
!0),a;if("vcfTabix"==f[0]&&this.bigDataUrl)return a.uri=z(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)}};m.prototype.bigwigStyles=function(){var a=this.type;if(!a){for(a=this;a._parent&&!a.type;)a=a._parent;a=a.type}if(a){var a=a.split(/\s+/),f,d;3<=a.length&&(f=1*a[1],d=1*a[2]);var g;this.maxHeightPixels&&(a=this.maxHeightPixels.split(/:/),3==a.length?g=a[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));
a="bars";this.graphTypeDefault&&(a=this.graphTypeDefault);var h="black",k=null;this.color&&(h="rgb("+this.color+")");this.altColor&&(k="rgb("+this.altColor+")");var m=new b,n=new q;n.glyph="points"==a?"POINT":"HISTOGRAM";k?(n.COLOR1=h,n.COLOR2=k):n.BGCOLOR=h;n.HEIGHT=g||30;if(f||d)n.MIN=f,n.MAX=d;m.pushStyle({type:"default"},null,n);return m.styles}};m.prototype.bigbedStyles=function(){var e="on"==(""+this.get("itemRgb")).toLowerCase(),f=this.get("visibility")||"full",d=this.get("color"),d=d?"rgb("+
d+")":"blue",g=new b,h=new q;h.glyph="BOX";h.FGCOLOR="black";h.BGCOLOR=d;h.HEIGHT="full"==f||"pack"==f?12:8;h.BUMP="full"==f||"pack"==f;h.LABEL="full"==f||"pack"==f;h.ZINDEX=20;e&&(h.BGITEM=!0);(f=this.get("colorByStrand"))?(f=f.split(/\s+/),d=a(h),d.BGCOLOR="rgb("+f[0]+")",g.pushStyle({type:"bigwig",orientation:"+"},null,d),h=a(h),h.BGCOLOR="rgb("+f[1]+")",g.pushStyle({type:"bigwig",orientation:"-"},null,h)):g.pushStyle({type:"bigwig"},null,h);h=new q;h.glyph="BOX";h.FGCOLOR="black";e&&(h.BGITEM=
!0);h.BGCOLOR="red";h.HEIGHT=10;h.BUMP=!0;h.ZINDEX=20;g.pushStyle({type:"translation"},null,h);e=new q;e.glyph="BOX";e.FGCOLOR="black";e.BGCOLOR="white";e.HEIGHT=10;e.ZINDEX=10;e.BUMP=!0;e.LABEL=!0;g.pushStyle({type:"transcript"},null,e);return g.styles};"undefined"!==typeof t&&(t.exports={connectTrackHub:h,THUB_COMPARE:x})},{"./das":10,"./utils":48}],42:[function(d,t,s){if("undefined"!==typeof d)var p=d("./cbrowser").Browser,m=d("./utils").shallowCopy;p.prototype.mergeSelectedTiers=function(){for(var d=
[],h=[],p=0;p<this.selectedTiers.length;++p){var r=this.tiers[this.selectedTiers[p]];d.push(m(r.dasSource));for(var s=r.stylesheet.styles,a=0;a<s.length;++a){var b=s[a],q=m(b);q.method=r.dasSource.name.replace(/[()+*?]/g,"\\$&");q._methodRE=null;q.style=m(b.style);void 0===q.style.ZINDEX&&(q.style.ZINDEX=p);r.forceMin&&(q.style.MIN=r.forceMin);r.forceMax&&(q.style.MAX=r.forceMax);h.push(q)}}this.addTier({name:"Merged",merge:"concat",overlay:d,noDownsample:!0,style:h});this.setSelectedTier(this.tiers.length-
1)}},{"./cbrowser":6,"./utils":48}],43:[function(d,t,s){function p(a){for(var b=0;b<a.styles.length;++b){var d=a.styles[b].style;if("__SEQUENCE"===d.glyph)return d}}if("undefined"!==typeof d){var m=d("./cbrowser").Browser,n=d("./utils").makeElement;t=d("./das");var h=t.isDasBooleanTrue,x=t.copyStylesheet,r=d("./color").dasColourForName}var z={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};m.prototype.openTierPanel=function(a){if("tier"===this.uiMode&&this.manipulatingTier===a)this.hideToolPanel(),
this.setUiMode("none");else{var b=function(a){a.BGGRAD||(1==w?("LINEPLOT"==a.glyph||z[a.glyph]?a.FGCOLOR=M.value:a.BGCOLOR=M.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=M.value,a.COLOR2=H.value,a.COLOR3=2<w?L.value:null),a._gradient=null,a._plusColor=P.value,a._minusColor=v.value)},d=function(c){for(var b=x(a.stylesheet),e=a.browser.zoomForCurrentScale(),f=0;f<b.styles.length;++f){var d=b.styles[f];d.zoom&&d.zoom!=e||c(d.style)}return b},g=function(c){a.mergeStylesheet(d(b))};this.manipulatingTier=
a;var k=n("div",null,{className:"tier-edit"});if(a.dasSource.mapping){var f=this.chains[a.dasSource.mapping].coords;k.appendChild(n("div","Mapped from "+f.auth+f.version,null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"}))}var e=n("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center",display:"none"});k.appendChild(e);var m=n("input",null,{type:"text"}),s=n("input",null,{type:"checkbox",disabled:this.disablePinning}),
t=n("select");t.appendChild(n("option","Histogram",{value:"HISTOGRAM"}));t.appendChild(n("option","Line Plot",{value:"LINEPLOT"}));t.appendChild(n("option","Ribbon",{value:"GRADIENT"}));t.appendChild(n("option","Scatter",{value:"SCATTER"}));var M=n("input",null,{type:"text",value:"#dd00dd"}),H=n("input",null,{type:"text",value:"#dd00dd"}),L=n("input",null,{type:"text",value:"#dd00dd"}),P=n("input",null,{type:"text",value:"#ffa07a"}),v=n("input",null,{type:"text",value:"#87cefa"});try{M.type=H.type=
L.type="color",P.type=v.type="color"}catch(F){}var E=[M,H,L],f=n("i",null,{className:"fa fa-plus-circle"}),c=n("i",null,{className:"fa fa-minus-circle"}),w=1,C=n("td",E),I=function(a){w=a;for(var c=0;c<a;++c)E[c].style.display="block";for(c=a;c<E.length;++c)E[c].style.display="none"};f.addEventListener("click",function(a){3>w&&(I(w+1),g(null))},!1);c.addEventListener("click",function(a){1<w&&(I(w-1),g(null))},!1);var y=n("input",null,{type:"text",value:"0.0"}),D=n("input",null,{type:"text",value:"10.0"}),
A=n("input",null,{type:"checkbox"}),J=n("input",null,{type:"checkbox"}),l=n("input",null,{type:"checkbox",checked:void 0!==a.quantLeapThreshold}),G=n("input",null,{type:"text",value:a.quantLeapThreshold,disabled:!l.checked}),S=n("input",null,{type:"text",value:"50"}),K=n("input",null,{type:"checkbox"}),R=n("input",null,{type:"text"}),V=n("input",null,{type:"checkbox"}),Z=null;0<a.stylesheet.styles.length&&(Z=a.stylesheet.styles[0].style);var ja=function(){m.value="string"===typeof a.config.name?a.config.name:
a.dasSource.name;s.checked=a.pinned;a.forceHeight?S.value=""+a.forceHeight:Z&&Z.HEIGHT&&(S.value=""+Z.HEIGHT);"number"==typeof a.quantLeapThreshold?(l.checked=!0,G.disabled=!1,parseFloat(G.value)!=a.quantLeapThreshold&&(G.value=a.quantLeapThreshold)):(l.checked=!1,G.disabled=!0);R.value="number"==typeof a.subtierMax?""+a.subtierMax:""+(a.dasSource.subtierMax||a.browser.defaultSubtierMax);if(0<a.stylesheet.styles.length){for(var c=null,b=!1,f=!1,f=a.browser.zoomForCurrentScale(),d=0,g=0;g<a.stylesheet.styles.length;++g){var k=
a.stylesheet.styles[g];if(!k.zoom||k.zoom==f)if(++d,k=a.stylesheet.styles[g].style,c||(c=Z=k),"LINEPLOT"==k.glyph||"HISTOGRAM"==k.glyph||"GRADIENT"==k.glyph||h(k.SCATTER))b||(c=Z=k),b=!0}if(!c)return;e.style.display=d==a.stylesheet.styles.length?"none":"block";f=b&&1==d;b?(ma.style.display="table-row",oa.style.display="table-row",sa.style.display="none",ta.style.display="none"):(ma.style.display="none",oa.style.display="none",sa.style.display="table-row",K.checked=h(Z.BUMP),R.disabled=!h(Z.BUMP),
ta.style.display="table-row",V.checked=h(Z.LABEL));f?(ea.style.display="table-row",ra.style.display="table-row"):(ea.style.display="none",ra.style.display="none");d=1;c.COLOR1?(M.value=r(c.COLOR1).toHexString(),c.COLOR2&&(H.value=r(c.COLOR2).toHexString(),c.COLOR3?(L.value=r(c.COLOR3).toHexString(),d=3):d=2)):"LINEPLOT"==c.glyph||"DOT"==c.glyph&&c.FGCOLOR?M.value=r(c.FGCOLOR).toHexString():c.BGCOLOR&&(M.value=r(c.BGCOLOR).toHexString());I(d);c._plusColor&&(P.value=r(c._plusColor).toHexString()||c._plusColor);
c._minusColor&&(v.value=r(c._minusColor).toHexString()||c._minusColor);h(c.SCATTER)?t.value="SCATTER":t.value=c.glyph;var n,w;void 0!==c.MIN&&(d=parseFloat(c.MIN),isNaN(d)||(n=d));a.forceMinDynamic||void 0===c.MIN&&void 0===a.forceMin?(A.checked=!1,y.disabled=!0):(A.checked=!0,y.disabled=!1);void 0!==c.MAX&&(d=parseFloat(c.MAX),isNaN(d)||(w=d));a.forceMaxDynamic||void 0===c.MAX&&void 0===a.forceMax?(J.checked=!1,D.disabled=!0):(J.checked=!0,D.disabled=!1);void 0!=a.forceMin&&(n=a.forceMin);void 0!=
a.forceMax&&(w=a.forceMax);"number"==typeof n&&n!=parseFloat(y.value)&&(y.value=n);"number"==typeof w&&w!=parseFloat(D.value)&&(D.value=w);(c=p(a.stylesheet))?(ca.style.display="table-row",T.checked="mismatch"===c.__SEQCOLOR,ka.style.display="table-row",X.checked=h(c.__INSERTIONS),la.style.display="table-row",ga.checked=void 0===c.__disableQuals||!1===c.__disableQuals,console.log(c.__disableQuals)):(ca.style.display="none",ka.style.display="none",la.style.display="none");c&&T.checked&&!f?($.style.display=
"table-row",pa.style.display="table-row"):($.style.display="none",pa.style.display="none")}b&&a.browser.sourceAdapterIsCapable(a.featureSource,"quantLeap")?fa.style.display="table-row":fa.style.display="none"},T=n("input",null,{type:"checkbox"}),ca=n("tr",[n("th","Highlight mismatches & strands"),n("td",T)]);T.addEventListener("change",function(c){c=x(a.stylesheet);p(c).__SEQCOLOR=T.checked?"mismatch":"base";a.mergeStylesheet(c)});var X=n("input",null,{type:"checkbox"}),ka=n("tr",[n("th","Show insertions"),
n("td",X)]);X.addEventListener("change",function(c){c=x(a.stylesheet);p(c).__INSERTIONS=X.checked?"yes":"no";a.mergeStylesheet(c)});var ga=n("input",null,{type:"checkbox"}),la=n("tr",[n("th","Reflect base quality as base color transparency"),n("td",ga)]);ga.addEventListener("change",function(c){c=x(a.stylesheet);var b=p(c);b.__disableQuals=!ga.checked;console.log(b.__disableQuals);a.mergeStylesheet(c)});var ea=n("tr",[n("th","Style"),n("td",t)]),ra=n("tr",[n("th",["Colour(s)",f,c]),C]),$=n("tr",[n("th",
"Plus Strand Color"),n("td",P)]),pa=n("tr",[n("th","Minus Strand Color"),n("td",v)]),ma=n("tr",[n("th","Min value"),n("td",[A," ",y])]),oa=n("tr",[n("th","Max value"),n("td",[J," ",D])]),fa=n("tr",[n("th","Threshold leap:"),n("td",[l," ",G])]),sa=n("tr",[n("th","Bump overlaps"),n("td",[K," limit: ",R])]),ta=n("tr",[n("th","Label features"),n("td",V)]),f=n("table",[n("tr",[n("th","Name",{},{width:"150px",textAlign:"right"}),m]),n("tr",[n("th","Pin to top"),s]),n("tr",[n("th","Height"),n("td",S)]),
ea,ra,$,pa,ma,oa,fa,sa,ta,ca,ka,la]);ja();k.appendChild(f);f=n("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});f.addEventListener("click",function(c){a.setConfig({})},!1);k.appendChild(f);m.addEventListener("input",function(c){a.mergeConfig({name:m.value})},!1);s.addEventListener("change",function(c){a.mergeConfig({pinned:s.checked})},!1);for(f=0;f<E.length;++f)E[f].addEventListener("change",g,!1);P.addEventListener("change",g,!1);v.addEventListener("change",
g,!1);t.addEventListener("change",function(c){c=d(function(a){"SCATTER"===t.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=t.value,a.SCATTER=void 0);b(a)});a.mergeStylesheet(c)},!1);A.addEventListener("change",function(c){c={forceMinDynamic:!A.checked};y.disabled=!A.checked;var b=parseFloat(y.value);A.checked&&"number"==typeof b&&!isNaN(b)&&(c.forceMin=parseFloat(b));a.mergeConfig(c)});y.addEventListener("input",function(c){c=parseFloat(y.value);"number"!=typeof c||isNaN(c)||a.mergeConfig({forceMin:c})},
!1);J.addEventListener("change",function(c){c={forceMaxDynamic:!J.checked};D.disabled=!J.checked;var b=parseFloat(D.value);J.checked&&"number"==typeof b&&!isNaN(b)&&(c.forceMax=parseFloat(b));a.mergeConfig(c)});D.addEventListener("input",function(c){c=parseFloat(D.value);"number"!=typeof c||isNaN(c)||a.mergeConfig({forceMax:c})},!1);S.addEventListener("input",function(c){c=parseFloat(S.value);"number"!=typeof c||isNaN(c)||a.mergeConfig({height:Math.min(500,c|0)})},!1);var U=function(){G.disabled=
!l.checked;if(l.checked){var c=parseFloat(G.value);"number"!=typeof c||isNaN(c)||a.mergeConfig({quantLeapThreshold:parseFloat(G.value)})}else a.mergeConfig({quantLeapThreshold:null})};l.addEventListener("change",function(a){U()},!1);G.addEventListener("input",function(a){U()},!1);V.addEventListener("change",function(c){c=d(function(a){a.LABEL=V.checked?"yes":"no"});a.mergeStylesheet(c)},!1);K.addEventListener("change",function(c){c=d(function(a){a.BUMP=K.checked?"yes":"no"});a.mergeStylesheet(c)},
!1);R.addEventListener("input",function(c){c=parseInt(R.value);"number"==typeof c&&0<c&&a.mergeConfig({subtierMax:c})},!1);this.showToolPanel(k);this.setUiMode("tier");a.addTierListener(ja);var Y=a.browser.scale;a.browser.addViewListener(function(){a.browser.scale!=Y&&(Y=a.browser.scale,ja())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./utils":48}],44:[function(d,t,s){function p(a,b,d,g){this.config=d||{};this.id="tier"+ ++q;this.browser=a;this.dasSource=n(b);this.background=g;this.viewport=m("canvas",
null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=m("div",this.viewport,{className:"viewport-holder_12_5"},{background:g,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=m("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=m("div","",{className:"notifier"});this.notifierHolder=
m("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=m("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=m("i",null,{className:"fa fa-times"});this.bumpButton=m("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=m("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=m("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);
b.pennant?this.nameButton.appendChild(m("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(d=null,this.browser.chains[b.mapping]&&(d=this.browser.chains[b.mapping].coords.version),d&&this.nameButton.appendChild(m("span",""+d,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=m("span",b.name);this.nameButton.appendChild(m("span",[this.nameElement,this.infoElement],
{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=m("span",[this.nameButton],{className:"btn-group track-label"});this.row=m("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});g||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=
0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);this.initSources();var h=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&h.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){h.notify(a,
-1)});this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof d){s=d("./utils");var m=s.makeElement,n=s.shallowCopy,h=s.miniJSONify;s=d("./das");var x=s.DASStylesheet,r=s.DASStyle,z=d("./sha1").b64_sha1;s=d("./style");var a=s.StyleFilter,b=s.StyleFilterSet}var q=0;p.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};p.prototype.toString=function(){return this.id};p.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=
[]);this.featureInfoPlugins.push(a)};p.prototype.init=function(){var a=this;a.dasSource.style?(this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this)):(a.status="Fetching stylesheet",a.fetchStylesheet(function(b,d){if(d||!b){a.error="No stylesheet";b=new x;var g=new r;g.glyph="BOX";g.BGCOLOR="blue";g.FGCOLOR="black";b.pushStyle({type:"default"},null,g);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();
a.browser.refreshTier(a)}))};p.prototype.setStylesheet=function(a){this.baseStylesheet=n(a);for(a=0;a<this.baseStylesheet.styles.length;++a){var b=this.baseStylesheet.styles[a]=n(this.baseStylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=n(b.style);b.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=z(h(this.baseStylesheet));this._updateFromConfig()};p.prototype.getSource=function(){return this.featureSource};p.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};
p.prototype.getActiveStyleFilters=function(f){f=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var e=new b,d=this.stylesheet.styles,g=0;g<d.length;++g){var h=d[g];h.zoom&&h.zoom!=f||e.add(new a(h.type,h.method,h.label))}return e}};p.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};p.prototype.viewFeatures=function(a,b,d,g,h){this.currentFeatures=g;this.currentSequence=
h;this.notifyFeaturesLoaded();this.knownChr=a;this.knownCoverage=b;this.status&&(this.status=null,this._notifierToStatus());this.draw()};p.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?k(this,a):g(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};p.prototype.findNextFeature=function(a,b,d,g,h){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*d/2|0,this.featureSource.quantFindNextFeature(a,b,d,this.quantLeapThreshold,h);else{if(this.knownCoverage&&
b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var k=null,m=0;m<this.currentFeatures.length;++m){var n=this.currentFeatures[m];if(n.min&&n.max&&!(n.parents&&0<n.parents.length))if(0>d)if(1==g&&n.max>=b&&n.min<b){if(!k||n.min>k.min||n.min==k.min&&n.max<k.max)k=n}else n.max<b&&(!k||n.max>k.max||n.max==k.max&&n.min<k.min||n.min==k.mmin&&k.max>=b)&&(k=n);else if(1==g&&n.min<=b&&n.max>b){if(!k||n.max<k.max||n.max==k.max&&n.min>k.min)k=n}else n.min>b&&(!k||n.min<k.min||
n.min==k.min&&n.max>k.max||n.max==k.max&&k.min<=b)&&(k=n)}if(k)return h(k);b=0>d?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,b,d,h)}};p.prototype.trySourceFNF=function(a,b,d,g){var h=this;this.featureSource.findNextFeature(a,b,d,function(a){a||g(a);var b=h.browser.getSequenceSource();b||g(a);b.getSeqInfo(a.segment,function(b){b?g(a):h.trySourceFNF(a.segment,0<d?1E10:0,d,g)})})};p.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":
"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};p.prototype.updateHeight=function(){this.currentHeight=Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};p.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:
a.featurePanelWidth;var d=this.overlay.getContext("2d");b&&d.scale(2,2);var g=b=a.viewStart,h=a.viewEnd;if(this.overlayLabelCanvas){var k=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale;d.save();d.translate(k,0);var m=-k+2;this.dasSource.tierGroup&&(m+=15);this.overlayLabelCanvas.draw(d,m,a.featurePanelWidth-k);d.restore()}for(k=0;k<a.highlights.length;++k)m=a.highlights[k],(m.chr===a.chr||m.chr==="chr"+a.chr)&&m.min<h&&m.max>g&&(d.globalAlpha=a.defaultHighlightAlpha,d.fillStyle=
a.defaultHighlightFill,d.fillRect((m.min-b)*a.scale,0,(m.max-m.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=this.viewport.style.height;this.overlay.style.left="0px"};p.prototype.updateStatus=function(a){a?(this.status=a,this._notifierToStatus()):this.status&&(this.status=null,this._notifierToStatus())};p.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=
null);if(a){if(this._notifierOn(a),0<b){var d=this;this.notifierFadeTimeout=setTimeout(function(){d._notifierToStatus()},b)}}else this._notifierToStatus()};p.prototype._notifierOn=function(a){this.notifier.textContent=a;this.notifier.style.opacity=0.8};p.prototype._notifierOff=function(){this.notifier.style.opacity=0};p.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status):this._notifierOff()};p.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();
this.notifyTierListeners()};p.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};p.prototype.mergeConfig=function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};p.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var d=this.config.height||this.dasSource.forceHeight;d!=this.forceHeight&&
(this.forceHeight=d,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);d=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=d&&(this.forceMin=d,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);d=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=d&&(this.forceMax=d,a=!0);d=null;void 0!==this.config.quantLeapThreshold?
d=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(d=this.dasSource.quantLeapThreshold);d!=this.quantLeapThreshold&&(this.quantLeapThreshold=d,a=!0);d=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(d=this.config.stylesheet);d=d||this.baseStylesheet;this.stylesheet!==d&&(this.stylesheet=d,a=!0);d=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;d!==this.pinned&&(this.pinned=d,b=!0);d=typeof("number"===this.config.subtierMax)?this.config.subtierMax:
this.dasSource.subtierMax||this.browser.defaultSubtierMax;d!=this.subtierMax&&(this.subtierMax=d,a=!0);d=void 0!==this.config.bumped?this.config.bumped:void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;d!==this.bumped&&(this.bumped=d,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};p.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();
a.redrawTimeout=null},10))}};p.prototype.clearTierListeners=function(){this.listeners=[]};p.prototype.addTierListener=function(a){this.listeners.push(a)};p.prototype.notifyTierListeners=function(a){for(var b=0;b<this.listeners.length;++b)try{this.listeners[b](a)}catch(d){console.log(d)}this.browser.notifyTier()};p.prototype.clearFeaturesLoadedListeners=function(){this.featuresLoadedListeners=[]};p.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};p.prototype.notifyFeaturesLoaded=
function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof t){t.exports={DasTier:p};var g=d("./feature-draw").drawFeatureTier,k=d("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":18,"./sequence-draw":31,"./sha1":33,"./style":36,"./utils":48}],45:[function(d,t,s){function p(a,b){for(var e=0;e<a.length;++e){var c=a[e];c===b?c.classList.add("active"):c.classList.remove("active")}}if("undefined"!==
typeof d){t=d("./cbrowser");var m=t.Browser,n=t.sourcesAreEqual;t=d("./utils");var h=t.makeElement,x=t.removeChildren,r=t.Observed;t=d("./thub");var z=t.THUB_COMPARE,a=t.connectTrackHub,b=d("./domui").makeTreeTableSection,q=d("./probe").probeResource;t=d("./bin");var g=t.URLFetchable,k=t.BlobFetchable,f=t.readInt,e=d("./lh3utils").unbgzf,u=d("./bam").BAI_MAGIC,B=d("./tabix").TABIX_MAGIC;t=d("./das");var Q=t.DASSource,M=t.DASSegment,H=t.DASRegistry,L=t.coordsMatch,P=d("./encode").EncodeFetchable}m.prototype.currentlyActive=
function(a){for(var b=0;b<this.tiers.length;++b)if(n(this.tiers[b].dasSource,a))return this.tiers[b];return!1};m.prototype.makeButton=function(a,b){var e=h("a",a,{href:"#"});b&&this.makeTooltip(e,b);return h("li",e)};m.prototype.showTrackAdder=function(d){function m(a){da.style.display="none";ha.style.display="none";ba.style.display="none";U=!1;x(N);for(var c=h("div",null,{},{width:"100%"}),e=[],f=0;f<a.length;++f)e.push(a[f]);e.sort(function(a,c){return a.shortLabel.toLowerCase().trim().localeCompare(c.shortLabel.toLowerCase().trim())});
a=[];for(var d=[],f=0;f<e.length;++f){var g=e[f];g.children&&0<g.children.length&&"multiWig"!=g.container?a.push(g):d.push(g)}0<d.length&&a.push({shortLabel:"Others",priority:-1E8,children:d});a.sort(z);for(var k=[],e=0;e<a.length;++e){g=d=a[e];!g.dimensions&&g._parent&&g._parent.dimensions&&(g=g._parent);f={};if(g.dimensions)for(var n=g.dimensions.split(/(\w+)=(\w+)/),w=0;w<n.length-2;w+=3)f[n[w+1]]=n[w+2];if(f.dimX&&f.dimY){for(var q=f.dimX,p=f.dimY,f=g.subgroups[q],n=g.subgroups[p],w={},r=0;r<
d.children.length;++r){var C=d.children[r],g=C.sgm[q],y=C.sgm[p];w[g]||(w[g]={});w[g][y]=C}p=h("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});g=h("tr");g.appendChild(h("th",null,{},{width:"150px",height:"100px"}));for(y=0;y<f.titles.length;++y)q=h("th",h("div",f.titles[y],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",
verticalAlign:"bottom"}),g.appendChild(q);p.appendChild(g);for(var s=h("tbody",null,{className:"table table-striped table-condensed"}),u=0;u<n.titles.length;++u){var y=n.tags[u],A=h("tr");A.appendChild(h("th",n.titles[u]),{});for(var t=0;t<f.titles.length;++t){var g=f.tags[t],I=h("td");if(w[g]&&w[g][y]){g=w[g][y];r=g.toDallianceSource();if(!r)continue;q=h("tr");C=h("td");C.style.textAlign="center";var v=h("input");v.type="checkbox";v.dalliance_source=r;qa&&(v.dalliance_mapping=qa);k.push(v);I.appendChild(v);
v.addEventListener("change",function(a){a.target.checked?l.addTier(a.target.dalliance_source):l.removeTier(a.target.dalliance_source)})}A.appendChild(I)}s.appendChild(A)}p.appendChild(s);c.appendChild(b(d.shortLabel,p,0==e))}else{n=h("tbody",null,{className:"table table-striped table-condensed"});w=h("table",n,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});y=0;d.children.sort(z);for(f=0;f<d.children.length;++f)if(g=d.children[f],r=g.toDallianceSource())q=h("tr"),
C=h("td",null,{},{width:"30px"}),C.style.textAlign="center",v=h("input"),v.type="checkbox",v.dalliance_source=r,qa&&(v.dalliance_mapping=qa),k.push(v),C.appendChild(v),v.addEventListener("change",function(a){a.target.checked?l.addTier(a.target.dalliance_source):l.removeTier(a.target.dalliance_source)}),q.appendChild(C),p=h("td"),p.appendChild(document.createTextNode(g.shortLabel)),g.longLabel&&0<g.longLabel.length&&l.makeTooltip(p,g.longLabel),q.appendChild(p),n.appendChild(q),++y;1<a.length||"Others"!==
d.shortLabel?c.appendChild(b(d.shortLabel,w,0==e)):c.appendChild(w)}}var D=function(){for(var a=0;a<k.length;++a){var c=k[a],b=l.currentlyActive(c.dalliance_source);b?(c.checked=!0,c.disabled=null!=b.sequenceSource):c.checked=!1}};D();l.addTierListener(function(a){D()});N.appendChild(c)}function n(){p(G,la);U="bin";da.style.display="none";ha.style.display="inline";ba.style.display="none";x(N);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom URL-based data"));
a.appendChild(h("p",["You can add indexed binary data hosted on an web server that supports CORS (",h("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(h("br"));a.appendChild(document.createTextNode("URL: "));$=h("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild($);a.appendChild(h("br"));a.appendChild(h("b","- or -"));a.appendChild(h("br"));
a.appendChild(document.createTextNode("File: "));fa=h("input",null,{type:"file",multiple:"multiple"});a.appendChild(fa);a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.'));N.appendChild(a);$.focus()}function c(){p(G,ea);da.style.display="none";ha.style.display="inline";ba.style.display="none";U="hub-connect";da.style.visibility="hidden";x(N);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Connect to a track hub."));
a.appendChild(h("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));$=h("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild($);N.appendChild(a);$.focus()}function w(){p(G,ga);da.style.display="none";ha.style.display="inline";ba.style.display="none";U="das";x(N);var a=h("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(h("h3","Add custom DAS data"));a.appendChild(h("p",
"This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(h("br"));$=h("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild($);a.appendChild(h("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));N.appendChild(a);
$.focus()}function C(){if(U)if("das"===U){var a=$.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);a=new Q({name:"temporary",uri:a});va(a)}else if("bin"===U){var b=fa.files;if(b&&0<b.length){a=na=[];U="multiple";for(var e=0;e<b.length;++e){var f=b[e];f&&a.push({blob:f})}for(e=0;e<a.length;++e)aa(a[e]);ia()}else a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),b={uri:a},a=a.toLowerCase(),0==a.indexOf("https://www.encodeproject.org/")&&0<=a.indexOf("@@download")&&(b.transport="encode"),W(b)}else if("reset"===
U)w();else if("reset-bin"===U)n();else if("reset-hub"===U)c();else if("prompt-bai"===U)(b=fa.files)&&0<b.length&&b[0]?(Y.baiBlob=b[0],t(Y)):(b=Y,da.style.display="none",ha.style.display="inline",ba.style.display="inline",x(N),U="prompt-bai",N.appendChild(h("h2","Select an index file")),N.appendChild(h("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
N.appendChild(document.createTextNode("Index file: ")),fa=h("input",null,{type:"file"}),N.appendChild(fa),Y=b);else if("prompt-tbi"===U)(b=fa.files)&&0<b.length&&b[0]?(Y.indexBlob=b[0],A(Y)):(b=Y,da.style.display="none",ha.style.display="inline",ba.style.display="inline",x(N),U="prompt-tbi",N.appendChild(h("h2","Select an index file")),N.appendChild(h("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
N.appendChild(document.createTextNode("Index file: ")),fa=h("input",null,{type:"file"}),N.appendChild(fa),Y=b);else if("finalize"===U||"finalize-bin"===U)Y.name=pa.value,b=ma.value,Y.mapping="__default__"!=b?b:void 0,oa&&(Y.maxbins=oa.checked),1<sa.value.length&&1<ta.value.length&&(Y.xUser=sa.value,Y.xPass=ta.value),l.addTier(Y),"finalize-bin"==U?n():w();else if("hub-connect"===U)a=$.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),s(a);else{if("multiple"===U){for(b=0;b<na.length;++b)if(a=na[b],!a.hidden&&
("bam"!=a.tier_type||a.indexBlob||a.indexUri)&&("tabix"!=a.tier_type||a.indexBlob||a.indexUri)&&(a=wa(a)))a.noPersist=!0,l.addTier(a);n()}}else l.removeAllPopups()}function s(c,b,e){b=b||{};for(var f=0;f<l.hubObjects.length;++f){var d=l.hubObjects[f];if(d.hub.url==c){for(f=0;f<G.length;++f)G[f].hub==d&&p(G,G[f]);d.getTracks(function(a,c){c&&console.log(c);m(a)});return}}a(c,function(a,f){if(f){if(!e)return s(c,{credentials:!0},!0);x(N);N.appendChild(h("h2","Error connecting to track hub"));N.appendChild(h("p",
f));U="reset-hub"}else{var d=null,g=null,k;for(k in a.genomes){var n=null,w=!1;if(k==l.coordSystem.ucscName)w=!0;else for(var q in l.chains)k==l.chains[q].coords.ucscName&&(n=q,w=!0);w&&(w={url:c,genome:k},b.credentials&&(w.credentials=!0),n&&(w.mapping=n,a.genomes[k].mapping=n),l.hubs.push(w),l.hubObjects.push(a.genomes[k]),w=ca(a.genomes[k]),ra.appendChild(w),n&&d||(d=a.genomes[k],g=w))}d?(l.notifyTier(),p(G,g),d.getTracks(function(a,c){m(a)})):(x(N),N.appendChild(h("h2","No data for this genome")),
N.appendChild(h("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),N.appendChild(h("p","coordSystem.ucscName = "+l.coordSystem.ucscName)),U="reset-hub")}},b)}function y(a,c){var b=a.uri;if(c){var e=/(.+)\/[^\/]+\/?/.exec(b);e&&(b=e[1]+"/sources")}(new H(b,{credentials:a.credentials})).sources(function(b){if(!b||0==b.length)return c?O(a):y(a,!0);var e=null;if(1==b.length)e=b[0];else for(var f=0;f<b.length;++f)if(b[f].uri===a.uri){e=
b[f];break}f=b=!1;if(e&&(a.name=e.name,a.desc=e.desc,a.maxbins=e.maxbins?!0:!1,e.capabilities&&(a.capabilities=e.capabilities),f=!0,e.coords&&1==e.coords.length))if(e=e.coords[0],L(e,l.coordSystem))b=!0;else if(l.chains)for(var d in l.chains)L(e,l.chains[d].coords)&&(a.mapping=d,b=!0);return O(a,b,f)},function(){return c?O(a):y(a,!0)})}function t(a){(a.baiBlob?new k(a.baiBlob):"encode"==a.transport?new P(a.bamURI+".bai"):new g(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(c){var b=
!1;c&&(c=new Uint8Array(c),b=f(c,0)==u);return b?O(a,!1,!1,!0):J("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function A(a){(a.indexBlob?new k(a.indexBlob):new g(a.uri+".tbi")).slice(0,65536).fetch(function(c){var b=!1;if(c){var d=new Uint8Array(c);if(31==d[0]||139==d[1])c=e(c),d=new Uint8Array(c),b=f(d,0)==B}return b?O(a,!1,!1,!0):J('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function J(a){da.style.display="none";ha.style.display="inline";ba.style.display="inline";x(N);a=a||"Custom data format not recognized";N.appendChild(h("h2","Error adding custom data"));N.appendChild(h("p",a));N.appendChild(h("p","Currently supported formats are bigBed, bigWig, and BAM."));U="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var l=this;d=h("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var G=[],S,K;if(!this.noRegistryTabs){var R=this.makeButton("Registry","Browse compatible datasources from the DAS registry");G.push(R);for(var V in this.mappableSources)(function(a){var c=l.makeButton(l.chains[a].srcTag,"Browse datasources mapped from "+l.chains[a].srcTag);G.push(c);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();p(G,c);S(l.mappableSources[a],a)},!1)})(V)}V={};for(var Z=0;Z<this.defaultSources.length;++Z){var ja=
this.defaultSources[Z],T=ja.group||"Defaults";V[T]?V[T].push(ja):V[T]=[ja]}var ca=function(a){var b=a.hub,e=h("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),f=b.shortLabel||"Unknown";a.mapping&&(f=f+" ("+a.genome+")");var f=h("span",[f," ",e]),d=l.makeButton(f,b.longLabel);d.hub=a;G.push(d);d.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();p(G,d);x(N);c=l.makeLoader(24);c.style.marginLeft="auto";c.style.marginRight="auto";c.style.marginTop="100px";N.appendChild(h("div",
c,null,{textAlign:"center"}));da.style.display="none";ha.style.display="none";ba.style.display="none";a.getTracks(function(a,c){c&&console.log(c);m(a)})},!1);e.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();var e=h("li",h("a","Remove hub")),f=h("li",h("a","Enable all")),g=h("li",h("a","Disable all")),k=h("ul",[e,f,g],{className:"dropdown-menu"},{display:"block"}),m=b.clientX;b=b.clientY;m+=document.documentElement.scrollLeft||document.body.scrollLeft;b+=document.documentElement.scrollTop||
document.body.scrollTop;k.style.position="absolute";k.style.top=""+(b+10)+"px";k.style.left=""+(m-30)+"px";l.hPopupHolder.appendChild(k);var n=function(a){console.log("cc");document.body.removeEventListener("click",n,!0);l.hPopupHolder.removeChild(k)};document.body.addEventListener("click",n,!0);e.addEventListener("click",function(b){for(b=0;b<l.hubObjects.length;++b)if(l.hubObjects[b].absURL==a.absURL){l.hubObjects.splice(b,1);break}for(b=0;b<l.hubs.length;++b){var e=l.hubs[b];"string"===typeof e&&
(e={url:e});if(e.url==a.hub.url&&!e.genome||e.genome==a.genome){l.hubs.splice(b,1);break}}l.notifyTier();ra.removeChild(d);p(G,ea);c()},!1);f.addEventListener("click",function(c){a.getTracks(function(a,c){c&&console.log(c);for(var b=0;b<a.length;++b){var e=a[b].toDallianceSource();l.currentlyActive(e)||l.addTier(e)}})},!1);g.addEventListener("click",function(c){a.getTracks(function(a,c){c&&console.log(c);for(var b=0;b<a.length;++b){var e=a[b].toDallianceSource();l.currentlyActive(e)&&l.removeTier(e)}})},
!1)},!1);return d},X=null,ka=null;for(T in V)(function(a,c){var b=l.makeButton(a,"Browse the default set of data for this browser");b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();p(G,b);S(new r(c))},!1);G.push(b);X||(X=b,ka=c)})(T,V[T]);var ga=this.makeButton("DAS","Add arbitrary DAS data");G.push(ga);var la=this.makeButton("Binary","Add data in bigwig or bigbed format");G.push(la);for(T=0;T<this.hubObjects.length;++T)ca(this.hubObjects[T]);var ea=this.makeButton("+",
"Connect to a new track-hub");G.push(ea);var ra=h("ul",G,{className:"nav nav-tabs"},{marginBottom:"0px"});d.appendChild(ra);var $,pa,ma,oa,fa,sa,ta,U=!1,Y=null,T=h("form",null,{},{display:"inline-block",width:"100%"});T.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();C();return!1},!0);var N=h("div");N.style.position="relative";N.style.overflow="scroll";T.appendChild(N);var qa,ua;S=function(a,c){da.style.display="none";ha.style.display="none";ba.style.display="none";ua&&
ua.removeListener(K);qa=c;ua=a;ua.addListenerAndFire(K)};K=function(a){U=!1;var c=[];x(N);if(a){for(var b=h("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),e=h("table",b,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),f=0,d=[],g=0;g<a.length;++g)d.push(a[g]);d.sort(function(a,c){return a.name.toLowerCase().trim().localeCompare(c.name.toLowerCase().trim())});for(g=0;g<d.length;++g){a=d[g];var k=h("tr"),m=h("td",null,{},{width:"30px"});
m.style.textAlign="center";if(!a.props||a.props.cors){var n=h("input");n.type="checkbox";n.dalliance_source=a;qa&&(n.dalliance_mapping=qa);m.appendChild(n);c.push(n);n.addEventListener("change",function(a){a.target.checked?l.addTier(a.target.dalliance_source):l.removeTier(a.target.dalliance_source)})}else m.appendChild(document.createTextNode("!")),l.makeTooltip(m,h("span",["This data source isn't accessible because it doesn't support ",h("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));k.appendChild(m);
m=h("td");m.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&l.makeTooltip(m,a.desc);k.appendChild(m);b.appendChild(k);++f}var w=function(){for(var a=0;a<c.length;++a){var b=c[a];l.currentlyActive(b.dalliance_source)?b.checked=!0:b.checked=!1}};w();l.addTierListener(function(a){w()});N.appendChild(e)}else N.appendChild(h("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};R&&R.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();p(G,R);S(l.availableSources)},!1);la.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();n()},!1);ea.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c()},!1);ga.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();w()},!1);var ha=h("button","Add",{className:"btn btn-primary"});ha.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();C()},!1);var va=function(a,c){var b=l.knownSpace;
if(b){var e=Math.max(b.min,(b.min+b.max-100)/2)|0,b=new M(b.chr,e,Math.min(e+99,b.max));a.features(b,{},function(b,e){if(e)c?(x(N),N.appendChild(h("h2","Custom data not found")),N.appendChild(h("p","DAS uri: "+a.uri+" is not answering features requests")),U="reset"):(a.credentials=!0,va(a,!0));else{var f=/\/([^/]+)\/?$/.exec(a.uri);f&&(a.name=f[1]);y(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},wa=function(a){var c={name:a.name};a.credentials&&(c.credentials=a.credentials);
a.mapping&&"__default__"!=a.mapping&&(c.mapping=a.mapping);a.transport&&(c.transport=a.transport);if("bwg"==a.tier_type)return a.blob?c.bwgBlob=a.blob:a.uri&&(c.bwgURI=a.uri),c;if("bam"==a.tier_type)return a.blob?(c.bamBlob=a.blob,c.baiBlob=a.indexBlob):(c.bamURI=a.uri,c.baiURI=a.indexUri),c;if("tabix"==a.tier_type)return c.tier_type="tabix",c.payload=a.payload,a.blob?(c.blob=a.blob,c.indexBlob=a.indexBlob):(c.uri=a.uri,c.indexUri=a.indexUri),c;if("memstore"==a.tier_type)return c.tier_type="memstore",
c.payload=a.payload,a.blob?c.blob=a.blob:c.uri=a.uri,c},W=function(a){q(a,function(a,c){if(c)x(N),N.appendChild(h("h2","Couldn't access custom data")),N.appendChild(h("p",""+c)),U="reset-bin";else{var b=wa(a);return"bam"==a.tier_type?t(b):"tabix"==a.tier_type?A(b):O(b,!1,!1,!0)}})},O=function(a,c,b,e){da.style.display="none";ha.style.display="inline";ba.style.display="inline";x(N);N.appendChild(h("h2","Add custom data: step 2"));N.appendChild(document.createTextNode("Label: "));pa=h("input","",{value:a.name});
N.appendChild(pa);sa=h("input","");ta=h("input","");N.appendChild(h("br"));N.appendChild(h("br"));N.appendChild(h("h4","Coordinate system: "));ma=h("select",null);ma.appendChild(h("option",l.nameForCoordSystem(l.coordSystem),{value:"__default__"}));if(l.chains)for(var f in l.chains)ma.appendChild(h("option",l.nameForCoordSystem(l.chains[f].coords),{value:f}));ma.value=a.mapping||"__default__";N.appendChild(ma);c?N.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):(N.appendChild(h("p",
[h("b","Warning: "),"unable to determine the correct value from server responses.  Please check carefully."])),N.appendChild(h("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));e||(N.appendChild(document.createTextNode("Quantitative: ")),oa=h("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(oa.checked=a.maxbins),N.appendChild(oa),b?N.appendChild(h("p","(Based on server response, probably doesn't need changing.)")):N.appendChild(h("p",
[h("b","Warning: "),"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&N.appendChild(h("p",[h("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));pa.focus();U="bin"===U||"prompt-bai"===U||"prompt-tbi"===U?"finalize-bin":"finalize";Y=a},na=null,aa=function(a){q(a,function(a,c){c&&(a.error=c);for(var b=[],e={},f={},d=0;d<na.length;++d){var g=na[d];"bam"!=g.tier_type||g.indexBlob||(e[g.blob.name]=
g);"tabix"!=g.tier_type||g.indexBlob||(f[g.blob.name]=g)}for(d=0;d<na.length;++d)if(g=na[d],"bai"===g.tier_type){var k=/(.+)\.bai$/.exec(g.blob.name);k&&e[k[1]]&&(e[k[1]].indexBlob=g.blob,b.push(d))}else"tabix-index"===g.tier_type&&(k=/(.+)\.tbi$/.exec(g.blob.name))&&f[k[1]]&&(f[k[1]].indexBlob=g.blob,b.push(d));for(e=b.length-1;0<=e;--e)na.splice(b[e],1);ia()})},ia=function(){x(N);var a=!1,c=h("table",na.filter(function(a){return!a.hidden}).map(function(c){h("tr").appendChild(h("td",c.name||c.blob.name));
var b;b=c.error?h("span","Error",null,{color:"red"}):c.tier_type?c.payload||c.tier_type:l.makeLoader(16);var e,f="unknown";"bwg"==c.tier_type||"memstore"==c.tier_type?f="okay":"bam"==c.tier_type?f=c.indexBlob?"okay":"needs-index":"tabix"==c.tier_type&&(f=c.indexBlob?"okay":"needs-index");if("okay"==f){e=h("select",null,null,{width:"150px"});e.appendChild(h("option",l.nameForCoordSystem(l.coordSystem),{value:"__default__"}));if(l.chains)for(var d in l.chains)e.appendChild(h("option",l.nameForCoordSystem(l.chains[d].coords),
{value:d}));e.value=c.mapping||"__default__";e.addEventListener("change",function(a){c.mapping=e.value;console.log(c)},!1)}else"needs-index"==f&&(e=h("span","Needs index",{},{color:"red"}),a=!0);return h("tr",[h("td",c.name||c.blob.name),h("td",b),h("td",e)])}),{className:"table table-striped table-condensed"});N.appendChild(c);if(a){N.appendChild(h("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
N.appendChild(document.createTextNode("Index file(s): "));var b=h("input",null,{type:"file",multiple:"multiple"});N.appendChild(b);b.addEventListener("change",function(a){console.log("fileset changed");a=b.files||[];for(var c=0;c<a.length;++c){var e=a[c];e&&(e={blob:e,hidden:!0},na.push(e),aa(e))}},!1)}},ba=h("button","Cancel",{className:"btn"});ba.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===U?n():w()},!1);var da=h("button","Refresh",{className:"btn"});
da.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();l.queryRegistry(qa)},!1);this.makeTooltip(da,"Click to re-fetch data from the DAS registry");V=h("div",[ha," ",ba," ",da]);V.style.margin="10px";T.appendChild(V);d.appendChild(T);S(l.availableSources);this.showToolPanel(d);this.setUiMode("add");X&&(p(G,X),S(new r(ka)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./encode":12,"./lh3utils":24,"./probe":28,"./tabix":40,"./thub":41,"./utils":48}],46:[function(d,
t,s){function p(d,h,p){h.fetchAsText(function(h){if(!h)return p(null,"Couldn't fetch index-index");h=h.split(/(.+)([0-9A-F]{10})\n/);for(var s=[],a=[],b=1;b<h.length;b+=3)s.push(h[b]),a.push(parseInt(h[b+1],16));return p(new m(s,a,d))})}function m(d,h,m){this.keys=d;this.offsets=h;this.ix=m}m.prototype.lookup=function(d,h){for(var m,p=(d+"     ").substring(0,5).toLowerCase(),s=0;s<this.keys.length;++s)if(0>p.localeCompare(this.keys[s])){m=this.ix.slice(this.offsets[s-1],this.offsets[s]-this.offsets[s-
1]);break}m||(m=this.ix.slice(this.offsets[this.offsets.length-1]));m.fetchAsText(function(a){a=a.split("\n");for(var b=0;b<a.length;++b)if(0==a[b].indexOf(d.toLowerCase()+" "))return h(a[b].split(" "));return h(null)})};"undefined"!==typeof t&&(t.exports={connectTrix:p})},{}],47:[function(d,t,s){function p(){}function m(a,f){var e=new p;e.data=a;e.data.slice(0,12500).fetch(function(a){if(!a)return f(null,"Couldn't access data");var d=new Uint8Array(a);a=h(d,0);if(a==b)e.readInt=h;else if(a==q)e.readInt=
x;else return f(null,"Not a .2bit file, magic=0x"+a.toString(16));a=e.readInt(d,4);if(0!=a)return f(null,"Unsupported version "+a);e.seqCount=e.readInt(d,8);e.seqDict={};var g=16,k=0,m=0,p=function(){for(;k<e.seqCount;){var a=d[g];if(g+a+6>=d.length)return e.data.slice(m+g,12500).fetch(function(a){m+=g;g=0;d=new Uint8Array(a);p()});++g;for(var b="",h=1;h<=a;++h)b+=String.fromCharCode(d[g++]);a=e.readInt(d,g);g+=4;e.seqDict[b]=new n(e,a);++k}return f(e)};p()})}function n(a,b){this.tbf=a;this.offset=
b}if("undefined"!==typeof d){s=d("./bin");var h=s.readInt,x=s.readIntBE;d=d("./spans");var r=d.Range,z=d.union,a=d.intersection}var b=440477507,q=1126646042;p.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};p.prototype.fetch=function(a,b,e,d){var g=this.getSeq(a);if(g){if(e<=b)return d("");g.fetch(b,e,d)}else return d(null,"Couldn't find "+a)};n.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(e){if(!e)return a("Fetch failed");
e=new Uint8Array(e);b._length=b.tbf.readInt(e,0);b.nBlockCnt=b.tbf.readInt(e,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(e){if(!e)return a("Fetch failed");e=new Uint8Array(e);for(var d=null,g=0;g<b.nBlockCnt;++g)var h=b.tbf.readInt(e,4*g),m=b.tbf.readInt(e,4*(g+b.nBlockCnt)),h=new r(h,h+m-1),d=d?z(d,h):h;b.nBlocks=d;b.mBlockCnt=b.tbf.readInt(e,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var g=["T","C","A","G"];
n.prototype.fetch=function(b,d,e){--b;--d;var h=this;this.init(function(m){if(m)return e(null,m);var n=b>>2;m=d+3>>2;if(0>n||m>h.seqLength)return e("Coordinates out of bounds: "+b+":"+d);h.tbf.data.slice(h.seqOffset+n,m-n).salted().fetch(function(m){function q(a){for(;x<=a;){var b=x&3,e=p[(x>>2)-n];t+=g[0==b?e>>6&3:1==b?e>>4&3:2==b?e>>2&3:e&3];++x}}if(null==m)return e("SeqFetch failed");var p=new Uint8Array(m);m=[];if(h.nBlocks){var s=a(new r(b,d),h.nBlocks);s&&(m=s.ranges())}for(var t="",x=b,s=0;s<
m.length;++s){var z=m[s];if(x>z.min())throw"N mismatch...";for(x<z.min()&&q(z.min()-1);x<=z.max();)t+="N",++x}x<=d&&q(d);return e(t)})})};n.prototype.length=function(a){var b=this;this.init(function(e){return e?a(null,e):a(b._length)})};"undefined"!==typeof t&&(t.exports={makeTwoBit:m})},{"./bin":4,"./spans":35}],48:[function(d,t,s){function p(a,b){for(var e=0;e<a.length;++e)if(a[e]==b)return;a.push(b)}function m(a,b,e){a[b]?a[b].push(e):a[b]=[e]}function n(a,b,e){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==
e)return;d.push(e)}else a[b]=[e]}function h(a,b,e,d){if(a)return a;if(b)return b;if(e)return e;if(d)return d}function p(a,b){for(var e=0;e<a.length;++e)if(a[e]==b)return;a.push(b)}function x(a,b){if(!a)return-1;for(var e=0;e<a.length;++e)if(a[e]===b)return e;return-1}function r(a,b,e,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var f=0;f<b.length;++f){var g=b[f];g&&("string"==typeof g?g=document.createTextNode(g):"number"==typeof g&&(g=document.createTextNode(""+g)),a.appendChild(g))}}if(e)for(var c in e)try{a[c]=
e[c]}catch(h){throw console.log("error setting "+c),h;}if(d)for(c in d)a.style[c]=d[c];return a}function z(a,b,e,d){a=document.createElementNS(a,b);if(e)for(e instanceof Array||(e=[e]),b=0;b<e.length;++b){var f=e[b];"string"==typeof f&&(f=document.createTextNode(f));a.appendChild(f)}if(d)for(var g in d){e=a;b=g;var f=d[g],c=Q[b];if(!c){for(var c="",h=0;h<b.length;++h)var k=b.substring(h,h+1),m=k.toLowerCase(),c=m!=k?c+"-"+m:c+k;Q[b]=c}e.setAttribute(c,f)}return a}function a(a){if(a&&a.childNodes)for(;0<
a.childNodes.length;)a.removeChild(a.firstChild)}function b(a,e){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var d=null,f=0;f<a.length;++f)d=(null==d?"":d+", ")+b(a[f],e);return"["+(d?d:"")+"]"}e=e||{};d=null;for(f in a)e[f]||void 0!=f&&"function"!=typeof a[f]&&(d=(null==d?"":d+", ")+f+": "+b(a[f],e));return"{"+(d?d:"")+"}"}return typeof a}
function q(a){var b={},e;for(e in a)b[e]=a[e];return b}function g(a){this.value=a;this.listeners=[]}function k(){this.queue=[]}function f(a,b,e){e&&e.salt&&(a=a+"?salt="+B(""+Date.now()+","+ ++M));var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(300<=d.status?b(null,"Error code "+d.status):b(d.responseText))};d.open("GET",a,!0);d.responseType="text";e&&e.credentials&&(d.withCredentials=!0);d.send("")}function e(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;
var e=a.lastIndexOf("/");return 0<=e?a.substr(0,e+1)+b:b}function u(a){return r("a",null,{href:a}).href}if("undefined"!==typeof d)var B=d("./sha1").b64_sha1;var Q={};g.prototype.addListener=function(a){this.listeners.push(a)};g.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};g.prototype.removeListener=function(a){var b=this.listeners;a=x(b,a);0<=a&&b.splice(a,1)};g.prototype.get=function(){return this.value};g.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};
k.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};k.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var M=0;d={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",
ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof t&&(t.exports={textXHR:f,relativeURL:e,resolveUrlToPage:u,shallowCopy:q,
pusho:m,pushnew:p,pushnewo:n,arrayIndexOf:x,pick:h,makeElement:r,makeElementNS:z,removeChildren:a,miniJSONify:b,Observed:g,Awaited:k,AMINO_ACID_TRANSLATION:d})},{"./sha1":33}],49:[function(d,t,s){function p(){this.info=[]}function m(a,b){this.parser=a;this.sink=b}if("undefined"!==typeof d){var n=d("./sourceadapters").registerParserFactory;d=d("./das");var h=d.DASStylesheet,x=d.DASStyle,r=d.DASFeature}var z=/([^;=]+)(=([^;]+))?;?/,a=/##INFO=<([^>]+)>/,b=/([^,=]+)=([^,]+|"[^"]+"),?/;p.prototype.createSession=
function(a){return new m(this,a)};m.prototype.parse=function(d){if(0!=d.length)if("#"==d[0]){if(1<d.length&&"#"==d[1]&&(d=a.exec(d))){var g=d[1].split(b),h=null,f=null;for(d=0;d<g.length-1;d+=3){var e=g[d+1],m=g[d+2].replace(/"/g,"");"ID"==e?h=m:"Description"==e&&(f=m)}h&&f&&this.parser.info.push({id:h,desc:f})}}else{g=d.split("\t");h=new r;h.segment=g[0];h.id=g[2];h.refAllele=g[3];h.altAlleles=g[4].split(",");h.min=parseInt(g[1]);h.max=h.min+h.refAllele.length-1;g=g[7].split(z);h.info={};for(d=0;d<
g.length;d+=4)h.info[g[d+1]]=g[d+3];d=h.altAlleles[0];g=h.refAllele;d.length>g.length?(h.type="insertion",0==d.indexOf(g)?(h.insertion=d.substr(g.length),h.min+=g.length,h.max=h.min-1):h.insertion=d):h.type=d.length<g.length?"deletion":"substitution";this.sink(h)}};m.prototype.flush=function(){};p.prototype.getStyleSheet=function(a){var b=new h,d=new x;d.glyph="__INSERTION";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"insertion"},
null,d);d=new x;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(255, 60, 60)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"deletion"},null,d);d=new x;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"default"},null,d);return a(b)};p.prototype.getDefaultFIPs=function(a){var b=this;a(function(a,d){d.add("Ref. allele",a.refAllele);d.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var e=
0;e<b.info.length;++e){var h=b.info[e],m=a.info[h.id];void 0!==m&&d.add(h.desc,m)}})};n("vcf",function(){return new p})},{"./das":10,"./sourceadapters":34}],50:[function(d,t,s){d={CONFIG:5,MAJOR:0,MINOR:13,MICRO:2,PATCH:"",BRANCH:"",toString:function(){var d=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(d+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(d=d+"-"+this.BRANCH);return d}};"undefined"!==typeof t&&(t.exports=d)},{}],51:[function(d,t,s){function p(){function d(a){a=Math.min(a,q);f=
a=Math.max(a,b);r.style.left=""+f+"px"}function h(a){a=Math.min(a,q);e=a=Math.max(a,b);s.style.left=""+e+"px"}var p=m("hr",null,{className:"slider-track"}),r=m("hr",null,{className:"slider-thumb active"}),s=m("hr",null,{className:"slider-thumb"}),a=m("div",[p,r,s],{className:"slider"}),b=0,q=200,g=0,k=200,f=50,e=100,t=[];a.removeLabels=function(){for(var b=0;b<t.length;++b)a.removeChild(t[b]);t=[]};a.addLabel=function(e,d){var f=m("div",d,{className:"slider-label"},{left:""+(b+(e-g)*(q-b)/(k-g)|0)+
"px"});a.appendChild(f);t.push(f)};var B=document.createEvent("HTMLEvents");B.initEvent("change",!0,!1);Object.defineProperty(a,"value",{get:function(){return g+(f-b)*(k-g)/(q-b)},set:function(a){d(b+(a-g)*(q-b)/(k-g))}});Object.defineProperty(a,"value2",{get:function(){return g+(e-b)*(k-g)/(q-b)},set:function(a){h(b+(a-g)*(q-b)/(k-g))}});Object.defineProperty(a,"active",{get:function(){return r.classList.contains("active")?1:2},set:function(a){1==a?(r.classList.add("active"),s.classList.remove("active")):
(s.classList.add("active"),r.classList.remove("active"))}});Object.defineProperty(a,"min",{get:function(){return g},set:function(a){g=a}});Object.defineProperty(a,"max",{get:function(){return k},set:function(a){k=a}});var Q,M,p=function(b){M=this==r?1:2;M!=a.active&&(a.active=M,a.dispatchEvent(B));b.stopPropagation();b.preventDefault();window.addEventListener("mousemove",H,!1);window.addEventListener("mouseup",L,!1);Q=b.clientX-(1==M?f:e)};r.addEventListener("mousedown",p,!1);s.addEventListener("mousedown",
p,!1);var H=function(b){1==M?d(b.clientX-Q):h(b.clientX-Q);a.dispatchEvent(B)},L=function(a){window.removeEventListener("mousemove",H,!1);window.removeEventListener("mouseup",L,!1)};return a}if("undefined"!==typeof d)var m=d("./utils").makeElement;"undefined"!==typeof t&&(t.exports=p)},{"./utils":48}],52:[function(d,t,s){t=d("./promise/promise").Promise;d=d("./promise/polyfill").polyfill;s.Promise=t;s.polyfill=d},{"./promise/polyfill":57,"./promise/promise":58}],53:[function(d,t,s){var p=d("./utils").isArray,
m=d("./utils").isFunction;s.all=function(d){if(!p(d))throw new TypeError("You must pass an array to all.");return new this(function(h,p){function r(b){return function(d){s[b]=d;0===--a&&h(s)}}var s=[],a=d.length,b;0===a&&h([]);for(var q=0;q<d.length;q++)(b=d[q])&&m(b.then)?b.then(r(q),p):(s[q]=b,0===--a&&h(s))})}},{"./utils":62}],54:[function(d,t,s){(function(d,m){function n(){return function(){d.nextTick(r)}}function h(){var b=0,d=new a(r),e=document.createTextNode("");d.observe(e,{characterData:!0});
return function(){e.data=b=++b%2}}function t(){return function(){b.setTimeout(r,1)}}function r(){for(var a=0;a<q.length;a++){var b=q[a];(0,b[0])(b[1])}q=[]}var z="undefined"!==typeof window?window:{},a=z.MutationObserver||z.WebKitMutationObserver,b="undefined"!==typeof m?m:void 0===this?window:this,q=[],g;g="undefined"!==typeof d&&"[object process]"==={}.toString.call(d)?n():a?h():t();s.asap=function(a,b){1===q.push([a,b])&&g()}}).call(this,d("/Users/pkok/repos/transmart-1.2/dalliance-plugin/web-app/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),
"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"/Users/pkok/repos/transmart-1.2/dalliance-plugin/web-app/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":63}],55:[function(d,t,s){s.cast=function(d){return d&&"object"===typeof d&&d.constructor===this?d:new this(function(m){m(d)})}},{}],56:[function(d,t,s){var p={instrument:!1};s.config=p;s.configure=function(d,n){if(2===arguments.length)p[d]=n;else return p[d]}},
{}],57:[function(d,t,s){(function(p){var m=d("./promise").Promise,n=d("./utils").isFunction;s.polyfill=function(){var d;d="undefined"!==typeof p?p:"undefined"!==typeof window&&window.document?window:self;"Promise"in d&&"cast"in d.Promise&&"resolve"in d.Promise&&"reject"in d.Promise&&"all"in d.Promise&&"race"in d.Promise&&function(){var m;new d.Promise(function(d){m=d});return n(m)}()||(d.Promise=m)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":58,
"./utils":62}],58:[function(d,t,s){function p(a){if(!e(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof p))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[];m(a,this)}function m(a,e){function c(a){z(e,a)}function d(a){b(e,a)}try{a(c,d)}catch(f){d(f)}}function n(a,d,c,f){var g=e(c),h,k,m,n;if(g)try{h=c(f),m=
!0}catch(p){n=!0,k=p}else h=f,m=!0;r(d,h)||(g&&m?z(d,h):n?b(d,k):a===P?z(d,h):a===v&&b(d,h))}function h(a,b,c,e){a=a._subscribers;var d=a.length;a[d]=b;a[d+P]=c;a[d+v]=e}function x(a,b){for(var c,e,d=a._subscribers,f=a._detail,g=0;g<d.length;g+=3)c=d[g],e=d[g+b],n(b,c,e,f);a._subscribers=null}function r(d,g){var c=null,h;try{if(d===g)throw new TypeError("A promises callback cannot return that same promise.");if(f(g)&&(c=g.then,e(c)))return c.call(g,function(c){if(h)return!0;h=!0;g!==c?z(d,c):a(d,
c)},function(a){if(h)return!0;h=!0;b(d,a)}),!0}catch(k){if(h)return!0;b(d,k);return!0}return!1}function z(b,e){b===e?a(b,e):r(b,e)||a(b,e)}function a(a,b){a._state===H&&(a._state=L,a._detail=b,k.async(q,a))}function b(a,b){a._state===H&&(a._state=L,a._detail=b,k.async(g,a))}function q(a){x(a,a._state=P)}function g(a){x(a,a._state=v)}var k=d("./config").config;d("./config");var f=d("./utils").objectOrFunction,e=d("./utils").isFunction;d("./utils");t=d("./cast").cast;var u=d("./all").all,B=d("./race").race,
Q=d("./resolve").resolve,M=d("./reject").reject;d=d("./asap").asap;k.async=d;var H=void 0,L=0,P=1,v=2;p.prototype={constructor:p,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,b){var c=this,e=new this.constructor(function(){});if(this._state){var d=arguments;k.async(function(){n(c._state,e,d[c._state-1],c._detail)})}else h(this,e,a,b);return e},"catch":function(a){return this.then(null,a)}};p.all=u;p.cast=t;p.race=B;p.resolve=Q;p.reject=M;s.Promise=p},{"./all":53,"./asap":54,"./cast":55,
"./config":56,"./race":59,"./reject":60,"./resolve":61,"./utils":62}],59:[function(d,t,s){var p=d("./utils").isArray;s.race=function(d){if(!p(d))throw new TypeError("You must pass an array to race.");return new this(function(n,h){for(var p,r=0;r<d.length;r++)(p=d[r])&&"function"===typeof p.then?p.then(n,h):n(p)})}},{"./utils":62}],60:[function(d,t,s){s.reject=function(d){return new this(function(m,n){n(d)})}},{}],61:[function(d,t,s){s.resolve=function(d){return new this(function(m,n){m(d)})}},{}],
62:[function(d,t,s){function p(d){return"function"===typeof d}d=Date.now||function(){return(new Date).getTime()};s.objectOrFunction=function(d){return p(d)||"object"===typeof d&&null!==d};s.isFunction=p;s.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)};s.now=d},{}],63:[function(d,t,s){d=t.exports={};d.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(d){return window.setImmediate(d)};if("undefined"!==typeof window&&window.postMessage&&
window.addEventListener){var d=[];window.addEventListener("message",function(m){var n=m.source;n!==window&&null!==n||"process-tick"!==m.data||(m.stopPropagation(),0<d.length&&d.shift()())},!0);return function(m){d.push(m);window.postMessage("process-tick","*")}}return function(d){setTimeout(d,0)}}();d.title="browser";d.browser=!0;d.env={};d.argv=[];d.binding=function(d){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(d){throw Error("process.chdir is not supported");
}},{}],64:[function(d,t,s){function p(){}function m(){this.was=[0]}function n(a,e,d){this.hufts=new Int32Array(3*b);this.window=new Uint8Array(d);this.end=d;this.checkfn=e;this.mode=u;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new h;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new x}function h(){}function x(){}function r(a,b,d,e,f){if(0!=f){if(!a)throw"Undef src";if(!d)throw"Undef dest";
if(0==b&&f==a.length)d.set(a,e);else if(E)a=a.subarray(b,b+f),d.set(a,e);else if(1==a.BYTES_PER_ELEMENT&&100<f)a=new Uint8Array(a.buffer,a.byteOffset+b,f),d.set(a,e);else for(var g=0;g<f;++g)d[e+g]=a[b+g]}}function z(c,b,d,e){c=b?d?new Uint8Array(c,b,d):new Uint8Array(c,b,c.byteLength-b):new Uint8Array(c);d=new p;d.inflateInit(a,!0);d.next_in=c;d.next_in_index=0;d.avail_in=c.length;c=[];for(var h=0;;){var m=new Uint8Array(32E3);d.next_out=m;d.next_out_index=0;d.avail_out=m.length;var n=d.inflate(q);
if(n!=g&&n!=k&&n!=f)throw d.msg;if(0!=d.avail_out){var s=new Uint8Array(m.length-d.avail_out);r(m,0,s,0,m.length-d.avail_out);m=s}c.push(m);h+=m.length;if(n==k||n==f)break}e&&(e[0]=(b||0)+d.next_in_index);if(1==c.length)return c[0].buffer;b=new Uint8Array(h);for(d=e=0;d<c.length;++d)h=c[d],r(h,0,b,e,h.length),e+=h.length;return b.buffer}var a=15,b=1440,q=0,g=0,k=1,f=-5,e=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],u=0,B=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,
48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,
0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,
162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,
8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,
6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,
149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,
0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,
19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],Q=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,
93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],M=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],L=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];p.prototype.inflateInit=function(c,b){c||(c=a);b&&(b=!1);this.istate=
new m;return this.istate.inflateInit(this,b?-c:c)};p.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};p.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};p.prototype.inflateSync=function(){return istate.inflateSync(this)};p.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};m.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=
a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return g};m.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return g};m.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new n(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return g};m.prototype.inflate=function(a,b){var d,e;if(null==a||null==a.istate||
null==a.next_in)return-2;b=4==b?f:g;for(d=f;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;e=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<
8)+e)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(e&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return d;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg="need dictionary",a.istate.marker=0,-2;case 7:d=a.istate.blocks.proc(a,d);if(-3==d){a.istate.mode=13;a.istate.marker=0;break}d==g&&(d=b);if(d!=k)return d;d=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return d;
d=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&
255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return k;case 13:return-3;default:return-2}};m.prototype.inflateSetDictionary=function(a,b,d){var e=0,f=d;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,d)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);f>=1<<a.istate.wbits&&(f=(1<<a.istate.wbits)-1,e=d-f);a.istate.blocks.set_dictionary(b,e,f);a.istate.mode=7;return g};var v=
[0,0,255,255];m.prototype.inflateSync=function(a){var b,d,e;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return f;d=a.next_in_index;for(e=a.istate.marker;0!=b&&4>e;)a.next_in[d]==v[e]?e++:e=0!=a.next_in[d]?0:4-e,d++,b--;a.total_in+=d-a.next_in_index;a.next_in_index=d;a.avail_in=b;a.istate.marker=e;if(4!=e)return-3;b=a.total_in;d=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=d;a.istate.mode=7;return g};m.prototype.inflateSyncPoint=
function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];n.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);this.mode=u;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};n.prototype.proc=function(a,b){var d,f,h,m,n,p,l;m=a.next_in_index;n=a.avail_in;f=this.bitb;h=this.bitk;p=this.write;for(l=p<this.read?this.read-
p-1:this.end-p;;)switch(this.mode){case u:for(;3>h;){if(0!=n)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);n--;f|=(a.next_in[m++]&255)<<h;h+=8}d=f&7;this.last=d&1;switch(d>>>1){case 0:f>>>=3;h-=3;d=h&7;f>>>=d;h-=d;this.mode=1;break;case 1:var q=new Int32Array(1),s=new Int32Array(1),t=[],v=[];d=s;var x=t,z=v;q[0]=9;d[0]=5;x[0]=B;z[0]=Q;this.codes.init(q[0],s[0],t[0],0,v[0],0,a);f>>>=3;h-=3;this.mode=6;break;
case 2:f>>>=3;h-=3;this.mode=3;break;case 3:return f>>>=3,h-=3,this.mode=13,a.msg="invalid block type",b=-3,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b)}break;case 1:for(;32>h;){if(0!=n)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);n--;f|=(a.next_in[m++]&255)<<h;h+=8}if((~f>>>16&65535)!=(f&65535))return this.mode=13,a.msg="invalid stored block lengths",
b=-3,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);this.left=f&65535;f=h=0;this.mode=0!=this.left?2:0!=this.last?7:u;break;case 2:if(0==n)return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,write=p,this.inflate_flush(a,b);if(0==l&&(p==end&&0!=read&&(p=0,l=p<this.read?this.read-p-1:this.end-p),0==l&&(this.write=p,b=this.inflate_flush(a,b),p=this.write,l=p<this.read?this.read-p-1:this.end-
p,p==this.end&&0!=this.read&&(p=0,l=p<this.read?this.read-p-1:this.end-p),0==l)))return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);b=g;d=this.left;d>n&&(d=n);d>l&&(d=l);r(a.next_in,m,this.window,p,d);m+=d;n-=d;p+=d;l-=d;if(0!=(this.left-=d))break;this.mode=0!=this.last?7:u;break;case 3:for(;14>h;){if(0!=n)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,
b);n--;f|=(a.next_in[m++]&255)<<h;h+=8}this.table=d=f&16383;if(29<(d&31)||29<(d>>5&31))return this.mode=9,a.msg="too many length or distance symbols",b=-3,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);d=258+(d&31)+(d>>5&31);if(null==this.blens||this.blens.length<d)this.blens=new Int32Array(d);else for(l=0;l<d;l++)this.blens[l]=0;f>>>=14;h-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>h;){if(0!=
n)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);n--;f|=(a.next_in[m++]&255)<<h;h+=8}this.blens[F[this.index++]]=f&7;f>>>=3;h-=3}for(;19>this.index;)this.blens[F[this.index++]]=0;this.bb[0]=7;d=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,a);if(d!=g)return b=d,-3==b&&(this.blens=null,this.mode=9),this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,write=
p,this.inflate_flush(a,b);this.index=0;this.mode=5;case 5:for(;;){d=this.table;if(!(this.index<258+(d&31)+(d>>5&31)))break;for(d=this.bb[0];h<d;){if(0!=n)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);n--;f|=(a.next_in[m++]&255)<<h;h+=8}d=this.hufts[3*(this.tb[0]+(f&e[d]))+1];s=this.hufts[3*(this.tb[0]+(f&e[d]))+2];if(16>s)f>>>=d,h-=d,this.blens[this.index++]=s;else{l=18==s?7:s-14;for(q=18==s?11:3;h<d+l;){if(0!=
n)b=g;else return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);n--;f|=(a.next_in[m++]&255)<<h;h+=8}f>>>=d;h-=d;q+=f&e[l];f>>>=l;h-=l;l=this.index;d=this.table;if(l+q>258+(d&31)+(d>>5&31)||16==s&&1>l)return this.blens=null,this.mode=9,a.msg="invalid bit length repeat",b=-3,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);s=16==s?this.blens[l-1]:0;do this.blens[l++]=
s;while(0!=--q);this.index=l}}this.tb[0]=-1;q=new Int32Array(1);s=new Int32Array(1);t=new Int32Array(1);v=new Int32Array(1);q[0]=9;s[0]=6;d=this.table;d=this.inftree.inflate_trees_dynamic(257+(d&31),1+(d>>5&31),this.blens,q,s,t,v,this.hufts,a);if(d!=g)return-3==d&&(this.blens=null,this.mode=13),b=d,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);this.codes.init(q[0],s[0],this.hufts,t[0],this.hufts,v[0],a);this.mode=6;case 6:this.bitb=
f;this.bitk=h;a.avail_in=n;a.total_in+=m-a.next_in_index;a.next_in_index=m;this.write=p;if((b=this.codes.proc(this,a,b))!=k)return this.inflate_flush(a,b);b=g;this.codes.free(a);m=a.next_in_index;n=a.avail_in;f=this.bitb;h=this.bitk;p=this.write;l=p<this.read?this.read-p-1:this.end-p;if(0==this.last){this.mode=u;break}this.mode=7;case 7:this.write=p;b=this.inflate_flush(a,b);p=this.write;if(this.read!=this.write)return this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=
m,this.write=p,this.inflate_flush(a,b);mode=12;case 8:return b=k,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);case 9:return b=-3,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b);default:return b=-2,this.bitb=f,this.bitk=h,a.avail_in=n,a.total_in+=m-a.next_in_index,a.next_in_index=m,this.write=p,this.inflate_flush(a,b)}};n.prototype.free=function(a){this.reset(a,
null);this.hufts=this.window=null};n.prototype.set_dictionary=function(a,b,d){r(a,b,window,0,d);this.read=this.write=d};n.prototype.sync_point=function(){return 1==this.mode};n.prototype.inflate_flush=function(a,b){var d,e,h;e=a.next_out_index;h=this.read;d=(h<=this.write?this.write:this.end)-h;d>a.avail_out&&(d=a.avail_out);0!=d&&b==f&&(b=g);a.avail_out-=d;a.total_out+=d;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,h,d));r(this.window,h,a.next_out,e,d);e+=d;h+=
d;h==this.end&&(h=0,this.write==this.end&&(this.write=0),d=this.write-h,d>a.avail_out&&(d=a.avail_out),0!=d&&b==f&&(b=g),a.avail_out-=d,a.total_out+=d,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,h,d)),r(this.window,h,a.next_out,e,d),e+=d,h+=d);a.next_out_index=e;this.read=h;return b};h.prototype.init=function(a,b,d,e,f,g,h){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=d;this.ltree_index=e;this.dtree=f;this.dtree_index=g;this.tree=null};h.prototype.proc=function(a,
b,d){var f,h,m=0,n=0,p=0,l,q,r,p=b.next_in_index;l=b.avail_in;m=a.bitb;n=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=r&&10<=l&&(a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,d=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,b),p=b.next_in_index,l=b.avail_in,m=a.bitb,n=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,d!=g)){this.mode=d==k?7:9;break}this.need=this.lbits;
this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(f=this.need;n<f;){if(0!=l)d=g;else return a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);l--;m|=(b.next_in[p++]&255)<<n;n+=8}f=3*(this.tree_index+(m&e[f]));m>>>=this.tree[f+1];n-=this.tree[f+1];h=this.tree[f];if(0==h){this.lit=this.tree[f+2];this.mode=6;break}if(0!=(h&16)){this.get=h&15;this.len=this.tree[f+2];this.mode=2;break}if(0==(h&64)){this.need=h;this.tree_index=
f/3+this.tree[f+2];break}if(0!=(h&32)){this.mode=7;break}this.mode=9;b.msg="invalid literal/length code";d=-3;a.bitb=m;a.bitk=n;b.avail_in=l;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,d);case 2:for(f=this.get;n<f;){if(0!=l)d=g;else return a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);l--;m|=(b.next_in[p++]&255)<<n;n+=8}this.len+=m&e[f];m>>=f;n-=f;this.need=this.dbits;this.tree=this.dtree;this.tree_index=
this.dtree_index;this.mode=3;case 3:for(f=this.need;n<f;){if(0!=l)d=g;else return a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);l--;m|=(b.next_in[p++]&255)<<n;n+=8}f=3*(this.tree_index+(m&e[f]));m>>=this.tree[f+1];n-=this.tree[f+1];h=this.tree[f];if(0!=(h&16)){this.get=h&15;this.dist=this.tree[f+2];this.mode=4;break}if(0==(h&64)){this.need=h;this.tree_index=f/3+this.tree[f+2];break}this.mode=9;b.msg="invalid distance code";d=-3;a.bitb=
m;a.bitk=n;b.avail_in=l;b.total_in+=p-b.next_in_index;b.next_in_index=p;a.write=q;return a.inflate_flush(b,d);case 4:for(f=this.get;n<f;){if(0!=l)d=g;else return a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);l--;m|=(b.next_in[p++]&255)<<n;n+=8}this.dist+=m&e[f];m>>=f;n-=f;this.mode=5;case 5:for(f=q-this.dist;0>f;)f+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,d=a.inflate_flush(b,
d),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);a.window[q++]=a.window[f++];r--;f==a.end&&(f=0);this.len--}this.mode=0;break;case 6:if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,d=a.inflate_flush(b,d),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-
1:a.end-q),0==r)))return a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);d=g;a.window[q++]=this.lit;r--;this.mode=0;break;case 7:7<n&&(n-=8,l++,p--);a.write=q;d=a.inflate_flush(b,d);q=a.write;if(a.read!=a.write)return a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);this.mode=8;case 8:return d=k,a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=
q,a.inflate_flush(b,d);case 9:return d=-3,a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d);default:return d=-2,a.bitb=m,a.bitk=n,b.avail_in=l,b.total_in+=p-b.next_in_index,b.next_in_index=p,a.write=q,a.inflate_flush(b,d)}};h.prototype.free=function(a){};h.prototype.inflate_fast=function(a,b,d,f,h,m,n,p){var l,q,s,t,u,v,x,z,B,F,E,H;v=p.next_in_index;x=p.avail_in;t=n.bitb;u=n.bitk;z=n.write;B=z<n.read?n.read-z-1:n.end-z;a=e[a];F=e[b];do{for(;20>
u;)x--,t|=(p.next_in[v++]&255)<<u,u+=8;l=t&a;q=d;s=f;H=3*(s+l);if(0==(b=q[H]))t>>=q[H+1],u-=q[H+1],n.window[z++]=q[H+2],B--;else{do{t>>=q[H+1];u-=q[H+1];if(0!=(b&16)){b&=15;E=q[H+2]+(t&e[b]);t>>=b;for(u-=b;15>u;)x--,t|=(p.next_in[v++]&255)<<u,u+=8;l=t&F;q=h;s=m;H=3*(s+l);b=q[H];do if(t>>=q[H+1],u-=q[H+1],0!=(b&16)){for(b&=15;u<b;)x--,t|=(p.next_in[v++]&255)<<u,u+=8;l=q[H+2]+(t&e[b]);t>>=b;u-=b;B-=E;if(z>=l)l=z-l,n.window[z++]=n.window[l++],n.window[z++]=n.window[l++],E-=2;else{l=z-l;do l+=n.end;while(0>
l);b=n.end-l;if(E>b){E-=b;if(0<z-l&&b>z-l){do n.window[z++]=n.window[l++];while(0!=--b)}else r(n.window,l,n.window,z,b),z+=b;l=0}}do n.window[z++]=n.window[l++];while(0!=--E);break}else if(0==(b&64))l+=q[H+2],l+=t&e[b],H=3*(s+l),b=q[H];else return p.msg="invalid distance code",E=p.avail_in-x,E=u>>3<E?u>>3:E,x+=E,v-=E,u-=E<<3,n.bitb=t,n.bitk=u,p.avail_in=x,p.total_in+=v-p.next_in_index,p.next_in_index=v,n.write=z,-3;while(1);break}if(0==(b&64)){if(l+=q[H+2],l+=t&e[b],H=3*(s+l),0==(b=q[H])){t>>=q[H+
1];u-=q[H+1];n.window[z++]=q[H+2];B--;break}}else{if(0!=(b&32))return E=p.avail_in-x,E=u>>3<E?u>>3:E,x+=E,v-=E,u-=E<<3,n.bitb=t,n.bitk=u,p.avail_in=x,p.total_in+=v-p.next_in_index,p.next_in_index=v,n.write=z,k;p.msg="invalid literal/length code";E=p.avail_in-x;E=u>>3<E?u>>3:E;x+=E;v-=E;u-=E<<3;n.bitb=t;n.bitk=u;p.avail_in=x;p.total_in+=v-p.next_in_index;p.next_in_index=v;n.write=z;return-3}}while(1)}}while(258<=B&&10<=x);E=p.avail_in-x;E=u>>3<E?u>>3:E;v-=E;n.bitb=t;n.bitk=u-(E<<3);p.avail_in=x+E;
p.total_in+=v-p.next_in_index;p.next_in_index=v;n.write=z;return g};x.prototype.huft_build=function(a,d,e,h,k,m,n,p,l,q,s){var t,u,v,x,z,B,E,F,H;B=0;u=e;do this.c[a[d+B]]++,B++,u--;while(0!=u);if(this.c[0]==e)return n[0]=-1,p[0]=0,g;z=p[0];for(v=1;15>=v&&0==this.c[v];v++);x=v;z<v&&(z=v);for(u=15;0!=u&&0==this.c[u];u--);q=u;z>u&&(z=u);p[0]=z;for(p=1<<v;v<u;v++,p<<=1)if(0>(p-=this.c[v]))return-3;if(0>(p-=this.c[u]))return-3;this.c[u]+=p;this.x[1]=v=0;B=1;for(E=2;0!=--u;)this.x[E]=v+=this.c[B],E++,B++;
B=u=0;do 0!=(v=a[d+B])&&(this.v[this.x[v]++]=u),B++;while(++u<e);e=this.x[q];B=this.x[0]=u=0;d=-1;F=-z;for(H=E=this.u[0]=0;x<=q;x++)for(a=this.c[x];0!=a--;){for(;x>F+z;){d++;F+=z;H=q-F;H=H>z?z:H;if((t=1<<(v=x-F))>a+1&&(t-=a+1,E=x,v<H))for(;++v<H&&!((t<<=1)<=this.c[++E]);)t-=this.c[E];H=1<<v;if(this.hn[0]+H>b)return-3;this.u[d]=E=this.hn[0];this.hn[0]+=H;0!=d?(this.x[d]=u,this.r[0]=v,this.r[1]=z,v=u>>>F-z,this.r[2]=E-this.u[d-1]-v,r(this.r,0,l,3*(this.u[d-1]+v),3)):n[0]=E}this.r[1]=x-F;B>=e?this.r[0]=
192:s[B]<h?(this.r[0]=256>this.v[B]?0:96,this.r[2]=this.v[B++]):(this.r[0]=m[this.v[B]-h]+16+64,this.r[2]=k[this.v[B++]-h]);t=1<<x-F;for(v=u>>>F;v<H;v+=t)r(this.r,0,l,3*(E+v),3);for(v=1<<x-1;0!=(u&v);v>>>=1)u^=v;u^=v;for(v=(1<<F)-1;(u&v)!=this.x[d];)d--,F-=z,v=(1<<F)-1}return 0!=p&&1!=q?f:g};x.prototype.inflate_trees_bits=function(a,b,d,e,g){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,d,b,e,this.hn,this.v);if(-3==a)g.msg="oversubscribed dynamic bit lengths tree";else if(a==
f||0==b[0])g.msg="incomplete dynamic bit lengths tree",a=-3;return a};x.prototype.inflate_trees_dynamic=function(a,b,d,e,h,k,m,n,l){this.initWorkArea(288);this.hn[0]=0;k=this.huft_build(d,0,a,257,M,H,k,e,n,this.hn,this.v);if(k!=g||0==e[0])return-3==k?l.msg="oversubscribed literal/length tree":-4!=k&&(l.msg="incomplete literal/length tree",k=-3),k;this.initWorkArea(288);k=this.huft_build(d,a,b,0,L,P,m,h,n,this.hn,this.v);return k!=g||0==h[0]&&257<a?(-3==k?l.msg="oversubscribed distance tree":k==f?
(l.msg="incomplete distance tree",k=-3):-4!=k&&(l.msg="empty distance tree with lengths",k=-3),k):g};x.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;r(this.c,0,this.u,0,15);r(this.c,0,this.x,0,16)};var E="function"===
typeof(new Uint8Array(1)).subarray;"undefined"!==typeof t&&(t.exports={inflateBuffer:z,arrayCopy:r})},{}]},{},[17]);
