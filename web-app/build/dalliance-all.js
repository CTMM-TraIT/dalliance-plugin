(function e$$0(x,t,q){function p(n,v){if(!t[n]){if(!x[n]){var y="function"==typeof require&&require;if(!v&&y)return y(n,!0);if(l)return l(n,!0);throw Error("Cannot find module '"+n+"'");}y=t[n]={exports:{}};x[n][0].call(y.exports,function(b){var a=x[n][1][b];return p(a?a:b)},y,y.exports,e$$0,x,t,q)}return t[n].exports}for(var l="function"==typeof require&&require,n=0;n<q.length;n++)p(q[n]);return p})({1:[function(d,x,t){function q(){}function p(k,m,G,e){function c(c){if(!c)return e(null,"Couldn't access BAM");
c=a(c,c.byteLength);c=new Uint8Array(c);var h=n(c,0);if(21840194!=h)return e(null,"Not a BAM file, magic=0x"+h.toString(16));for(var b=n(c,4),k="",h=0;h<b;++h)k+=String.fromCharCode(c[h+8]);k=n(c,b+8);b+=12;f.chrToIndex={};f.indexToChr=[];for(h=0;h<k;++h){for(var G=n(c,b),m="",u=0;u<G-1;++u)m+=String.fromCharCode(c[b+4+u]);n(c,b+G+4);f.chrToIndex[m]=h;0==m.indexOf("chr")?f.chrToIndex[m.substring(3)]=h:f.chrToIndex["chr"+m]=h;f.indexToChr.push(m);b=b+8+G}if(f.indices)return e(f)}var f=new q;f.data=
k;f.bai=m;f.indexChunks=G;var h=f.indexChunks?f.indexChunks.minBlockIndex:1E9;if(f.indexChunks){k=f.indexChunks.chunks;f.indices=[];for(m=0;m<k.length;m++)f.indices[m]=null;f.data.slice(0,h).fetch(c)}else f.bai.fetch(function(a){var k,m,G;if(a){var u=new Uint8Array(a),g=n(u,0);if(21578050!=g)a=e(null,"Not a BAI file, magic=0x"+g.toString(16));else{g=n(u,4);f.indices=[];for(var D=8,r=0;r<g;++r){var C=D;k=u;var I=G=C;m=n(k,I);for(var I=I+4,K=0;K<m;++K){n(k,I);var H=n(k,I+4),I=I+(8+16*H)}for(var K=n(k,
I),I=I+4,H=1E9,B=I,N=0;N<K;++N){var v=b(k,B),B=B+8;if(v){k=v.block;0<v.offset&&(k+=65536);k<H&&(H=k);break}}I+=8*K;k=H;G=I-G;D+=G;h=Math.min(k,h);0<m&&(f.indices[r]=new Uint8Array(a,C,D-C))}a=!0}}else a="Couldn't access BAI";!0!==a?e(null,a):f.data.slice(0,h).fetch(c)})}function l(){}if("undefined"!==typeof d){d("./spans");t=d("./bin");var n=t.readInt,w=t.readShort,v=t.readByte,y=t.readFloat;d=d("./lh3utils");var b=d.readVob,a=d.unbgzf,r=d.reg2bins,e=d.Chunk}d={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,
SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};q.prototype.blocksForRange=function(a,m,G){var P=this.indices[a];if(!P)return[];a=r(m,G);for(var c=[],f=0;f<a.length;++f)c[a[f]]=!0;a=[];for(var h=[],f=n(P,0),z=4,A=0;A<f;++A){var F=n(P,z),E=n(P,z+4),z=z+8;if(c[F])for(var g=0;g<E;++g){var v=b(P,z),D=b(P,z+8);(4681>F?h:a).push(new e(v,D));z+=16}else z+=16*
E}f=n(P,z);c=null;m=Math.min(m>>14,f-1);G=Math.min(G>>14,f-1);for(f=m;f<=G;++f)(m=b(P,z+4+8*f))&&(!c||m.block<c.block||m.offset<c.offset)&&(c=m);P=[];if(null!=c)for(f=0;f<h.length;++f)G=h[f],G.maxv.block>=c.block&&G.maxv.offset>=c.offset&&P.push(G);h=P;P=[];for(f=0;f<h.length;++f)P.push(h[f]);for(f=0;f<a.length;++f)P.push(a[f]);P.sort(function(c,f){var h=c.minv.block-f.minv.block;return 0!=h?h:c.minv.offset-f.minv.offset});a=[];if(0<P.length){h=P[0];for(f=1;f<P.length;++f)G=P[f],G.minv.block==h.maxv.block?
h=new e(h.minv,G.maxv):(a.push(h),h=G);a.push(h)}return a};q.prototype.fetch=function(b,m,G,e,c){function f(){if(g>=A.length)return e(E);if(r){var b=new Uint8Array(r),b=h.readBamRecords(b,A[g].minv.offset,E,m,G,z,c);r=null;++g;return b?e(E):f()}var k=A[g],b=k.minv.block;h.data.slice(b,k.maxv.block+65536-b).fetch(function(c){r=a(c,k.maxv.block-k.minv.block+1);return f()})}var h=this;c=c||{};var z=this.chrToIndex[b],A;if(void 0===z)A=[];else{if(null===this.indices[z]&&this.indexChunks.chunks[z]){var F=
this.indexChunks.chunks[z];return this.bai.slice(F[0],F[1]).fetch(function(f){f=new Uint8Array(f);this.indices[z]=f;return this.fetch(b,m,G,e,c)}.bind(this))}(A=this.blocksForRange(z,m,G))||e(null,"Error in index fetch")}var E=[],g=0,r;f()};var g="=ACxGxxxTxxxxxxN".split(""),m="MIDNSHP=X???????".split("");q.prototype.readBamRecords=function(b,a,G,e,c,f,h){for(;;){var z=n(b,a),z=a+z+4;if(z>=b.length)return G;var A=new l,F=n(b,a+4),E=n(b,a+8),r=n(b,a+12),R=(r&65280)>>8,D=r&255,r=n(b,a+16),d=(r&4294901760)>>
16,C=r&65535,r=n(b,a+20),I=n(b,a+24),K=n(b,a+28);n(b,a+32);A.segment=this.indexToChr[F];A.flag=d;A.pos=E;A.mq=R;h.light&&(A.seqLength=r);if(!h.light){0<=I&&(A.nextSegment=this.indexToChr[I],A.nextPos=K);R="";for(E=0;E<D-1;++E)R+=String.fromCharCode(b[a+36+E]);A.readName=R;a=a+36+D;D="";for(E=0;E<C;++E)R=n(b,a),D=D+(R>>4)+m[R&15],a+=4;A.cigar=D;C="";D=r+1>>1;for(E=0;E<D;++E)R=b[a+E],C+=g[(R&240)>>4],C+=g[R&15];a+=D;A.seq=C;C="";for(E=0;E<r;++E)C+=String.fromCharCode(b[a+E]+33);a+=r;for(A.quals=C;a<
z;){C=String.fromCharCode(b[a],b[a+1]);D=String.fromCharCode(b[a+2]);if("A"==D)D=String.fromCharCode(b[a+3]),a+=4;else if("i"==D||"I"==D)D=n(b,a+3),a+=7;else if("c"==D||"C"==D)D=b[a+3],a+=4;else if("s"==D||"S"==D)D=w(b,a+3),a+=5;else if("f"==D)D=y(b,a+3),a+=7;else if("Z"==D||"H"==D)for(a+=3,D="";E=b[a++],0!=E;)D+=String.fromCharCode(E);else if("B"==D){D=String.fromCharCode(b[a+3]);E=n(b,a+4);if("i"==D||"I"==D||"f"==D)R=4,d="f"==D?y:n;else if("s"==D||"S"==D)R=2,d=w;else if("c"==D||"C"==D)R=1,d=v;else throw"Unknown array type "+
D;a+=8;D=[];for(I=0;I<E;++I)D.push(d(b,a)),a+=R}else throw"Unknown type "+D;A[C]=D}}if(!e||A.pos<=c&&A.pos+r>=e)void 0!==f&&F!=f||G.push(A);if(A.pos>c)return!0;a=z}};"undefined"!==typeof x&&(x.exports={makeBam:p,BAM_MAGIC:21840194,BAI_MAGIC:21578050,BamFlags:d})},{"./bin":4,"./lh3utils":23,"./spans":34}],2:[function(d,x,t){function q(b){this.type=b}function p(b,a){this.parser=b;this.sink=a}function l(b,a){this.parser=b;this.sink=a;this.wigState=null}if("undefined"!==typeof d){var n=d("./spans"),w=
n.Range,v=n.union,y=n.intersection,n=d("./sourceadapters").registerParserFactory;x=d("./das");var b=x.DASStylesheet,a=x.DASStyle,r=x.DASGroup,e=d("./utils").shallowCopy}q.prototype.createSession=function(b){return"wig"==this.type?new l(this,b):new p(this,b)};var g=/([^=]+)=(.+)/,m=/\s/,k=/^[0-9]+,[0-9]+,[0-9]+/;p.prototype.parse=function(b){var a=b.split(m);if(!(3>a.length)){var g=parseInt(a[1])+1;b=parseInt(a[2]);b={segment:a[0],min:g,max:b};3<a.length&&"."!==a[3]&&(b.label=a[3]);4<a.length&&(b.score=
parseFloat(a[4]));5<a.length&&(b.orientation=a[5]);if(8<a.length){var c=a[8];k.test(c)&&(b.itemRgb="rgb("+c+")")}if(12<=a.length){var c=parseInt(a[6]),f=parseInt(a[7]),h=parseInt(a[9]),z=a[10].split(",").map(function(c){return parseInt(c)}),A=a[11].split(",").map(function(c){return parseInt(c)});b.type="transcript";var F=new r;F.id=a[3];F.type="transcript";F.notes=[];b.groups=[F];if(12<a.length){var E=F=a[12];13<a.length&&(E=a[13]);a=new r;a.id=F;a.label=E;a.type="gene";b.groups.push(a)}a=null;for(F=
0;F<h;++F)E=A[F]+g,E=new w(E,E+z[F]),a=a?v(a,E):E;A=a.ranges();for(g=0;g<A.length;++g)z=A[g],h=e(b),h.min=z.min(),h.max=z.max(),this.sink(h);if(f>c&&(c="+"==b.orientation?new w(c,f+3):new w(c-3,f),c=y(a,c)))for(b.type="translation",c=c.ranges(),g=f=0;g<c.length;++g)h=g,"-"==b.orientation&&(h=c.length-g-1),z=c[h],h=e(b),h.min=z.min(),h.max=z.max(),b.readframe=f,z=z.max()-z.min(),f=(f+z)%3,this.sink(h)}else this.sink(b)}};p.prototype.flush=function(){};l.prototype.parse=function(a){a=a.split(m);if("fixedStep"==
a[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var b=this.span=1;b<a.length;++b){var k=g.exec(a[b]);k&&("chrom"==k[1]?this.chr=k[2]:"start"==k[1]?this.pos=parseInt(k[2]):"step"==k[1]?this.step=parseInt(k[2]):"span"==k[1]&&(this.span=parseInt(k[2])))}}else if("variableStep"==a[0])for(this.wigState="variableStep",this.chr=null,b=this.span=1;b<a.length;++b)k=g.exec(a[b]),"chrom"==k[1]?this.chr=k[2]:"span"==k[1]&&(this.span=parseInt(k[2]));else this.wigState?"fixedStep"==this.wigState?
1==a.length&&(a=parseFloat(a[0]),a={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:a},this.pos+=this.step,this.sink(a)):"variableStep"==this.wigState&&2==a.length&&(b=parseInt(a[0]),a=parseFloat(a[1]),a={segment:this.chr,min:b,max:b+this.span-1,score:a},this.sink(a)):4>a.length||(a={segment:a[0],min:parseInt(a[1])+1,max:parseInt(a[2]),score:parseFloat(a[3])},this.sink(a))};l.prototype.flush=function(){};q.prototype.getStyleSheet=function(m){var k=new b;if("wig"==this.type){var e=new a;
e.glyph="HISTOGRAM";e.BGCOLOR="blue";e.HEIGHT=30;k.pushStyle({type:"default"},null,e)}else e=new a,e.glyph="BOX",e.FGCOLOR="black",e.BGCOLOR="blue",e.HEIGHT=8,e.BUMP=!0,e.LABEL=!0,e.ZINDEX=20,k.pushStyle({type:"default"},null,e),e=new a,e.glyph="BOX",e.FGCOLOR="black",e.BGCOLOR="red",e.HEIGHT=10,e.BUMP=!0,e.ZINDEX=20,k.pushStyle({type:"translation"},null,e),e=new a,e.glyph="BOX",e.FGCOLOR="black",e.BGCOLOR="white",e.HEIGHT=10,e.ZINDEX=10,e.BUMP=!0,e.LABEL=!0,k.pushStyle({type:"transcript"},null,e),
e=new a,e.glyph="HISTOGRAM",e.COLOR1="white",e.COLOR2="black",e.HEIGHT=30,k.pushStyle({type:"density"},null,e);return m(k)};n("bed",function(a){return new q(a)});n("wig",function(a){return new q(a)})},{"./das":10,"./sourceadapters":33,"./spans":34,"./utils":49}],3:[function(d,x,t){function q(a,b){return a[b]+256*a[b+1]+65536*a[b+2]+16777216*a[b+3]+4294967296*a[b+4]}function p(){}function l(a,b,c,f){this.bwg=a;this.cirTreeOffset=b;this.cirTreeLength=c;this.isSummary=f}function n(a,b,c){var f=new p;
f.data=a;f.name=c;f.data.slice(0,512).salted().fetch(function(c){if(!c)return b(null,"Couldn't fetch file");var a=new Uint8Array(c),e=new Int16Array(c);c=new Int32Array(c);var m=a[0]+256*a[1]+65536*a[2]+16777216*a[3];2291137574==m?f.type="bigwig":2273964779==m?f.type="bigbed":654086024==m||3958540679==m?b(null,"Currently don't support big-endian BBI files"):b(null,"Not a supported format, magic=0x"+m.toString(16));f.version=e[2];f.numZoomLevels=e[3];f.chromTreeOffset=q(a,8);f.unzoomedDataOffset=q(a,
16);f.unzoomedIndexOffset=q(a,24);f.fieldCount=e[16];f.definedFieldCount=e[17];f.asOffset=q(a,36);f.totalSummaryOffset=q(a,44);f.uncompressBufSize=c[13];f.extHeaderOffset=q(a,56);f.zoomLevels=[];for(e=0;e<f.numZoomLevels;++e){var m=c[6*e+16],k=q(a,24*e+72),G=q(a,24*e+80);f.zoomLevels.push({reduction:m,dataOffset:k,indexOffset:G})}f.readChromTree(function(){f.getAutoSQL(function(c){f.schema=c;return b(f)})})})}function w(a,b,c,f,h){this.bbi=a;this.type=b;this.fieldCount=c;this.offset=f;this.field=
h}if("undefined"!==typeof d){t=d("./spans");var v=t.Range,y=t.union,b=t.intersection;t=d("./das");var a=t.DASFeature,r=t.DASGroup,e=d("./utils").shallowCopy,g=d("./bin").readInt;d=d("jszlib");var m=d.inflateBuffer,k=d.arrayCopy}var u=/^[0-9]+,[0-9]+,[0-9]+/;p.prototype.readChromTree=function(a){var b=this;this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var c=this.unzoomedDataOffset,c=c+4-(c-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,c-this.chromTreeOffset).fetch(function(c){var h=
new Uint8Array(c),e=new Int16Array(c),m=(new Int32Array(c))[2];q(h,16);var k=function(c){var a=h[c],f=e[c/2+1];c+=4;for(var G=0;G<f;++G)if(0==a){c+=m;var g=q(h,c);c+=8;g-=b.chromTreeOffset;k(g)}else{for(var g="",C=0;C<m;++C){var I=h[c++];0!=I&&(g+=String.fromCharCode(I))}C=h[c+3]<<24|h[c+2]<<16|h[c+1]<<8|h[c+0];c+=8;b.chromsToIDs[g]=C;0==g.indexOf("chr")&&(b.chromsToIDs[g.substr(3)]=C);b.idsToChroms[C]=g;b.maxID=Math.max(b.maxID,C)}};k(32);a(b)})};l.prototype.readWigData=function(a,b,c,f){a=this.bwg.chromsToIDs[a];
if(void 0===a)return f([]);this.readWigDataById(a,b,c,f)};l.prototype.readWigDataById=function(a,b,c,f){var h=this;if(this.cirHeader){var e=[],m=0;Date.now();var k=function(f,h,C,e){return(0>a||f==a)&&h<=c&&C>=b},g=function(c,a){h.bwg.instrument&&console.log("level="+a+"; offset="+c+"; time="+(Date.now()|0));m+=c.length;if(1==c.length&&48==c[0]-h.cirTreeOffset&&h.cachedCirRoot)u(h.cachedCirRoot,0,a),--m,0==m&&h.fetchFeatures(k,e,f);else{for(var b=4+32*h.cirBlockSize,g,K=0;K<c.length;++K){var H=new v(c[K],
c[K]+b);g=g?y(g,H):H}b=g.ranges();for(g=0;g<b.length;++g)r(c,b[g],a)}},r=function(c,a,b,g){a.max();a.min();h.bwg.data.slice(a.min(),a.max()-a.min()).fetch(function(K){for(var g=0;g<c.length;++g)a.contains(c[g])&&(u(K,c[g]-a.min(),b),48==c[g]-h.cirTreeOffset&&0==c[g]-a.min()&&(h.cachedCirRoot=K),--m,0==m&&h.fetchFeatures(k,e,f))})},u=function(f,h,C){var m=new Uint8Array(f),k=new Int16Array(f);f=new Int32Array(f);var F=m[h],k=k[h/2+1];h+=4;if(0!=F)for(F=0;F<k;++F){var B=h/4,A=f[B],r=f[B+1],J=f[B+2],
B=f[B+3],u=q(m,h+16);C=q(m,h+24);(0>a||A<a||A==a&&r<=c)&&(0>a||J>a||J==a&&B>=b)&&e.push({offset:u,size:C});h+=32}else{for(var v=[],F=0;F<k;++F)B=h/4,A=f[B],r=f[B+1],J=f[B+2],B=f[B+3],u=q(m,h+16),(0>a||A<a||A==a&&r<=c)&&(0>a||J>a||J==a&&B>=b)&&v.push(u),h+=24;0<v.length&&g(v,C+1)}};g([h.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(e){h.cirHeader=e;e=new Int32Array(h.cirHeader);h.cirBlockSize=e[1];h.readWigDataById(a,b,c,f)})};l.prototype.fetchFeatures=function(b,
e,c){var f=this;e.sort(function(c,a){return(c.offset|0)-(a.offset|0)});if(0==e.length)c([]);else{var h=[],g=function(c,b,e,m){m||(m={});var k=new a;k._chromId=c;k.segment=f.bwg.idsToChroms[c];k.min=b;k.max=e;k.type="bigwig";for(var g in m)k[g]=m[g];h.push(k)},A=function(){if(0==e.length)Date.now(),c(h);else{var a=e[0];if(a.data)f.parseFeatures(a.data,g,b),e.splice(0,1),A();else{for(var r=a.offset,u=a.size,a=1;a<e.length&&e[a].offset==r+u;)u+=e[a].size,++a;f.bwg.data.slice(r,u).fetch(function(c){for(var a=
0,b=0;a<u;){var C=e[b],h;0<f.bwg.uncompressBufSize?h=m(c,a+2,C.size-2):(h=new Uint8Array(C.size),k(new Uint8Array(c,a,C.size),0,h,0,C.size),h=h.buffer);C.data=h;a+=C.size;++b}A()})}}};A()}};l.prototype.parseFeatures=function(a,m,c){var f=new Uint8Array(a);if(this.isSummary)for(var h=new Int16Array(a),k=new Int32Array(a),g=new Float32Array(a),f=a.byteLength/32,h=0;h<f;++h){a=k[8*h];var F=k[8*h+1],E=k[8*h+2],M=k[8*h+3],n=g[8*h+5],D=g[8*h+6];c(a,F+1,E)&&(M={type:"bigwig",score:D/M,maxScore:n},"bigbed"==
this.bwg.type&&(M.type="density"),m(a,F+1,E,M))}else if("bigwig"==this.bwg.type)if(h=new Int16Array(a),k=new Int32Array(a),g=new Float32Array(a),a=k[0],n=k[1],D=k[3],M=k[4],F=f[20],f=h[11],3==F)for(h=0;h<f;++h){var d=g[h+6],k=n+h*D+1,F=n+h*D+M;c(a,k,F)&&m(a,k,F,{score:d})}else if(2==F)for(h=0;h<f;++h)F=k[2*h+6]+1,E=F+M-1,d=g[2*h+7],c(a,F,E)&&m(a,F,E,{score:d});else if(1==F)for(h=0;h<f;++h)F=k[3*h+6]+1,E=k[3*h+7],d=g[3*h+8],F>E&&(F=E),c(a,F,E)&&m(a,F,E,{score:d});else console.log("Currently not handling bwgType="+
F);else if("bigbed"==this.bwg.type)for(h=0,M=this.bwg.definedFieldCount,n=this.bwg.schema;h<f.length;){a=f[h+3]<<24|f[h+2]<<16|f[h+1]<<8|f[h+0];F=f[h+7]<<24|f[h+6]<<16|f[h+5]<<8|f[h+4];E=f[h+11]<<24|f[h+10]<<16|f[h+9]<<8|f[h+8];h+=12;for(d="";;)if(D=f[h++],0!=D)d+=String.fromCharCode(D);else break;var D={},C;C=0<d.length?d.split("\t"):[];0<C.length&&3<M&&(D.label=C[0]);1<C.length&&4<M&&(d=parseInt(C[1]),isNaN(d)||(D.score=d));2<C.length&&5<M&&(D.orientation=C[2]);5<C.length&&8<M&&(d=C[5],u.test(d)&&
(D.itemRgb="rgb("+d+")"));if(C.length>M-3&&n)for(d=M-3;d<C.length;++d)D[n.fields[d+3].name]=C[d];if(c(a,F+1,E,C))if(12>M)m(a,F+1,E,D);else{var d=C[3]|0,I=C[4]|0,K=C[6]|0,H=C[7].split(","),B=C[8].split(",");D.exonFrames&&(g=D.exonFrames.split(","),D.exonFrames=void 0);D.type="transcript";var N=new r;for(k in D)N[k]=D[k];N.id=C[0];N.segment=this.bwg.idsToChroms[a];N.min=F+1;N.max=E;N.notes=[];D.groups=[N];if(9<C.length){var l=E=D.geneName||C[9];10<C.length&&(l=C[10]);D.geneName2&&(l=D.geneName2);C=
e(N);C.id=E;C.label=l;C.type="gene";D.groups.push(C)}E=[];for(C=0;C<K;++C)N=(B[C]|0)+F,N=new v(N,N+(H[C]|0)),E.push(N);H=y(E);K=H.ranges();for(F=0;F<K.length;++F)E=K[F],m(a,E.min()+1,E.max(),D);if(I>d&&(F="+"==D.orientation?new v(d,I+3):new v(d-3,I),F=b(H,F))){D.type="translation";d=F.ranges();for(H=I=0;d[0].min()>K[H].max();)H++;for(F=0;F<d.length;++F)K=F,"-"==D.orientation&&(K=d.length-F-1),E=d[K],D.readframe=I,g&&(K=parseInt(g[K+H]),"number"===typeof K&&0<=K&&2>=K&&(D.readframe=K,D.readframeExplicit=
!0)),K=E.max()-E.min(),I=(I+K)%3,m(a,E.min()+1,E.max(),D)}}}else throw Error("Don't know what to do with "+this.bwg.type);};l.prototype.getFirstAdjacent=function(a,b,c,f){a=this.bwg.chromsToIDs[a];if(void 0===a)return f([]);this.getFirstAdjacentById(a,b,c,f)};l.prototype.getFirstAdjacentById=function(a,b,c,f){var h=this;if(this.cirHeader){var e=null,k=-1,m=-1,g=0;Date.now();var r=function(c,a){g+=c.length;for(var b=4+32*h.cirBlockSize,f,e=0;e<c.length;++e){var B=new v(c[e],c[e]+b);f=f?y(f,B):B}b=
f.ranges();for(f=0;f<b.length;++f)u(c,b[f],a)},u=function(k,C,m,F){C.max();C.min();h.bwg.data.slice(C.min(),C.max()-C.min()).fetch(function(F){for(var B=0;B<k.length;++B)if(C.contains(k[B])&&(d(F,k[B]-C.min(),m),--g,0==g)){if(!e)return 0<c&&(0!=a||0<b)?h.getFirstAdjacentById(0,0,c,f):0>c&&(a!=h.bwg.maxID||1E9>b)?h.getFirstAdjacentById(h.bwg.maxID,1E9,c,f):f([]);h.fetchFeatures(function(f,C,h,B){return 0>c&&(f<a||h<b)||0<c&&(f>a||C>b)},[e],function(a){for(var b=null,C=-1,h=-1,B=0;B<a.length;++B){var e=
a[B],k=e._chromId,m=e.min,g=e.max;if(null==b||0>c&&(k>C||g>h)||0<c&&(k<C||m<h))b=e,h=0>c?g:m,C=k}return null!=b?f([b]):f([])})}})},d=function(f,C,g){var K=new Uint8Array(f),H=new Int16Array(f);f=new Int32Array(f);var B=K[C],H=H[C/2+1];C+=4;if(0!=B)for(B=0;B<H;++B){var N=C/4,u=f[N],J=f[N+1],E=f[N+2],v=f[N+3],N=q(K,C+16);g=q(K,C+24);(0>c&&(u<a||u==a&&J<=b)||0<c&&(E>a||E==a&&v>=b))&&!/_random/.exec(h.bwg.idsToChroms[u])&&(null==e||0>c&&(E>k||E==k&&v>m)||0<c&&(u<k||u==k&&J<m))&&(e={offset:N,size:g},m=
0>c?v:J,k=0>c?E:u);C+=32}else{for(var d=K=-1,B=0;B<H;++B){N=C/4;u=f[N];J=f[N+1];E=f[N+2];v=f[N+3];N=f[N+4]<<32|f[N+5];if(0>c&&(u<a||u==a&&J<=b)&&E>=a||0<c&&(E>a||E==a&&v>=b)&&u<=a)if(0>K||v>d)K=N,d=0>c?v:J;C+=24}0<=K&&r([K],g+1)}};r([h.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(e){h.cirHeader=e;e=new Int32Array(h.cirHeader);h.cirBlockSize=e[1];h.getFirstAdjacentById(a,b,c,f)})};p.prototype.readWigData=function(a,b,c,f){this.getUnzoomedView().readWigData(a,
b,c,f)};p.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new l(this,this.unzoomedIndexOffset,a,!1)}return this.unzoomedView};p.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new l(this,a.indexOffset,4E3,!0));return a.view};p.prototype._tsFetch=function(a,b,c,f,h){var e=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var k=[],m=this.topLevelReductionCache,
g=0;g<m.length;++g)m[g]._chromId==b&&k.push(m[g]);return h(k)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(k){e.topLevelReductionCache=k;return e._tsFetch(a,b,c,f,h)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(b,c,f,h)};p.prototype.thresholdSearch=function(a,b,c,f,h){function e(){if(0==m.length)return h(null);m.sort(function(a,f){var b=a.zoom-f.zoom;if(0!=b)return b;b=a.chrOrd-f.chrOrd;return 0!=b?b:a.min-f.min*c});var a=m.splice(0,
1)[0];k._tsFetch(a.zoom,a.chr,a.min,a.max,function(k){var g=0<c?0:3E8;a.fromRef&&(g=b);for(var C=0;C<k.length;++C){var r=k[C],K;K=void 0!=r.maxScore?r.maxScore:r.score;if(0<c){if(K>f)if(0>a.zoom){if(r.min>g)return h(r)}else r.max>g&&m.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:r.min,max:r.max,fromRef:a.fromRef})}else if(K>f)if(0>a.zoom){if(r.max<g)return h(r)}else r.min<g&&m.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:r.min,max:r.max,fromRef:a.fromRef})}e()})}c=0>c?-1:1;var k=this;a=
this.chromsToIDs[a];for(var m=[{chrOrd:0,chr:a,zoom:k.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],g=1;g<=this.maxID+1;++g){var r=(a+c*g)%(this.maxID+1);0>r&&(r+=this.maxID+1);m.push({chrOrd:g,chr:r,zoom:k.zoomLevels.length-1,min:0,max:3E8})}e()};p.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(b){var c=new Uint8Array(b);b="";for(var f=0;f<c.length&&0!=c[f];++f)b+=String.fromCharCode(c[f]);var c=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,
h=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(b);if(h){f={declType:h[1],name:h[2],comment:h[4],fields:[]};b=b.substring(h[0]);for(h=c.exec(b);null!=h;h=c.exec(b))f.fields.push({type:h[1],name:h[2],comment:h[4]});return a(f)}})};p.prototype.getExtraIndices=function(a){var b=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(c){if(!c)return a(null,"Couldn't fetch extension header");var f=new Uint8Array(c),h=new Int16Array(c);
new Int32Array(c);var e=h[1];c=q(f,4);if(0==e)return a(null);b.data.slice(c,20*e).fetch(function(c){if(!c)return a(null,"Couldn't fetch index info");var f=new Uint8Array(c),h=new Int16Array(c);new Int32Array(c);c=[];for(var k=0;k<e;++k){var m=h[10*k],g=h[10*k+1],r=q(f,20*k+4),m=new w(b,m,g,r,h[10*k+8]);c.push(m)}a(c)})})};w.prototype.lookup=function(a,b){var c=this;this.bbi.data.slice(this.offset,32).fetch(function(f){function h(f){c.bbi.data.slice(f,4+k*(m+r)).fetch(function(f){var e=new Uint8Array(f),
k=new Uint16Array(f);new Uint32Array(f);k=k[1];f=4;if(0==e[0]){for(var C=null,A=0;A<k;++A){for(var K="",H=0;H<m;++H){var B=e[f++];0!=B&&(K+=String.fromCharCode(B))}H=q(e,f);f+=8;if(0>a.localeCompare(K)&&C){h(C);return}C=H}h(C)}else{for(A=0;A<k;++A){K="";for(H=0;H<m;++H)B=e[f++],0!=B&&(K+=String.fromCharCode(B));if(K==a)return k=q(e,f),e=g(e,f+8),c.bbi.getUnzoomedView().fetchFeatures(function(f,b,h,C){if(C&&C.length>c.field-3)return C[c.field-3]==a},[{offset:k,size:e}],b);f+=r}return b([])}})}var e=
new Uint8Array(f);new Int16Array(f);f=new Int32Array(f);var k=f[1],m=f[2],r=f[3];q(e,16);h(c.offset+32)})};"undefined"!==typeof x&&(x.exports={makeBwg:n,BIG_BED_MAGIC:2273964779,BIG_WIG_MAGIC:2291137574})},{"./bin":4,"./das":10,"./spans":34,"./utils":49,jszlib:65}],4:[function(d,x,t){function q(a){this.blob=a}function p(a,b,e,g){g||("object"===typeof b?(g=b,b=void 0):g={});this.url=a;this.start=b||0;e&&(this.end=e);this.opts=g}function l(a){if(!a)return null;for(var b=new Uint8Array(a.length),e=0;e<
b.length;++e)b[e]=a.charCodeAt(e);return b.buffer}function n(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function w(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function v(a,b){return a[b+1]<<8|a[b]}function y(a,b){return a[b]}function b(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof d)var a=d("./utils").shallowCopy,r=d("./sha1").b64_sha1;q.prototype.slice=function(a,b){var e;e=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,
a+b):this.blob.webkitSlice(a);return new q(e)};q.prototype.salted=function(){return this};q.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=function(e){a(l(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var e=b.readAsArrayBuffer(this.blob);a(e)}catch(g){a(null,g)}};p.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var e=this.start,g=this.end,e=e&&a?e+a:a||e;return new p(this.url,e,b&&e?e+b-1:g||b-1,this.opts)};
var e=0,g=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");p.prototype.fetchAsText=function(a){var b=new XMLHttpRequest,u=this.url;if(g||this.opts.salt)u=u+"?salt="+r(""+Date.now()+","+ ++e);b.open("GET",u,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";b.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}b.onreadystatechange=function(){if(4==b.readyState)return 200==b.status||206==b.status?a(b.responseText):a(null)};this.opts.credentials&&
(b.withCredentials=!0);b.send("")};p.prototype.salted=function(){var b=a(this.opts);b.salt=!0;return new p(this.url,this.start,this.end,b)};p.prototype.fetch=function(a,b,u){var v=this;b=b||1;if(3<b)return a(null);var d=new XMLHttpRequest,c,f=this.url;if(g||this.opts.salt)f=f+"?salt="+r(""+Date.now()+","+ ++e);d.open("GET",f,!0);d.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";d.setRequestHeader("Range","bytes="+this.start+"-"+
this.end);c=this.end-this.start+1}d.responseType="arraybuffer";d.onreadystatechange=function(){if(4==d.readyState){if(200==d.status||206==d.status){if(d.response){var f=d.response.byteLength;return!c||c==f||u&&f==u?a(d.response):v.fetch(a,b+1,f)}if(d.mozResponseArrayBuffer)return a(d.mozResponseArrayBuffer);f=d.responseText;return!c||c==f.length||u&&f.length==u?a(l(d.responseText)):v.fetch(a,b+1,f.length)}return v.fetch(a,b+1)}};this.opts.credentials&&(d.withCredentials=!0);d.send("")};(function(a){var b=
new ArrayBuffer(8),e=new Uint8Array(b),g=new Float32Array(b);a.readFloat=function(a,c){e[0]=a[c];e[1]=a[c+1];e[2]=a[c+2];e[3]=a[c+3];return g[0]}})(this);"undefined"!==typeof x&&(x.exports={BlobFetchable:q,URLFetchable:p,readInt:w,readIntBE:b,readInt64:n,readShort:v,readByte:y,readFloat:this.readFloat})},{"./sha1":32,"./utils":49}],5:[function(d,x,t){function q(d){var n="bp";1E9<d?(d/=1E9,n="Gb"):1E6<d?(d/=1E6,n="Mb"):1E3<d&&(d/=1E3,n="kb");return""+Math.round(d)+n}if("undefined"!==typeof d){var p=
d("./cbrowser").Browser,l=d("./utils").makeElement,n=d("./numformats").formatLongInt,w=d("./zoomslider");d("./tier-edit");d("./export-config");d("./export-ui");d("./export-image");d("./svg-export");d("./session")}p.prototype.initUI=function(d,y){this.noSourceCSS||["bootstrap-scoped.css","dalliance-scoped.css","font-awesome.min.css"].forEach(function(a){document.head.appendChild(l("link","",{rel:"stylesheet",href:this.resolveURL("$$css/"+a)}))}.bind(this));var b=this;b.disableDefaultFeaturePopup||
this.addFeatureListener(function(a,c,f,C){b.featurePopup(a,c,f,C)});d.classList.add("dalliance");var a=b.toolbar=l("div",null,{className:"btn-toolbar toolbar"}),r=b.coordSystem.speciesName+" "+b.nameForCoordSystem(b.coordSystem);this.setDocumentTitle&&(document.title=r+" :: dalliance");var e=l("input","",{className:"loc-field"});b.makeTooltip(e,"Enter a genomic location or gene name");var g=l("p","",{className:"loc-status"}),m=l("a",[l("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),
k=new w;b.makeTooltip(k,"Highlighted button shows current zoom level, gray button shows inactive zoom level (click or tap SPACE to toggle).");var u=l("a",[l("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),G=l("a",[l("i",null,{className:"fa fa-eraser"})],{className:"btn"}),p=l("a",[l("i",null,{className:"fa fa-plus"})],{className:"btn"}),c=l("a",[l("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),f=l("a",[l("i",null,{className:"fa fa-print"})],{className:"btn"});l("a",[l("i",
null,{className:"fa fa-refresh"})],{className:"btn"});var h=l("a",[l("i",null,{className:"fa fa-cogs"})],{className:"btn"}),z=l("a",[l("i",null,{className:"fa fa-question"})],{className:"btn"}),A=l("a",[l("i",null,{className:"fa fa-road"})],{className:"btn"});b.makeTooltip(A,"Configure currently selected track(s) (E)");var F=l("a",[l("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),E=l("a",[l("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),
M=l("div",null,{className:"btn-group pull-right"});this.noTrackAdder||M.appendChild(p);this.noTrackEditor||M.appendChild(A);this.noExport||M.appendChild(f);this.noOptions||M.appendChild(h);this.noHelp||M.appendChild(z);this.setUiMode=function(a){this.uiMode=a;var c={help:z,add:p,opts:h,"export":f,tier:A},b;for(b in c)b==a?c[b].classList.add("active"):c[b].classList.remove("active")};this.noLeapButtons||a.appendChild(E);M.firstChild&&a.appendChild(M);this.noLeapButtons||a.appendChild(F);this.noTitle||
a.appendChild(l("div",l("h4",r,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||a.appendChild(l("div",[e,g],{className:"btn-group loc-group"}));this.noClearHighlightsButton||a.appendChild(G);this.noZoomSlider||a.appendChild(l("div",[m,l("span",k,{className:"btn"}),u],{className:"btn-group"}));this.toolbarBelow?(d.appendChild(y),d.appendChild(a)):(d.appendChild(a),d.appendChild(y));var R=Math.log10(2),D=Math.log10(5),Z=function(a){var c=(a/b.zoomExpt+Math.log(b.zoomBase))/Math.log(10);
a=c|0;c-=a;return((.01>c?a:c<=R+.01?a+R:c<=D+.01?a+D:a+1)*Math.log(10)-Math.log(b.zoomBase))*b.zoomExpt},C=function(a){k.addLabel(a,q(Math.exp(a/b.zoomExpt)*b.zoomBase))};this.addViewListener(function(a,c,f,h,m){e.value=a+":"+n(c)+".."+n(f);k.min=m.min|0;k.max=m.max|0;m.isSnapZooming?(k.value=m.alternate,k.value2=m.current,k.active=2):(k.value=m.current,k.value2=m.alternate,k.active=1);k.removeLabels();a=m.min;m=m.max;c=m-a;C(Z(a));C(Z(a+1*c/3));C(Z(a+2*c/3));C(Z(m));b.storeStatus&&b.storeViewStatus();
G.style.display=0<b.highlights.length?"inline-block":"none"});this.addTierListener(function(){b.storeStatus&&b.storeTierStatus()});e.addEventListener("keydown",function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),b.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),b.search(e.value,function(a){g.textContent=a?""+a:""})},!1);var I;p.addEventListener("click",function(a){I&&I.displayed?b.removeAllPopups():I=b.showTrackAdder(a)},!1);b.makeTooltip(p,"Add a new track from the registry or an indexed file. (A)");
m.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.zoomStep(-10)},!1);b.makeTooltip(m,"Zoom in (+)");u.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.zoomStep(10)},!1);b.makeTooltip(u,"Zoom out (-)");k.addEventListener("change",function(a){a=2==k.active;a!=b.isSnapZooming&&(b.savedZoom=b.zoomSliderValue-b.zoomMin,b.isSnapZooming=a);a=1==k.active?k.value:k.value2;b.zoomSliderValue=1*a;b.zoom(Math.exp(1*a/b.zoomExpt))},!1);c.addEventListener("click",
function(a){a.stopPropagation();a.preventDefault()},!1);b.makeTooltip(c,"Favourite regions");f.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.openExportPanel()},!1);b.makeTooltip(f,"Export publication-quality SVG. (X)");h.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleOptsPopup(a)},!1);b.makeTooltip(h,"Configure options.");z.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();b.toggleHelpPopup(a)});b.makeTooltip(z,
"Help; Keyboard shortcuts. (H)");A.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]])},!1);F.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?-1:1,!1)},!1);b.makeTooltip(F,function(a){a=b.getSelectedTier();var c;0<=a&&(c=b.tiers[a]);return c&&c.featureSource&&b.sourceAdapterIsCapable(c.featureSource,"quantLeap")&&"number"==typeof c.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+
(c.config.name||c.dasSource.name)+'"" (ctrl+LEFT)':c&&c.featureSource&&b.sourceAdapterIsCapable(c.featureSource,"leap")?'Jump to the next feature in the selected track "'+(c.config.name||c.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});E.addEventListener("click",function(a){b.leap(b.reverseKeyScrolling?1:-1,!1)},!1);b.makeTooltip(E,function(a){a=b.getSelectedTier();var c;0<=a&&(c=b.tiers[a]);return c&&c.featureSource&&b.sourceAdapterIsCapable(c.featureSource,"quantLeap")&&"number"==typeof c.quantLeapThreshold?
'Jump to the next region with a score above the threshold in the selected track "'+(c.config.name||c.dasSource.name)+'"" (ctrl+RIGHT)':c&&c.featureSource&&b.sourceAdapterIsCapable(c.featureSource,"leap")?'Jump to the next feature in the selected track "'+(c.config.name||c.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});b.addTierSelectionListener(function(){var a=b.getSelectedTier(),c;0<=a&&(c=b.tiers[a]);a=!1;c&&c.featureSource&&(b.sourceAdapterIsCapable(c.featureSource,"quantLeap")&&
"number"==typeof c.quantLeapThreshold?a=!0:b.sourceAdapterIsCapable(c.featureSource,"leap")&&(a=!0));F.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";E.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});G.addEventListener("click",function(a){b.clearHighlights()},!1);b.makeTooltip(G,"Clear highlights (C)");b.addTierSelectionWrapListener(function(a){0>a&&(b.setSelectedTier(null),e.focus())});b.addTierSelectionListener(function(a){"tier"===b.uiMode&&(0==a.length?
(b.hideToolPanel(),b.manipulatingTier=null,b.uiMode="none"):(a=b.tiers[a[0]],a!=b.manipulatingTier&&b.openTierPanel(a)))});var K=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),b.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),b.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),1==b.selectedTiers.length&&b.openTierPanel(b.tiers[b.selectedTiers[0]]);else if(88==a.keyCode||
120==a.keyCode)a.stopPropagation(),a.preventDefault(),b.openExportPanel();else if(67==a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),b.clearHighlights()};d.addEventListener("focus",function(a){d.addEventListener("keydown",K,!1)},!1);d.addEventListener("blur",function(a){d.removeEventListener("keydown",K,!1)},!1);d.addEventListener("keydown",function(a){27===a.keyCode&&"none"!==b.uiMode&&(a.preventDefault(),a.stopPropagation(),b.setUiMode("none"),b.hideToolPanel(),b.selectedTiers&&
0<b.selectedTiers.length&&b.browserHolder.focus())},!1)};p.prototype.showToolPanel=function(d,n){var b=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var a;a=n?d:l("div",d,{},{overflowY:"auto",width:"100%"});var r=l("div",l("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});r.addEventListener("click",function(a){b.hideToolPanel();b.setUiMode("none")},!1);this.makeTooltip(r,"Close tool panel (ESC)");this.activeToolPanel=l("div",[r,
a],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();b=this};p.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};p.prototype.toggleHelpPopup=function(d){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(d=l("iframe",null,{scrolling:"yes",seamless:"seamless",src:this.resolveURL("$$help/index.html"),
className:"help-panel"}),this.showToolPanel(d,!1),this.setUiMode("help"))};p.prototype.toggleOptsPopup=function(d){var n=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{d=l("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var b=l("table");b.cellPadding=5;var a=l("input","",{type:"checkbox",checked:n.reverseScrolling});a.addEventListener("change",function(b){n.reverseScrolling=a.checked;
n.storeStatus()},!1);b.appendChild(l("tr",[l("td","Reverse trackpad scrolling",{align:"right"}),l("td",a)]));var r=l("input","",{type:"checkbox",checked:n.reverseKeyScrolling});r.addEventListener("change",function(a){n.reverseKeyScrolling=r.checked;n.storeStatus()},!1);b.appendChild(l("tr",[l("td","Reverse scrolling buttons and keys",{align:"right"}),l("td",r)]));var e=l("select");e.appendChild(l("option","Left",{value:"left"}));e.appendChild(l("option","Center",{value:"center"}));e.appendChild(l("option",
"Right",{value:"right"}));e.appendChild(l("option","None",{value:"none"}));e.value=n.rulerLocation;e.addEventListener("change",function(a){n.rulerLocation=e.value;n.positionRuler();for(a=0;a<n.tiers.length;++a)n.tiers[a].paintQuant();n.storeStatus()},!1);b.appendChild(l("tr",[l("td","Vertical guideline",{align:"right"}),l("td",e)]));var g=l("input","",{type:"checkbox",checked:n.singleBaseHighlight});g.addEventListener("change",function(a){n.singleBaseHighlight=g.checked;n.positionRuler();n.storeStatus()},
!1);g.setAttribute("id","singleBaseHightlightButton");b.appendChild(l("tr",[l("td","Display and highlight current genome location",{align:"right"}),l("td",g)]));d.appendChild(b);b=l("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});b.addEventListener("click",function(a){n.reset()},!1);d.appendChild(b);this.showToolPanel(d);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":13,"./export-image":14,"./export-ui":15,"./numformats":25,"./session":31,
"./svg-export":36,"./tier-edit":42,"./utils":49,"./zoomslider":52}],6:[function(d,x,t){function q(a,c,b){this.min=c;this.max=b;this.chr=a}function p(a){a||(a={});this.prefix="//www.biodalliance.org/release-0.13/";this.sources=[];this.tiers=[];this.tierGroups={};this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=[];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.registry="//www.dasregistry.org/das/sources";
this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=.5;this.zoomFactor=1;this.maxPixelsPerBase=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=.3;this.singleBaseHighlight=
this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.baseColors={A:"green",C:"blue",G:"orange",T:"red","-":"hotpink"};this.availableSources=new g;this.defaultSources=[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new e;this.useFetchWorkers=this.retina=!0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.initListeners=[];
if(void 0!==a.viewStart&&"number"!==typeof a.viewStart)throw Error("viewStart must be an integer");if(void 0!==a.viewEnd&&"number"!==typeof a.viewEnd)throw Error("viewEnd must be an integer");for(var c in a)this[c]=a[c];"string"===typeof a.uiPrefix&&"string"!==typeof a.prefix&&(this.prefix=a.uiPrefix);0===this.prefix.indexOf("//")&&(a=window.location.protocol,"http:"!=a&&"https:"!=a&&(console.log(window.location.protocol),console.log("WARNING: prefix is set to a protocol-relative URL ("+this.prefix+
" when loading from a non-HTTP source"),this.prefix="http:"+this.prefix));if(!this.coordSystem)throw Error("Coordinate system must be configured");if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var b=this;"complete"===document.readyState?b.realInit():window.addEventListener("load",function(a){b.realInit()},!1)}function l(a,c,b){if(b)for(var f=0;f<c.length;++f)c[f].mapping=b;a.set(c)}function n(a){return a.uri?a.uri:
a.blob?"file:"+a.blob.name:a.bwgBlob?"file:"+a.bwgBlob.name:a.bamBlob?"file:"+a.bamBlob.name:a.twoBitBlob?"file:"+a.twoBitBlob.name:a.bwgURI||a.bamURI||a.jbURI||a.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function w(a){return a.stylesheet_uri?a.stylesheet_uri:"sequence"==a.tier_type||a.twoBitURI||a.twoBitBlob?"http://www.biodalliance.org/magic/sequence":n(a)}function v(a,c){if(n(a)!=n(c)||a.mapping!=c.mapping||a.tier_type!=c.tier_type)return!1;if(a.overlay){if(!c.overlay||c.overlay.length!=
a.overlay.length)return!1;for(var b=0;b<a.overlay.length;++b)if(!v(a.overlay[b],c.overlay[b]))return!1}else if(c.overlay)return!1;return!0}function y(a,c){if(n(a)!=n(c)||w(a)!=w(c)||a.mapping!=c.mapping||a.tier_type!=c.tier_type)return!1;if(a.overlay){if(!c.overlay||c.overlay.length!=a.overlay.length)return!1;for(var b=0;b<a.overlay.length;++b)if(!y(a.overlay[b],c.overlay[b]))return!1}else if(c.overlay)return!1;return!0}function b(a,c,f,h){h=h||[];for(var B=a.length-1;0<=B;--B){var e=a[B];if(!e.notSelectable&&
e.min()<=c&&e.max()>=c&&(!e.minY||!(f<e.minY()||f>e.maxY()))){e.feature?h.push(e.feature):e.group&&h.push(e.group);if(e.glyphs)return b(e.glyphs,c,f,h);if(e.glyph)return b([e.glyph],c,f,h);break}}return h}function a(a,c){var b=this;this.tagSeed=0;this.callbacks={};this.browser=a;this.worker=c;this.worker.onmessage=function(a){var c=b.callbacks[a.data.tag];c&&(c(a.data.result,a.data.error),delete b.callbacks[a.data.tag])}}function r(c){var b=c.resolveURL(c.workerPath);0==b.indexOf("//")&&(b="https:"==
window.location.protocol?"https:"+b:"http:"+b);var f=new Blob(['importScripts("'+b+'");'],{type:"application/javascript"});return new E(function(b,h){var e=new Worker(URL.createObjectURL(f));e.onmessage=function(f){"init"===f.data.tag&&(console.log("Worker initialized"),b(new a(c,e)))};e.onerror=function(a){h(a.message)}})}function e(){this.sourcesByURI={}}if("undefined"!==typeof d){t=d("./utils");var g=t.Observed,m=t.makeElement,k=t.removeChildren,u=t.miniJSONify,G=t.shallowCopy,P=d("./tier").DasTier,
c=d("./sha1").hex_sha1,f=d("./thub").connectTrackHub,h=d("./version");t=d("./numformats");var z=t.formatQuantLabel,A=t.formatLongInt,F=d("./chainset").Chainset,E=d("es6-promise").Promise}p.prototype.resolveURL=function(a){return a.replace("$$",this.prefix)};p.prototype.realInit=function(){var a=this;if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");else{this.wasInitialized=!0;var c=navigator.userAgent||"dummy";0<=c.indexOf("Trident")&&0<=
c.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(c=0;c<this.sources.length;++c){var b=this.sources[c];b&&this.defaultSources.push(b)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var f=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");this.browserHolder=m("div",null,{className:"dalliance dalliance-root",
tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);k(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=m("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=m("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=m("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});
this.locSingleBase=m("span","",{className:"loc-single-base"});c=m("div",this.locSingleBase,{className:"loc-single-base-holder"});this.addViewListener(function(c,b,f,h,e,B,k){b=Math.round((k+B)/2);a.locSingleBase.appendChild(document.createTextNode(c+":"+A(b)));a.locSingleBase.removeChild(a.locSingleBase.firstChild)});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=m("div",[c,this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));
this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=m("div");this.disablePoweredBy||(this.bhtmlRoot.appendChild(m("span",["Powered by ",m("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+h],{className:"powered-by"})),this.bhtmlRoot.appendChild(m("span",[" | ",m("a","Link to Ensembl",{href:"http://www.ensembl.org/",id:"enslink",target:"_newtab"})," "],{className:"powered-by"})));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",function(a){f.resizeViewer()},
!1);this.ruler=m("div",null,{className:"guideline"});this.ruler2=m("div",null,{className:"single-base-guideline"});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var e in this.chainConfigs)c=this.chainConfigs[e],c instanceof F&&console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[e]=new F(c);if(0<this.maxWorkers){e=[];for(c=0;c<this.maxWorkers;++c)e.push(r(this));
e=E.all(e)}else e=E.resolve([]);this.fetchWorkers=null;this.nextWorker=0;e.then(function(a){console.log("Booted "+a.length+" workers");f.fetchWorkers=a},function(a){console.log("Failed to boot workers",a)}).then(function(){if("none"!=window.getComputedStyle(f.browserHolderHolder).display)setTimeout(function(){f.realInit2()},1);else var a=setInterval(function(){"none"!=window.getComputedStyle(f.browserHolderHolder).display&&(clearInterval(a),f.realInit2())},300)})}};p.prototype.realInit2=function(){var a=
this;k(this.tierHolder);k(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",
function(c){c.stopPropagation();c.preventDefault();if(c.wheelDeltaX){var b=c.wheelDeltaX/5;a.reverseScrolling||(b=-b);a.move(b)}c.wheelDeltaY&&(b=c.wheelDeltaY,a.reverseScrolling&&(b=-b),a.tierHolder.scrollTop+=b)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(c){c.stopPropagation();c.preventDefault();1==c.axis?0!=c.detail&&(c=c.detail/4,a.reverseScrolling&&(c=-c),a.move(c)):(c=c.detail,a.reverseScrolling||(c=-c),a.tierHolder.scrollTop+=c)},!1);this.tierHolderHolder.addEventListener("touchstart",
function(c){return a.touchStartHandler(c)},!1);this.tierHolderHolder.addEventListener("touchmove",function(c){return a.touchMoveHandler(c)},!1);this.tierHolderHolder.addEventListener("touchend",function(c){return a.touchEndHandler(c)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(c){return a.touchCancelHandler(c)},!1);var c=function(c){if(13==c.keyCode){var b=!1;for(c=0;c<a.tiers.length;++c){var f=a.tiers[c];f.wantedLayoutHeight&&f.wantedLayoutHeight!=f.layoutHeight&&(f.layoutHeight=
f.wantedLayoutHeight,f.clipTier(),b=!0)}b&&a.arrangeTiers()}else if(32==c.keyCode||32==c.charCode)a.isSnapZooming?(a.isSnapZooming=!1,b=(a.savedZoom||20)+a.zoomMin):(a.isSnapZooming=!0,b=(a.savedZoom||0)+a.zoomMin),a.savedZoom=a.zoomSliderValue-a.zoomMin,a.zoomSliderValue=b,a.zoom(Math.exp(1*b/a.zoomExpt)),c.stopPropagation(),c.preventDefault();else if(85==c.keyCode)"opts"===a.uiMode&&(b=document.getElementById("singleBaseHightlightButton").checked,document.getElementById("singleBaseHightlightButton").checked=
!b),a.singleBaseHighlight=!a.singleBaseHighlight,a.positionRuler(),c.stopPropagation(),c.preventDefault();else if(39==c.keyCode)c.stopPropagation(),c.preventDefault(),a.scrollArrowKey(c,-1);else if(37==c.keyCode)c.stopPropagation(),c.preventDefault(),a.scrollArrowKey(c,1);else if(38==c.keyCode||87==c.keyCode)if(c.stopPropagation(),c.preventDefault(),c.shiftKey)c=a.getSelectedTier(),0>c||(b=a.tiers[c],c=b.forceHeight||b.subtiers[0].height,40<=c&&b.mergeConfig({height:c-10}));else if(c.ctrlKey||c.metaKey){if(c=
a.getSelectedTier(),!(0>c)&&(b=a.tiers[c],b.quantLeapThreshold)){var f=b.subtiers[0].height,h=b.subtiers[0].quant;h&&(c=1*h.min,h=1*h.max,f=(h-c)/f,b.mergeConfig({quantLeapThreshold:c+((Math.round((b.quantLeapThreshold-c)/f)|0)+1)*f}),b.notify("Threshold: "+z(b.quantLeapThreshold)))}}else if(c.altKey){if(h=a.selectedTiers.length,0!=h){c=a.selectedTiers[0];for(var e=!0,b=[],f=0;f<a.selectedTiers.length;++f)b.push(a.tiers[a.selectedTiers[f]]),0<f&&1!=a.selectedTiers[f]-a.selectedTiers[f-1]&&(e=!1);
if(!(e&&0>=c)){for(f=a.selectedTiers.length-1;0<=f;--f)a.tiers.splice(a.selectedTiers[f],1);a.selectedTiers.splice(0,h);c=e?c-1:c;for(f=0;f<b.length;++f)a.tiers.splice(c+f,0,b[f]),a.selectedTiers.push(c+f);a.withPreservedSelection(a._ensureTiersGrouped);a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else if(c=a.getSelectedTier(),0<c){if(a.setSelectedTier(c-1),c=a.tiers[a.getSelectedTier()],b=c.row.offsetTop,c=b+c.row.offsetHeight,b<a.tierHolder.scrollTop||c>a.tierHolder.scrollTop+
a.tierHolder.offsetHeight)a.tierHolder.scrollTop=b}else a.notifyTierSelectionWrap(-1);else if(40==c.keyCode||83==c.keyCode)if(c.stopPropagation(),c.preventDefault(),c.shiftKey)c=a.getSelectedTier(),0>c||(b=a.tiers[c],c=b.forceHeight||b.subtiers[0].height,b.mergeConfig({height:c+10}));else if(c.ctrlKey||c.metaKey){if(c=a.getSelectedTier(),!(0>c)&&(b=a.tiers[c],b.quantLeapThreshold&&(f=b.subtiers[0].height,h=b.subtiers[0].quant)))c=1*h.min,h=1*h.max,f=(h-c)/f,h=Math.round((b.quantLeapThreshold-c)/f)|
0,1<h&&(b.mergeConfig({quantLeapThreshold:c+(h-1)*f}),b.notify("Threshold: "+z(b.quantLeapThreshold)))}else if(c.altKey){if(h=a.selectedTiers.length,0!=h){c=a.selectedTiers[0];for(var B=0,b=[],f=0;f<a.selectedTiers.length;++f)b.push(a.tiers[a.selectedTiers[f]]),0<f&&(B+=a.selectedTiers[f]-a.selectedTiers[f-1]-1);e=0==B;if(!(e&&c+h>=a.tiers.length)){for(f=a.selectedTiers.length-1;0<=f;--f)a.tiers.splice(a.selectedTiers[f],1);a.selectedTiers.splice(0,h);c=e?c+1:c+B;for(f=0;f<b.length;++f)a.tiers.splice(c+
f,0,b[f]),a.selectedTiers.push(c+f);a.withPreservedSelection(function(){a._ensureTiersGrouped(!0)});a.markSelectedTiers();a.notifyTierSelection();a.reorderTiers();a.notifyTier()}}}else{if(c=a.getSelectedTier(),c<a.tiers.length-1&&(a.setSelectedTier(c+1),c=a.tiers[a.getSelectedTier()],b=c.row.offsetTop,c=b+c.row.offsetHeight,b<a.tierHolder.scrollTop||c>a.tierHolder.scrollTop+a.tierHolder.offsetHeight))a.tierHolder.scrollTop=Math.min(b,c-a.tierHolder.offsetHeight)}else if(187==c.keyCode||61==c.keyCode)c.stopPropagation(),
c.preventDefault(),a.zoomStep(-10);else if(189==c.keyCode||173==c.keyCode)c.stopPropagation(),c.preventDefault(),a.zoomStep(10);else if(73==c.keyCode||105==c.keyCode)c.stopPropagation(),c.preventDefault(),c=a.getSelectedTier(),0>c||(f=a.tiers[c],f.infoVisible?(f.infoElement.style.display="none",f.updateHeight(),f.infoVisible=!1):(f.infoElement.style.display="block",f.updateHeight(),f.infoVisible=!0));else if(84==c.keyCode||116==c.keyCode)if(c.shiftKey)for(c.stopPropagation(),c.preventDefault(),c=
0;c<a.tiers.length;++c)f=a.tiers[c],f.dasSource.collapseSuperGroups&&(void 0===b&&(b=!f.bumped),f.mergeConfig({bumped:b}));else c.ctrlKey||c.metaKey||(c.stopPropagation(),c.preventDefault(),c=a.getSelectedTier(),0>c||(f=a.tiers[c],f.dasSource.collapseSuperGroups&&(void 0===b&&(b=!f.bumped),f.mergeConfig({bumped:b}))));else if(77==c.keyCode||109==c.keyCode)c.stopPropagation(),c.preventDefault(),(c.ctrlKey||c.metaKey)&&1<a.selectedTiers.length&&a.mergeSelectedTiers();else if(68==c.keyCode||100==c.keyCode){if(c.stopPropagation(),
c.preventDefault(),c.ctrlKey||c.metaKey)c=a.getSelectedTier(),0>c||a.addTier(a.tiers[c].dasSource)}else if(80==c.keyCode||112==c.keyCode)if(c.ctrlKey||c.metaKey){b=[];for(c=0;c<a.selectedTiers.length;++c)b.push(a.tiers[a.selectedTiers[c]]);for(c=0;c<b.length;++c)b[c].mergeConfig({pinned:!b[c].pinned})}};this.browserHolder.addEventListener("focus",function(b){a.browserHolder.addEventListener("keydown",c,!1)},!1);this.browserHolder.addEventListener("blur",function(b){a.browserHolder.removeEventListener("keydown",
c,!1)},!1);this.hPopupHolder=m("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]="12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var b=0;b<this.sources.length;++b){var h=this.sources[b];if(h){var e={};this.restoredConfigs&&(e=this.restoredConfigs[b]);h.disabled||this.makeTier(h,e)}}a._ensureTiersGrouped();a.arrangeTiers();a.reorderTiers();a.refresh();a.setSelectedTier(1);a.positionRuler();(b=this.getSequenceSource())&&
b.getSeqInfo(this.chr,function(c){a.currentSeqMax=c.length});this.queryRegistry();for(var g in this.chains)this.queryRegistry(g,!0);if(this.hubs)for(g=0;g<this.hubs.length;++g)b=this.hubs[g],"string"==typeof b&&(b={url:b}),function(c){f(c.url,function(b,f){if(f)console.log(f);else{var h;if(h=c.genome?b.genomes[c.genome]:b.genomes[a.coordSystem.ucscName])c.mapping&&(h.mapping=c.mapping),a.hubObjects.push(h)}},c)}(b);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&
this.storeStatus();for(g=0;g<this.initListeners.length;++g)try{this.initListeners[g].call(this)}catch(r){console.log(r)}};p.prototype.touchStartHandler=function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};p.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var c=
a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&c!=this.touchOriginX&&this.move(c-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&(this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=c;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){c=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(c!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var b=this.viewStart+a/this.scale|0;this.scale=c/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=
b-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=c}};p.prototype.touchEndHandler=function(a){};p.prototype.touchCancelHandler=function(a){};p.prototype.makeTier=function(a,c){try{return this.realMakeTier(a,c)}catch(b){console.log("Error initializing",a),console.log(b.stack||b)}};p.prototype.realMakeTier=function(a,c){var f=this,h=null;this.tierBackgroundColors&&(h=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var e=new P(this,
a,c,h);e.oorigin=this.viewStart;var k=!1,m,g,r,F=function(a,c){var h=e.subtiers;if(h){var k=0;for(c-=e.padding;k<h.length&&c>h[k].height&&k<h.length-1;)c=c-h[k].height-e.padding,++k;if(!(k>=h.length))return h=h[k].glyphs,a-=(e.glyphCacheOrigin-f.viewStart)*f.scale,b(h,a,c)}},A=function(a){a.preventDefault();a.stopPropagation();a=a.clientX;a!=g&&(f.move(a-g,!0),g=a);f.isDragging=!0},d=function(a){window.removeEventListener("mousemove",A,!0);window.removeEventListener("mouseup",d,!0);f.move(a.clientX-
g)};e.viewport.addEventListener("mousedown",function(a){f.browserHolder.focus();a.preventDefault();e.row.getBoundingClientRect();a=a.clientX;window.addEventListener("mousemove",A,!0);window.addEventListener("mouseup",d,!0);m=g=a;f.isDragging=!1},!1);e.viewport.addEventListener("mousemove",function(a){var c=e.row.getBoundingClientRect(),b=a.clientX-c.left,h=a.clientY-c.top,c=F(b,h);e.row.style.cursor=c&&0<c.length?"pointer":"default";r&&clearTimeout(r);k||(r=setTimeout(function(){var c=F(b,h);c&&0<
c.length&&f.notifyFeatureHover(a,c[c.length-1],c,e)},1E3))});var z=null;e.viewport.addEventListener("mouseup",function(a){var c=e.row.getBoundingClientRect(),b=a.clientX-c.left,c=a.clientY-c.top,h=F(b,c);h&&0<h.length&&!f.isDragging&&(z?(clearTimeout(z),z=null,f.featureDoubleClick(h,b,c)):z=setTimeout(function(){z=null;f.notifyFeature(a,h[h.length-1],h,e)},500));if(f.isDragging&&b!=m&&e.sequenceSource){var c=f.viewStart+b/f.scale,k=f.viewStart+m/f.scale;c<k?(b=c|0,c=k|0):(b=k|0,c|=0);f.notifyRegionSelect(f.chr,
b,c)}f.isDragging=!1},!1);e.viewport.addEventListener("mouseout",function(a){k=!1});e.removeButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();for(a=0;a<f.tiers.length;++a)if(f.tiers[a]===e){f.removeTier({index:a});break}},!1);e.nameButton.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();if(a.shiftKey){a=-1;for(var c=0;c<f.tiers.length;++c)if(f.tiers[c]===e){a=c;break}0<=a&&(c=f.selectedTiers.indexOf(a),0<=c?f.selectedTiers.splice(c,1):(f.selectedTiers.push(a),
f.selectedTiers.sort()),f.markSelectedTiers(),f.notifyTierSelection(),0<f.selectedTiers.length?f.browserHolder.focus():f.notifyTierSelectionWrap(-1))}else{for(c=0;c<f.tiers.length;++c)if(f.tiers[c]===e&&(f.browserHolder.focus(),1!=f.selectedTiers.length||f.selectedTiers[0]!=c)){f.setSelectedTier(c);return}e.infoVisible?(e.infoElement.style.display="none",e.updateHeight(),e.infoVisible=!1):(e.infoElement.style.display="block",e.updateHeight(),e.infoVisible=!0)}},!1);e.bumpButton.addEventListener("click",
function(a){a.stopPropagation();a.preventDefault();var c;e.dasSource.collapseSuperGroups&&(void 0===c&&(c=!e.bumped),e.mergeConfig({bumped:c}))},!1);var E,u,n,v,G,D=!1,M=function(a){var c=e.label;a.stopPropagation();a.preventDefault();if(!E){u=e.pinned?f.pinnedTierHolder:f.tierHolder;n=u.scrollHeight-u.offsetHeight;E=c.cloneNode(!0);E.style.cursor="pointer";u.appendChild(E);c.style.visibility="hidden";for(var b=0;b<f.tiers.length;++b)if(f.tiers[b]===e){v=b;break}G=a.clientY}var h=u.getBoundingClientRect();
E.style.left=c.getBoundingClientRect().left-h.left+"px";E.style.top=a.clientY-h.top+u.scrollTop-10+"px";c=a.clientY-h.top+u.scrollTop;for(b=0;b<f.tiers.length;++b)if(h=f.tiers[b],!(h.pinned^e.pinned)&&(h=h.row.getBoundingClientRect(),c-=h.bottom-h.top,0>c)){if(b<v&&a.clientY<G||b>v&&a.clientY>G){f.withPreservedSelection(function(){f.tiers.splice(v,1);f.tiers.splice(b,0,e);f._ensureTiersGrouped(b>v)});for(c=0;c<f.tiers.length;++c)f.tiers[c]==e&&(v=c);G=a.clientY;f.reorderTiers();u.appendChild(E);D=
!0}break}E.offsetTop<u.scrollTop?u.scrollTop-=u.scrollTop-E.offsetTop:E.offsetTop+E.offsetHeight>u.scrollTop+u.offsetHeight&&(u.scrollTop=Math.min(u.scrollTop+(E.offsetTop+E.offsetHeight)-(u.scrollTop+u.offsetHeight),n))},l=function(a){var c=e.label;a.stopPropagation();a.preventDefault();E&&(E.style.cursor="auto",u.removeChild(E),E=null,c.style.visibility="visible");document.removeEventListener("mousemove",M,!1);document.removeEventListener("mouseup",l,!1);if(D){for(a=0;a<f.tiers.length;++a)if(f.tiers[a]==
e){f.setSelectedTier(a);break}f.notifyTier()}};e.label.addEventListener("mousedown",function(a){a.stopPropagation();a.preventDefault();D=!1;document.addEventListener("mousemove",M,!1);document.addEventListener("mouseup",l,!1)},!1);this.tiers.push(e);e.init();e.currentlyHeight=50;this.updateHeight();e.updateLabel();e.featureSource&&e.featureSource.addActivityListener&&e.featureSource.addActivityListener(function(a){e.loaderButton.style.display=0<a?"inline-block":"none";f.pingActivity()});this.withPreservedSelection(f._ensureTiersGrouped);
e._updateFromConfig();this.reorderTiers();return e};p.prototype.reorderTiers=function(){k(this.tierHolder);k(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,c=[],b=[],f=0;f<this.tiers.length;++f){var h=this.tiers[f];h.pinned&&!this.disablePinning?(c.push(h),this.pinnedTierHolder.appendChild(this.tiers[f].row),a=!0):(b.push(h),this.tierHolder.appendChild(this.tiers[f].row))}this.withPreservedSelection(function(){this.tiers.splice(0,
this.tiers.length);for(var a=0;a<c.length;++a)this.tiers.push(c[a]);for(a=0;a<b.length;++a)this.tiers.push(b[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};p.prototype.withPreservedSelection=function(a){for(var c=[],b=0;b<this.selectedTiers.length;++b)c.push(this.tiers[this.selectedTiers[b]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=c.indexOf(this.tiers[a])&&
this.selectedTiers.push(a)};p.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};p.prototype._ensureTiersGrouped=function(a){for(var c={},b=0;b<this.tiers.length;++b){var f=this.tiers[b];f.dasSource.tierGroup&&pusho(c,f.dasSource.tierGroup,f)}var h=[];a&&this.tiers.reverse();for(b=0;b<this.tiers.length;++b)if(f=this.tiers[b],f.dasSource.tierGroup){var e=c[f.dasSource.tierGroup];if(e){a&&e.reverse();for(var k=0;k<e.length;++k)h.push(e[k]);c[f.dasSource.tierGroup]=null}}else h.push(f);
a&&h.reverse();this.tiers.splice(0,this.tiers.length);for(k=0;k<h.length;++k)this.tiers.push(h[k])};p.prototype.arrangeTiers=function(){for(var a=[],c={},b=0;b<this.tiers.length;++b){var f=this.tiers[b];f.pinned&&(a.push(f),f.dasSource.tierGroup&&pusho(c,f.dasSource.tierGroup,f))}for(b=0;b<this.tiers.length;++b)f=this.tiers[b],f.pinned||(a.push(f),f.dasSource.tierGroup&&pusho(c,f.dasSource.tierGroup,f));for(var h in c){var f=c[h],e=this.tierGroups[h];e||(e={element:m("div",m("span",h,{className:"tier-group-label"}),
{className:"tier-group"})},this.tierGroups[h]=e);e.element.parentNode&&e.element.parentNode.removeChild(e.element);for(var k=f[0].pinned?this.pinnedTierHolder:this.tierHolder,g=1E7,r=0,b=0;b<f.length;++b)var F=f[b].row,g=Math.min(g,F.offsetTop),r=Math.max(r,F.offsetTop+F.offsetHeight);e.element.style.top=g+"px";e.element.style.left="0px";e.element.style.height=r-g+"px";k.appendChild(e.element)}if(this.tierBackgroundColors)for(b=0;b<a.length;++b)f=a[b],f.setBackground(this.tierBackgroundColors[b%this.tierBackgroundColors.length]),
f.label.style.left=f.dasSource.tierGroup?"18px":"2px",f.background=this.tierBackgroundColors[b%this.tierBackgroundColors.length]};p.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,c=1E3/this.scale|0,b=(this.viewStart+this.viewEnd)/2,f=b-this.origin;this.origin=b;this.scaleAtLastRedraw=this.scale;for(b=0;b<this.tiers.length;++b){var h=f;this.tiers[b].originHaxx&&(h+=this.tiers[b].originHaxx);this.tiers[b].originHaxx=h}f=this.targetQuantRes/this.scale;b=Math.max(1,(this.viewStart|
0)-a);a=Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);h=Math.max(1,(this.viewStart|0)-c);c=Math.min((this.viewEnd|0)+c,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var e=this.getSequenceSource();this.knownSpace&&this.knownSpace.cancel();this.knownSpace=new D(this.tiers,this.chr,h,c,f,e)}(e=this.knownSpace.bestCacheOverlapping(this.chr,b,a))&&e.min<=b&&e.max>=a?(this.drawnStart=Math.max(e.min,h),this.drawnEnd=
Math.min(e.max,c)):(this.drawnStart=h,this.drawnEnd=c);this.knownSpace.viewFeatures(this.chr,this.drawnStart,this.drawnEnd,f);this.drawOverlays();this.positionRuler()};p.prototype.queryRegistry=function(a,b){var f,h;a?(f=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new g),h=this.mappableSources[a]):(f=this.coordSystem,h=this.availableSources);var e=c(u(f));if(b){var k=localStorage["dalliance.registry."+e+".last_queried"];if(k)try{if(l(h,JSON.parse(localStorage["dalliance.registry."+
e+".sources"]),a),432E5>(Date.now()|0)-(k|0))return}catch(m){console.log("Bad registry cache: "+m)}}(new Z(this.registry)).sources(function(c){for(var b=[],k=0;k<c.length;++k){var m=c[k];if(m.coords&&0!=m.coords.length){var g=m.coords[0];g.taxon==f.taxon&&g.auth==f.auth&&g.version==f.version&&b.push(m)}}localStorage["dalliance.registry."+e+".sources"]=JSON.stringify(b);localStorage["dalliance.registry."+e+".last_queried"]=""+Date.now();l(h,b,a)},function(a){},f)};p.prototype.move=function(a,c){var b=
this.viewEnd-this.viewStart,f=this.viewStart-1*a/this.scale,h=f+b;c||(0<this.currentSeqMax&&h>this.currentSeqMax&&(h=this.currentSeqMax,f=this.viewEnd-b),1>f&&(f=1,h=f+b));this.setLocation(null,f,h,null,c)};p.prototype.zoomStep=function(a){var c=1*this.zoomSliderValue;a=c+a;a<this.zoomMin&&(a=this.zoomMin);a>this.zoomMax&&(a=this.zoomMax);a!=c&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};p.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/
2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.notifyLocation();this.refresh()};p.prototype.spaceCheck=function(a){this.knownSpace&&
this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};p.prototype.resizeViewer=function(a){var c=this.tierHolder.getBoundingClientRect().width|0;if(0!=c){var b=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=c|0;b!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),
this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/this.maxPixelsPerBase/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/b,c=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-c+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+c-1),this.positionRuler(),
a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};p.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(1E3,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};p.prototype.addTier=function(a){a=G(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();this.positionRuler();this.notifyTier();return a};p.prototype.removeTier=function(a,c){var b=-1;if("undefined"!==typeof a.index&&0<=a.index&&
a.index<this.tiers.length)b=a.index;else for(var f=0;f<this.tiers.length;++f)if(y(a,this.tiers[f].dasSource)){b=f;break}if(0>b)throw"Couldn't find requested tier";this.tiers.splice(b,1);for(var f=[],h=0;h<this.selectedTiers.length;++h){var e=this.selectedTiers[h];e<b?f.push(e):e>b&&f.push(e-1)}this.selectedTiers=f;this.markSelectedTiers();this.reorderTiers();this.notifyTier()};p.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());
return this._sequenceSource};p.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var c=this.defaultSources[a];if(c.provides_entrypoints||"sequence"==c.tier_type||c.twoBitURI||c.twoBitBlob)return c.twoBitURI||c.twoBitBlob?new M(c):new R(c)}};p.prototype.setLocation=function(a,c,b,f,h){if("number"!==typeof c)throw Error("minimum must be a number (got "+JSON.stringify(c)+
")");if("number"!==typeof b)throw Error("maximum must be a number (got "+JSON.stringify(b)+")");f||(f=function(a){if(a)throw a;});var e=this;if((!a||a==this.chr)&&0<this.currentSeqMax)return this._setLocation(null,c,b,null,f,h);var k=this.getSequenceSource();if(!k)return f("Need a sequence source");k.getSeqInfo(a,function(m){if(m)return e._setLocation(a,c,b,m,f,h);var g;g=0==a.indexOf("chr")?a.substr(3):"chr"+a;k.getSeqInfo(g,function(k){return k?e._setLocation(g,c,b,k,f,h):f("Couldn't find sequence '"+
a+"'")})})};p.prototype._setLocation=function(a,c,b,f,h,e){var k=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(k=!0),this.chr=a,this.currentSeqMax=f.length);c=parseFloat(c);b=parseFloat(b);a=Math.max(10,b-c+1);e||(1>c&&(c=1,b=c+a-1),b>this.currentSeqMax&&(b=this.currentSeqMax,c=Math.max(1,b-a+1)));this.viewStart=c;this.viewEnd=b;c=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);e=1E-6<Math.abs(c-this.scale);this.scale=c;b=this.zoomSliderValue;this.zoomSliderValue=
c=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(e||k){for(k=0;k<this.tiers.length;++k)this.tiers[k].viewportHolder.style.left="5000px",this.tiers[k].overlay.style.left="5000px";this.refresh();this.savedZoom?(c-=this.zoomMin,b-=this.zoomMin,k=c-this.savedZoom,Math.abs(c-b)>Math.abs(k)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=b)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(k=0;k<this.tiers.length;++k)this.tiers[k].viewportHolder.style.left=""+((-((this.viewStart-
this.tiers[k].norigin)*this.scale)|0)-1E3)+"px",this.tiers[k].drawOverlay();this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return h()};p.prototype.setCenterLocation=function(a,c){var b=(this.viewEnd-this.viewStart)/2;this.setLocation(a,c-b,c+b)};p.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,c=0;c<this.tiers.length;++c)"none"!==this.tiers[c].loaderButton.style.display&&++a;0==a&&(a=Date.now()|
0,console.log("Loading took "+(a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};p.prototype.addInitListener=function(a){this.initListeners.push(a)};p.prototype.addFeatureListener=function(a,c){this.featureListeners.push(a)};p.prototype.notifyFeature=function(a,c,b,f){for(var h=0;h<this.featureListeners.length;++h)try{if(this.featureListeners[h](a,c,b,f))break}catch(e){console.log(e.stack)}};p.prototype.addFeatureHoverListener=function(a,c){this.featureHoverListeners.push(a)};p.prototype.notifyFeatureHover=
function(a,c,b,f){for(var h=0;h<this.featureHoverListeners.length;++h)try{this.featureHoverListeners[h](a,c,b,f)}catch(e){console.log(e.stack)}};p.prototype.addViewListener=function(a,c){this.viewListeners.push(a)};p.prototype.notifyLocation=function(){var a=Math.max(1,this.viewStart|0),c=this.viewEnd|0;0<this.currentSeqMax&&c>this.currentSeqMax&&(c=this.currentSeqMax);for(var b=0;b<this.viewListeners.length;++b)try{this.viewListeners[b](this.chr,a,c,this.zoomSliderValue,{current:this.zoomSliderValue,
alternate:this.savedZoom+this.zoomMin||this.zoomMin,isSnapZooming:this.isSnapZooming,min:this.zoomMin,max:this.zoomMax},this.viewStart,this.viewEnd)}catch(f){console.log(f.stack)}};p.prototype.addTierListener=function(a){this.tierListeners.push(a)};p.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(c){console.log(c.stack)}};p.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};p.prototype.notifyRegionSelect=
function(a,c,b){for(var f=0;f<this.regionSelectListeners.length;++f)try{this.regionSelectListeners[f](a,c,b)}catch(h){console.log(h.stack)}};p.prototype.highlightRegion=function(a,c,b){var f=this;if(a==this.chr)return this._highlightRegion(a,c,b);var h=this.getSequenceSource();if(!h)throw"Need a sequence source";h.getSeqInfo(a,function(e){if(e)return f._highlightRegion(a,c,b);var k;k=0==a.indexOf("chr")?a.substr(3):"chr"+a;h.getSeqInfo(k,function(a){if(a)return f._highlightRegion(k,c,b)})})};p.prototype._highlightRegion=
function(a,c,b){for(var f=0;f<this.highlights.length;++f){var h=this.highlights[f];if(h.chr==a&&h.min==c&&h.max==b)return}this.highlights.push(new q(a,c,b));f=this.viewStart-1E3/this.scale;h=this.viewEnd+1E3/this.scale;(a==this.chr||a=="chr"+this.chr)&&c<h&&b>f&&this.drawOverlays();this.notifyLocation()};p.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};p.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};
p.prototype.featuresInRegion=function(a,c,b){var f=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var h=this.tiers[a].currentFeatures||[],e=0;e<h.length;++e){var k=h[e];k.min<=b&&k.max>=c&&f.push(k)}return f};p.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};p.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};p.prototype.markSelectedTiers=function(){for(var a=
0;a<this.tiers.length;++a){var c=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?c.classList.add("active"):c.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};p.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};p.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(c){console.log(c.stack)}};
p.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};p.prototype.notifyTierSelectionWrap=function(a){for(var c=0;c<this.tierSelectionWrapListeners.length;++c)try{this.tierSelectionWrapListeners[c](a)}catch(b){console.log(b.stack)}};p.prototype.positionRuler=function(){var a="none",c="",b="";"center"==this.rulerLocation?(a="block",c=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",c="0px"):"right"==this.rulerLocation?(a="block",b=
"0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=c;this.ruler.style.right=b;this.singleBaseHighlight?(this.ruler2.style.display="block",this.ruler2.style.borderWidth="1px",1>this.scale?(this.ruler2.style.width="0px",this.ruler2.style.borderRightWidth="0px"):(this.ruler2.style.width=this.scale+"px",this.ruler2.style.borderRightWidth="1px"),this.locSingleBase.style.visibility="visible",this.locSingleBase.style.left=""+(this.featurePanelWidth/2-this.locSingleBase.offsetWidth/2+this.ruler2.offsetWidth/
2|0)+"px"):(this.locSingleBase.style.visibility="hidden",this.ruler2.style.width="1px",this.ruler2.style.borderWidth="0px",this.ruler2.style.display="center"==this.rulerLocation?"none":"block");this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var f=0;f<this.tiers.length;++f){var h=this.tiers[f],e=h.quantOverlay,k;h.subtiers&&0<h.subtiers.length&&(k=h.subtiers[0].quant);e&&(e.style.display=k?a:"none",e.style.left=c,e.style.right=b)}};p.prototype.featureDoubleClick=function(a,c,b){if(a&&
0!=a.length&&(b=a[a.length-1],b.min&&b.max)){var f=((b.min|0)-(this.viewStart|0))*this.scale,h=(b.max-b.min+1)*this.scale;a=((b.min|0)+(b.max|0))/2;10<h&&(c=1*(c-f)/h,.3>c?a=b.min|0:.7<c&&(a=(b.max|0)+1));c=this.viewEnd-this.viewStart;this.setLocation(null,a-c/2,a+c/2)}};p.prototype.zoomForScale=function(a){return.2<a?"high":.01<a?"medium":"low"};p.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};p.prototype.updateHeight=function(){for(var a=0,c=0;c<this.tiers.length;++c)a+=
this.tiers[c].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px";this.browserHolder.style.display="block";this.browserHolder.style.display="flex"};p.prototype.scrollArrowKey=function(a,c){this.reverseKeyScrolling&&(c=-c);if(a.ctrlKey||a.metaKey){var b=!1;a.shiftKey&&(b=!0);this.leap(c,b)}else if(1<this.scale){var b=(this.viewStart+this.viewEnd)/2,b=b-Math.round(b),f=1;a.shiftKey&&(f*=10);0<c?(f=-f-b,0<b&&(f+=1)):(f-=b,0>b&&--f);this.setLocation(null,this.viewStart+
f,this.viewEnd+f)}else this.move(a.shiftKey?100*c:25*c)};p.prototype.leap=function(a,c){var b=this,f=(b.viewStart+b.viewEnd+1)/2|0;0<a&&1>=b.viewStart?f-=1E8:0>a&&b.viewEnd>=b.currentSeqMax&&(f+=1E8);var h=b.getSelectedTier();0>h||((h=b.tiers[h])&&(h.featureSource&&this.sourceAdapterIsCapable(h.featureSource,"quantLeap")&&"number"==typeof h.quantLeapThreshold||h.featureSource&&this.sourceAdapterIsCapable(h.featureSource,"leap"))?h.findNextFeature(b.chr,f,-a,c,function(h){if(h){var e=h.min,k=h.max;
c&&(0<a?e>f+1?k=e:(k++,e=k):k<f-1?(k++,e=k):k=e);var m=b.viewEnd-b.viewStart+1;parseFloat(m/2)==parseInt(m/2)&&m--;e=(e+k-m)/2+1;b.setLocation(h.segment,e,e+m-1)}else alert("no next feature")}):this.move(100*a))};p.prototype.nameForCoordSystem=function(a){var c=null,b=null;this.assemblyNamePrimary&&(c=""+a.auth,"undefined"!==typeof a.version&&(c+=a.version));this.assemblyNameUcsc&&(b=a.ucscName);return null!=c&&null!=b?c+"/"+b:c||b||"unknown"};p.prototype.makeLoader=function(a){var c=1<window.devicePixelRatio;
return 20>(a||16)?m("img",null,{src:this.resolveURL("$$img/spinner_"+(c?16:32)+".gif"),width:"16",height:"16"}):m("img",null,{src:this.resolveURL("$$img/spinner_"+(c?24:48)+".gif"),width:"24",height:"24"})};p.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};a.prototype.postCommand=function(a,c,b){var f="x"+ ++this.tagSeed;a.tag=
f;this.callbacks[f]=c;this.worker.postMessage(a,b)};if("undefined"!==typeof x){x.exports={Browser:p,sourcesAreEqual:y,sourceDataURI:n};d("./browser-ui");d("./track-adder");d("./track-adder-custom");d("./feature-popup");d("./tier-actions");d("./domui");d("./search");x=d("./sourceadapters");var M=x.TwoBitSequenceSource,R=x.DASSequenceSource,D=d("./kspace").KnownSpace,Z=d("./das").DASRegistry}e.prototype.get=function(a){var c=this.sourcesByURI[n(a)];if(c)for(var b=0;b<c.configs.length;++b)if(v(c.configs[b],
a))return c.sources[b]};e.prototype.put=function(a,c){var b=n(a),f=this.sourcesByURI[b];f||(f={configs:[],sources:[]},this.sourcesByURI[b]=f);f.configs.push(a);f.sources.push(c)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":18,"./kspace":22,"./numformats":25,"./search":29,"./sha1":32,"./sourceadapters":33,"./thub":40,"./tier":43,"./tier-actions":41,"./track-adder":45,"./track-adder-custom":44,"./utils":49,"./version":51,"es6-promise":53}],7:[function(d,x,t){function q(a,
b,c,f){"string"==typeof a?(this.uri=a,this.srcTag=b,this.destTag=c,this.coords=f):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=e(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.fetchedTiles={};this.granularity=1E6;this.chainFetcher="bigbed"==this.type?new l(this.uri,this.credentials):"alias"==this.type?new y(a):new p(this.uri,this.srcTag,this.destTag)}function p(a,e,c){this.source=new b(a);
this.srcTag=e;this.destTag=c}function l(a,b){var c=this;this.uri=a;this.credentials=b;this.bwg=new u(function(a,b){k(new m(c.uri,{credentials:c.credentials}),function(c,e){c?a(c):b(e)})});this.bwg.then(function(a,c){c&&console.log(c)})}function n(a){return parseInt(a)}function w(a){return 0==a.indexOf("chr")?a.substr(3):a}function v(a){var b={srcChr:w(a.srcChrom),srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:w(a.segment),destMin:a.min-1,destMax:a.max,destOri:a.ori,
blocks:[]},c=a.srcStarts.split(",").map(n),f=a.destStarts.split(",").map(n);a=a.blockLens.split(",").map(n);for(var h=0;h<c.length;++h)b.blocks.push([c[h],f[h],a[h]]);return b}function y(a){this.conf=a;this.forwardAliases={};a=a.sequenceAliases||[];for(var b=0;b<a.length;++b){var c=a[b];if(!(2>c.length)){for(var f=[],h=0;h<c.length-1;++h)f.push(c[h]);this.forwardAliases[c[c.length-1]]=f}}}if("undefined"!==typeof d){t=d("./das");var b=t.DASSource,a=t.DASSegment;t=d("./utils");var r=t.pusho,e=t.shallowCopy,
g=d("./cigar").parseCigar,m=d("./bin").URLFetchable,k=d("./bigwig").makeBwg,u=d("es6-promise").Promise}q.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};q.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],f=0;f<c.length;++f){var h=c[f];if(b>=h.srcMin&&b<=h.srcMax){var e;e="-"==h.srcOri?h.srcMax-b:b-h.srcMin;for(var k=h.blocks,m=0;m<k.length;++m){var g=k[m],r=g[0],d=g[1],
g=g[2];if(e>=r&&e<=r+g)return c=e-r,{seq:h.destChr,pos:"-"==h.destOri?h.destMax-d-c:c+d+h.destMin,flipped:h.srcOri!=h.destOri}}}}return null};q.prototype.mapSegment=function(a,b,c){a=this.chainsBySrc[a]||[];for(var f=[],h=0;h<a.length;++h){var e=a[h];if(c>=e.srcMin&&b<=e.srcMax){var k,m;"-"==e.srcOri?(k=e.srcMax-c,m=e.srcMax-b):(k=b-e.srcMin,m=c-e.srcMin);for(var g=e.blocks,r=0;r<g.length;++r){var d=g[r],u=d[0],n=d[1],d=d[2];if(m>=u&&k<=u+d){var v={segment:e.destChr,flipped:"-"==e.srcOri^"-"==e.destOri};
"-"==e.destOri?(k>=u?v.max=e.destMax-n-k+u:(v.max=e.destMax-n,v.partialMax=u-k),m<=u+d?v.min=e.destMax-n-m+u:(v.min=e.destMax-n-d,v.partialMin=m-u-d)):(k>=u?v.min=e.destMin+n+k-u:(v.min=e.destMin+n,v.partialMin=u-k),m<=u+d?v.max=e.destMin+n+m-u:(v.max=e.destMin+n+d,v.partialMax=m-u-d));f.push(v)}}}}return f};q.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],f=0;f<c.length;++f){var h=c[f];if(b>=h.destMin&&b<=h.destMax){var e;e="-"==h.srcOri?h.destMax-b:b-h.destMin;for(var k=h.blocks,
m=0;m<k.length;++m){var g=k[m],r=g[0],d=g[1],g=g[2];if(e>=d&&e<=d+g)return c=e-d,f=c+r+h.srcMin,f="-"==h.destOri?h.srcMax-r-c:c+r+h.srcMin,{seq:h.srcChr,pos:f,flipped:h.srcOri!=h.destOri}}}}return null};q.prototype.sourceBlocksForRange=function(b,e,c,f){for(var h=this,k=e/this.granularity|0,m=c/this.granularity|0,g=!1,d=k;d<=m;++d){var u=b+"_"+d;2!=this.fetchedTiles[u]&&(g=!0,1!=this.fetchedTiles[u]&&(this.fetchedTiles[u]=1))}if(g)this.postFetchQueues[b]||this.chainFetcher.fetchChains(b,k*this.granularity,
(m+1)*this.granularity-1).then(function(a){h.chainsByDest||(h.chainsByDest[b]=[]);for(var c=0;c<a.length;++c){var f=a[c],e=h.chainsBySrc[f.srcChr];if(e){for(var g=!1,B=0;B<e.length;++B){var r=e[B];if(r.srcMin==f.srcMin&&r.srcMax==f.srcMax){g=!0;break}}g||e.push(f)}else h.chainsBySrc[f.srcChr]=[f];if(e=h.chainsByDest[f.destChr]){g=!1;for(B=0;B<e.length;++B)if(r=e[B],r.destMin==f.destMin&&r.destMax==f.destMax){g=!0;break}g||e.push(f)}else h.chainsByDest[f.destChr]=[f]}for(a=k;a<=m;++a)h.fetchedTiles[b+
"_"+a]=2;if(h.postFetchQueues[b]){a=h.postFetchQueues[b];for(c=0;c<a.length;++c)a[c]();h.postFetchQueues[b]=null}})["catch"](function(a){console.log(a)}),r(this.postFetchQueues,b,function(){h.sourceBlocksForRange(b,e,c,f)});else{g=[];d=this.chainsByDest[b]||[];for(u=0;u<d.length;++u){var n=d[u];if(e<=n.destMax&&c>=n.destMin){var v,l;"-"==n.srcOri?(v=n.destMax-c,l=n.destMax-e):(v=e-n.destMin,l=c-n.destMin);for(var p=n.blocks,q=0;q<p.length;++q){var y=p[q],w=y[0],B=y[1],N=y[2];l>=B&&v<=B+N&&(y=Math.max(v,
B)-B,B=Math.min(l,B+N)-B,"-"==n.destOri?g.push(new a(n.srcChr,n.srcMax-w-B,n.srcMax-w-y)):g.push(new a(n.srcChr,n.srcMin+y+w,n.srcMin+B+w)))}}}f(g)}};p.prototype.fetchChains=function(a,b,c){var f=this;return new u(function(c,b){f.source.alignments(a,{},function(a){for(var b=[],e=0;e<a.length;++e)for(var k=a[e],m=0;m<k.blocks.length;++m){for(var r=k.blocks[m],d,u,n=0;n<r.segments.length;++n){var v=r.segments[n],z=k.objects[v.object];z.dbSource===f.srcTag?d=v:z.dbSource===f.destTag&&(u=v)}if(d&&u){for(var r=
{srcChr:k.objects[d.object].accession,srcMin:d.min|0,srcMax:d.max|0,srcOri:d.strand,destChr:k.objects[u.object].accession,destMin:u.min|0,destMax:u.max|0,destOri:u.strand,blocks:[]},n=g(d.cigar),v=g(u.cigar),B=z=0,l=0,G=0;l<n.length&&G<v.length;)if("M"==n[l].op&&"M"==v[G].op){var q=Math.min(n[l].cnt,v[G].cnt);r.blocks.push([z,B,q]);n[l].cnt==q?++l:n[l].cnt-=q;v[G].cnt==q?++G:v[G]-=q;z+=q;B+=q}else"I"==n[l].op?B+=n[l++].cnt:"I"==v[G].op&&(z+=v[G++].cnt);b.push(r)}}c(b)})})};l.prototype.fetchChains=
function(a,b,c){return this.bwg.then(function(f,h){if(!f)throw Error("No BWG");return new u(function(h,e){f.getUnzoomedView().readWigData(a,b,c,function(a){h(a.map(v))})})})};y.prototype.fetchChains=function(a,b,c){b=[];c=this.forwardAliases[a]||[];for(var f=0;f<c.length;++f)b.push({srcChr:c[f],srcMin:1,srcMax:1E9,srcOri:"+",destChr:a,destMin:1,destMax:1E9,destOri:"+",blocks:[[1,1,1E9]]});return u.resolve(b)};"undefined"!==typeof x&&(x.exports={Chainset:q})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,
"./utils":49,"es6-promise":53}],8:[function(d,x,t){function q(d){for(var n=[],q;null!=(q=p.exec(d));){var v=q[1];0==v.length&&(v=1);n.push({cnt:v|0,op:q[2]})}return n}var p=RegExp("([0-9]*)([MIDS])","g");"undefined"!==typeof x&&(x.exports={parseCigar:q})},{}],9:[function(d,x,t){function q(a,b,e,g){this.red=a|0;this.green=b|0;this.blue=e|0;g&&(this.name=g)}function p(a){a="00"+a.toString(16);return a.substring(a.length-2)}function l(a){var r=v[a];r||((r=y.exec(a))?r=new q("0x"+r[1]|0,"0x"+r[2]|0,"0x"+
r[3]|0,a):(r=b.exec(a))?r=new q(r[1]|0,r[2]|0,r[3]|0,a):(console.log("couldn't handle color: "+a),r=v.black),v[a]=r);return r}function n(a,b,e){for(var g=[],m=0;m<e.length;++m)g.push(l(e[m]));e=[];m=0;a:for(;m<a;++m){for(var k=b[0]+1*m/(a-1)*(b[b.length-1]-b[0]),d=0;d<b.length-1;++d)if(k>=b[d]&&k<=b[d+1]){var k=(k-b[d])/(b[d+1]-b[d]),n=g[d],d=g[d+1],d=(new q(n.red*(1-k)+d.red*k|0,n.green*(1-k)+d.green*k|0,n.blue*(1-k)+d.blue*k|0)).toSvgString();e.push(d);continue a}throw"Bad step";}return e}function w(a,
b,e,g){return g?n(a,[0,.5,1],[b,e,g]):n(a,[0,1],[b,e])}q.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};q.prototype.toHexString=function(){return"#"+p(this.red)+p(this.green)+p(this.blue)};var v={red:new q(255,0,0,"red"),green:new q(0,255,0,"green"),blue:new q(0,0,255,"blue"),yellow:new q(255,255,0,"yellow"),white:new q(255,255,255,"white"),black:new q(0,0,0,"black"),gray:new q(180,180,180,"gray"),grey:new q(180,180,180,"grey"),
lightskyblue:new q(135,206,250,"lightskyblue"),lightsalmon:new q(255,160,122,"lightsalmon"),hotpink:new q(255,105,180,"hotpink")},y=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,b=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof x&&(x.exports={makeColourSteps:n,makeGradient:w,dasColourForName:l})},{}],10:[function(d,x,t){function q(a,c,b,f){this.name=a;this.start=c;this.end=b;this.description=f}function p(a,c){var b;"string"==typeof a?(this.uri=a,b=c||{}):b=a||{};for(var f in b)"function"!=
typeof b[f]&&(this[f]=b[f]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function l(){}function n(a,c){return a.taxon==c.taxon&&a.auth==c.auth&&a.version==c.version}function w(a,c,b,f,h){this.name=a;this.start=c;this.end=b;this.alphabet=f;this.seq=h}function v(){}function y(a){a&&(this.id=a)}function b(a,c){this.desc=a;this.uri=c}function a(a){this.type=a;this.objects={};this.blocks=[]}
function r(){this.styles=[]}function e(){}function g(a,c){c=c||{};this.uri=a;this.opts=c}function m(a,c){var b=a.getElementsByTagName(c);if(0<b.length&&b[0].firstChild){b=b[0];if(1==b.childNodes.length)return b.firstChild.nodeValue;for(var f="",h=0;h<b.childNodes.length;++h)f+=b.childNodes[h].nodeValue;return f}return null}function k(a){for(var c=[],f=a.getElementsByTagName("LINK"),h=0;h<f.length;++h){var e=f[h];e.parentNode==a&&c.push(new b(e.firstChild?e.firstChild.nodeValue:"Unknown",e.getAttribute("href")))}return c}
function u(a){var c=[];a=a.getElementsByTagName("NOTE");for(var b=0;b<a.length;++b)a[b].firstChild&&c.push(a[b].firstChild.nodeValue);return c}function G(a,c,b,f){if(window.XDomainRequest){var h=new XDomainRequest;h.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(h.responseText);c(a)};h.open("get",a)}else Date.now(),h=new XMLHttpRequest,h.onreadystatechange=function(){4==h.readyState&&(200<=h.status||0==h.status)&&c(h.responseXML,h)},h.open("get",a,!0),b&&(h.withCredentials=
!0),f&&h.setRequestHeader("X-DAS-Authorisation",f),h.overrideMimeType("text/xml"),h.setRequestHeader("Accept","application/xml,*/*");h.send("")}function P(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function c(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function f(a){var c=h(a);c.styles=[];for(var b=0;b<a.styles.length;++b){var f=c.styles[b]=h(a.styles[b]);f._methodRE=f._labelRE=f._typeRE=void 0;f.style=h(f.style);f.style.id=void 0;f.style._gradient=void 0}return c}
if("undefined"!==typeof d){t=d("./utils");var h=t.shallowCopy,z=t.pusho,A=d("./color").makeColourSteps}q.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};q.prototype.isBounded=function(){return this.start&&this.end};q.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};p.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(c){if(!c)return a([]);var b=[];
c=c.getElementsByTagName("SEGMENT");for(var f=0;f<c.length;++f){var h=c[f],e=h.getAttribute("id"),k=h.getAttribute("size"),m;k?(m=1,k|=0):((m=h.getAttribute("start"))&&(m|=0),(k=h.getAttribute("stop"))&&(k|=0));var g=null;h.firstChild&&(g=h.firstChild.nodeValue);b.push(new q(e,m,k,g))}a(b)})};p.prototype.sequence=function(a,c){var b=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(b,function(a){if(a){var b=[];a=a.getElementsByTagName("SEQUENCE");for(var f=0;f<a.length;++f){var h=
a[f],e=h.getAttribute("id"),k=h.getAttribute("start"),m=h.getAttribute("stop"),g=null;if(h.firstChild)for(var h=h.firstChild.nodeValue,g="",r=0;;){var d=h.indexOf("\n",r);if(0<=d)g+=h.substring(r,d).toUpperCase(),r=d+1;else{g+=h.substring(r).toUpperCase();break}}b.push(new w(e,k,m,"DNA",g))}c(b)}else c([])})};p.prototype.features=function(a,c,b){c=c||{};var f;if(this.features_uri)f=this.features_uri;else{var h=[];if(a)h.push(a.toDASQuery());else if(c.group)if(a=c.group,"string"==typeof a)h.push("group_id="+
a);else for(var e=0;e<a.length;++e)h.push("group_id="+a[e]);if(c.adjacent)for(a=c.adjacent,"string"==typeof a&&(a=[a]),e=0;e<a.length;++e)h.push("adjacent="+a[e]);if(c.type)if("string"==typeof c.type)h.push("type="+c.type);else for(a=0;a<c.type.length;++a)h.push("type="+c.type[a]);c.maxbins&&h.push("maxbins="+c.maxbins);0<h.length?f=this.dasBaseURI+"features?"+h.join(";"):b([],"No filters specified")}this.doCrossDomainRequest(f,function(a,c){if(a){for(var f=[],h={},e=a.getElementsByTagName("SEGMENT"),
g=0;g<e.length;++g){var r=e[g],d=r.getAttribute("id");h[d]={min:r.getAttribute("start"),max:r.getAttribute("stop")};for(var r=r.getElementsByTagName("FEATURE"),n=0;n<r.length;++n){var A=r[n],z=new v;z.segment=d;z.id=A.getAttribute("id");z.label=A.getAttribute("label");var F=m(A,"START"),l=m(A,"END");(F|0)>(l|0)?(z.min=l|0,z.max=F|0):(z.min=F|0,z.max=l|0);F=A.getElementsByTagName("TYPE");0<F.length&&(F=F[0],F.firstChild&&(z.type=F.firstChild.nodeValue),z.typeId=F.getAttribute("id"),z.typeCv=F.getAttribute("cvId"));
z.type=m(A,"TYPE");!z.type&&z.typeId&&(z.type=z.typeId);z.method=m(A,"METHOD");(F=m(A,"ORIENTATION"))||(F="0");z.orientation=F;z.score=m(A,"SCORE");z.links=k(A);z.notes=u(A);F=A.getElementsByTagName("GROUP");for(l=0;l<F.length;++l){var E=F[l],q=new y;q.type=E.getAttribute("type");q.id=E.getAttribute("id");q.links=k(E);q.notes=u(E);z.groups?z.groups.push(q):z.groups=Array(q)}if(z.notes)for(F=0;F<z.notes.length;++F)l=z.notes[F],0==l.indexOf("Genename=")&&(E=new y,E.type="gene",E.id=l.substring(9),z.groups?
z.groups.push(E):z.groups=Array(E));F=A.getElementsByTagName("PART");if(0<F.length){E=[];for(l=0;l<F.length;++l)E.push(F[l].getAttribute("id"));z.parts=E}F=A.getElementsByTagName("PARENT");if(0<F.length){A=[];for(l=0;l<F.length;++l)A.push(F[l].getAttribute("id"));z.parents=A}f.push(z)}}b(f,void 0,h)}else b([],"Failed request: "+(0==c.status?"server may not support CORS":"status="+c.status))},function(a){b([],a)})};p.prototype.alignments=function(c,b,f){var h=this.dasBaseURI+"alignment?query="+c;this.doCrossDomainRequest(h,
function(c){if(c){var b=[];c=c.getElementsByTagName("alignment");for(var e=0;e<c.length;++e){for(var k=c[e],g=new a(k.getAttribute("alignType")),r=k.getElementsByTagName("alignObject"),B=0;B<r.length;++B){var d=r[B],d={id:d.getAttribute("intObjectId"),accession:d.getAttribute("dbAccessionId"),version:d.getAttribute("objectVersion"),dbSource:d.getAttribute("dbSource"),dbVersion:d.getAttribute("dbVersion")};g.objects[d.id]=d}k=k.getElementsByTagName("block");for(r=0;r<k.length;++r){for(var d=k[r],B=
{order:d.getAttribute("blockOrder"),segments:[]},d=d.getElementsByTagName("segment"),A=0;A<d.length;++A){var u=d[A],u={object:u.getAttribute("intObjectId"),min:u.getAttribute("start"),max:u.getAttribute("end"),strand:u.getAttribute("strand"),cigar:m(u,"cigar")};B.segments.push(u)}g.blocks.push(B)}b.push(g)}f(b)}else f([],"Failed request "+h)})};r.prototype.pushStyle=function(a,c,b){a||(a={type:"default"});a=h(a);c&&(a.zoom=c);a.style=b;this.styles.push(a)};p.prototype.stylesheet=function(a,c){var b,
f=this.credentials;this.stylesheet_uri?(b=this.stylesheet_uri,f=!1):b=this.dasBaseURI+"stylesheet";G(b,function(b){if(b){var f=new r;b=b.getElementsByTagName("TYPE");for(var h=0;h<b.length;++h){var k=b[h],m={};m.type=k.getAttribute("id");m.label=k.getAttribute("label");m.method=k.getAttribute("method");for(var k=k.getElementsByTagName("GLYPH"),g=0;g<k.length;++g){var B=k[g],d=B.getAttribute("zoom"),u;a:{if(B.hasChildNodes()){B=B.firstChild;do{if(B.nodeType==Node.ELEMENT_NODE){u=B;break a}B=B.nextSibling}while(null!=
B)}u=null}B=new e;B.glyph=u.localName;for(u=u.firstChild;u;){if(u.nodeType==Node.ELEMENT_NODE)if("BGGRAD"==u.localName){var n=B,z=u.localName,v,l=u;v=(v=l.getAttribute("steps"))?v|0:50;for(var q=[],G=[],l=l.getElementsByTagName("STOP"),p=0;p<l.length;++p){var y=l[p];q.push(1*y.getAttribute("score"));G.push(y.firstChild.nodeValue)}v=A(v,q,G);n[z]=v}else B[u.localName]=u.firstChild.nodeValue;u=u.nextSibling}f.pushStyle(m,d,B)}}a(f)}else c&&c()},f)};g.prototype.sources=function(a,c,b){b||(b={});var f=
[];b.taxon&&f.push("organism="+b.taxon);b.auth&&f.push("authority="+b.auth);b.version&&f.push("version="+b.version);b=this.uri;0<f.length&&(b=b+"?"+f.join("&"));G(b,function(b){if(!b&&c)c();else{var f=[];b=b.getElementsByTagName("SOURCE");for(var h=0;h<b.length;++h){var e=b[h],k=e.getElementsByTagName("VERSION");if(!(1>k.length)){for(var m=k[0],g=m.getElementsByTagName("COORDINATES"),k=[],r=0;r<g.length;++r){var d=g[r],u=new l;u.auth=d.getAttribute("authority");u.taxon=d.getAttribute("taxid");u.version=
d.getAttribute("version");k.push(u)}for(var g=[],d=m.getElementsByTagName("CAPABILITY"),A,r=0;r<d.length;++r)u=d[r],g.push(u.getAttribute("type")),"das1:features"==u.getAttribute("type")&&(A=u.getAttribute("query_uri"),A=A.substring(0,A.length-8));r={};m=m.getElementsByTagName("PROP");for(d=0;d<m.length;++d)z(r,m[d].getAttribute("name"),m[d].getAttribute("value"));A&&(e=new p(A,{source_uri:e.getAttribute("uri"),name:e.getAttribute("title"),desc:e.getAttribute("description"),coords:k,props:r,capabilities:g}),
f.push(e))}}a(f)}})};p.prototype.doCrossDomainRequest=function(a,c,b){var f;this.xUser&&(f="Basic "+btoa(this.xUser+":"+this.xPass));try{return G(a,c,this.credentials,f)}catch(h){if(b)b(h);else throw h;}};"undefined"!==typeof x&&(x.exports={DASGroup:y,DASFeature:v,DASStylesheet:r,DASStyle:e,DASSource:p,DASSegment:q,DASRegistry:g,DASSequence:w,DASLink:b,isDasBooleanTrue:P,isDasBooleanNotFalse:c,copyStylesheet:f,coordsMatch:n})},{"./color":9,"./utils":49}],11:[function(d,x,t){function q(d,n,q){function b(){q?
(a.className="fa fa-caret-down",n.style.display="table"):(a.className="fa fa-caret-right",n.style.display="none")}var a=l("i");b();a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();q=!q;b()},!1);d=l("h6",[a," ",d],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return l("div",[d,n],{})}if("undefined"!==typeof d){var p=d("./cbrowser").Browser;d=d("./utils");var l=d.makeElement,n=d.removeChildren}p.prototype.removeAllPopups=
function(){n(this.hPopupHolder);n(this.popupHolder)};p.prototype.makeTooltip=function(d,n){var q=!1,b=this,a=null,r;r=function(b){q=!1;a&&(clearTimeout(a),a=null);d.removeEventListener("mouseout",r,!1)};var e=function(g){var m=g.clientX+window.scrollX,k=g.clientY+window.scrollY;a||(a=setTimeout(function(){var g;g="function"===typeof n?n():n;var r=l("div",[l("div",null,{className:"tooltip-arrow"}),l("div",g,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(k+20)+
"px",left:""+Math.max(m-30,20)+"px"});b.hPopupHolder.appendChild(r);var p;p=function(a){try{b.hPopupHolder.removeChild(r)}catch(f){}window.removeEventListener("mousemove",p,!1);q&&null!=d.offsetParent&&e(a)};window.addEventListener("mousemove",p,!1);a=null},1E3))};d.addEventListener("mouseover",function(a){q=!0;d.addEventListener("mouseout",r,!1);e(a)},!1);d.addEventListener("DOMNodeRemovedFromDocument",function(b){q=!1;a&&(clearTimeout(a),a=null)},!1)};p.prototype.popit=function(d,n,q,b){var a=this;
b||(b={});d||(d={});var r=b.width||200,e;d.clientX?(b=d.clientX,e=d.clientY):(b=500,e=50);b+=document.documentElement.scrollLeft||document.body.scrollLeft;e+=document.documentElement.scrollTop||document.body.scrollTop;var g=window.innerWidth,m=e,k=Math.min(b-r/2-4,g-r-30),u=l("div");u.className="popover fade "+(d.clientX?"bottom ":"")+"in";u.style.display="block";u.style.position="absolute";u.style.top=""+m+"px";u.style.left=""+k+"px";u.style.width=r+"px";276<r&&(u.style.maxWidth=r+"px");u.appendChild(l("div",
null,{className:"arrow"}));if(n){var p=l("button","",{className:"close"});p.innerHTML="&times;";p.addEventListener("mouseover",function(a){p.style.color="red"},!1);p.addEventListener("mouseout",function(a){p.style.color="black"},!1);p.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();a.removeAllPopups()},!1);d=l("h4",[l("span",n,null,{maxWidth:"200px"}),p],{},{paddingLeft:"10px",paddingRight:"10px"});var P,c,f,h;f=function(a){a.stopPropagation();a.preventDefault();k+=a.clientX-
P;8>k&&(k=8);k>g-r-32&&(k=g-r-26);m+=a.clientY-c;m=Math.max(10,m);u.style.top=""+m+"px";u.style.left=""+Math.min(k,g-r-10)+"px";P=a.clientX;c=a.clientY};h=function(a){a.stopPropagation();a.preventDefault();window.removeEventListener("mousemove",f,!1);window.removeEventListener("mouseup",h,!1)};d.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();P=a.clientX;c=a.clientY;window.addEventListener("mousemove",f,!1);window.addEventListener("mouseup",h,!1)},!1);u.appendChild(d)}u.appendChild(l("div",
q,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(u);var z={node:u,displayed:!0};u.addEventListener("DOMNodeRemoved",function(a){a.target==u&&(z.displayed=!1)},!1);return z};"undefined"!==typeof x&&(x.exports={makeTreeTableSection:q})},{"./cbrowser":6,"./utils":49}],12:[function(d,x,t){function q(d){this.source=d;this.base=d.uri||"//rest.ensembl.org";this.species=d.species||"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof d.type?[d.type]:d.type||
["regulatory"]}if("undefined"!==typeof d){var p=d("./sourceadapters").registerSourceAdapterFactory;d=d("./das");var l=d.DASStylesheet,n=d.DASStyle,w=d.DASFeature,v=d.DASGroup}q.prototype.addActivityListener=function(d){this.activityListeners.push(d)};q.prototype.notifyActivity=function(){for(var d=0;d<this.activityListeners.length;++d)try{this.activityListeners[d](this.busy)}catch(b){console.log(b)}};q.prototype.getStyleSheet=function(d){var b=new l,a=new n;a.glyph="__NONE";0<=this.type.indexOf("exon")&&
b.pushStyle({type:"transcript"},null,a);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&b.pushStyle({type:"gene"},null,a);a=new n;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="red";a.HEIGHT=8;a.BUMP=!0;a.LABEL=!0;a.ZINDEX=10;b.pushStyle({type:"cds"},null,a);a=new n;a.glyph="SQUARE";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:".+_UTR_variant"},null,a);a=new n;a.glyph="TRIANGLE";a.DIRECTION="S";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",
method:"missense_variant"},null,a);a=new n;a.glyph="TRIANGLE";a.DIRECTION="N";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:"splice_.+_variant"},null,a);a=new n;a.glyph="STAR";a.POINTS=6;a.BUMP="yes";a.LABEL="no";a.FGCOLOR="blue";b.pushStyle({type:"variation",method:"regulatory_region_variant"},null,a);a=new n;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="rgb(50,80,255)";a.STROKECOLOR="black";b.pushStyle({type:"variation"},null,a);a=new n;a.glyph="SQUARE";
a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:".+_UTR_variant"},null,a);a=new n;a.glyph="TRIANGLE";a.DIRECTION="S";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"missense_variant"},null,a);a=new n;a.glyph="TRIANGLE";a.DIRECTION="N";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"splice_.+_variant"},null,a);a=new n;a.glyph="STAR";a.POINTS=6;a.BUMP="yes";
a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";b.pushStyle({type:"indel",method:"regulatory_region_variant"},null,a);a=new n;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.BGCOLOR="#888888";a.FGCOLOR="red";a.STROKECOLOR="black";b.pushStyle({type:"indel"},null,a);a=new n;a.glyph="BOX";a.FGCOLOR="black";a.BGCOLOR="orange";a.HEIGHT=8;a.BUMP=!0;a.LABEL=!0;a.ZINDEX=20;b.pushStyle({type:"default"},null,a);return d(b)};q.prototype.getScales=function(){return[]};q.prototype.fetch=function(d,b,a,r,e,g,m){var k=
this;b=this.base+"/overlap/region/"+this.species+"/"+d+":"+b+"-"+a;a=[];for(r=0;r<this.type.length;++r)a.push("feature="+this.type[r]);a.push("content-type=application/json");b=b+"?"+a.join(";");var u=new XMLHttpRequest;u.onreadystatechange=function(){if(4==u.readyState)if(k.busy--,k.notifyActivity(),300<=u.status){var a="Error code "+u.status;try{var b=JSON.parse(u.response);b.error&&(a=b.error)}catch(c){}m(a,null)}else{for(var a=JSON.parse(u.response),b=[],f=0;f<a.length;++f){var h=a[f],e=[],g=
new w;g.segment=d;g.min=h.start|0;g.max=h.end|0;g.type=h.feature_type||"unknown";g.id=h.ID;if(h.Parent){var r=new v;r.id=h.Parent;g.groups=[r]}h.strand&&(0>h.strand?g.orientation="-":0<h.strand&&(g.orientation="+"));h.consequence_type&&(g.method=h.consequence_type);h.alt_alleles&&(e.push("Alleles="+h.alt_alleles.join("/")),1<h.alt_alleles.length&&(h.alt_alleles[1].length!=h.alt_alleles[0].length||"-"==h.alt_alleles[1])&&(g.type="indel"));0<e.length&&(g.notes=e);b.push(g)}m(null,b)}};k.busy++;k.notifyActivity();
u.open("GET",b,!0);u.responseType="text";u.send("")};p("ensembl",function(d){return{features:new q(d)}})},{"./das":10,"./sourceadapters":33}],13:[function(d,x,t){if("undefined"!==typeof d)var q=d("./cbrowser").Browser,p=d("./utils").shallowCopy,l=d("./sha1").hex_sha1,n=d("./das").copyStylesheet;q.prototype.exportFullConfig=function(d){d={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+l(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),
chains:this.exportChains()};this.prefix&&(d.prefix=this.prefix);return d};q.prototype.exportChains=function(){var d={},n=this.chains||{},l;for(l in n)d[l]=n[l].exportConfig();return d};q.prototype.exportSourceConfig=function(d){d=[];for(var v=0;v<this.tiers.length;++v){var l=this.tiers[v],b=p(l.dasSource);b.noPersist||(b.coords=void 0,b.props=void 0,b.disabled||(b.disabled=void 0),l.config.stylesheet?(b.style=n(l.config.stylesheet).styles,b.stylesheet_uri=void 0):b.style&&(b.style=n({styles:b.style}).styles),
"string"===typeof l.config.name&&(b.name=l.config.name),void 0!==l.config.height&&(b.forceHeight=l.config.height),void 0!==l.config.forceMin&&(b.forceMin=l.config.forceMin),l.config.forceMinDynamic&&(b.forceMinDynamic=l.config.forceMinDynamic),void 0!==l.config.forceMax&&(b.forceMax=l.config.forceMax),void 0!==l.config.bumped&&(b.bumped=l.config.bumped),l.config.forceMaxDynamic&&(b.forceMaxDynamic=l.config.forceMaxDynamic),d.push(b))}return d};q.prototype.exportPageTemplate=function(d){d=d||{};return'<html>\n  <head>\n    <script language="javascript" src="'+
this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(d),null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":32,"./utils":49}],14:[function(d,x,t){if("undefined"!==typeof d)var q=d("./cbrowser").Browser,p=d("./glyphs").OverlayLabelCanvas,l=d("./numformats").formatQuantLabel,
n=d("./sequence-draw").drawSeqTierGC;q.prototype.exportImage=function(d){d=d||{};for(var v=this.featurePanelWidth,q=0,b=0;b<this.tiers.length;++b){0<b&&(q+=3);var a=this.tiers[b];void 0!==a.layoutHeight&&(q+=a.layoutHeight)}var r=d.resolutionMultiplier||1,b=(v+200)*r|0,a=q*r|0,q=makeElement("canvas",null,{width:b,height:a}),e=q.getContext("2d");e.fillStyle="white";e.fillRect(0,0,b,a);e.scale(r,r);for(b=r=0;b<this.tiers.length;++b){var a=this.tiers[b],g=(a.glyphCacheOrigin-this.viewStart)*this.scale,
m=new p;e.save();e.translate(0,r);e.save();e.beginPath();e.moveTo(200,0);e.lineTo(200+v,0);e.lineTo(200+v,a.layoutHeight);e.lineTo(200,a.layoutHeight);e.closePath();e.clip();e.translate(200,0);e.save();e.translate(g,0);a.subtiers?a.paintToContext(e,m,g+1E3):n(a,a.currentSequence,e);e.restore();e.save();e.translate(g,0);m.draw(e,-g,v-g);e.restore();e.restore();for(var m=!1,k=0,u=a.subtiers||[],G=0;G<u.length;++G){var P=u[G];if(P.quant){var m=!0,c=P.quant,f=P.height,h=2;40<f&&(h=1+(f/20|0));var f=f/
(h-1),z=(c.max-c.min)/(h-1);e.beginPath();e.moveTo(205,k);e.lineTo(200,k);e.lineTo(200,k+P.height);e.lineTo(205,k+P.height);for(var A=1;A<h-1;++A){var F=A*f;e.moveTo(200,k+F);e.lineTo(203,k+F)}e.strokeStyle="black";e.strokeWidth=2;e.stroke();e.fillStyle="black";var A=l(c.max),E=k+7;e.fillText(A,197-e.measureText(A).width,E);A=l(c.min);E=k+P.height;e.fillText(A,197-e.measureText(A).width,E);for(A=1;A<h-1;++A)F=A*f,E=l(1*c.max-A*z),F=k+F+3,e.fillText(E,197-e.measureText(E).width,F)}k+=P.height+3}k=
"string"===typeof a.config.name?a.config.name:a.dasSource.name;u=e.measureText(k).width;e.fillStyle="black";e.fillText(k,200-(m?22:12)-u,(a.layoutHeight+6)/2);e.restore();r+=a.layoutHeight+3}if(d.highlights){e.save();e.beginPath();e.moveTo(200,0);e.lineTo(200+v,0);e.lineTo(200+v,r);e.lineTo(200,r);e.closePath();e.clip();e.translate(200+g,0);g=v=this.viewStart;b=this.viewEnd;for(a=0;a<this.highlights.length;++a)f=this.highlights[a],(f.chr===this.chr||f.chr==="chr"+this.chr)&&f.min<b&&f.max>g&&(e.globalAlpha=
this.defaultHighlightAlpha,e.fillStyle=this.defaultHighlightFill,e.fillRect((f.min-v)*this.scale,0,(f.max-f.min)*this.scale,r));e.restore()}v=-1;"center"==d.ruler?v=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==d.ruler?v=200:"right"==d.ruler&&(v=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=v&&(e.strokeStyle="blue",e.beginPath(),e.moveTo(v,0),e.lineTo(v,r),e.stroke());return q.toDataURL("image/png")}},{"./cbrowser":6,"./glyphs":20,"./numformats":25,"./sequence-draw":30}],15:[function(d,
x,t){if("undefined"!==typeof d){var q=d("./cbrowser").Browser;d=d("./utils");var p=d.makeElement,l=d.removeChildren}q.prototype.openExportPanel=function(){var d=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var q=p("div",null,{className:"export-form"}),v=p("select");v.appendChild(p("option","SVG",{value:"svg"}));v.appendChild(p("option","Image",{value:"png"}));v.appendChild(p("option","Dalliance config",{value:"config"}));v.appendChild(p("option","Dalliance sources",
{value:"sources"}));v.appendChild(p("option","Dalliance page",{value:"page"}));v.value="svg";v.addEventListener("change",function(a){l(e);G()},!1);q.appendChild(p("p",["Export as: ",v]));var y=p("input",null,{type:"checkbox",checked:this.exportHighlights});y.addEventListener("change",function(a){d.exportHighlights=y.checked;d.storeStatus()},!1);var b=p("input",null,{type:"checkbox",checked:this.exportRuler});b.addEventListener("change",function(a){d.exportRuler=b.checked;d.storeStatus()},!1);var a=
p("input",null,{type:"text",value:"1.0"}),r=p("button","Export",{className:"btn btn-primary"});r.addEventListener("click",function(k){l(e);var c,f,h,m;if("svg"===v.value)c=URL.createObjectURL(d.makeSVG({highlights:y.checked,ruler:b.checked?d.rulerLocation:"none"})),f="SVG",h="image/svg",m="dalliance-view.svg";else if("png"===v.value){h=parseFloat(a.value);if(.1>h||10<h){alert("bad scale "+h);return}c=d.exportImage({highlights:y.checked,ruler:b.checked?d.rulerLocation:"none",resolutionMultiplier:h});
f="Image";h="image/png";m="dalliance-view.png"}else"config"===v.value?(h=JSON.stringify(d.exportFullConfig(),null,2),f=new Blob([h],{type:"text/plain"}),c=URL.createObjectURL(f),f="Configuration",h="text/plain",m="dalliance-config.json"):"sources"===v.value?(h=JSON.stringify(d.exportSourceConfig(),null,2),f=new Blob([h],{type:"text/plain"}),c=URL.createObjectURL(f),f="Source array",h="text/plain",m="dalliance-sources.json"):"page"===v.value&&(f=d.exportPageTemplate(),h="text/html",f=new Blob([f],
{type:h}),c=URL.createObjectURL(f),f="Page template",m="dalliance-view.html");c&&(k=p("a","[Download]",{href:c,download:m,type:h}),h=p("a","[Preview in browser]",{href:c,type:h,target:"_new"}),e.appendChild(p("p",[""+f+" created: ",k,h])))},!1);d.addViewListener(function(){l(e)});d.addTierListener(function(){l(e)});var e=p("p",""),g=p("tr",[p("th","Include highlights",{},{width:"200px",textAlign:"right"}),p("td",y)]),m=p("tr",[p("th","Include vertical guideline"),p("td",b)]),k=p("tr",[p("th","Scale multiplier"),
p("td",a)]),u=p("table",[g,m,k]),G=function(){var a=v.value;g.style.display="svg"==a||"png"==a?"table-row":"none";m.style.display="svg"==a||"png"==a?"table-row":"none";k.style.display="png"==a?"table-row":"none"};G();q.appendChild(u);q.appendChild(r);q.appendChild(e);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(q,this.svgHolder);this.activeToolPanel=q;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":49}],16:[function(d,x,t){x=d("./cbrowser");t=d("./chainset");var q=
d("./sourceadapters"),p=d("./utils");d=d("./das");window.Browser=x.Browser;window.Chainset=t.Chainset;window.makeElement=p.makeElement;window.dalliance_registerSourceAdapterFactory=q.registerSourceAdapterFactory;window.dalliance_registerParserFactory=q.registerParserFactory;window.dalliance_makeParser=q.makeParser;window.DASSequence=d.DASSequence;window.DASFeature=d.DASFeature;window.DASGroup=d.DASGroup;window.DASStylesheet=d.DASStylesheet;window.DASStyle=d.DASStyle;window.DASSource=d.DASSource},
{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":33,"./utils":49}],17:[function(d,x,t){function q(){this.glyphs=[];this.height=0;this.quant=null}function p(f){Date.now();aa=f.viewport.getContext("2d");a(f);f.padding="number"===typeof f.dasSource.padding?f.dasSource.padding:3;var h=[],e={},k={},m;for(m in f.ungroupedFeatures)for(var g=f.ungroupedFeatures[m],d=0;d<g.length;++d){var r=g[d];if(!r.parts){var B=f.styleForFeature(r);if(B)if("LINEPLOT"==B.glyph)b(e,B.id,r),k[B.id]=B;else{var u=
n(r,0,B,f);u&&h.push(u)}}}for(var A in e)m=e[A],B=k[A],"LINEPLOT"==B.glyph&&h.push(w(m,B,f));if(f.dasSource.collapseSuperGroups&&!f.bumped)for(var z in f.superGroups){e=f.superGroups[z];f.groups[z]=y(f.groups[z]);f.groups[z].isSuperGroup=!0;k={};A=1E10;g=-1E10;d=null;for(u=0;u<e.length;++u)if(m=f.groupedFeatures[e[u]]){for(B=0;B<m.length;++B)r=m[B],b(k,r.type,r),A=Math.min(r.min,A),g=Math.max(r.max,g),r.segment&&!d&&(d=r.segment);if(f.groups[z]&&!f.groups[z].links||0==f.groups[z].links.length)f.groups[z].links=
f.groups[e[0]].links;delete f.groupedFeatures[e[u]]}f.groups[z].max=g;f.groups[z].min=A;f.groups[z].segment=d;for(var v in k){m=k[v];A=m[0];g=null;for(B=0;B<m.length;++B)r=m[B],r=new S(r.min,r.max),g=g?J(g,r):r;g=g.ranges();for(d=0;d<g.length;++d){for(var F=g[d],E=((F.max()|0)-(F.min()|0)+1)*e.length,p=0,B=0;B<m.length;++B)if(r=m[B],(r.min|0)<=F.max()&&(r.max|0)>=F.min())var G=Math.max(r.min|0,F.min()),r=Math.min(r.max|0,F.max()),p=p+(r-G+1);var r=new L,D;for(D in A)r[D]=A[D];r.min=F.min();r.max=
F.max();r.label&&1<e.length&&(r.label+=" ("+e.length+" vars)");r.visualWeight=1*p/E;b(f.groupedFeatures,z,r)}}delete f.superGroups[z]}D=[];for(var N in f.groupedFeatures)D.push(N);D.sort(function(a,c){var b=f.groupedFeatures[a][0].score-f.groupedFeatures[c][0].score;return 0<b?-1:0==b?0:1});v={};for(r=0;r<D.length;++r)if(N=D[r],u=l(f.groupedFeatures[N],0,f.groups[N],f,f.dasSource.collapseSuperGroups&&!f.bumped?"collapsed_gene":"tent"))u.group=f.groups[N],v[N]=u;for(z in f.superGroups){e=f.superGroups[z];
N=[];A=1E10;g=-1E10;for(D=0;D<e.length;++D)r=v[e[D]],v[e[D]]=null,r&&(N.push(r),A=Math.min(A,r.min()),g=Math.max(g,r.max()));for(D=0;D<N.length;++D)r=N[D],h.push(new c(r,A,g))}for(u in v)(r=v[u])&&h.push(r);z=new q;N=[];v=f.subtierMax||f.dasSource.subtierMax||f.browser.defaultSubtierMax;D=!1;r=0;a:for(;r<h.length;++r)if(u=h[r],u.bump&&(f.bumped||f.dasSource.collapseSuperGroups)){for(e=0;e<N.length;++e)if(k=N[e],k.hasSpaceFor(u)){k.add(u);continue a}N.length>=v?D=!0:(k=new q,k.add(u),N.push(k))}else z.add(u);
0<z.glyphs.length&&(N=[z].concat(N));for(e=0;e<N.length;++e)k=N[e],k.quant&&k.glyphs.unshift(new I(k.height));for(e=0;e<N.length;++e)k=N[e],k.glyphs.sort(function(a,c){return(a.zindex||0)-(c.zindex||0)});f.subtiers=N;f.glyphCacheOrigin=f.browser.viewStart;D?f.updateStatus("Bumping limit exceeded, use the track editor to see more features"):f.updateStatus()}function l(a,c,b,f,h){h=f.styleForFeature(b);var k,g=!1,d=[];c=null;for(var r=0;r<a.length;++r){var B=a[r];B.orientation&&null==c&&(c=B.orientation);
!k&&B.label&&(k=B.label);var u=f.styleForFeature(B);u&&!B.parts&&(V(u.LABEL)&&(g=!0),(B=n(B,0,u,f,null,!0))&&d.push(B))}if(0==d.length)return null;a="flat";h&&"LINE"===h.glyph||(f.dasSource.collapseSuperGroups&&!f.bumped?"+"===c?a="collapsed+":"-"===c&&(a="collapsed-"):"+"===c?a="hat+":"-"===c&&(a="hat-"));f=null;if(k&&g||h&&(V(h.LABEL)||V(h.LABELS)))f=b.label||k;b=new e(d,a);f&&("+"===c?f=">"+f:"-"===c&&(f="<"+f),b=new m(aa,b,f,!1));b.bump=!0;return b}function n(a,b,g,d,B,n){function v(a,c,b){var f=
null;if(a.currentSequence){var h=a.currentSequence.start|0,e=a.currentSequence.end|0;if(h<=b&&e>=c){for(var g=Math.max(c,h),e=Math.min(b,e),f=a.currentSequence.seq.substr(g-h,e-g+1);c<g;)f="N"+f,g--;for(;b>e;)f+="N",e++}}return f}var l=d.browser.scale,q=d.browser.viewStart,p=g.glyph||"BOX",y=a.min,w=a.max,t=a.orientation,J=a.score,x=a.label||a.id,I=(y-q)*l,S=Math.max((w-q+1)*l,I+1),L=d.forceHeight||g.HEIGHT||B||12,Y=L*=1,q=g.BUMP&&V(g.BUMP),X;if("CROSS"===p||"EX"===p||"TRIANGLE"===p||"DOT"===p||"SQUARE"===
p||"STAR"===p||"PLIMSOLL"===p){var U=g.FGCOLOR||"black",O=g.BGCOLOR||"none",y=g.STROKECOLOR;g.BGITEM&&a.itemRgb?U=a.itemRgb:V(g.COLOR_BY_SCORE2)&&(l=g.BGGRAD||g._gradient,l||(l=N(50,g.COLOR1,g.COLOR2,g.COLOR3),g._gradient=l),L=a.score2,void 0==L&&U||(w=g.MIN2?1*g.MIN2:0,w=(1*(L||0)-w)/((g.MAX2?1*g.MAX2:1)-w)*l.length|0,0>w&&(w=0),w>=l.length&&(w=l.length-1),U=l[w]));L=d.forceHeight||g.HEIGHT||B||12;Y=L*=1;w=g.SIZE||L;g.RSIZE&&(w=1*g.RSIZE*L);g.STROKETHRESHOLD&&w<1*g.STROKETHRESHOLD&&(y=null);w*=1;
L=(I+S)/2;l=w/2;"EX"===p?y=new u(L,w,U):"TRIANGLE"===p?y=new G(L,w,g.DIRECTION||"N",g.LINEWIDTH||w,U,y):"DOT"===p?y=new P(L,w,U,y):"PLIMSOLL"===p?y=new H(L,w,.2*w,U,y):"SQUARE"===p?y=new r(L-l,0,w,w,U,y):"STAR"===p?(p=5,g.POINTS&&(p=g.POINTS|0),y=new K(L,l,p,U,y)):y=new k(L,w,U);O&&"none"!=O&&5<S-I&&(I=new r(I,0,S-I,w,O),y=new e([I,y]));if(V(g.SCATTER)){O=d.quantMin(g);(w=d.quantMax(g))||(w=0>O?0:10);O||(O=0);d=(1*J-O)/(w-O);J=-1*O/(w-O);if(0>d||1<d)return null;d>=J?(L=Math.max(1,(d-J)*Y),b=b+(1-
J)*Y-L):(L=Math.max(1,(d-J)*Y),b+=(1-J)*Y);X={min:O,max:w};I=0;S="undefined"!==typeof a.forceLabel?a.forceLabel:g.LABEL;ba(S)&&x&&!n&&(y=new m(aa,y,x,!0,null,"above"==S?"above":"below"),"above"==S&&(I=y.textHeight+2),n=!0);y=new Z(y,0,b-l-I,Y)}}else if("HISTOGRAM"===p||"GRADIENT"===p&&"undefined"!==J)O=d.quantMin(g),(w=d.quantMax(g))||(w=0>O?0:10),O||(O=0),1*J<1*O&&(J=O),1*J>1*w&&(J=w),d=(1*J-O)/(w-O),J=-1*O/(w-O),"HISTOGRAM"===p&&(d>=J?(L=Math.max(1,(d-J)*Y),b=b+(1-J)*Y-L):(L=Math.max(1,(J-d)*Y),
b+=(1-J)*Y),X={min:O,max:w}),U=g.FGCOLOR||null,O=g.BGCOLOR||g.COLOR1||"green",g.BGITEM&&a.itemRgb&&(O=a.itemRgb),J=g.ALPHA?1*g.ALPHA:null,g.BGGRAD&&(l=g.BGGRAD,w=d*l.length|0,0>w&&(w=0),w>=l.length&&(w=l.length-1),O=l[w]),g.COLOR2&&(l=g._gradient,l||(l=N(50,g.COLOR1,g.COLOR2,g.COLOR3),g._gradient=l),w=d*l.length|0,0>w&&(w=0),w>=l.length&&(w=l.length-1),O=l[w]),y=new r(I,b,S-I,L,O,U,J);else if("HIDDEN"===p)y=new c(null,I,S),n=!0;else if("ARROW"===p)d=g.FGCOLOR||"purple",b=V(g.PARALLEL),J=V(g.SOUTHWEST),
O=V(g.NORTHEAST),y=new F(I,S,L,d,b,J,O);else if("ANCHORED_ARROW"===p)U=g.FGCOLOR||"none",O=g.BGCOLOR||"green",y=new f(I,S,L,O,U,t),y.bump=!0;else if("SPAN"===p)U=g.FGCOLOR||"black",y=new h(I,S,L,U);else if("LINE"===p)U=g.FGCOLOR||"black",y=new z(I,S,L,g.STYLE||"solid",t,U);else if("PRIMERS"===p)U=g.FGCOLOR||"black",O=g.BGCOLOR||"red",y=new A(I,S,L,O,U);else if("TEXT"===p)d=g.STRING||"text",O=g.FGCOLOR||"black",y=new M(aa,I,S,L,O,d);else if("TOOMANY"===p)U=g.FGCOLOR||"gray",O=g.BGCOLOR||"orange",y=
new E(I,S,L,O,U);else if("POINT"===p)L=d.forceHeight||g.HEIGHT||30,O=d.quantMin(g),w=d.quantMax(g),d=(1*J-O)/(w-O),b=1*L/(w-O)*(J-1*O)|0,X={min:O,max:w},O=g.FGCOLOR||g.COLOR1||"black",g.COLOR2&&(l=g._gradient,l||(l=N(50,g.COLOR1,g.COLOR2,g.COLOR3),g._gradient=l),w=d*l.length|0,0>w&&(w=0),w>=l.length&&(w=l.length-1),O=l[w]),y=new C((I+S)/2,L-b,L,O);else if("__SEQUENCE"===p){O=Y=a.seq;p=U=a.quals;b=V(g.__INSERTIONS);J=[];if(a.cigar){B=W(a.cigar);for(var p=O="",ha=t=0;ha<B.length;++ha){var ea=B[ha];
if("M"==ea.op)O+=Y.substr(t,ea.cnt),p+=U.substr(t,ea.cnt),t+=ea.cnt;else if("D"==ea.op)for(var la=0;la<ea.cnt;++la)O+="-",p+="Z";else if("I"==ea.op){var fa=Y.substr(t,ea.cnt),la=new G(I+O.length*l,5,"S",5,"red");b&&(la=new m(aa,la,fa,!1,"center","above","7px sans-serif"));la.feature={label:"Insertion: "+fa,type:"insertion",method:"insertion"};J.push(la);t+=ea.cnt}else"S"==ea.op?t+=ea.cnt:console.log("unknown cigop"+ea.op)}}l=v(d,y,w);if(O&&l&&("mismatch"===g.__SEQCOLOR||"mismatch-all"===g.__SEQCOLOR)){y=
[];w="-"===a.orientation?",":".";for(Y=0;Y<O.length;++Y)y.push(O[Y]==l[Y]?w:O[Y]);O=y.join("")}y=new R(d.browser.baseColors,"-"===a.orientation?g._minusColor||"lightskyblue":g._plusColor||"lightsalmon",I,S,L,O,l,g.__SEQCOLOR,p,!V(g.__CLEARBG));b&&(y=new Z(y,0,7));0<J.length&&(J.splice(0,0,y),y=new e(J))}else if("__INSERTION"===p)la=new G(I,5,"S",5,"red"),y=new m(aa,la,a.insertion||a.altAlleles[0],!1,"center","above","7px sans-serif"),1<S-I&&(O=g.BGCOLOR||g.COLOR1||"green",I=new r(I,5,S-I,L,O,U),y=
new e([I,y]));else{if("__NONE"===p)return null;U=g.FGCOLOR||null;O=g.BGCOLOR||g.COLOR1||"green";g.BGITEM&&a.itemRgb&&(O=a.itemRgb);l=(S-I)/(w-y);"translation"==a.type&&("protein_coding"==a.method||a.readframeExplicit)&&(!a.tags||0>a.tags.indexOf("cds_start_NF")||a.readframeExplicit)&&(!d.dasSource.collapseSuperGroups||d.bumped)&&.5<=l?(l=v(d,y,w),y=new D(I,S,L,O,l,a.orientation,a.readframe)):y=new r(I,0,S-I,L,O,U)}(V(g.LABEL)||a.forceLabel)&&x&&!n&&(y=new m(aa,y,x,!1));q&&(y.bump=!0);y.feature=a;
X&&(y.quant=X);g.ZINDEX&&(y.zindex=g.ZINDEX|0);return y}function w(a,c,b){var f=b.browser.viewStart,h=b.browser.scale,e=b.forceHeight||c.HEIGHT||30,k=b.quantMin(c);b=b.quantMax(c);for(var m=1*e/(b-k),d=c.FGCOLOR||c.COLOR1||"black",r=[],B=0;B<a.length;++B){var u=a[B],l=e-((u.score-1*k)*m|0);r.push((((u.min|0)+(u.max|0))/2-f)*h);r.push(l)}a=new g(r,d,e);a.quant={min:k,max:b};c.ZINDEX&&(a.zindex=c.ZINDEX|0);return a}if("undefined"!==typeof d){var v=d("./utils"),y=v.shallowCopy,b=v.pusho,v=d("./tier").DasTier,
a=d("./features").sortFeatures;t=d("./glyphs");var r=t.BoxGlyph,e=t.GroupGlyph,g=t.LineGraphGlyph,m=t.LabelledGlyph,k=t.CrossGlyph,u=t.ExGlyph,G=t.TriangleGlyph,P=t.DotGlyph,c=t.PaddedGlyph,f=t.AArrowGlyph,h=t.SpanGlyph,z=t.LineGlyph,A=t.PrimersGlyph,F=t.ArrowGlyph,E=t.TooManyGlyph,M=t.TextGlyph,R=t.SequenceGlyph,D=t.AminoAcidGlyph,Z=t.TranslatedGlyph,C=t.PointGlyph,I=t.GridGlyph,K=t.StarGlyph,H=t.PlimsollGlyph,B=t.OverlayLabelCanvas,N=d("./color").makeGradient;t=d("./spans");var S=t.Range,J=t.union;
t=d("./das");var L=t.DASFeature,V=t.isDasBooleanTrue,ba=t.isDasBooleanNotFalse,W=d("./cigar").parseCigar,X=d("./numformats").formatQuantLabel}q.prototype.indexFor=function(a){a=a.min();for(var c=0,b=this.glyphs.length;b>c;){var f=(c+b)/2|0;if(f>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[f].min()?b=f:c=f+1}return b};q.prototype.add=function(a){var c=this.indexFor(a);this.glyphs.splice(c,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};
q.prototype.hasSpaceFor=function(a){var c=this.indexFor(a);return 0<c&&this.glyphs[c-1].max()>=a.min()||c<this.glyphs.length&&this.glyphs[c].min()<=a.max()?!1:!0};var aa;v.prototype.paint=function(){var a=this.browser.retina&&1<window.devicePixelRatio,c=this.subtiers;if(c){var b=this.browser.featurePanelWidth+2E3;a&&(b*=2);var f=this.viewport.width|0;f<b-50&&(this.viewport.width=f=b);for(var b=this.padding,h=0;h<c.length;++h)b=b+c[h].height+this.padding;h=b=Math.max(b+6,this.browser.minTierHeight);
a&&(h*=2);h!=this.viewport.height&&(this.viewport.height=h);Math.max(b,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+f/2+"px":""+f+"px";this.viewport.style.height=""+b+"px";this.layoutHeight=Math.max(b,this.browser.minTierHeight);this.updateHeight();this.norigin=this.browser.viewStart;c=this.viewport.getContext("2d");c.clearRect(0,0,f,h);c.save();a&&c.scale(2,2);f=this.browser.viewStart-1E3/this.browser.scale;h=this.browser.viewEnd+1E3/this.browser.scale;
a=[];if(this.knownCoverage)for(var e=this.knownCoverage.ranges(),g=0;g<e.length;++g){var k=e[g];0==g?k.min()>f&&a.push({min:f,max:k.min()-1}):a.push({min:e[g-1].max()+1,max:k.min()-1});g==e.length-1&&k.max()<h&&a.push({min:k.max()+1,max:h})}if(0<a.length)for(c.fillStyle="gray",f=0;f<a.length;++f)h=a[f],e=(h.min-this.browser.viewStart)*this.browser.scale+1E3,c.fillRect(e,0,(h.max-this.browser.viewStart)*this.browser.scale+1E3-e,b);b=new B;a=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+
1E3;c.translate(a,this.padding);b.translate(0,this.padding);this.paintToContext(c,b,a);this.overlayLabelCanvas=0<b.glyphs.length?b:null;c.restore();this.drawOverlay();this.paintQuant()}};v.prototype.paintToContext=function(a,c,b){var f=this.subtiers,h=this.viewport.width|0;a.save();for(var e=0;e<f.length;++e){for(var g=null,k=f[e].glyphs,m=0;m<k.length;++m){var d=k[m];d.min()<h-b&&d.max()>-b&&(d=k[m],d.draw(a,c),d.quant&&(g=d.quant))}a.translate(0,f[e].height+this.padding);c.translate(0,f[e].height+
this.padding)}a.restore();g&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(c=f[0].height*(1-(this.quantLeapThreshold-g.min)/(g.max-g.min)),a.save(),a.strokeStyle="red",a.lineWidth=.3,a.beginPath(),a.moveTo(-1E3,c),a.lineTo(h+1E3,c),a.stroke(),a.restore())};v.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,c;this.subtiers&&0<this.subtiers.length&&(c=this.subtiers[0].quant);
if(c){var b=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var f=this.quantOverlay.getContext("2d");a&&f.scale(2,2);a=2;40<b&&(a=1+(b/20|0));var h=(b+2*this.padding)/(a-1),e=(c.max-c.min)/(a-1);f.fillStyle="white";f.globalAlpha=.6;"right"==this.browser.rulerLocation?f.fillRect(20,
0,30,b+2*this.padding):f.fillRect(0,0,30,b+2*this.padding);f.globalAlpha=1;f.strokeStyle="black";f.lineWidth=1;f.beginPath();if("right"==this.browser.rulerLocation){f.moveTo(42,this.padding);f.lineTo(50,this.padding);f.lineTo(50,b+this.padding);f.lineTo(42,b+this.padding);for(var g=1;g<a-1;++g){var k=g*h;f.moveTo(50,k);f.lineTo(45,k)}}else for(f.moveTo(8,this.padding),f.lineTo(0,this.padding),f.lineTo(0,b+this.padding),f.lineTo(8,b+this.padding),g=1;g<a-1;++g)k=g*h,f.moveTo(0,k),f.lineTo(5,k);f.stroke();
f.fillStyle="black";if("right"==this.browser.rulerLocation)for(f.textAlign="right",f.fillText(X(c.max),41,8),f.fillText(X(c.min),41,b+this.padding),g=1;g<a-1;++g)k=g*h,f.fillText(X(1*c.max-g*e),41,k+3);else for(f.textAlign="left",f.fillText(X(c.max),9,8),f.fillText(X(c.min),9,b+this.padding),g=1;g<a-1;++g)k=g*h,f.fillText(X(1*c.max-g*e),9,k+3)}else this.quantOverlay.style.display="none"}};v.prototype.styleForFeature=function(a){var c=this.browser.zoomForCurrentScale();if(!this.stylesheet)return null;
for(var b=null,f=this.stylesheet.styles,h=0;h<f.length;++h){var e=f[h];if(!(e.zoom&&e.zoom!=c||e.orientation&&e.orientation!=a.orientation)){var g=e._labelRE;g&&g.test||(g=new RegExp("^"+e.label+"$"),e._labelRE=g);if(!e.label||g.test(a.label))if(g=e._methodRE,g&&g.test||(g=new RegExp("^"+e.method+"$"),e._methodRE=g),!e.method||g.test(a.method)){if(e.type)if("default"==e.type){b||(b=e.style);continue}else if(g=e._typeRE,g&&g.test||(g=new RegExp("^"+e.type+"$"),e._typeRE=g),!g.test(a.type))continue;
return e.style}}}return b};v.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};v.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof x&&(x.exports={drawFeatureTier:p})},{"./cigar":8,"./color":9,"./das":10,"./features":19,"./glyphs":20,
"./numformats":25,"./spans":34,"./tier":43,"./utils":49}],18:[function(d,x,t){function q(b,a,d){var e=n(d.type,a.type),g=n(d.label,a.label,d.id,a.id);g&&0!=g.indexOf("__dazzle")&&(e=e+": "+g);this.hit=b;this.feature=a;this.group=d;this.title=e;this.sections=[]}function p(b,a){var d=[];if(b)for(var e=0;e<b.length;++e)w(d,b[e]);if(a)for(e=0;e<a.length;++e)w(d,a[e]);return d}if("undefined"!==typeof d){var l=d("./cbrowser").Browser;d=d("./utils");var n=d.pick,w=d.pushnew,v=d.makeElement}var y=/^([A-Za-z_-]+)=(.+)/;
l.prototype.addFeatureInfoPlugin=function(b){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(b)};q.prototype.setTitle=function(b){this.title=b};q.prototype.add=function(b,a){"string"===typeof a&&(a=v("span",a));this.sections.push({label:b,info:a})};l.prototype.featurePopup=function(b,a,d,e){var g=d.length;a=0<=--g?d[g]:{};var m=0<=--g?d[g]:{};d=new q(d,a,m);d.tier=e;for(var g=this.featureInfoPlugins||[],k=0;k<g.length;++k)try{g[k](a,d)}catch(u){console.log(u.stack||
u)}g=e.featureInfoPlugins||[];for(k=0;k<g.length;++k)try{g[k](a,d)}catch(l){console.log(l.stack||l)}this.removeAllPopups();e=v("table",null,{className:"table table-striped table-condensed"});e.style.width="100%";e.style.margin="0px";g=0;a.method&&(k=v("tr",[v("th","Method"),v("td",a.method)]),e.appendChild(k),++g);k=m.segment?m:a;k=v("tr",[v("th","Location"),v("td",k.segment+":"+k.min+"-"+k.max,{},{minWidth:"200px"})]);e.appendChild(k);++g;void 0===a.score||null===a.score||"-"==a.score||a.suppressScore||
(k=v("tr",[v("th","Score"),v("td",""+a.score)]),e.appendChild(k),++g);(k=p(m.links,a.links))&&0<k.length&&(k=v("tr",[v("th","Links"),v("td",k.map(function(a){return v("div",v("a",a.desc,{href:a.uri,target:"_new"}))}))]),e.appendChild(k),++g);a=p(m.notes,a.notes);for(m=0;m<a.length;++m){var k="Note",n=a[m],c=n.match(y);c&&(k=c[1],n=c[2]);k=v("tr",[v("th",k),v("td",n)]);e.appendChild(k);++g}for(a=0;a<d.sections.length;++a)g=d.sections[a],e.appendChild(v("tr",[v("th",g.label),v("td",g.info)]));this.popit(b,
d.title||"Feature",e,{width:450})}},{"./cbrowser":6,"./utils":49}],19:[function(d,x,t){function q(d){for(var q=d.browser.drawnStart,v=d.browser.drawnEnd,y={},b={},a={},r={},e={},g={},m={},k={},u=[],G,P,c,f=function(){c={};for(var a=0;a<d.currentFeatures.length;++a){var b=d.currentFeatures[a];b.id&&(c[b.id]=b)}},h=function(a){var b=[];if(a.parents)for(var f=0;f<a.parents.length;++f){var h=a.parents[f],e=c[h];e&&"SO:0000704"==e.typeCv&&pushnew(b,h)}return b},z=0;z<d.currentFeatures.length;++z){var A=
d.currentFeatures[z];if(!A.parts){var F=A.min<=v&&A.max>=q;if(A.min&&A.max){if(A.score&&"."!=A.score&&"-"!=A.score){var E=1*A.score;if(!G||E<G)G=E;if(!P||E>P)P=E}var E=[],M=null;if(A.groups)for(var R=0;R<A.groups.length;++R){var D=A.groups[R],t=D.id;if("gene"==D.type)M=t,g[t]=D;else if("translation"!=D.type){p(b,t,A);g[t]=D;E.push(t);D=r[t];if(!D||A.min<D)r[t]=A.min;D=e[t];if(!D||A.max>D)e[t]=A.max}}if(A.parents)for(c||f(),R=0;R<A.parents.length;++R){var C=A.parents[R],I=c[C];if(I){I.parts||(I.parts=
[A]);l(b,C,I);p(b,C,A);g[C]||(g[C]={type:I.type,id:I.id,label:I.label||I.id});E.push(C);D=r[C];if(!D||A.min<D)r[C]=A.min;D=e[C];if(!D||A.max>D)e[C]=A.max;D=h(I);0<D.length&&(M=D[0],C=c[D[0]],g[D[0]]={type:C.type,id:C.id,label:C.label||C.id},d.dasSource.collapseSuperGroups||(d.dasSource.collapseSuperGroups=!0))}}if(0==E.length)F&&p(y,A.type,A);else if(M)for(D=0;D<E.length;++D)t=E[D],l(m,M,t),k[t]=M}else u.push(A)}}for(t in b)u=g[t],"number"!==typeof u.min&&(u.min=r[t]),"number"!==typeof u.max&&(u.max=
e[t]),e[t]>=q&&r[t]<=v&&(a[t]=b[t]);d.ungroupedFeatures=y;d.groupedFeatures=a;d.groups=g;d.superGroups=m;d.groupsToSupers=k;G&&(0<G?G=0:0>P&&(P=0),d.currentFeaturesMinScore=G,d.currentFeaturesMaxScore=P)}if("undefined"!==typeof d){d=d("./utils");var p=d.pusho,l=d.pushnewo}"undefined"!==typeof x&&(x.exports={sortFeatures:q})},{"./utils":49}],20:[function(d,x,t){function q(a,c){this._stroke=a;this._fill=c}function p(a,c,b,f,h,e,g,k){this.x=a;this.y=c;this._width=b;this._height=f;this.fill=h;this.stroke=
e;this._alpha=g;this._radius=k||0}function l(a,c){this.glyphs=a;this.connector=c;this.h=a[0].height();for(var b=[],f=0;f<a.length;++f){var h=a[f];b.push(new Z(h.min(),h.max()));this.h=Math.max(this.h,h.height())}this.coverage=D(b)}function n(a,c,b){this.points=a;this.color=c;this._height=b||50}function w(a,c,b,f,h,e,g){this.glyph=c;this.text=b;this.anchor=h||"left";this.align=e||"below";g&&(this.font=g);this.font&&(a.save(),a.font=this.font);b=a.measureText(b);this.font&&a.restore();this.textLen=
b.width;this.textHeight=5;this.bump=c.bump;this.measured=!f}function v(a,c,b){this._x=a;this._height=c;this._stroke=b}function y(a,c,b){this._x=a;this._height=c;this._stroke=b}function b(a,c,b,f,h,e){q.call(this,e,h);this._x=a;this._height=c;this._dir=b;this._width=f}function a(a,c,b,f){this._x=a;this._height=c;this._fill=b;this._stroke=f}function r(a,c,b){this.glyph=a;this._min=c;this._max=b;a&&(this.bump=a.bump)}function e(a,c,b,f,h,e){q.call(this,h,f);this._min=a;this._max=c;this._height=b;this._ori=
e}function g(a,c,b,f){q.call(this,f,null);this._min=a;this._max=c;this._height=b}function m(a,c,b,f,h,e){this._min=a;this._max=c;this._height=b;this._style=f;this._strand=h;this._stroke=e}function k(a,c,b,f,h){this._min=a;this._max=c;this._height=b;this._fill=f;this._stroke=h}function u(a,c,b,f,h,e,g){q.call(this,null,f);this._min=a;this._max=c;this._height=b;this._color=f;this._parallel=h;this._sw=e;this._ne=g}function G(a,c,b,f,h){this._min=a;this._max=c;this._height=b;this._fill=f;this._stroke=
h}function P(a,c,b,f,h,e){this._min=c;this._max=b;this._height=f;this._fill=h;this._string=e;this._textLen=a.measureText(e).width}function c(a,c,b){var f={red:"darkred",purple:"mediumpurple",blue:"darkblue",green:"darkgreen"}[b.toLowerCase()];b=f?[b,f]:["rgb(73, 68, 149)","rgb(9, 0, 103)"];return"?"==a?"black":"M"==a?"greenyellow":"*"==a?"crimson":b[c%2]}function f(a){var c={A:"T",T:"A",G:"C",C:"G"};a=a.split("").reverse().join("");for(var b=[],f=0;f<a.length;++f){var h=a.substr(f,1).toUpperCase();
b.push(h in c?c[h]:"N")}return b.join("")}function h(a,c,b,f,h,e,g){this._min=a;this._max=c;this._height=b;this._fill=f;this._seq=h;this._orientation=e;this._readframe=g}function z(a,c,b,f){this.glyph=a;this._height=f;this._x=c;this._y=b}function A(a,c,b,f){this._x=a;this._y=c;this._height=b;this._fill=f}function F(a){this._height=a||50}function E(a,c,b,f,h){q.call(this,h,f);this._x=a;this._r=c;this._points=b}function M(a,c,b,f,h){this._x=a;this._height=c;this._overhang=b;this._fill=f;this._stroke=
h;this._hh=c/2}function R(){this.oy=this.ox=0;this.glyphs=[]}if("undefined"!==typeof d){t=d("./spans");var D=t.union,Z=t.Range;t=d("./utils");var C=t.makeElementNS,I=t.AMINO_ACID_TRANSLATION;d=d("./svg-utils");var K=d.NS_SVG,H=d.SVGPath}q.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};q.prototype.toSVG=function(){var a=new H;this.drawPath(a);return C(K,"path",null,{d:a.toPathData(),fill:this._fill||
"none",stroke:this._stroke||"none"})};q.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";};p.prototype.draw=function(a){var c=this._radius;0<c?(a.beginPath(),a.moveTo(this.x+c,this.y),a.lineTo(this.x+this._width-c,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+c,c),a.lineTo(this.x+this._width,this.y+this._height-c),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-c,this.y+this._height,c),a.lineTo(this.x+c,this.y+this._height),
a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-c,c),a.lineTo(this.x,this.y+c),a.arcTo(this.x,this.y,this.x+c,this.y,c),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=
.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};p.prototype.toSVG=function(){var a=C(K,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};p.prototype.min=function(){return this.x};p.prototype.max=function(){return this.x+this._width};p.prototype.height=function(){return this.y+this._height};l.prototype.drawConnectors=
function(a){for(var c=this.coverage.ranges(),b=1;b<c.length;++b){var f=c[b],h=c[b-1];if(h&&f.min()>h.max()){var h=h.max(),f=f.min(),e=(h+f)/2;"hat+"===this.connector?(a.moveTo(h,this.h/2),a.lineTo(e,0),a.lineTo(f,this.h/2)):"hat-"===this.connector?(a.moveTo(h,this.h/2),a.lineTo(e,this.h),a.lineTo(f,this.h/2)):"collapsed+"===this.connector?(a.moveTo(h,this.h/2),a.lineTo(f,this.h/2),4<f-h&&(a.moveTo(e-2,this.h/2-3),a.lineTo(e+2,this.h/2),a.lineTo(e-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(h,
this.h/2),a.lineTo(f,this.h/2),4<f-h&&(a.moveTo(e+2,this.h/2-3),a.lineTo(e-2,this.h/2),a.lineTo(e+2,this.h/2+3))):(a.moveTo(h,this.h/2),a.lineTo(f,this.h/2))}}};l.prototype.draw=function(a,c){for(var b=0;b<this.glyphs.length;++b)this.glyphs[b].draw(a,c);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};l.prototype.toSVG=function(){for(var a=C(K,"g"),c=0;c<this.glyphs.length;++c)a.appendChild(this.glyphs[c].toSVG());c=new H;this.drawConnectors(c);0<c.toPathData().length&&(c=C(K,
"path",null,{d:c.toPathData(),fill:"none",stroke:"black",strokeWidth:.5}),a.appendChild(c));return a};l.prototype.min=function(){return this.coverage.min()};l.prototype.max=function(){return this.coverage.max()};l.prototype.height=function(){return this.h};n.prototype.min=function(){return this.points[0]};n.prototype.max=function(){return this.points[this.points.length-2]};n.prototype.height=function(){return this._height};n.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=
2;a.beginPath();for(var c=0;c<this.points.length;c+=2){var b=this.points[c],f=this.points[c+1];0==c?a.moveTo(b,f):a.lineTo(b,f)}a.stroke();a.restore()};n.prototype.toSVG=function(){for(var a=new H,c=0;c<this.points.length;c+=2){var b=this.points[c],f=this.points[c+1];0==c?a.moveTo(b,f):a.lineTo(b,f)}return C(K,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};w.prototype.toSVG=function(){var a=this.glyph.toSVG(),c={};"above"==this.align?(a=C(K,"g",a,{transform:"translate(0, "+
(this.textHeight|2)+")"}),c.y=this.textHeight):c.y=this.glyph.height()+15;this.font&&(c.fontSize=7);c.x="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return C(K,"g",[a,C(K,"text",this.text,c)])};w.prototype.min=function(){return this.glyph.min()};w.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};w.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==
this.align?a+(this.textHeight+2):a+20);return a};w.prototype.draw=function(a,c){"above"==this.align&&(a.save(),a.translate(0,this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();c.registerGlyph(this)};w.prototype.drawOverlay=function(a,c,b){a.fillStyle="black";this.font&&(a.save(),a.font=this.font);"center"==this.anchor?b=(this.glyph.min()+this.glyph.max()-this.textLen)/2:(b=this.glyph.min(),b<c&&(b=Math.min(c,this.glyph.max()-this.textLen)));a.fillText(this.text,b,"above"==this.align?
this.textHeight:this.glyph.height()+15);this.font&&a.restore()};v.prototype.draw=function(a){var c=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-c,c);a.lineTo(this._x+c,c);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};v.prototype.toSVG=function(){var a=this._height/2,c=new H;c.moveTo(this._x,0);c.lineTo(this._x,this._height);c.moveTo(this._x-a,a);c.lineTo(this._x+a,a);return C(K,"path",null,{d:c.toPathData(),fill:"none",stroke:this._stroke,
strokeWidth:"1px"})};v.prototype.min=function(){return this._x-this._height/2};v.prototype.max=function(){return this._x+this._height/2};v.prototype.height=function(){return this._height};y.prototype.draw=function(a){var c=this._height/2;a.beginPath();a.moveTo(this._x-c,0);a.lineTo(this._x+c,this._height);a.moveTo(this._x-c,this._height);a.lineTo(this._x+c,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};y.prototype.toSVG=function(){var a=this._height/2,c=new H;c.moveTo(this._x-a,0);c.lineTo(this._x+
a,this._height);c.moveTo(this._x-a,this._height);c.lineTo(this._x+a,0);return C(K,"path",null,{d:c.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};y.prototype.min=function(){return this._x-this._height/2};y.prototype.max=function(){return this._x+this._height/2};y.prototype.height=function(){return this._height};b.prototype=Object.create(q.prototype);b.prototype.drawPath=function(a){var c=this._height/2,b=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-
b,0),a.lineTo(this._x+b,0)):"W"===this._dir?(a.moveTo(this._x+b,c),a.lineTo(this._x-b,0),a.lineTo(this._x-b,this._height)):"E"===this._dir?(a.moveTo(this._x-b,c),a.lineTo(this._x+b,0),a.lineTo(this._x+b,this._height)):(a.moveTo(this._x,0),a.lineTo(this._x+b,this._height),a.lineTo(this._x-b,this._height));a.closePath()};b.prototype.min=function(){return this._x-this._height/2};b.prototype.max=function(){return this._x+this._height/2};b.prototype.height=function(){return this._height};a.prototype.draw=
function(a){var c=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,c,c,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};a.prototype.toSVG=function(){var a=this._height/2;return C(K,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};a.prototype.min=function(){return this._x-this._height/2};a.prototype.max=function(){return this._x+this._height/2};a.prototype.height=
function(){return this._height};r.prototype.draw=function(a,c){this.glyph&&this.glyph.draw(a,c)};r.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():C(K,"g")};r.prototype.min=function(){return this._min};r.prototype.max=function(){return this._max};r.prototype.height=function(){return this.glyph?this.glyph.height():1};e.prototype=Object.create(q.prototype);e.prototype.min=function(){return this._min};e.prototype.max=function(){return this._max};e.prototype.height=function(){return this._height};
e.prototype.drawPath=function(a){var c=this._max,b=this._min,f=this._height,h=0,e=0,g=this._height+2,k=.333333*this._height;this._ori&&("+"===this._ori?e=.5*this._height:"-"===this._ori&&(h=.5*this._height));c-b<g&&(b=(c+b-g)/2,c=b+g);a.moveTo(b+h,0+k);a.lineTo(c-e,0+k);a.lineTo(c-e,0);a.lineTo(c,0+this._height/2);a.lineTo(c-e,0+f);a.lineTo(c-e,0+k+k);a.lineTo(b+h,0+k+k);a.lineTo(b+h,0+f);a.lineTo(b,0+f/2);a.lineTo(b+h,0);a.lineTo(b+h,0+k)};g.prototype=Object.create(q.prototype);g.prototype.min=function(){return this._min};
g.prototype.max=function(){return this._max};g.prototype.height=function(){return this._height};g.prototype.drawPath=function(a){var c=this._min,b=this._max,f=this._height,h=f/2;a.moveTo(c,h);a.lineTo(b,h);a.moveTo(c,0);a.lineTo(c,f);a.moveTo(b,0);a.lineTo(b,f)};m.prototype.min=function(){return this._min};m.prototype.max=function(){return this._max};m.prototype.height=function(){return this._height};m.prototype.drawPath=function(a){var c=this._min,b=this._max,f=this._height,h=f/2;"hat"===this._style?
(a.moveTo(c,h),a.lineTo((c+b)/2,"-"===this._strand?f:0)):a.moveTo(c,h);a.lineTo(b,h)};m.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};m.prototype.toSVG=function(){var a=new H;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return C(K,"path",null,a)};k.prototype.min=function(){return this._min};
k.prototype.max=function(){return this._max};k.prototype.height=function(){return this._height};k.prototype.drawStemPath=function(a){var c=this._max,b=this._height/2;a.moveTo(this._min,b);a.lineTo(c,b)};k.prototype.drawTrigsPath=function(a){var c=this._min,b=this._max,f=this._height,h=f/2;a.moveTo(c,0);a.lineTo(c+f,h);a.lineTo(c,f);a.lineTo(c,0);a.moveTo(b,0);a.lineTo(b-f,h);a.lineTo(b,f);a.lineTo(b,0)};k.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();
a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};k.prototype.toSVG=function(){var a=new H;this.drawStemPath(a);var c=new H;this.drawTrigsPath(c);return C(K,"g",[C(K,"path",null,{d:a.toPathData(),stroke:this._stroke||"none"}),C(K,"path",null,{d:c.toPathData(),fill:this._fill||"none"})])};u.prototype=Object.create(q.prototype);u.prototype.min=function(){return this._min};u.prototype.max=function(){return this._max};u.prototype.height=function(){return this._height};u.prototype.drawPath=
function(a){var c=this._min,b=this._max,f=this._height;if(this._parallel){var h=f/2,e=.4*f;this._sw?(a.moveTo(c+h,f-e),a.lineTo(c+h,f),a.lineTo(c,h),a.lineTo(c+h,0),a.lineTo(c+h,e)):(a.moveTo(c,f-e),a.lineTo(c,e));this._ne?(a.lineTo(b-h,e),a.lineTo(b-h,0),a.lineTo(b,h),a.lineTo(b-h,f),a.lineTo(b-h,f-e)):(a.lineTo(b,e),a.lineTo(b,f-e))}else{var h=(c+b)/2,e=.4*(b-c),g=f/3;this._ne?(a.moveTo(c+e,g),a.lineTo(c,g),a.lineTo(h,0),a.lineTo(b,g),a.lineTo(b-e,g)):(a.moveTo(c+e,0),a.lineTo(b-e,0));this._sw?
(a.lineTo(b-e,f-g),a.lineTo(b,f-g),a.lineTo(h,f),a.lineTo(c,f-g),a.lineTo(c+e,f-g)):(a.lineTo(b-e,f),a.lineTo(c+e,f))}a.closePath()};G.prototype.min=function(){return this._min};G.prototype.max=function(){return this._max};G.prototype.height=function(){return this._height};G.prototype.toSVG=function(){return C(K,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};G.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,
a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var c=2;c<this._height;c+=3)a.moveTo(this._min,c),a.lineTo(this._max,c);a.stroke()}};P.prototype.min=function(){return this._min};P.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};P.prototype.height=function(){return this._height};P.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,
this._min,this._height-4)};P.prototype.toSVG=function(){return C(K,"text",this._string,{x:this._min,y:this._height-4})};h.prototype.min=function(){return this._min};h.prototype.max=function(){return this._max};h.prototype.height=function(){return this._height};h.prototype.draw=function(a){var b=this._seq,h=this._fill;if(b){var e=(this._max-this._min+1)/b.length,g=(3-this._readframe)%3,k=(b.length-g)%3,g="+"==this._orientation?g:k;0<g&&(a.fillStyle=h,a.fillRect(this._min,0,e*g,this._height));for(;g<
b.length;g+=3){k=b.substr(g,3).toUpperCase();"-"==this._orientation&&(k=f(k));var d=k in I?I[k]:"?",h=3==k.length?c(d,g,this._fill):this._fill;a.fillStyle=h;a.fillRect(this._min+g*e,0,e*k.length,this._height);8<=e&&3==k.length&&(a.fillStyle="white",a.fillText(d,this._min+(g+1)*e,this._height))}}};h.prototype.toSVG=function(){var a=C(K,"g"),b=this._seq,h=this._fill;if(!b)return a;var e=(this._max-this._min+1)/b.length,g=(3-this._readframe)%3,k=(b.length-g)%3,g="+"==this._orientation?g:k;for(0<g&&a.appendChild(C(K,
"rect",null,{x:this._min,y:0,width:e*g,height:this._height,fill:h}));g<b.length;g+=3){k=b.substr(g,3).toUpperCase();"-"==this._orientation&&(k=f(k));var d=k in I?I[k]:"?",h=3==k.length?c(d,g,this._fill):this._fill;a.appendChild(C(K,"rect",null,{x:this._min+g*e,y:0,width:e*k.length,height:this._height,fill:h}));8<=e&&3==k.length&&a.appendChild(C(K,"text",d,{x:this._min+(g+1)*e,y:this._height,fill:"white"}))}return a};(function(a){function c(a,b,f,h,e,g,k,d,m,r){this.baseColors=a;this._strandColor=
b;this._min=f;this._max=h;this._height=e;this._seq=g;this._ref=k;this._scheme=d;this._quals=m;this._fillbg=r}var b=1<window.devicePixelRatio,f={},h=/^[ACGT-]$/;c.prototype.min=function(){return this._min};c.prototype.max=function(){return this._max};c.prototype.height=function(){return this._height};c.prototype.alphaForQual=function(a){return.1+.9*Math.max(0,Math.min(1*a/30,1))};c.prototype.draw=function(a){var c=this._seq,e=this._ref,g="mismatch-all"===this._scheme,k=c?c.length:this._max-this._min+
1,d=(this._max-this._min+1)/k;"mismatch"!==this._scheme&&"mismatch-all"!==this._scheme||8<=d||(a.fillStyle=this._strandColor,a.fillRect(this._min,this._height/4,this._max-this._min,this._height/2));for(var m=0;m<k;++m){var r=c?c.substr(m,1).toUpperCase():"N";if(h.test(r)||8<=d){var u=this.baseColors[r];if(this._quals){var l=this._quals.charCodeAt(m)-33,z=a.globalAlpha;a.globalAlpha=this.alphaForQual(l)}u||(l=e?e.substr(m,1).toUpperCase():"N",u="N"==r||"N"==l?"gray":this._strandColor,g&&(r=l));a.fillStyle=
u;l=h.test(r);!this._fillbg&&8<=d&&l||a.fillRect(this._min+m*d,0,d,this._height);if(8<=d&&l){var l=u+"_"+r,A=f[l];if(!A){A=document.createElement("canvas");b?(A.width=16,A.height=20):(A.width=8,A.height=10);var n=A.getContext("2d");b&&n.scale(2,2);n.fillStyle=this._fillbg?"black":u;u=n.measureText(r).width;n.fillText(r,.5*(8-u),8);f[l]=A}b?a.drawImage(A,this._min+m*d+.5*(d-8),0,8,10):a.drawImage(A,this._min+m*d+.5*(d-8),0)}this._quals&&(a.globalAlpha=z)}}};c.prototype.toSVG=function(){for(var a=this._seq,
c=this._ref,b="mismatch-all"===this._scheme,f=(this._max-this._min+1)/this._seq.length,e=C(K,"g"),g=0;g<a.length;++g){var k=a?a.substr(g,1).toUpperCase():"N",d=this.baseColors[k];if(!d){var m=c?c.substr(g,1).toUpperCase():"N",d="N"==k||"N"==m?"gray":this._strandColor;b&&(k=m)}m=1;this._quals&&(m=this._quals.charCodeAt(g)-33,m=this.alphaForQual(m));var r=h.test(k);!this._fillbg&&8<=f&&r||e.appendChild(C(K,"rect",null,{x:this._min+g*f,y:0,width:f,height:this._height,fill:d,fillOpacity:m}));8<=f&&r&&
e.appendChild(C(K,"text",k,{x:this._min+(.5+g)*f,y:8,textAnchor:"middle",fill:this._fillbg?"black":d,fillOpacity:m}))}return e};a.SequenceGlyph=c})(this);z.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};z.prototype.min=function(){return this.glyph.min()+this._x};z.prototype.max=function(){return this.glyph.max()+this._x};z.prototype.minY=function(){return this._y};z.prototype.maxY=function(){return this._y+this.glyph.height()};z.prototype.draw=function(a,
c){a.save();a.translate(this._x,this._y);this.glyph.draw(a,c);a.restore()};z.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};A.prototype.min=function(){return this._x-2};A.prototype.max=function(){return this._x+2};A.prototype.height=function(){return this._height};A.prototype.draw=function(a){a.save();a.globalAlpha=.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};A.prototype.toSVG=
function(){return C(K,"circle",null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};F.prototype.notSelectable=!0;F.prototype.min=function(){return-1E5};F.prototype.max=function(){return 1E5};F.prototype.height=function(){return this._height};F.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=.1;a.beginPath();for(var c=0;c<=this._height;c+=10)a.moveTo(-5E3,c),a.lineTo(5E3,c);a.stroke();a.restore()};F.prototype.toSVG=function(){for(var a=new H,c=0;c<=this._height;c+=
10)a.moveTo(-5E3,c),a.lineTo(5E3,c);return C(K,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};E.prototype=Object.create(q.prototype);E.prototype.min=function(){return this._x-this._r};E.prototype.max=function(){return this._x+this._r};E.prototype.height=function(){return 2*this._r};E.prototype.drawPath=function(a){for(var c=this._x,b=this._r,f=this._r,h=0;h<this._points;++h){var e=6.28*h/this._points,g=c+f*Math.sin(e),e=b-f*Math.cos(e);0==h?a.moveTo(g,e):a.lineTo(g,
e);e=6.28*(h+.5)/this._points;g=c+.4*f*Math.sin(e);e=b-.4*f*Math.cos(e);a.lineTo(g,e)}a.closePath()};M.prototype.draw=function(a){var c=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,c,c-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};M.prototype.toSVG=function(){var a=this._hh;return C(K,"g",[C(K,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),C(K,
"line",null,{x1:this._x,y1:0,x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};M.prototype.min=function(){return this._x-this._hh};M.prototype.max=function(){return this._x+this._hh};M.prototype.height=function(){return this._height};R.prototype.translate=function(a,c){this.ox+=a;this.oy+=c};R.prototype.registerGlyph=function(a){this.glyphs.push({x:this.ox,y:this.oy,glyph:a})};R.prototype.draw=function(a,c,b){for(var f=0;f<this.glyphs.length;++f){var h=
this.glyphs[f];a.save();a.translate(h.x,h.y);h.glyph.drawOverlay(a,c,b);a.restore()}};"undefined"!==typeof x&&(x.exports={BoxGlyph:p,GroupGlyph:l,LineGraphGlyph:n,LabelledGlyph:w,CrossGlyph:v,ExGlyph:y,TriangleGlyph:b,DotGlyph:a,PaddedGlyph:r,AArrowGlyph:e,SpanGlyph:g,LineGlyph:m,PrimersGlyph:k,ArrowGlyph:u,TooManyGlyph:G,TextGlyph:P,SequenceGlyph:this.SequenceGlyph,AminoAcidGlyph:h,TranslatedGlyph:z,GridGlyph:F,StarGlyph:E,PointGlyph:A,PlimsollGlyph:M,OverlayLabelCanvas:R})},{"./spans":34,"./svg-utils":37,
"./utils":49}],21:[function(d,x,t){function q(d,n){this.base=d;this.query=n}if("undefined"!==typeof d)var p=d("./das").DASFeature;q.prototype.features=function(d,n,q){url=this.base+"/features/"+d.name;n=[];this.query&&n.push(this.query);d.isBounded&&(n.push("start="+d.start),n.push("end="+d.end));0<n.length&&(url=url+"?"+n.join("&"));var v=new XMLHttpRequest;v.onreadystatechange=function(){if(4==v.readyState)if(300<=v.status)q(null,"Error code "+v.status);else{var n=JSON.parse(v.response).features,
b=[];for(fi=0;fi<n.length;++fi){var a=n[fi],r=new p;r.segment=d;r.min=(a.start|0)+1;r.max=a.end|0;a.name&&(r.label=a.name);r.type=a.type||"unknown";b.push(r)}q(b)}};v.open("GET",url,!0);v.responseType="text";v.send("")};"undefined"!==typeof x&&(x.exports={JBrowseStore:q})},{"./das":10}],22:[function(d,x,t){function q(){var a=this;this.reqs=[];this.awaitedFeatures={};this.requestsIssued=new z(function(c,b){a.notifyRequestsIssued=c})}function p(a,c,b,f,h,e,g){this.chr=a;this.min=c;this.max=b;this.coverage=
g;this.scale=f;this.features=h||[];this.status=e}function l(a,c,b,f,h,e){this.tierMap=a;this.chr=c;this.min=b;this.max=f;this.scale=h;this.seqSource=e||new m;this.viewCount=0;this.featureCache={};this.latestViews={}}function n(a,c,b){for(var f=[],h={},e=0;e<a.length;++e){var g=a[e];g.min&&g.max?g.groups&&0<g.groups.length?v(h,g.groups[0].id,g):g.min<=b&&g.max>=c&&f.push(g):f.push(g)}for(var k in h){a=h[k];for(var d=1E11,m=-1E11,e=0;e<a.length;++e)g=a[e],d=Math.min(d,g.min),m=Math.max(m,g.max);if(d<=
b||m>=c)for(e=0;e<a.length;++e)f.push(a[e])}return f}if("undefined"!==typeof d){t=d("./utils");var w=t.Awaited,v=t.pusho;t=d("./sourceadapters");var y=t.MappedFeatureSource,b=t.CachingFeatureSource,a=t.BWGFeatureSource,r=t.RemoteBWGFeatureSource,e=t.BAMFeatureSource,g=t.RemoteBAMFeatureSource,m=t.DummySequenceSource,k=t.DummyFeatureSource,u=d("./overlay").OverlayFeatureSource;t=d("./spans");var G=t.Range,P=t.intersection;t=d("./sample");var c=t.downsample,f=t.getBaseCoverage,h=d("./das").DASSequence,
z=d("es6-promise").Promise}q.prototype.addRequest=function(a){this.reqs.push(a)};q.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};p.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};l.prototype.cancel=function(){this.cancelled=!0};l.prototype.bestCacheOverlapping=function(a,c,b){return(a=this.featureCache[this.tierMap[0]])?a:null};l.prototype.viewFeatures=function(a,c,b,f){if(f!=f)throw"viewFeatures called with silly scale";
if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";1>c&&(c=1);this.min=c;this.max=b;this.scale=f;this.pool&&this.pool.abortAll();this.pool=new q;this.awaitedSeq=new w;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap);this.pool.notifyRequestsIssued()};l.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};l.prototype.startFetchesForTiers=function(a){for(var c=this,b=this.awaitedSeq,f=!1,e,g=0;g<a.length;++g)try{this.startFetchesFor(a[g],
b)&&(f=!0)}catch(k){e=a[g],e.currentFeatures=[],e.currentSequence=null,e.draw(),e.updateHeight(),e.updateStatus(k),console.log("Error fetching tier source"),console.log(k),e=k}if(f&&!this.seqWasFetched){this.seqWasFetched=!0;var d=this.min,m=this.max;if(this.cs&&this.cs.start<=d&&this.cs.end>=m)return a=this.cs.start==d&&this.cs.end==m?this.cs:new h(this.cs.name,d,m,this.cs.alphabet,this.cs.seq.substring(d-this.cs.start,m+1-this.cs.start)),b.provide(a);this.seqSource.fetch(this.chr,d,m,this.pool,
function(a,f){if(f){if(!c.cs||d<=c.cs.start&&m>=c.cs.end||d>=c.cs.end||m<=c.cs.start||m-d>c.cs.end-c.cs.start)c.cs=f;b.provide(f)}else console.log("Sequence loading failed",a),b.provide(null)})}if(e)throw e;};l.prototype.startFetchesFor=function(a,c){var b=this,f=this.viewCount,h=a.getSource()||new k,e=a.needsSequence(this.scale),g=b.featureCache[a],d=a.getActiveStyleFilters(this.scale),m;d&&(m=d.typeList());var r=this.chr,u=this.min,l=this.max;if(void 0===m)return!1;if(g&&g.chr===this.chr&&g.min<=
u&&g.max>=l){var z=g.features;if(g.min<u||g.max>l)z=n(z,u,l);b.provision(a,g.chr,P(g.coverage,new G(u,l)),g.scale,m,z,g.status,e?c:null);z=h.getScales();if(g.scale<=this.scale||!z)return e}h.instrument&&console.log("Starting  fetch "+f+" ("+u+", "+l+")");h.fetch(r,u,l,this.scale,m,this.pool,function(k,d,z,n){h.instrument&&console.log("Finishing fetch "+f);var v=b.latestViews[a]||-1;if(!(b.cancelled||v>f)){n||(n=new G(u,l));if(!g||u<g.min||l>g.max)b.featureCache[a]=new p(r,u,l,z,d,k,n);b.latestViews[a]=
f;b.provision(a,r,n,z,m,d,k,e?c:null)}},d);return e};l.prototype.provision=function(h,k,d,m,l,z,n,v){n&&(h.currentFeatures=[],h.currentSequence=null,h.draw(),h.updateHeight());h.updateStatus(n);if(!n){for(var q=n=!1,p=h.getSource();y.prototype.isPrototypeOf(p)||b.prototype.isPrototypeOf(p)||u.prototype.isPrototypeOf(p);)p=u.prototype.isPrototypeOf(p)?p.sources[0]:p.source;if(a.prototype.isPrototypeOf(p)||r.prototype.isPrototypeOf(p)||e.prototype.isPrototypeOf(p)||g.prototype.isPrototypeOf(p))n=!0;
p.opts&&(p.opts.forceReduction||p.opts.noDownsample)||n&&l&&1==l.length&&0<=l.indexOf("density")&&(z=c(z,this.scale));l&&1==l.length&&0<=l.indexOf("base-coverage")&&(q=!0);v?v.await(function(a){q&&(z=f(z,a,h.browser.baseColors));h.viewFeatures(k,d,m,z,a)}):h.viewFeatures(k,d,m,z)}};"undefined"!==typeof x&&(x.exports={KnownSpace:l})},{"./das":10,"./overlay":26,"./sample":28,"./sourceadapters":33,"./spans":34,"./utils":49,"es6-promise":53}],23:[function(d,x,t){function q(a,b){this.block=a;this.offset=
b}function p(a,b){var e=4294967296*(a[b+6]&255)+16777216*(a[b+5]&255)+65536*(a[b+4]&255)+256*(a[b+3]&255)+(a[b+2]&255),g=a[b+1]<<8|a[b];return 0==e&&0==g?null:new q(e,g)}function l(a,d){d=Math.min(d||1,a.byteLength-50);for(var e=[],g=[0],m=0;g[0]<d;){var k=new Uint8Array(a,g[0],12),k=k[11]<<8|k[10],k=y(a,12+k+g[0],Math.min(65536,a.byteLength-12-k-g[0]),g);g[0]+=8;m+=k.byteLength;e.push(k)}if(1==e.length)return e[0];g=new Uint8Array(m);for(k=m=0;k<e.length;++k){var u=new Uint8Array(e[k]);b(u,0,g,m,
u.length);m+=u.length}return g.buffer}function n(a,b){this.minv=a;this.maxv=b}function w(a,b){--b;return a>>14==b>>14?4681+(a>>14):a>>17==b>>17?585+(a>>17):a>>20==b>>20?73+(a>>20):a>>23==b>>23?9+(a>>23):a>>26==b>>26?1+(a>>26):0}function v(a,b){var e,g=[];--b;g.push(0);for(e=1+(a>>26);e<=1+(b>>26);++e)g.push(e);for(e=9+(a>>23);e<=9+(b>>23);++e)g.push(e);for(e=73+(a>>20);e<=73+(b>>20);++e)g.push(e);for(e=585+(a>>17);e<=585+(b>>17);++e)g.push(e);for(e=4681+(a>>14);e<=4681+(b>>14);++e)g.push(e);return g}
if("undefined"!==typeof d){d=d("jszlib");var y=d.inflateBuffer,b=d.arrayCopy}q.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof x&&(x.exports={unbgzf:l,readVob:p,reg2bin:w,reg2bins:v,Chunk:n})},{jszlib:65}],24:[function(d,x,t){function q(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function p(b){this.source=b;w.call(this);this.storeHolder=new v;this.parser=n(b.payload);if(!this.parser)throw"Unsupported memstore payload: "+b.payload;var a=this;this._load(function(b,
e){if(b){for(var g=new q,d=[],k=b.split("\n"),u=a.parser.createSession(function(a){d.push(a)}),l=0;l<k.length;++l){var n=k[l];0<n.length&&u.parse(n)}u.flush();g.addFeatures(d);a.storeHolder.provide(g)}else a.error=e||"No data",a.storeHolder.provide(null)})}if("undefined"!==typeof d){x=d("./sourceadapters");var l=x.registerSourceAdapterFactory,n=x.makeParser,w=x.FeatureSourceBase;d("./das");d=d("./utils");var v=d.Awaited,y=d.textXHR}q.prototype.addFeatures=function(b){for(var a={},d=0;d<b.length;++d){var e=
b[d],g=e.segment||e.chr,m=this.featuresByChr[g];m||(m=[],this.featuresByChr[g]=m);m.push(e);a[g]=!0;e=e.max-e.min+1;e>this.maxLength&&(this.maxLength=e)}for(g in a)m=this.featuresByChr[g],m.sort(function(a,b){var e=a.min-b.min;return 0!=e?e:a.max-b.max});this.chrRing=null};q.prototype._indexFor=function(b,a){for(var d=0,e=b.length;e>d;){var g=(d+e)/2|0;if(g>=b.length)return b.length;a<b[g].min?e=g:d=g+1}return e};q.prototype.fetch=function(b,a,d){var e=this.featuresByChr[b];e||(e=0==b.indexOf("chr")?
this.featuresByChr[b.substring(3)]:this.featuresByChr["chr"+b]);if(!e)return[];var g=Math.max(0,this._indexFor(e,a-this.maxLength-1));b=Math.min(e.length-1,this._indexFor(e,d));for(var m=[];g<=b;++g){var k=e[g];k.min<=d&&k.max>=a&&m.push(k)}return m};q.prototype.findNextFeature=function(b,a,d){if(null==this.chrRing){this.chrRing=[];for(b in this.featuresByChr)this.chrRing.push(b);this.chrRing.sort()}var e=this.featuresByChr[b];e||(b=0==b.indexOf("chr")?b.substring(3):"chr"+b,e=this.featuresByChr[b]);
if(!e)return null;var g=Math.max(0,Math.min(this._indexFor(e,a),e.length-1));if(0<d){for(;g<e.length;){var m=e[g++];if(m.min>a)return m}b=this.chrRing.indexOf(b)+1;b>=this.chrRing.length&&(b=0);return this.findNextFeature(this.chrRing[b],0,d)}for(;0<=g;)if(m=e[g--],m.max<a)return m;b=this.chrRing.indexOf(b)-1;0>b&&(b=this.chrRing.length-1);return this.findNextFeature(this.chrRing[b],1E10,d)};p.prototype=Object.create(w.prototype);p.prototype._load=function(b){if(this.source.blob){var a=new FileReader;
a.onloadend=function(){return b(a.result,a.error)};a.readAsText(this.source.blob)}else y(this.source.uri,b,{})};p.prototype.fetch=function(b,a,d,e,g,m,k){var u=this;this.storeHolder.await(function(e){return e?(e=e.fetch(b,a,d),k(null,e,1E8)):k(u.error)})};p.prototype.getStyleSheet=function(b){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(b)};p.prototype.getDefaultFIPs=function(b){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(b)};p.prototype.getScales=function(){return 1E8};
p.prototype.findNextFeature=function(b,a,d,e){var g=this;this.storeHolder.await(function(m){return m?e(m.findNextFeature(b,a,d)):e(null,g.error)})};p.prototype.capabilities=function(){return{leap:!0}};l("memstore",function(b){return{features:new p(b)}})},{"./das":10,"./sourceadapters":33,"./utils":49}],25:[function(d,x,t){function q(d){return(d|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function p(d){d=""+d;var n=d.indexOf(".");if(0>n)return d;var p=2;"-"==d.substring(0,1)&&++p;return n>=
p?d.substring(0,n):d.substring(0,n+2)}"undefined"!==typeof x&&(x.exports={formatLongInt:q,formatQuantLabel:p})},{}],26:[function(d,x,t){function q(d,p){this.sources=d;this.opts=p||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var b=0;b<this.sources.length;++b)this.initN(b);"function"===typeof p.merge?this.merge=p.merge:"concat"==p.merge?this.merge=n:"alternates"==p.merge?(this.merge=n,this.filterDispatchOnMethod=!0):this.merge=
l}function p(d,l,b){this.source=d;this.callback=l;this.sources=b;this.count=b.length;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function l(d){for(var l=[],b=1;b<d.length;++b){for(var a={},r=d[b],e=0;e<r.length;++e)a[this.keyForFeature(r[e])]=r[e];l.push(a)}b=[];d=d[0];for(e=0;e<d.length;++e){for(var g=d[e],m=0;m<l.length;++m)if(a=l[m],r=a[this.keyForFeature(g)])for(var k in r)"score"===k?g.score2=r.score:"min"!==k&&"max"!==k&&"segment"!==
k&&"_cachedStyle"!==k&&(g[k]=r[k]);b.push(g)}return b}function n(d,l){for(var b=[],a=0;a<d.length;++a)for(var r=d[a],e=l[a].name,g=0;g<r.length;++g){var m=r[g];m.method=e;b.push(m)}return b}if("undefined"!==typeof d)var w=d("./utils").shallowCopy;q.prototype.initN=function(d){var l=this.sources[d],b=this;this.business[d]=0;l.addActivityListener&&l.addActivityListener(function(a){b.business[d]=a;b.notifyActivity()});l.addChangeListener&&l.addChangeListener(function(){b.notifyChange()});l.addReadinessListener&&
l.addReadinessListener(function(a){b.readiness[d]=a;b.notifyReadiness()})};q.prototype.addReadinessListener=function(d){this.readinessListeners.push(d);this.notifyReadinessListener(d)};q.prototype.notifyReadiness=function(){for(var d=0;d<this.readinessListeners.length;++d)this.notifyReadinessListener(this.readinessListeners[d])};q.prototype.notifyReadinessListener=function(d){for(var l=null,b=0;b<this.readiness.length;++b)if(null!=this.readiness[b]){l=this.readiness[b];break}try{d(l)}catch(a){console.log(a)}};
q.prototype.addActivityListener=function(d){this.activityListeners.push(d)};q.prototype.notifyActivity=function(){for(var d=0,l=0;l<this.business.length;++l)d+=this.business[l];for(l=0;l<this.activityListeners.length;++l)try{this.activityListeners[l](d)}catch(b){console.log(b)}};q.prototype.addChangeListener=function(d){this.changeListeners.push(d)};q.prototype.notifyChange=function(){for(var d=0;d<this.changeListeners.length;++d)try{this.changeListeners[d](this.busy)}catch(l){console.log(l)}};q.prototype.getScales=
function(){return this.sources[0].getScales()};q.prototype.getStyleSheet=function(d){return this.sources[0].getStyleSheet(d)};q.prototype.capabilities=function(){var d={},l=this.sources[0];l.capabilities&&(d=w(l.capabilities()));for(l=1;l<this.sources.length;++l){var b=this.sources[l];b.capabilities&&(b=b.capabilities(),b.search&&(d.search=b.search))}return d};q.prototype.search=function(d,l){for(var b=0;b<this.sources.length;++b){var a;a=this.sources[b];a=a.capabilities?a.capabilities().search:!1;
if(a)return this.sources[b].search(d,l)}};q.prototype.fetch=function(d,l,b,a,r,e,g,m){var k;if(this.filterDispatchOnMethod){k=[];for(var u=m.list(),n=0;n<this.sources.length;++n)for(var q=this.sources[n],c=0;c<u.length;++c){var f=u[c];if(!f.method||f.method==q.name){k.push(q);break}}}else k=this.sources;g=new p(this,g,k);for(n=0;n<k.length;++n)this.fetchN(g,n,k[n],d,l,b,a,r,e,m)};q.prototype.fetchN=function(d,l,b,a,r,e,g,m,k,u){b.fetch(a,r,e,g,m,k,function(a,b,c){return d.completed(l,a,b,c)},u)};
q.prototype.quantFindNextFeature=function(d,l,b,a,r){return this.sources[0].quantFindNextFeature(d,l,b,a,r)};q.prototype.findNextFeature=function(d,l,b,a){return this.sources[0].findNextFeature(d,l,b,a)};p.prototype.completed=function(d,l,b,a){if(null==this.scale||0==d)this.scale=a;if(this.returns[d])throw"Multiple returns for source "+d;this.returns[d]=!0;this.returnCount++;this.features[d]=b;l&&(this.statuses[d]=l,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){d="";
for(l=0;l<this.count;++l)if(b=this.statuses[l])0<d.length&&(d+=", "),d+=b;return this.callback(d,null,this.scale)}this.callback(null,this.source.merge(this.features,this.sources),this.scale)}};q.prototype.getDefaultFIPs=function(d){for(var l=0;l<this.sources.length;++l){var b=this.sources[l];b.getDefaultFIPs&&b.getDefaultFIPs(d)}};q.prototype.keyForFeature=function(d){return""+d.min+".."+d.max};"undefined"!==typeof x&&(x.exports={OverlayFeatureSource:q})},{"./utils":49}],27:[function(d,x,t){function q(g,
d,k){var u=/^\w+\s[0-9]+\s[0-9]+.*$/,G=/([^=]+)=\"?([^\"]+)\"?/,t=/^##\s*fileformat=VCFv4\..+/;(g.blob?new n(g.blob):new l(g.uri,{credentials:g.credentials})).slice(0,65536).salted().fetch(function(c,f){if(!c)return k||(g.credentials=!0,q(g,d,!0)),d(g,"Couldn't fetch data");var h=new Uint8Array(c),l=(new Uint32Array(c,0,1))[0];if(l==v||l==y){g.tier_type="bwg";h=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(h=h.exec(g.uri||g.blob.name))g.name=h[1];return d(g,null)}if(l==r)return g.tier_type="bai",d(g,
null);if(31==h[0]||139==h[1]){h=b(c);h=new Uint8Array(h);l=w(h,0);if(l==a){g.tier_type="bam";h=/\/?([^/]+?)(.bam)?$/;if(h=h.exec(g.uri||g.blob.name))g.name=h[1];return d(g,null)}if(l==e)return g.tier_type="tabix-index",d(g,null);if(1768301347==l){g.tier_type="tabix";g.payload="vcf";h=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(h=h.exec(g.uri||g.blob.name))g.name=h[1];return d(g,null)}console.log("magic = "+l.toString(16));return d(g,"Unsupported format")}h=String.fromCharCode.apply(null,h).split("\n");if(0<h.length&&
t.test(h[0]))return g.tier_type="memstore",g.payload="vcf",h=/\/?([^/]+?)(.vcf)?$/,(h=h.exec(g.uri||g.blob.name))&&!g.name&&(g.name=h[1]),d(g,null);for(var n=0;n<h.length;++n)if(l=h[n].replace("\r",""),0!=l.length&&0!=l.indexOf("browser")){if(0==l.indexOf("track")){h="bed";l=l.split(/\s/);for(n=1;n<l.length;++n){var F=G.exec(l[n]);F&&("type"==F[1]&&"wiggle_0"==F[2]?h="wig":"name"==F[0]&&(g.name=F[2]))}p(g,h);return d(g,null)}if(0==l.indexOf("fixedStep")||0==l.indexOf("variableStep"))return p(g,"wig"),
d(g,null);if(u.test(l))return p(g,null),d(g,null);break}return d(g,"Unsupported format")})}function p(a,b){a.tier_type="memstore";var e=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);e&&(a.name||(a.name=e[1]),!b&&e[3]&&(b=e[3]));a.payload=b||"bed"}if("undefined"!==typeof d){t=d("./bin");var l=t.URLFetchable,n=t.BlobFetchable,w=t.readInt;t=d("./bigwig");var v=t.BIG_WIG_MAGIC,y=t.BIG_BED_MAGIC,b=d("./lh3utils").unbgzf;t=d("./bam");var a=t.BAM_MAGIC,r=t.BAI_MAGIC,e=d("./tabix").TABIX_MAGIC}"undefined"!==
typeof x&&(x.exports={probeResource:q})},{"./bam":1,"./bigwig":3,"./bin":4,"./lh3utils":23,"./tabix":39}],28:[function(d,x,t){function q(a){return r[a%r.length]*Math.pow(10,a/r.length|0)}function p(a,b,d){this.scale=a;this.cnt=this.tot=0;this.hasScore=!1;this.min=b;this.max=d;this.features=[]}function l(a,b){return a.min<b.min?-1:a.min>b.min?1:a.max<b.max?-1:b.max>a.max?1:0}function n(a,b){for(var d=0;q(d+1)<b;)++d;for(var d=q(d),k=[],l=-1E10,r=1E10,n=0;n<a.length;++n){var c=a[n];if(c.groups&&0<c.groups.length)return a;
for(var f=c.min/d|0,h=c.max/d|0,l=Math.max(l,h),r=Math.min(r,f);f<=h;++f){var z=k[f];z||(z=new p(d,f*d,(f+1)*d-1),k[f]=z);z.feature(c)}}n=[];for(f=r;f<=l;++f)if(z=k[f])c=new y,c.segment=a[0].segment,c.min=f*d+1,c.max=(f+1)*d,c.score=z.score(),c.type="density",n.push(c);Date.now();return n}function w(a){this._pos=a;this._bases={};this._totalCount=0}function v(e,d,m){for(var k,l,r=null,n=null,c=[],f=0;f<e.length;++f){var h=e[f];if(h.groups&&0<h.groups.length)return e;k=h.seq;var z=h.quals,p=b(h.cigar),
q=[];l=[];for(var v=0,M=0;M<p.length;++M){var t=p[M];if("M"==t.op)q.push(k.substr(v,t.cnt)),l.push(z.substr(v,t.cnt)),v+=t.cnt;else if("D"==t.op)for(var D=0;D<t.cnt;++D)q.push("-"),l.push("Z");else"I"==t.op?v+=t.cnt:"S"==t.op?v+=t.cnt:console.log("unknown cigop"+t.op)}k=q.join("");l=l.join("");q=k;v=l;M=h.orientation;t=h.min||0;h=h.max||0;l=0;for(k=t;k<=h;++k)p=c[k],p||(p=new w(k),c[k]=p),z=q.charAt(l),D=v.charCodeAt(l)-33,p.recordBase(z,D,M),l++;r=r?Math.min(r,t):t;n=n?Math.max(n,h):h}h=r;f=n;l=
[];if(d&&(k=d.start|0,p=d.end|0,k<=f&&p>=h)){z=Math.max(h,k);p=Math.min(f,p);for(q=0;q<z-h;q++)l.push("N");l.push(d.seq.substr(z-k,p-z+1));for(q=0;q<f-p;q++)l.push("N")}d=l.join("");f=[];l=0;for(k=r;k<=n;++k){if(p=c[k])if(h=new y,h.segment=e[0].segment,h.min=p.pos(),h.max=h.min,h.notes=[],h.notes=h.notes.concat(p.infoList()),h.type="base-coverage",h.suppressScore=!0,d)for(r=d.charAt(l),h.notes.unshift("Ref="+r),p=p.baseScoreList(r,.2),q=0;q<p.length;q++){z=p[q].base;v=p[q].score;M=a(h);M.score=v;
if(1<p.length||z!=r)M.itemRgb=m[z];f.push(M)}else f.push(h);l++}return f}if("undefined"!==typeof d)var y=d("./das").DASFeature,b=d("./cigar").parseCigar,a=d("./utils").shallowCopy;var r=[1,2,5];p.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var a=this.features;a.sort(l);for(var b=-1E10,d=0,k=0,r=1;r<a.length;++r){var n=a[r],p=Math.max(n.min,this.min),n=Math.min(n.max,this.max),k=k+(n-p+1);p>b?(d+=n-p+1,b=n):n>b&&(d+=n-b,b=n)}return 0<d?1*k/d:0};p.prototype.feature=
function(a){void 0!==a.score&&(this.tot+=a.score,this.hasScore=!0);++this.cnt;this.features.push(a)};w.prototype.recordBase=function(a,b,d){if(this._bases[a])a=this._bases[a],a.cnt++,a.totalQual+=b,a.strandCnt[d]++;else{var k={"+":0,"-":0};k[d]++;this._bases[a]={cnt:1,totalQual:b,strandCnt:k}}this._totalCount++};w.prototype.totalCount=function(){return this._totalCount};w.prototype.pos=function(){return this._pos};w.prototype.infoList=function(){var a=[],b=this._totalCount;a.push("Depth="+b.toString());
for(var d in this._bases){var k=this._bases[d],l=k.cnt,r=k.strandCnt["+"],n=k.strandCnt["-"],k=k.totalQual/l,l=[d,"=",l," (",(100*l/b).toFixed(0),"%, ",r," +, ",n," -, Qual: ",k.toFixed(0),")"];a.push(l.join(""))}return a};w.prototype.baseScoreList=function(a,b){var d=[],k=this._totalCount,l=b*k,r;for(r in this._bases){var n=this._bases[r].cnt;n<l||r==a||(d.push({base:r,score:k}),k-=n)}d.push({base:a,score:k});return d};"undefined"!==typeof x&&(x.exports={downsample:n,getBaseCoverage:v})},{"./cigar":8,
"./das":10,"./utils":49}],29:[function(d,x,t){function q(d,l){var b=parseFloat(d.replace(/,/g,""));return"k"===l||"K"===l?1E3*b|0:"m"==l||"M"===l?1E6*b|0:b|0}if("undefined"!==typeof d)var p=d("./cbrowser").Browser,l=d("./bin").URLFetchable,n=d("./trix").connectTrix;var w=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;p.prototype.search=function(d,p){var b=this,a=w.exec(d);if(a){var r=a[1],e;if(a[6])e=q(a[2],a[3]),a=q(a[6],a[7]);else{var g=this.viewEnd-this.viewStart+
1;e=q(a[2],a[3])-g/2|0;a=e+g-1}this.setLocation(r,e,a,p)}else{if(!d||0==d.length)return!1;var m=0,k=!1,u=function(a,c){--m;if(c)return p(c);a||(a=[]);for(var f=5E8,h=-1E8,e=null,g=0;g<a.length;++g){var l=a[g];null==e&&(e=l.segment);f=Math.min(f,l.min);h=Math.max(h,l.max)}if(e)k=!0,b.highlightRegion(e,f,h),g=Math.max(2500,.3*(h-f+1)|0),b.setLocation(e,f-g,h+g,p);else if(0==m&&!k)return p("no match for '"+d+"'")},G=function(a,c){c.lookup(d,function(c,b){if(null==c||2>c.length)return a.featureSource.search(d,
u);var e=c[1].split(",")[0];return a.featureSource.search(e,u)})};if(this.searchEndpoint)return m=1,this.doDasSearch(b.searchEndpoint,d,u);for(r=0;r<this.tiers.length;++r)(function(a){b.sourceAdapterIsCapable(a.featureSource,"search")?a.dasSource.trixURI?(++m,a.trix?G(a,a.trix):n(new l(a.dasSource.trixURI),new l(a.dasSource.trixURI+"x"),function(c){a.trix=c;G(a,c)})):(++m,a.featureSource.search(d,u)):a.dasSource.provides_search&&(++m,b.doDasSearch(a.dasSource,d,u))})(this.tiers[r])}};p.prototype.doDasSearch=
function(d,l,b){d.features(null,{group:l,type:"transcript"},function(a){a||(a=[]);for(var d=[],e=0;e<a.length;++e){var g=a[e];g.label.toLowerCase()==l.toLowerCase()&&d.push(g)}return b(d)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":46}],30:[function(d,x,t){function q(a,d){d||(d=100);for(var e=b.length;a*b[e%b.length]*Math.pow(10,e/b.length|0)<d;)++e;return b[e%b.length]*Math.pow(10,e/b.length|0)}function p(a,b){var e=a.viewport.getContext("2d"),d=a.browser.retina&&1<window.devicePixelRatio,m=a.browser.featurePanelWidth+
2E3;d&&(m*=2);var k=a.viewport.width|0;k<m-50&&(a.viewport.width=k=m);m=50;b&&b.seq&&(m+=25);var n=m;d&&(n*=2);a.viewport.height=n;a.viewport.style.height=""+m+"px";a.viewport.style.width=d?""+k/2+"px":""+k+"px";a.layoutHeight=m;a.updateHeight();a.background&&(e.fillStyle=a.background,e.fillRect(0,0,k,a.viewport.height));d&&e.scale(2,2);l(a,b,e)}function l(a,b,e){var d=a.browser.scale,m=a.browser.viewStart-1E3/d|0,k=a.browser.viewEnd+2E3/d,l=a.browser.currentSeqMax;e.translate(1E3,0);var n=k;0<l&&
l<k&&(n=l);for(var p=q(d),c=Math.max(0,(m/p|0)*p),l=a.browser.viewStart;c<=n;)e.fillStyle=0==c/p%2?"white":"black",e.strokeStyle="black",e.fillRect((c-l)*d,8,p*d,3),e.strokeRect((c-l)*d,8,p*d,3),e.fillStyle="black",e.fillText(w(c),(c-l)*d,22),c+=p;if(b&&b.seq)for(;m<=k;++m)m>=b.start&&m<=b.end&&(n=b.seq.substr(m-b.start,1).toUpperCase(),(p=a.browser.baseColors[n])||(p="gray"),e.fillStyle=p,8<=d?(p=e.measureText(n).width,e.fillText(n,(m-l)*d+.5*(d-p),52)):e.fillRect((m-l)*d,42,d,12));a.norigin=a.browser.viewStart;
a.viewportHolder.style.left="-1000px"}function n(a,b){var e=a.browser.scale,d=a.browser.viewStart-1E3/e|0,m=a.browser.viewEnd+2E3/e,k=a.browser.currentSeqMax,l=m;0<k&&k<m&&(l=k);for(var n=q(e),p=Math.max(0,(d/n|0)*n),k=a.browser.viewStart,c=v(y,"g",[],{fontSize:"8pt"});p<=l;)c.appendChild(v(y,"rect",null,{x:(p-k)*e,y:8,width:n*e,height:3,fill:0==p/n%2?"white":"black",stroke:"black"})),c.appendChild(v(y,"text",w(p),{x:(p-k)*e,y:28,fill:"black",stroke:"none"})),p+=n;if(b&&b.seq)for(;d<=m;++d)d>=b.start&&
d<=b.end&&(l=b.seq.substr(d-b.start,1).toUpperCase(),(n=a.browser.baseColors[l])||(n="gray"),8<=e?c.appendChild(v(y,"text",l,{x:(.5+d-k)*e,y:52,textAnchor:"middle",fill:n})):c.appendChild(v(y,"rect",null,{x:(d-k)*e,y:42,width:e,height:12,fill:n})));return c}if("undefined"!==typeof d){t=d("./utils");var w=t.formatLongInt,v=t.makeElementNS,y=d("./svg-utils").NS_SVG,w=d("./numformats").formatLongInt}var b=[1,2,5],y="http://www.w3.org/2000/svg";"undefined"!==typeof x&&(x.exports={drawSeqTier:p,drawSeqTierGC:l,
svgSeqTier:n})},{"./numformats":25,"./svg-utils":37,"./utils":49}],31:[function(d,x,t){if("undefined"!=typeof d){x=d("./cbrowser");var q=x.Browser,p=x.sourceDataURI,l=x.sourcesAreEqual,n=d("./version"),w=d("./utils").miniJSONify,v=d("./sha1").hex_sha1}q.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+
this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+
this.cookieKey+".ruler-location"]};q.prototype.storeStatus=function(){this.storeViewStatus();this.storeTierStatus()};q.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+
this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+this.cookieKey+".current-seq-length"]=this.currentSeqMax))};q.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var d=[],b=0;b<this.tiers.length;++b){var a=this.tiers[b];a.dasSource.noPersist||d.push({source:a.dasSource,config:a.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(d);d={};b=[];for(a=0;a<this.hubObjects.length;++a){var l=this.hubObjects[a],
e={url:l.hub.url,genome:l.genome};l.credentials&&(e.credentials=l.credentials);l.mapping&&(e.mapping=l.mapping);d[e.url]=!0;b.push(e)}for(a=0;a<this.hubs.length;++a)e=this.hubs[a],"string"===typeof e&&(e={url:e}),d[e.url]||b.push(e);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(b);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+
this.cookieKey+".single-base-highlight"]=this.singleBaseHighlight;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=n.CONFIG}};q.prototype.restoreStatus=function(){if(!this.noPersist){var d=localStorage["dalliance."+this.cookieKey+".version"];if(n.CONFIG==(d?
d|0:-100)){var d=localStorage["dalliance."+this.cookieKey+".configHash"]||"",b=v(w({sources:this.sources,hubs:this.hubs}));if(b!=d)localStorage["dalliance."+this.cookieKey+".configHash"]=b;else{d={};for(b=0;b<this.sources.length;++b){var a=this.sources[b];if(a){var r=p(a),e=d[r];e||(d[r]=e=[]);e.push(a)}}if(!this.noPersistView&&(b=localStorage["dalliance."+this.cookieKey+".view-chr"],a=localStorage["dalliance."+this.cookieKey+".view-start"]|0,e=localStorage["dalliance."+this.cookieKey+".view-end"]|
0,b&&a&&e)){this.chr=b;this.viewStart=a;this.viewEnd=e;if(b=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=b|0;this.isSnapZooming="true"==localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"];b=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof b||isNaN(b)||(this.savedZoom=b)}this.reverseScrolling=(b=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==b;this.reverseKeyScrolling=(b=localStorage["dalliance."+
this.cookieKey+".reverse-key-scrolling"])&&"true"==b;this.singleBaseHighlight=(b=localStorage["dalliance."+this.cookieKey+".single-base-highlight"])&&"true"==b;if(b=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=b;if(b=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===b;if(b=localStorage["dalliance."+this.cookieKey+".sources"]){var g=
JSON.parse(b);this.sources=[];this.restoredConfigs=[];for(b=0;b<g.length;++b)for(a=this.sources[b]=g[b].source,this.restoredConfigs[b]=g[b].config,r=p(a),e=d[r]||[],r=0;r<e.length;++r){var m=e[r];if(l(a,m))for(var k in m)m.hasOwnProperty(k)&&("function"===typeof m[k]||m[k]instanceof Blob)&&(a[k]=m[k])}}if(k=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=JSON.parse(k);return!0}}}};q.prototype.reset=function(){for(var d=this.tiers.length-1;0<=d;--d)this.removeTier({index:d},!0);for(d=0;d<
this.defaultSources.length;++d)this.defaultSources[d].disabled||this.addTier(this.defaultSources[d]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":32,"./utils":49,"./version":51}],32:[function(d,x,t){function q(d){d=l(n(d));for(var p="",b,a=0;a<d.length;a++)b=d.charCodeAt(a),p+="0123456789abcdef".charAt(b>>>4&15)+"0123456789abcdef".charAt(b&15);return p}function p(d){d=l(n(d));for(var p="",b=d.length,
a=0;a<b;a+=3)for(var r=d.charCodeAt(a)<<16|(a+1<b?d.charCodeAt(a+1)<<8:0)|(a+2<b?d.charCodeAt(a+2):0),e=0;4>e;e++)p=8*a+6*e>8*d.length?p+"":p+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6*(3-e)&63);return p}function l(d){for(var l=Array(d.length>>2),b=0;b<l.length;b++)l[b]=0;for(b=0;b<8*d.length;b+=8)l[b>>5]|=(d.charCodeAt(b/8)&255)<<24-b%32;d=8*d.length;l[d>>5]|=128<<24-d%32;l[(d+64>>9<<4)+15]=d;d=Array(80);for(var b=1732584193,a=-271733879,r=-1732584194,e=271733878,
g=-1009589776,m=0;m<l.length;m+=16){for(var k=b,n=a,p=r,q=e,c=g,f=0;80>f;f++){if(16>f)d[f]=l[m+f];else{var h=d[f-3]^d[f-8]^d[f-14]^d[f-16];d[f]=h<<1|h>>>31}var h=b<<5|b>>>27,z;z=20>f?a&r|~a&e:40>f?a^r^e:60>f?a&r|a&e|r&e:a^r^e;h=w(w(h,z),w(w(g,d[f]),20>f?1518500249:40>f?1859775393:60>f?-1894007588:-899497514));g=e;e=r;r=a<<30|a>>>2;a=b;b=h}b=w(b,k);a=w(a,n);r=w(r,p);e=w(e,q);g=w(g,c)}l=[b,a,r,e,g];d="";for(b=0;b<32*l.length;b+=8)d+=String.fromCharCode(l[b>>5]>>>24-b%32&255);return d}function n(d){for(var l=
"",b=-1,a,r;++b<d.length;)a=d.charCodeAt(b),r=b+1<d.length?d.charCodeAt(b+1):0,55296<=a&&56319>=a&&56320<=r&&57343>=r&&(a=65536+((a&1023)<<10)+(r&1023),b++),127>=a?l+=String.fromCharCode(a):2047>=a?l+=String.fromCharCode(192|a>>>6&31,128|a&63):65535>=a?l+=String.fromCharCode(224|a>>>12&15,128|a>>>6&63,128|a&63):2097151>=a&&(l+=String.fromCharCode(240|a>>>18&7,128|a>>>12&63,128|a>>>6&63,128|a&63));return l}function w(d,l){var b=(d&65535)+(l&65535);return(d>>16)+(l>>16)+(b>>16)<<16|b&65535}"undefined"!==
typeof x&&(x.exports={b64_sha1:p,hex_sha1:q})},{}],33:[function(d,x,t){function q(a,c){ma[a]=c}function p(a,c){na[a]=c}function l(a){if(na[a])return na[a](a)}function n(a){var c=this;this.source=a;this.cfsid="cfs"+ ++pa;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){c.cfsid="cfs"+ ++pa})}function w(){this.busy=0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function v(a){this.dasSource=new R(a);this.busy=0;this.activityListeners=[]}function y(a){this.dasSource=
new R(a);this.awaitedEntryPoints=new h;var c=this;this.dasSource.entryPoints(function(a){c.awaitedEntryPoints.provide(a)})}function b(a){var c=this;this.source=a;this.twoBit=new h;if(a.twoBitURI)a=new K(a.twoBitURI);else if(a.twoBitBlob)a=new H(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");B(a,function(a,b){b?console.log(b):c.twoBit.provide(a)})}function a(a){w.call(this);var c=this;this.readiness="Connecting";this.bwgSource=this.opts=a;c.bwgHolder=new h;if(this.opts.preflight){var b=
ja[this.opts.preflight];if(!b){b=new h;ja[this.opts.preflight]=b;var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&(200==f.status?b.provide("success"):b.provide("failure"))};f.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(f.withCredentials=!0);f.send("")}b.await(function(a){"success"===a&&c.init()})}else c.init()}function r(a,c){w.call(this);this.worker=c;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new h;
this.init()}function e(a,c){if(!(a.flag&J.SEGMENT_UNMAPPED)){var b;b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var f=ba(a.cigar),h=0;h<f.length;++h){var e=f[h];if("M"==e.op||"D"==e.op)b+=e.cnt}}f=new Z;f.min=a.pos+1;f.max=a.pos+b;f.segment=a.segment;f.type="bam";f.id=a.readName;f.notes=["MQ="+a.mq];f.cigar=a.cigar;f.seq=a.seq;f.quals=a.quals;f.orientation=a.flag&J.REVERSE_COMPLEMENT?"-":"+";f.bamRecord=a;c&&a.flag&J.MULTIPLE_SEGMENTS&&(f.groups=[{id:a.readName,type:"readpair"}]);return f}}
function g(a){w.call(this);var c=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new h;if(this.opts.preflight){var b=ja[this.opts.preflight];if(!b){b=new h;ja[this.opts.preflight]=b;var f=new XMLHttpRequest;f.onreadystatechange=function(){4==f.readyState&&(200==f.status?b.provide("success"):b.provide("failure"))};f.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(f.withCredentials="true");
f.send("")}b.await(function(a){"success"===a&&c.init()})}else c.init()}function m(a,c){w.call(this);this.bamSource=a;this.worker=c;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new h;this.init()}function k(a,c){this.source=a;this.mapping=c;this.activityListeners=[];this.busy=0}function u(){}function G(){}function P(a){this.store=new X(a.jbURI,a.jbQuery)}if("undefined"!==typeof d){var c=d("./cbrowser").Browser,f=d("./tier").DasTier;t=d("./utils");var h=
t.Awaited,z=t.arrayIndexOf,A=t.shallowCopy,F=t.resolveUrlToPage;t=d("./das");var E=t.DASStylesheet,M=t.DASStyle,R=t.DASSource,D=t.DASSegment,Z=t.DASFeature,C=t.DASSequence,I=t.DASLink;t=d("./bin");var K=t.URLFetchable,H=t.BlobFetchable,B=d("./twoBit").makeTwoBit,N=d("./bigwig").makeBwg;t=d("./bam");var S=t.makeBam,J=t.BamFlags;t=d("./spans");var L=t.Range,V=t.union,ba=d("./cigar").parseCigar,W=d("./overlay").OverlayFeatureSource,X=d("./jbjson").JBrowseStore,aa=d("./chainset").Chainset;d("./style")}var ma=
{},na={};f.prototype.initSources=function(){var a=this,c=this.browser.createSources(this.dasSource);this.featureSource=c.features||new u;this.sequenceSource=c.sequence;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};c.prototype.createSources=function(c){var f=this.sourceCache.get(c);if(f)return f;var h,e;if("sequence"==c.tier_type||c.twoBitURI||c.twoBitBlob)e=c.twoBitURI||c.twoBitBlob?new b(c):new y(c);else if(c.tier_type&&
ma[c.tier_type])e=(0,ma[c.tier_type])(c),h=e.features,e=e.sequence;else if(c.bwgURI||c.bwgBlob)h=(h=this.getWorker())?new r(c,h):new a(c);else if(c.bamURI||c.bamBlob)h=(h=this.getWorker())?new m(c,h):new g(c);else if(c.jbURI)h=new P(c);else if(c.uri||c.features_uri)h=new v(c);if(c.overlay){f=[];h&&f.push(new n(h));for(h=0;h<c.overlay.length;++h){var d=this.createSources(c.overlay[h]);d&&d.features&&f.push(d.features)}h=new W(f,c)}c.sequenceAliases&&(h=new k(h,new aa({type:"alias",sequenceAliases:c.sequenceAliases})));
c.mapping&&(h=new k(h,this.chains[c.mapping]));c.name&&h&&!h.name&&(h.name=c.name);null!=h&&(h=new n(h));if(null!=h||null!=e)f={features:h,sequence:e},this.sourceCache.put(c,f);return f};f.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri||!(this.dasSource.tier_type||this.dasSource.bwgURI||this.dasSource.bwgBlob||this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.twoBitURI||this.dasSource.twoBitBlob||this.dasSource.jbURI||this.dasSource.overlay)?new v(this.dasSource):
this.getSource()).getStyleSheet(a)};var pa=0;n.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};n.prototype.search=function(a,c){if(this.source.search)return this.source.search(a,c)};n.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};n.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};n.prototype.getScales=function(){return this.source.getScales()};
n.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};n.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};n.prototype.findNextFeature=function(a,c,b,f){this.source.findNextFeature(a,c,b,f)};n.prototype.quantFindNextFeature=function(a,c,b,f,h){this.source.quantFindNextFeature(a,c,b,f,h)};n.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};
n.prototype.fetch=function(a,c,b,f,e,d,g,k){if(!d)throw Error("Fetch pool is null");var m=this,l=this.cfsid,r=d.awaitedFeatures[l];if(r&&r.started){if(r.styleFilters.doesNotContain(k)){m.source.fetch(a,c,b,f,e,d,g,k);return}}else r?r.styleFilters.addAll(k):(r=new h,r.styleFilters=k,d.awaitedFeatures[l]=r,d.requestsIssued.then(function(){r.started=!0;m.source.fetch(a,c,b,f,r.styleFilters.typeList(),d,function(a,c,b,f){r.res||r.provide({status:a,features:c,scale:b,coverage:f})},r.styleFilters)})["catch"](function(a){console.log(a)}));
r.await(function(a){g(a.status,a.features,a.scale,a.coverage)})};w.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};w.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(c){console.log(c)}};w.prototype.addActivityListener=function(a){this.activityListeners.push(a)};w.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(c){console.log(c)}};
w.prototype.getScales=function(){return null};w.prototype.fetch=function(a,c,b,f,h,e,d){return d(null,[],1E9)};w.prototype.getStyleSheet=function(a){var c=new E,b=new M;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";c.pushStyle({type:"default"},null,b);return a(c)};v.prototype.addActivityListener=function(a){this.activityListeners.push(a)};v.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(c){console.log(c)}};v.prototype.getStyleSheet=
function(a){this.dasSource.stylesheet(function(c){a(c)},function(){a(null,"Couldn't fetch DAS stylesheet")})};v.prototype.fetch=function(a,c,b,f,h,e,d){if(h&&0==h.length)d(null,[],f);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return d(null,this.cachedStaticFeatures,this.cachedStaticScale);var g=!1!==this.dasSource.maxbins;h={type:h};g&&(h.maxbins=1+((b-c)/f|0));var k=this;k.busy++;k.notifyActivity();this.dasSource.features(new D(a,
c,b),h,function(a,c){k.busy--;k.notifyActivity();var b=f;g||(b=.1);!c&&k.dasSource.dasStaticFeatures&&(k.cachedStaticFeatures=a,k.cachedStaticScale=b);d(c,a,b)})}};v.prototype.findNextFeature=this.sourceFindNextFeature=function(a,c,b,f){if(this.dasSource.capabilities&&0<=z(this.dasSource.capabilities,"das1:adjacent-feature")){var h=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(c|0)+":"+(0<b?"F":"B")};if(c=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=
c;thisTier.dasSource.features(null,a,function(a){h.dasAdjLock=!1;0<a.length&&null!=a[0]&&f(a[0])})}};y.prototype.fetch=function(a,c,b,f,h){this.dasSource.sequence(new D(a,c,b),function(a){return 1==a.length?h(null,a[0]):h("Didn't get sequence")})};y.prototype.getSeqInfo=function(a,c){this.awaitedEntryPoints.await(function(b){for(var f=0;f<b.length;++f)if(b[f].name==a)return c({length:b[f].end});return c()})};b.prototype.fetch=function(a,c,b,f,h){this.twoBit.await(function(f){f.fetch(a,c,b,function(f,
e){if(e)return h(e,null);var d=new C(a,c,b,"DNA",f);return h(null,d)})})};b.prototype.getSeqInfo=function(a,c){this.twoBit.await(function(b){b.getSeq(a)?b.getSeq(a).length(function(a){c({length:a})}):c()})};v.prototype.getScales=function(){return[]};var ja={};a.prototype=Object.create(w.prototype);a.prototype.init=function(){var a=this,c;c=this.bwgSource.bwgURI?new K(this.bwgSource.bwgURI,{credentials:this.opts.credentials}):new H(this.bwgSource.bwgBlob);N(c,function(c,b){b?(a.error=b,a.readiness=
null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(c),a.readiness=null,a.notifyReadiness(),"bigbed"==c.type&&c.getExtraIndices(function(c){a.extraIndices=c}))})};a.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var c=0;c<this.extraIndices.length;++c)a.search.push(this.extraIndices[c].field)}return a};a.prototype.fetch=function(a,c,b,f,h,
e,d){var g=this;this.bwgHolder.await(function(e){if(null==e)return d(g.error||"Can't access binary file",null,null);var k;k=!h||0==h.length||0<=z(h,"density");g.opts.clientBin&&(k=!1);if("bigwig"==e.type||k||"undefined"!==typeof g.opts.forceReduction){k=-1;for(var m=0;m<e.zoomLevels.length;++m)if(e.zoomLevels[m].reduction<=f)k=m;else break;"undefined"!==typeof g.opts.forceReduction&&(k=g.opts.forceReduction);k=0>k?e.getUnzoomedView():e.getZoomedView(k)}else k=e.getUnzoomedView();g.busy++;g.notifyActivity();
k.readWigData(a,c,b,function(a){g.busy--;g.notifyActivity();var f=1E9;if("bigwig"===e.type){var h=(b-c)/a.length/2;h<f&&(f=h)}if(g.opts.link)for(h=0;h<a.length;++h){var k=a[h];k.label&&(k.links=[new I("Link",g.opts.link.replace(/\$\$/,k.label))])}d(null,a,f)})})};a.prototype.quantFindNextFeature=function(a,c,b,f,h){var e=this;e.busy++;e.notifyActivity();this.bwgHolder.res.thresholdSearch(a,c,b,f,function(a,c){e.busy--;e.notifyActivity();return h(a,c)})};a.prototype.findNextFeature=function(a,c,b,
f){var h=this;h.busy++;h.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,c,b,function(a){h.busy--;h.notifyActivity();0<a.length&&null!=a[0]&&f(a[0])})};a.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var c=[1],b=0;b<a.zoomLevels.length;++b)c.push(a.zoomLevels[b].reduction);return c}return null};a.prototype.search=function(a,c){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,c):c(null,"No indices available")};a.prototype.getDefaultFIPs=
function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(c){c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,b){for(var f=0;f<b.hit.length;++f)if(b.hit[f].isSuperGroup)return;for(f=c.definedFieldCount;f<c.schema.fields.length;++f){var h=c.schema.fields[f];b.add(h.comment,a[h.name])}})})};a.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(c){if(!c)return a(null,"bbi error");var b=new E;if("bigbed"==c.type){var f=new M;f.glyph="BOX";f.FGCOLOR=
"black";f.BGCOLOR="blue";f.HEIGHT=8;f.BUMP=!0;f.LABEL=!0;f.ZINDEX=20;b.pushStyle({type:"bigwig"},null,f);f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="red";f.HEIGHT=10;f.BUMP=!0;f.ZINDEX=20;b.pushStyle({type:"translation"},null,f);f=new M;f.glyph="BOX";f.FGCOLOR="black";f.BGCOLOR="white";f.HEIGHT=10;f.ZINDEX=10;f.BUMP=!0;f.LABEL=!0;b.pushStyle({type:"transcript"},null,f);f=new M;f.glyph="HISTOGRAM";f.COLOR1="white";f.COLOR2="black";f.HEIGHT=30;b.pushStyle({type:"density"},null,f)}else f=new M,f.glyph=
"HISTOGRAM",f.COLOR1="white",f.COLOR2="black",f.HEIGHT=30,b.pushStyle({type:"default"},null,f);12==c.definedFieldCount&&14<=c.fieldCount&&(b.geneHint=!0);return a(b)})};r.prototype=Object.create(w.prototype);r.prototype.init=function(){var a=this,c=this.bwgSource.uri||this.bwgSource.bwgURI,b=this.bwgSource.blob||this.bwgSource.bwgBlob,f=function(c,b){a.readiness=null;a.notifyReadiness();c?a.worker.postCommand({command:"meta",connection:c},function(b,f){f?(a.error=f,a.keyHolder.provide(null)):(a.meta=
b,a.keyHolder.provide(c))}):(a.error=b,a.keyHolder.provide(null))};b?this.worker.postCommand({command:"connectBBI",blob:b},f):this.worker.postCommand({command:"connectBBI",uri:F(c),credentials:this.bwgSource.credentials},f)};r.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var c=0;c<this.meta.extraIndices.length;++c)a.search.push(this.meta.extraIndices[c].field)}return a};
r.prototype.fetch=function(a,c,b,f,h,e,d){var g=this;g.busy++;g.notifyActivity();this.keyHolder.await(function(e){if(!e)return g.busy--,g.notifyActivity(),d(g.error||"Can't access binary file",null,null);var k=-1,m=!h||0==h.length||0<=z(h,"density");g.opts.clientBin&&(m=!1);if("bigwig"==g.meta.type||m||"undefined"!==typeof g.opts.forceReduction){for(m=1;m<g.meta.zoomLevels.length;++m)if(g.meta.zoomLevels[m]<=f)k=m-1;else break;"undefined"!==typeof g.opts.forceReduction&&(k=g.opts.forceReduction)}g.worker.postCommand({command:"fetch",
connection:e,chr:a,min:c,max:b,zoom:k},function(a,f){g.busy--;g.notifyActivity();var h=1E9;if("bigwig"===g.meta.type){var e=(b-c)/a.length/2;e<h&&(h=e)}if(g.opts.link)for(e=0;e<a.length;++e){var k=a[e];k.label&&(k.links=[new I("Link",g.opts.link.replace(/\$\$/,k.label))])}d(f,a,h)})})};r.prototype.quantFindNextFeature=function(a,c,b,f,h){var e=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:c,dir:b,threshold:f,under:!1},function(a,
c){console.log(a,c);e.busy--;e.notifyActivity();return h(a,c)})};r.prototype.findNextFeature=function(a,c,b,f){var h=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:c,dir:b},function(a,c){h.busy--;h.notifyActivity();0<a.length&&null!=a[0]&&f(a[0])})};r.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};r.prototype.search=function(a,c){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return c(null,
"No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,f){b.busy--;b.notifyActivity();c(a,f)})};r.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var c=this;this.keyHolder.await(function(b){var f=c.meta;f&&f.schema&&f.definedFieldCount<f.schema.fields.length&&a(function(a,c){for(var b=0;b<c.hit.length;++b)if(c.hit[b].isSuperGroup)return;
for(b=f.definedFieldCount;b<f.schema.fields.length;++b){var h=f.schema.fields[b];c.add(h.comment,a[h.name])}})})};r.prototype.getStyleSheet=function(a){var c=this;this.keyHolder.await(function(b){b=c.meta;if(!b)return a(null,"bbi error");var f=new E;if("bigbed"==b.type){var h=new M;h.glyph="BOX";h.FGCOLOR="black";h.BGCOLOR="blue";h.HEIGHT=8;h.BUMP=!0;h.LABEL=!0;h.ZINDEX=20;f.pushStyle({type:"bigwig"},null,h);h.glyph="BOX";h.FGCOLOR="black";h.BGCOLOR="red";h.HEIGHT=10;h.BUMP=!0;h.ZINDEX=20;f.pushStyle({type:"translation"},
null,h);h=new M;h.glyph="BOX";h.FGCOLOR="black";h.BGCOLOR="white";h.HEIGHT=10;h.ZINDEX=10;h.BUMP=!0;h.LABEL=!0;f.pushStyle({type:"transcript"},null,h);h=new M;h.glyph="HISTOGRAM";h.COLOR1="white";h.COLOR2="black";h.HEIGHT=30;f.pushStyle({type:"density"},null,h)}else h=new M,h.glyph="HISTOGRAM",h.COLOR1="white",h.COLOR2="black",h.HEIGHT=30,f.pushStyle({type:"default"},null,h);12==b.definedFieldCount&&14<=b.fieldCount&&(f.geneHint=!0);return a(f)})};g.prototype=Object.create(w.prototype);g.prototype.init=
function(){var a=this,c,b;this.bamSource.bamBlob?(c=new H(this.bamSource.bamBlob),b=new H(this.bamSource.baiBlob)):(c=new K(this.bamSource.bamURI,{credentials:this.opts.credentials}),b=new K(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));S(c,b,null,function(c,b){a.readiness=null;a.notifyReadiness();c?a.bamHolder.provide(c):(a.error=b,a.bamHolder.provide(null))})};g.prototype.fetch=function(a,c,b,f,h,d,g){var k=h&&1==h.length&&"density"==h[0],m=this;m.busy++;
m.notifyActivity();this.bamHolder.await(function(f){if(!f)return m.busy--,m.notifyActivity(),g(m.error||"Couldn't fetch BAM");f.fetch(a,c,b,function(a,c){m.busy--;m.notifyActivity();if(c)g(c,null,null);else{for(var b=[],f=0;f<a.length;++f){var h=e(a[f],m.opts.bamGroup);h&&b.push(h)}g(null,b,1E9)}},{light:k})})};g.prototype.getScales=function(){return 1E9};g.prototype.getStyleSheet=function(a){this.bamHolder.await(function(c){c=new E;var b=new M;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";
b.HEIGHT=30;c.pushStyle({type:"density"},"low",b);c.pushStyle({type:"density"},"medium",b);b=new M;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;c.pushStyle({type:"bam"},"high",b);return a(c)})};m.prototype=Object.create(w.prototype);m.prototype.init=function(){var a=this,c=this.bamSource.uri||this.bamSource.bamURI,b=this.bamSource.indexUri||this.bamSource.baiURI||c+".bai",f=this.bamSource.bamBlob||this.bamSource.blob,h=this.bamSource.baiBlob||
this.bamSource.indexBlob,e=function(c,b){a.readiness=null;a.notifyReadiness();c?a.keyHolder.provide(c):(a.error=b,a.keyHolder.provide(null))};f?this.worker.postCommand({command:"connectBAM",blob:f,indexBlob:h},e):this.worker.postCommand({command:"connectBAM",uri:F(c),indexUri:F(b),credentials:this.bamSource.credentials,indexChunks:this.bamSource.indexChunks},e)};m.prototype.fetch=function(a,c,b,f,h,d,g){var k=h&&1==h.length&&"density"==h[0],m=this;m.busy++;m.notifyActivity();this.keyHolder.await(function(f){if(!f)return m.busy--,
m.notifyActivity(),g(m.error||"Couldn't fetch BAM");m.worker.postCommand({command:"fetch",connection:f,chr:a,min:c,max:b,opts:{light:k}},function(a,c){m.busy--;m.notifyActivity();if(c)g(c,null,null);else{for(var b=[],f=0;f<a.length;++f){var h=e(a[f],m.opts.bamGroup);h&&b.push(h)}g(null,b,1E9)}})})};m.prototype.getScales=function(){return 1E9};m.prototype.getStyleSheet=function(a){this.keyHolder.await(function(c){c=new E;var b=new M;b.glyph="HISTOGRAM";b.COLOR1="black";b.COLOR2="red";b.HEIGHT=30;c.pushStyle({type:"density"},
"low",b);c.pushStyle({type:"density"},"medium",b);b=new M;b.glyph="__SEQUENCE";b.FGCOLOR="black";b.BGCOLOR="blue";b.HEIGHT=8;b.BUMP=!0;b.LABEL=!1;b.ZINDEX=20;c.pushStyle({type:"bam"},"high",b);return a(c)})};k.prototype.addActivityListener=function(a){this.activityListeners.push(a)};k.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(c){console.log(c)}};k.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};
k.prototype.getScales=function(){return this.source.getScales()};k.prototype.getDefaultFIPs=function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};k.prototype.simplifySegments=function(a,c){if(0==a.length)return a;a.sort(function(a,c){var b=a.name-c.name;return b?b:(b=a.start-c.start)?b:a.end-c.end});for(var b=[],f=a[0],h=0;h<a.length;++h){var e=a[h];e.name!=f.name||e.start>f.end+c?(b.push(f),f=e):f=new D(f.name,Math.min(f.start,e.start),Math.max(f.end,e.end))}b.push(f);return b};
k.prototype.fetch=function(a,c,b,f,h,e,d,g){var k=this,m=b-c+1;k.busy++;k.notifyActivity();this.mapping.sourceBlocksForRange(a,c,b,function(a){if(0==a.length)k.busy--,k.notifyActivity(),d("No mapping available for this regions",[],f);else{a=k.simplifySegments(a,Math.max(100,.05*m));var c=[],b=null,l=a.length,r;a.map(function(a){k.source.fetch(a.name,a.start,a.end,f,h,e,function(f,h,e){f&&!r&&(r=f);if(h)for(f=0;f<h.length;++f){var g=h[f],m=g.segment;0==m.indexOf("chr")&&(m=m.substr(3));m=k.mapping.mapSegment(m,
g.min,g.max);if(0==m.length)g.parts&&0<g.parts.length&&c.push(g);else for(var n=0;n<m.length;++n){var u=m[n],p=A(g);p.segment=u.segment;p.min=u.min;p.max=u.max;u.partialMin&&(p.partialMin=u.partialMin);u.partialMax&&(p.partialMax=u.partialMax);u.flipped&&("-"==g.orientation?p.orientation="+":"+"==g.orientation&&(p.orientation="-"));c.push(p)}}h=k.mapping.mapPoint(a.name,a.start);f=k.mapping.mapPoint(a.name,a.end);h&&f&&(h=new L(h.pos,f.pos),b=b?V(b,h):h);--l;0==l&&(k.busy--,k.notifyActivity(),d(r,
c,e,b))},g)})}})};u.prototype.getScales=function(){return null};u.prototype.fetch=function(a,c,b,f,h,e,d){return d(null,[],1E9)};u.prototype.getStyleSheet=function(a){var c=new E,b=new M;b.glyph="BOX";b.BGCOLOR="blue";b.FGCOLOR="black";c.pushStyle({type:"default"},null,b);return a(c)};G.prototype.fetch=function(a,c,b,f,h){return h(null,null)};P.prototype.getScales=function(){return null};P.prototype.getStyleSheet=function(a){var c=new E,b=new M;b.glyph="BOX";b.FGCOLOR="black";b.BGCOLOR="green";b.HEIGHT=
8;b.BUMP=!0;b.LABEL=!0;b.ZINDEX=20;c.pushStyle({type:"default"},null,b);return a(c)};P.prototype.fetch=function(a,c,b,f,h,e,d){h&&0==h.length?d(null,[],f):this.store.features(new D(a,c,b),{},function(a,c){d(c,a,1E5)})};c.prototype.sourceAdapterIsCapable=function(a,c){return a.capabilities?a.capabilities()[c]:!1};"undefined"!==typeof x&&(x.exports={FeatureSourceBase:w,TwoBitSequenceSource:b,DASSequenceSource:y,MappedFeatureSource:k,CachingFeatureSource:n,BWGFeatureSource:a,RemoteBWGFeatureSource:r,
BAMFeatureSource:g,RemoteBAMFeatureSource:m,DummyFeatureSource:u,DummySequenceSource:G,registerSourceAdapterFactory:q,registerParserFactory:p,makeParser:l},d("./ensembljson"),d("./tabix-source"),d("./memstore"),d("./bedwig"),d("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./chainset":7,"./cigar":8,"./das":10,"./ensembljson":12,"./jbjson":21,"./memstore":24,"./overlay":26,"./spans":34,"./style":35,"./tabix-source":38,"./tier":43,"./twoBit":48,"./utils":49,"./vcf":50}],34:[function(d,
x,t){function q(b,a){if("number"!=typeof b||"number"!=typeof a)throw"Bad range "+b+","+a;this._min=b;this._max=a}function p(b){this._ranges=b}function l(b,a){b instanceof Array||(b=[b],a&&b.push(a));if(0==b.length)return null;if(1==b.length)return b[0];for(var d=[],e=0;e<b.length;++e)b[e]._pushRanges(d);for(var d=d.sort(y),e=[],g=d[0],g=new q(g._min,g._max),m=1;m<d.length;++m){var k=d[m];k._min>g._max+1?(e.push(g),g=new q(k._min,k._max)):k._max>g._max&&(g._max=k._max)}e.push(g);return 1==e.length?
e[0]:new p(e)}function n(b,a){for(var d=b.ranges(),e=a.ranges(),g=d.length,m=e.length,k=0,l=0,n=[];k<g&&l<m;){b=d[k];a=e[l];var v=Math.max(b.min(),a.min()),c=Math.min(b.max(),a.max());c>=v&&n.push(new q(v,c));b.max()>a.max()?++l:++k}return 0==n.length?null:1==n.length?n[0]:new p(n)}function w(b){var a=0;b=b.ranges();for(var d=0;d<b.length;++d)var e=b[d],a=a+(e.max()-e.min()+1);return a}function v(b,a){return b.min()<a.min()?-1:b.min()>a.min()?1:b.max()<a.max()?-1:a.max()>b.max()?1:0}function y(b,
a){return b._min<a._min?-1:b._min>a._min?1:b._max<a._max?-1:a._max>b._max?1:0}q.prototype.min=function(){return this._min};q.prototype.max=function(){return this._max};q.prototype.contains=function(b){return b>=this._min&&b<=this._max};q.prototype.isContiguous=function(){return!0};q.prototype.ranges=function(){return[this]};q.prototype._pushRanges=function(b){b.push(this)};q.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};p.prototype.min=function(){return this._ranges[0].min()};
p.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};p.prototype.contains=function(b){for(var a=0;a<this._ranges.length;++a)if(this._ranges[a].contains(b))return!0;return!1};p.prototype.isContiguous=function(){return 1<this._ranges.length};p.prototype.ranges=function(){return this._ranges};p.prototype._pushRanges=function(b){for(var a=0;a<this._ranges.length;++a)b.push(this._ranges[a])};p.prototype.toString=function(){for(var b="",a=0;a<this._ranges.length;++a)0<a&&(b+=","),
b+=this._ranges[a].toString();return b};"undefined"!==typeof x&&(x.exports={Range:q,union:l,intersection:n,coverage:w,rangeOver:v,_rangeOrder:y})},{}],35:[function(d,x,t){function q(d,n,p){this.type=d;this.method=n;this.label=p}function p(d){this._filters={};if(d)for(var n=0;n<d.length;++n)this.add(d[n])}q.prototype.equals=function(d){return this.type==d.type&&this.method==d.method&&this.label==d.label};q.prototype.toString=function(){var d=[];this.type&&d.push("type="+this.type);this.method&&d.push("method="+
this.method);this.label&&d.push("label="+this.label);return"StyleFilter<"+d.join(";")+">"};p.prototype.add=function(d){var n=d.toString();this._filters[n]||(this._filters[n]=d,this._list=null)};p.prototype.addAll=function(d){d=d.list();for(var n=0;n<d.length;++n)this.add(d[n])};p.prototype.doesNotContain=function(d){d=d.list();for(var n=0;n<d.length;++n)if(!this._filters[n.toString()])return!0;return!1};p.prototype.list=function(){if(!this._list){this._list=[];for(var d in this._filters)this._filters.hasOwnProperty(d)&&
this._list.push(this._filters[d])}return this._list};p.prototype.typeList=function(){for(var d=[],n=this.list(),p=0;p<n.length;++p){var q=n[p].type;if(!q||"default"==q)return null;0>d.indexOf(q)&&d.push(q)}return d};"undefined"!==typeof x&&(x.exports={StyleFilter:q,StyleFilterSet:p})},{}],36:[function(d,x,t){if("undefined"!==typeof d){var q=d("./cbrowser").Browser,p=d("./utils").makeElementNS,l=d("./version"),n=d("./sequence-draw").svgSeqTier;x=d("./svg-utils");var w=x.NS_SVG,v=x.NS_XLINK,y=x.SVGPath,
b=d("./numformats").formatQuantLabel}q.prototype.makeSVG=function(a){a=a||{};var d=a.minTierHeight||20,e=document.implementation.createDocument(w,"svg",null),g=p(w,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});e.documentElement.appendChild(g);var m=p(w,"a",p(w,"text","Graphics from Dalliance "+l,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",textAnchor:"middle",fill:"blue"}));m.setAttribute("xmlns:xlink",v);m.setAttribute("xlink:href","http://www.biodalliance.org/");g.appendChild(m);
m=p(w,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});m=p(w,"clipPath",m,{id:"featureClip"});g.appendChild(m);for(var m=70,k=p(w,"g",null,{}),u=0;u<this.tiers.length;++u){var q=this.tiers[u],t=p(w,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),c=p(w,"g"),f=m,h=p(w,"rect",null,{x:0,y:f,width:"10000",height:50,fill:q.background});t.appendChild(h);if(q.sequenceSource){var z=n(q,q.currentSequence);t.appendChild(p(w,"g",z,{transform:"translate(200, "+m+")"}));m+=80}else{if(!q.subtiers)continue;
for(var z=(q.glyphCacheOrigin-this.viewStart)*this.scale,A=!1,F=0;F<q.subtiers.length;++F){for(var m=m+3,E=q.subtiers[F],M=[],R=0;R<E.glyphs.length;++R)M.push(E.glyphs[R].toSVG());t.appendChild(p(w,"g",M,{transform:"translate("+(200+z)+", "+m+")"}));if(E.quant){var A=!0,M=E.quant,D=E.height,R=2;40<D&&(R=1+(D/20|0));var D=D/(R-1),x=(M.max-M.min)/(R-1),C=new y;C.moveTo(205,m);C.lineTo(200,m);C.lineTo(200,m+E.height);C.lineTo(205,m+E.height);for(var I=1;I<R-1;++I){var K=I*D;C.moveTo(200,m+K);C.lineTo(203,
m+K)}c.appendChild(p(w,"path",null,{d:C.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));c.appendChild(p(w,"text",b(M.max),{x:197,y:m+7,textAnchor:"end"}));c.appendChild(p(w,"text",b(M.min),{x:197,y:m+E.height,textAnchor:"end"}));for(I=1;I<R-1;++I)K=I*D,c.appendChild(p(w,"text",b(1*M.max-I*x),{x:197,y:m+K+3,textAnchor:"end"}))}m+=E.height+3}m-f<d&&(m=f+d)}c.appendChild(p(w,"text","string"===typeof q.config.name?q.config.name:q.dasSource.name,{x:200-(A?20:12),y:(m+f+8)/2,fontSize:"10pt",
textAnchor:"end"}));h.setAttribute("height",m-f);k.appendChild(p(w,"g",[t,c]))}if(a.highlights)for(d=this.highlights||[],A=0;A<d.length;++A)D=d[A],(D.chr==this.chr||D.chr=="chr"+this.chr)&&D.min<this.viewEnd&&D.max>this.viewStart&&(u=(Math.max(D.min,this.viewStart)-this.viewStart)*this.scale,q=(Math.min(D.max,this.viewEnd)-this.viewStart)*this.scale,k.appendChild(p(w,"rect",null,{x:200+u,y:70,width:q-u,height:m-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));
d=-1;"center"==a.ruler?d=200+(this.viewEnd-this.viewStart)*this.scale/2:"left"==a.ruler?d=200:"right"==a.ruler&&(d=200+(this.viewEnd-this.viewStart)*this.scale);0<=d&&k.appendChild(p(w,"line",null,{x1:d,y1:70,x2:d,y2:m,stroke:"blue"}));g.appendChild(k);e.documentElement.setAttribute("width",this.featurePanelWidth+20+200);e.documentElement.setAttribute("height",m+50);return new Blob([(new XMLSerializer).serializeToString(e)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":25,"./sequence-draw":30,
"./svg-utils":37,"./utils":49,"./version":51}],37:[function(d,x,t){function q(){this.ops=[]}q.prototype.moveTo=function(d,l){this.ops.push("M "+d+" "+l)};q.prototype.lineTo=function(d,l){this.ops.push("L "+d+" "+l)};q.prototype.closePath=function(){this.ops.push("Z")};q.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof x&&(x.exports={NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:q})},{}],38:[function(d,x,t){function q(a){n.call(this);
this.readiness="Connecting";this.source=a;this.tabixHolder=new y;var d=this,e=l(a.payload);if(e)this.parser=e;else throw"Unsuported tabix payload "+a.payload;var g;this.source.blob?(a=new v(this.source.blob),g=new v(this.source.indexBlob)):(a=new w(this.source.uri,{credentials:this.source.credentials}),g=new w(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));b(a,g,function(a,b){d.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var d=e.createSession(function(){}),
c=0;c<a.length;++c)d.parse(a[c]);d.flush()}});d.readiness=null;d.notifyReadiness()})}if("undefined"!==typeof d){x=d("./sourceadapters");var p=x.registerSourceAdapterFactory,l=x.makeParser,n=x.FeatureSourceBase;x=d("./bin");var w=x.URLFetchable,v=x.BlobFetchable,y=d("./utils").Awaited,b=d("./tabix").connectTabix}q.prototype=Object.create(n.prototype);q.prototype.fetch=function(a,b,e,d,m,k,l){var n=this;n.busy++;n.notifyActivity();this.tabixHolder.await(function(d){d.fetch(a,b,e,function(a,b){n.busy--;
n.notifyActivity();for(var h=[],e=n.parser.createSession(function(a){h.push(a)}),d=0;d<a.length;++d)e.parse(a[d]);e.flush();l(null,h,1E9)})})};q.prototype.getStyleSheet=function(a){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(a)};q.prototype.getDefaultFIPs=function(a){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(a)};p("tabix",function(a){return{features:new q(a)}})},{"./bin":4,"./sourceadapters":33,"./tabix":39,"./utils":49}],39:[function(d,x,t){function q(){}
function p(b,a,d){var e=new q;e.data=b;e.tbi=a;e.tbi.fetch(function(a){if(!a)return d(null,"Couldn't access Tabix");a=w(a,a.byteLength);var b=new Uint8Array(a);if(21578324!=l(b,0))return d(null,"Not a tabix index");var k=l(b,4);e.format=l(b,8);e.colSeq=l(b,12);e.colStart=l(b,16);e.colEnd=l(b,20);e.meta=l(b,24);e.skip=l(b,28);l(b,32);e.indices=[];var p=36;e.chrToIndex={};e.indexToChr=[];for(var q=0;q<k;++q){for(var v="";;){var c=b[p++];if(0==c)break;v+=String.fromCharCode(c)}e.chrToIndex[v]=q;0==v.indexOf("chr")?
e.chrToIndex[v.substring(3)]=q:e.chrToIndex["chr"+v]=q;e.indexToChr.push(v)}v=1E9;for(c=0;c<k;++c){for(var f=p,h=l(b,p),p=p+4,q=0;q<h;++q){l(b,p);var z=l(b,p+4),p=p+(8+16*z)}for(var z=l(b,p),A=p+=4,q=0;q<z;++q){var F=n(b,A),A=A+8;if(F){q=F.block;0<F.offset&&(q+=65536);q<v&&(v=q);break}}p+=8*z;0<h&&(e.indices[c]=new Uint8Array(a,f,p-f))}e.headerMax=v;d(e)})}if("undefined"!==typeof d){d("./spans");var l=d("./bin").readInt;d=d("./lh3utils");var n=d.readVob,w=d.unbgzf,v=d.reg2bins,y=d.Chunk}q.prototype.blocksForRange=
function(b,a,d){var e=this.indices[b];if(!e)return[];b=v(a,d);for(var g=[],m=0;m<b.length;++m)g[b[m]]=!0;b=[];for(var k=[],m=l(e,0),p=4,q=0;q<m;++q){var t=l(e,p),c=l(e,p+4),p=p+8;if(g[t])for(var f=0;f<c;++f){var h=n(e,p),z=n(e,p+8);(4681>t?k:b).push(new y(h,z));p+=16}else p+=16*c}m=l(e,p);g=null;a=Math.min(a>>14,m-1);d=Math.min(d>>14,m-1);for(m=a;m<=d;++m)(a=n(e,p+4+8*m))&&(!g||a.block<g.block||a.offset<g.offset)&&(g=a);e=[];if(null!=g)for(m=0;m<k.length;++m)d=k[m],d.maxv.block>=g.block&&d.maxv.offset>=
g.offset&&e.push(d);k=e;e=[];for(m=0;m<k.length;++m)e.push(k[m]);for(m=0;m<b.length;++m)e.push(b[m]);e.sort(function(a,c){var b=a.minv.block-c.minv.block;return 0!=b?b:a.minv.offset-c.minv.offset});b=[];if(0<e.length){k=e[0];for(m=1;m<e.length;++m)d=e[m],d.minv.block==k.maxv.block?k=new y(k.minv,d.maxv):(b.push(k),k=d);b.push(k)}return b};q.prototype.fetch=function(b,a,d,e){function g(){if(p>=l.length)return e(n);if(c){var b=new Uint8Array(c);m.readRecords(b,l[p].minv.offset,n,a,d,k);c=null;++p;return g()}var h=
l[p],b=h.minv.block;m.data.slice(b,h.maxv.block+65536-b).fetch(function(a){c=w(a,h.maxv.block-h.minv.block+1);return g()})}var m=this;b=this.chrToIndex[b];if(void 0==b)return e([]);var k=this.indexToChr[b],l;void 0===b?l=[]:(l=this.blocksForRange(b,a,d))||e(null,"Error in index fetch");var n=[],p=0,c;g()};q.prototype.readRecords=function(b,a,d,e,g,m){a:for(;;){for(var k="";a<b.length;){var l=b[a++];if(10==l){l=k.split("\t");if(l[this.colSeq-1]==m){var n=parseInt(l[this.colStart-1]),p=n;0<this.colEnd&&
(p=parseInt(l[this.colEnd-1]));this.format&65536&&++n;n<=g&&p>=e&&d.push(k)}continue a}else k+=String.fromCharCode(l)}break}};q.prototype.fetchHeader=function(b){var a=this;a.data.slice(0,a.headerMax).fetch(function(d){if(!d)return b(null,"Fetch failed");d=new Uint8Array(w(d,d.byteLength));for(var e=0,g="",m=[];e<d.length;){var k=d[e++];if(10==k)if(g.charCodeAt(0)==a.meta)m.push(g),g="";else return b(m);else g+=String.fromCharCode(k)}b(m)})};"undefined"!==typeof x&&(x.exports={connectTabix:p,TABIX_MAGIC:21578324})},
{"./bin":4,"./lh3utils":23,"./spans":34}],40:[function(d,x,t){function q(a){this.genomes={};this.url=a}function p(){}function l(a){this.hub=a}function n(a,b,d){d=d||{};d.salt=!0;v(a,function(m,c){if(c)return b(null,c);var f=m.split(g),h=new q(a);d.credentials&&(h.credentials=d.credentials);for(var n=0;n<f.length-2;n+=3)h[f[n+1]]=f[n+2];if(h.genomesFile){var p=y(a,h.genomesFile);v(p,function(a,c){if(c)return b(null,c);for(var f=a.split(e),k=0;k<f.length;++k){var m=f[k].split(g),n=new l(h);d.credentials&&
(n.credentials=d.credentials);for(var r=0;r<m.length-2;r+=3)n[m[r+1]]=m[r+2];n.twoBitPath&&(n.twoBitPath=y(p,n.twoBitPath));n.genome&&n.trackDb&&(n.absURL=y(p,n.trackDb),h.genomes[n.genome]=n)}b(h)},d)}else b(null,"No genomesFile")},d)}function w(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}if("undefined"!==typeof d){t=d("./utils");var v=t.textXHR,y=t.relativeURL,b=t.shallowCopy;d=d("./das");var a=d.DASStylesheet,
r=d.DASStyle}var e=/\n\s*\n/,g=/(\w+) +(.+)\n?/,m=/subGroup[1-9]/;p.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};l.prototype.getTracks=function(a){var b=this;if(this._tracks)return a(this._tracks);v(this.absURL,function(d,l){if(l)return a(null,l);d=d.replace("\\\n"," ");for(var c=[],f={},h=d.split(e),n=0;n<h.length;++n){var r=h[n].replace(/\#.*/g,"").split(g),q=new p;q._db=b;for(var v=0;v<r.length-2;v+=3){var t=r[v+1],w=r[v+2];if(t.match(m)){q.subgroups||
(q.subgroups={});for(var t=w.split(/\s/),w=t[0],D={name:t[1],tags:[],titles:[]},y=2;y<t.length;++y){var C=t[y].split(/=/);D.tags.push(C[0]);D.titles.push(C[1])}q.subgroups[w]=D}else if("subGroups"===t)for(t=w.split(/(\w+)=(\w+)/),q.sgm={},y=0;y<t.length-2;y+=3)q.sgm[t[y+1]]=t[y+2];else q[r[v+1]]=r[v+2]}q.track&&(q.type||q.container||q.view||q.bigDataUrl)&&(c.push(q),f[q.track]=q)}h=[];n=[];for(t=0;t<c.length;++t)q=c[t],r=!0,q.parent&&(v=q.parent.split(/\s+/),(w=f[v[0]])?(q._parent=w,w.children||(w.children=
[]),w.children.push(q),w&&(r=!1)):console.log("Couldn't find parent "+v[0]+"("+q.parent+")")),q.compositeTrack?n.push(q):r&&h.push(q);for(c=0;c<n.length;++c)if(f=n[c],f.children){q=!1;for(r=0;r<f.children.length;++r)t=f.children[r],t.view&&(t.shortLabel=f.shortLabel+": "+t.shortLabel,h.push(t),q=!0);q||h.push(f)}b._tracks=h;return a(b._tracks,null)},{credentials:this.credentials,salt:!0})};p.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&
(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=y(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var d=0;d<b.length;++d){var e=b[d],c=e.toDallianceSource();a.overlay.push(c);if(c.style)for(var f=0;f<c.style.length;++f){var h=c.style[f];h.method=e.shortLabel;"transparentOverlay"==this.aggregate&&
(h.style.ALPHA=.5);a.style.push(h)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){d=b.split(/\s+/);if("bigBed"==d[0]&&this.bigDataUrl)return b=d[1]|0,d="+"==d[2],a.bwgURI=y(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&d&&(a.collapseSuperGroups=!0),a;if("bigWig"==d[0]&&this.bigDataUrl)return a.bwgURI=y(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&
"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==d[0]&&this.bigDataUrl)return a.bamURI=y(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==d[0]&&this.bigDataUrl)return a.uri=y(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=!0),a;console.log("Unsupported "+this.type)}};p.prototype.bigwigStyles=function(){var b=
this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){var b=b.split(/\s+/),d,e;3<=b.length&&(d=1*b[1],e=1*b[2]);var g;this.maxHeightPixels&&(b=this.maxHeightPixels.split(/:/),3==b.length?g=b[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));b="bars";this.graphTypeDefault&&(b=this.graphTypeDefault);var c="black",f=null;this.color&&(c="rgb("+this.color+")");this.altColor&&(f="rgb("+this.altColor+")");var h=new a,m=new r;m.glyph="points"==b?"POINT":"HISTOGRAM";
f?(m.COLOR1=c,m.COLOR2=f):m.BGCOLOR=c;m.HEIGHT=g||30;if(d||e)m.MIN=d,m.MAX=e;h.pushStyle({type:"default"},null,m);return h.styles}};p.prototype.bigbedStyles=function(){var d="on"==(""+this.get("itemRgb")).toLowerCase(),e=this.get("visibility")||"full",g=this.get("color"),g=g?"rgb("+g+")":"blue",m=new a,c=new r;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR=g;c.HEIGHT="full"==e||"pack"==e?12:8;c.BUMP="full"==e||"pack"==e;c.LABEL="full"==e||"pack"==e;c.ZINDEX=20;d&&(c.BGITEM=!0);(e=this.get("colorByStrand"))?
(e=e.split(/\s+/),g=b(c),g.BGCOLOR="rgb("+e[0]+")",m.pushStyle({type:"bigwig",orientation:"+"},null,g),c=b(c),c.BGCOLOR="rgb("+e[1]+")",m.pushStyle({type:"bigwig",orientation:"-"},null,c)):m.pushStyle({type:"bigwig"},null,c);c=new r;c.glyph="BOX";c.FGCOLOR="black";d&&(c.BGITEM=!0);c.BGCOLOR="red";c.HEIGHT=10;c.BUMP=!0;c.ZINDEX=20;m.pushStyle({type:"translation"},null,c);d=new r;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;m.pushStyle({type:"transcript"},
null,d);return m.styles};"undefined"!==typeof x&&(x.exports={connectTrackHub:n,THUB_COMPARE:w})},{"./das":10,"./utils":49}],41:[function(d,x,t){if("undefined"!==typeof d)var q=d("./cbrowser").Browser,p=d("./utils").shallowCopy;q.prototype.mergeSelectedTiers=function(){for(var d=[],n=[],q=0;q<this.selectedTiers.length;++q){var v=this.tiers[this.selectedTiers[q]];d.push(p(v.dasSource));for(var t=v.stylesheet.styles,b=0;b<t.length;++b){var a=t[b],r=p(a);r.method=v.dasSource.name.replace(/[()+*?]/g,"\\$&");
r._methodRE=null;r.style=p(a.style);void 0===r.style.ZINDEX&&(r.style.ZINDEX=q);v.forceMin&&(r.style.MIN=v.forceMin);v.forceMax&&(r.style.MAX=v.forceMax);n.push(r)}}this.addTier({name:"Merged",merge:"concat",overlay:d,noDownsample:!0,style:n});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":49}],42:[function(d,x,t){function q(b){for(var a=0;a<b.styles.length;++a){var d=b.styles[a].style;if("__SEQUENCE"===d.glyph)return d}}if("undefined"!==typeof d){var p=d("./cbrowser").Browser,
l=d("./utils").makeElement;x=d("./das");var n=x.isDasBooleanTrue,w=x.copyStylesheet,v=d("./color").dasColourForName}var y={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};p.prototype.openTierPanel=function(b){if("tier"===this.uiMode&&this.manipulatingTier===b)this.hideToolPanel(),this.setUiMode("none");else{var a=function(a){a.BGGRAD||(1==R?("LINEPLOT"==a.glyph||y[a.glyph]?a.FGCOLOR=c.value:a.BGCOLOR=c.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=c.value,a.COLOR2=f.value,a.COLOR3=
2<R?h.value:null),a._gradient=null,a._plusColor=z.value,a._minusColor=A.value)},d=function(a){for(var c=w(b.stylesheet),f=b.browser.zoomForCurrentScale(),h=0;h<c.styles.length;++h){var d=c.styles[h];d.zoom&&d.zoom!=f||a(d.style)}return c},e=function(c){b.mergeStylesheet(d(a))};this.manipulatingTier=b;var g=l("div",null,{className:"tier-edit"});if(b.dasSource.mapping){var m=this.chains[b.dasSource.mapping].coords;g.appendChild(l("div","Mapped from "+m.auth+m.version,null,{background:"gray",paddingBottom:"5px",
marginBottom:"5px",textAlign:"center"}))}var k=l("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center",display:"none"});g.appendChild(k);var p=l("input",null,{type:"text"}),t=l("input",null,{type:"checkbox",disabled:this.disablePinning}),x=l("select");x.appendChild(l("option","Histogram",{value:"HISTOGRAM"}));x.appendChild(l("option","Line Plot",{value:"LINEPLOT"}));x.appendChild(l("option","Ribbon",{value:"GRADIENT"}));x.appendChild(l("option",
"Scatter",{value:"SCATTER"}));var c=l("input",null,{type:"text",value:"#dd00dd"}),f=l("input",null,{type:"text",value:"#dd00dd"}),h=l("input",null,{type:"text",value:"#dd00dd"}),z=l("input",null,{type:"text",value:"#ffa07a"}),A=l("input",null,{type:"text",value:"#87cefa"});try{c.type=f.type=h.type="color",z.type=A.type="color"}catch(F){}var E=[c,f,h],m=l("i",null,{className:"fa fa-plus-circle"}),M=l("i",null,{className:"fa fa-minus-circle"}),R=1,D=l("td",E),Z=function(a){R=a;for(var c=0;c<a;++c)E[c].style.display=
"block";for(c=a;c<E.length;++c)E[c].style.display="none"};m.addEventListener("click",function(a){3>R&&(Z(R+1),e(null))},!1);M.addEventListener("click",function(a){1<R&&(Z(R-1),e(null))},!1);var C=l("input",null,{type:"text",value:"0.0"}),I=l("input",null,{type:"text",value:"10.0"}),K=l("input",null,{type:"checkbox"}),H=l("input",null,{type:"checkbox"}),B=l("input",null,{type:"checkbox",checked:void 0!==b.quantLeapThreshold}),N=l("input",null,{type:"text",value:b.quantLeapThreshold,disabled:!B.checked}),
S=l("input",null,{type:"text",value:"50"}),J=l("input",null,{type:"checkbox"}),L=l("input",null,{type:"text"}),V=l("input",null,{type:"checkbox"}),ba=null;0<b.stylesheet.styles.length&&(ba=b.stylesheet.styles[0].style);var W=function(){p.value="string"===typeof b.config.name?b.config.name:b.dasSource.name;t.checked=b.pinned;b.forceHeight?S.value=""+b.forceHeight:ba&&ba.HEIGHT&&(S.value=""+ba.HEIGHT);"number"==typeof b.quantLeapThreshold?(B.checked=!0,N.disabled=!1,parseFloat(N.value)!=b.quantLeapThreshold&&
(N.value=b.quantLeapThreshold)):(B.checked=!1,N.disabled=!0);L.value="number"==typeof b.subtierMax?""+b.subtierMax:""+(b.dasSource.subtierMax||b.browser.defaultSubtierMax);if(0<b.stylesheet.styles.length){for(var a=null,d=!1,e=!1,e=b.browser.zoomForCurrentScale(),g=0,m=0;m<b.stylesheet.styles.length;++m){var l=b.stylesheet.styles[m];if(!l.zoom||l.zoom==e)if(++g,l=b.stylesheet.styles[m].style,a||(a=ba=l),"LINEPLOT"==l.glyph||"HISTOGRAM"==l.glyph||"GRADIENT"==l.glyph||n(l.SCATTER))d||(a=ba=l),d=!0}if(!a)return;
k.style.display=g==b.stylesheet.styles.length?"none":"block";e=d&&1==g;d?(ra.style.display="table-row",oa.style.display="table-row",ia.style.display="none",ta.style.display="none"):(ra.style.display="none",oa.style.display="none",ia.style.display="table-row",J.checked=n(ba.BUMP),L.disabled=!n(ba.BUMP),ta.style.display="table-row",V.checked=n(ba.LABEL));e?(pa.style.display="table-row",ja.style.display="table-row"):(pa.style.display="none",ja.style.display="none");g=1;a.COLOR1?(c.value=v(a.COLOR1).toHexString(),
a.COLOR2&&(f.value=v(a.COLOR2).toHexString(),a.COLOR3?(h.value=v(a.COLOR3).toHexString(),g=3):g=2)):"LINEPLOT"==a.glyph||"DOT"==a.glyph&&a.FGCOLOR?c.value=v(a.FGCOLOR).toHexString():a.BGCOLOR&&(c.value=v(a.BGCOLOR).toHexString());Z(g);a._plusColor&&(z.value=v(a._plusColor).toHexString()||a._plusColor);a._minusColor&&(A.value=v(a._minusColor).toHexString()||a._minusColor);n(a.SCATTER)?x.value="SCATTER":x.value=a.glyph;var r,F;void 0!==a.MIN&&(g=parseFloat(a.MIN),isNaN(g)||(r=g));b.forceMinDynamic||
void 0===a.MIN&&void 0===b.forceMin?(K.checked=!1,C.disabled=!0):(K.checked=!0,C.disabled=!1);void 0!==a.MAX&&(g=parseFloat(a.MAX),isNaN(g)||(F=g));b.forceMaxDynamic||void 0===a.MAX&&void 0===b.forceMax?(H.checked=!1,I.disabled=!0):(H.checked=!0,I.disabled=!1);void 0!=b.forceMin&&(r=b.forceMin);void 0!=b.forceMax&&(F=b.forceMax);"number"==typeof r&&r!=parseFloat(C.value)&&(C.value=r);"number"==typeof F&&F!=parseFloat(I.value)&&(I.value=F);(a=q(b.stylesheet))?(aa.style.display="table-row",X.checked=
"mismatch"===a.__SEQCOLOR,na.style.display="table-row",ma.checked=n(a.__INSERTIONS)):(aa.style.display="none",na.style.display="none");a&&X.checked&&!e?(ua.style.display="table-row",ca.style.display="table-row"):(ua.style.display="none",ca.style.display="none")}d&&b.browser.sourceAdapterIsCapable(b.featureSource,"quantLeap")?qa.style.display="table-row":qa.style.display="none"},X=l("input",null,{type:"checkbox"}),aa=l("tr",[l("th","Highlight mismatches & strands"),l("td",X)]);X.addEventListener("change",
function(a){a=w(b.stylesheet);q(a).__SEQCOLOR=X.checked?"mismatch":"base";b.mergeStylesheet(a)});var ma=l("input",null,{type:"checkbox"}),na=l("tr",[l("th","Show insertions"),l("td",ma)]);ma.addEventListener("change",function(a){a=w(b.stylesheet);q(a).__INSERTIONS=ma.checked?"yes":"no";b.mergeStylesheet(a)});var pa=l("tr",[l("th","Style"),l("td",x)]),ja=l("tr",[l("th",["Colour(s)",m,M]),D]),ua=l("tr",[l("th","Plus Strand Color"),l("td",z)]),ca=l("tr",[l("th","Minus Strand Color"),l("td",A)]),ra=l("tr",
[l("th","Min value"),l("td",[K," ",C])]),oa=l("tr",[l("th","Max value"),l("td",[H," ",I])]),qa=l("tr",[l("th","Threshold leap:"),l("td",[B," ",N])]),ia=l("tr",[l("th","Bump overlaps"),l("td",[J," limit: ",L])]),ta=l("tr",[l("th","Label features"),l("td",V)]),m=l("table",[l("tr",[l("th","Name",{},{width:"150px",textAlign:"right"}),p]),l("tr",[l("th","Pin to top"),t]),l("tr",[l("th","Height"),l("td",S)]),pa,ja,ua,ca,ra,oa,qa,ia,ta,aa,na]);W();g.appendChild(m);m=l("button","Reset track",{className:"btn"},
{marginLeft:"auto",marginRight:"auto",display:"block"});m.addEventListener("click",function(a){b.setConfig({})},!1);g.appendChild(m);p.addEventListener("input",function(a){b.mergeConfig({name:p.value})},!1);t.addEventListener("change",function(a){b.mergeConfig({pinned:t.checked})},!1);for(m=0;m<E.length;++m)E[m].addEventListener("change",e,!1);z.addEventListener("change",e,!1);A.addEventListener("change",e,!1);x.addEventListener("change",function(c){c=d(function(c){"SCATTER"===x.value?(c.SCATTER=
!0,c.glyph="DOT",c.SIZE="3"):(c.glyph=x.value,c.SCATTER=void 0);a(c)});b.mergeStylesheet(c)},!1);K.addEventListener("change",function(a){a={forceMinDynamic:!K.checked};C.disabled=!K.checked;var c=parseFloat(C.value);K.checked&&"number"==typeof c&&!isNaN(c)&&(a.forceMin=parseFloat(c));b.mergeConfig(a)});C.addEventListener("input",function(a){a=parseFloat(C.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({forceMin:a})},!1);H.addEventListener("change",function(a){a={forceMaxDynamic:!H.checked};I.disabled=
!H.checked;var c=parseFloat(I.value);H.checked&&"number"==typeof c&&!isNaN(c)&&(a.forceMax=parseFloat(c));b.mergeConfig(a)});I.addEventListener("input",function(a){a=parseFloat(I.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({forceMax:a})},!1);S.addEventListener("input",function(a){a=parseFloat(S.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({height:Math.min(500,a|0)})},!1);var va=function(){N.disabled=!B.checked;if(B.checked){var a=parseFloat(N.value);"number"!=typeof a||isNaN(a)||b.mergeConfig({quantLeapThreshold:parseFloat(N.value)})}else b.mergeConfig({quantLeapThreshold:null})};
B.addEventListener("change",function(a){va()},!1);N.addEventListener("input",function(a){va()},!1);V.addEventListener("change",function(a){a=d(function(a){a.LABEL=V.checked?"yes":"no"});b.mergeStylesheet(a)},!1);J.addEventListener("change",function(a){a=d(function(a){a.BUMP=J.checked?"yes":"no"});b.mergeStylesheet(a)},!1);L.addEventListener("input",function(a){a=parseInt(L.value);"number"==typeof a&&0<a&&b.mergeConfig({subtierMax:a})},!1);this.showToolPanel(g);this.setUiMode("tier");b.addTierListener(W);
var T=b.browser.scale;b.browser.addViewListener(function(){b.browser.scale!=T&&(T=b.browser.scale,W())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./utils":49}],43:[function(d,x,t){function q(a,b,d,e){this.config=d||{};this.id="tier"+ ++r;this.browser=a;this.dasSource=l(b);this.background=e;this.viewport=p("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=p("div",this.viewport,
{className:"viewport-holder_12_5"},{background:e,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=p("canvas",null,{width:+(this.browser.featurePanelWidth|0),height:"30",className:"viewport-overlay"});this.notifier=p("div","",{className:"notifier"});this.notifierHolder=p("div",this.notifier,{className:"notifier-holder"});this.quantOverlay=p("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=p("i",null,{className:"fa fa-times"});
this.bumpButton=p("i",null,{className:"fa fa-plus-circle"});this.loaderButton=a.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=p("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=p("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);b.pennant?this.nameButton.appendChild(p("img",null,{src:b.pennant,width:"16",height:"16"})):b.mapping&&(d=null,this.browser.chains[b.mapping]&&(d=this.browser.chains[b.mapping].coords.version),
d&&this.nameButton.appendChild(p("span",""+d,null,{fontSize:"8pt",background:"black",color:"white",paddingLeft:"3px",paddingRight:"3px",paddingTop:"1px",paddingBottom:"1px",marginLeft:"2px",borderRadius:"10px"})));this.nameElement=p("span",b.name);this.nameButton.appendChild(p("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=p("span",[this.nameButton],{className:"btn-group track-label"});
this.row=p("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"+(b.className?" "+b.className:"")});e||(this.row.style.background="none");a.noDefaultLabels||this.row.appendChild(this.label);this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;b.quantLeapThreshold&&(this.quantLeapThreshold=b.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;b.featureInfoPlugin&&this.addFeatureInfoPlugin(b.featureInfoPlugin);
this.initSources();var g=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!b.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&g.addFeatureInfoPlugin(a)});this.featureSource&&this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){g.notify(a,-1)});this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof d){t=d("./utils");var p=t.makeElement,l=t.shallowCopy,n=t.miniJSONify;t=d("./das");var w=t.DASStylesheet,v=t.DASStyle,
y=d("./sha1").b64_sha1;t=d("./style");var b=t.StyleFilter,a=t.StyleFilterSet}var r=0;q.prototype.setBackground=function(a){this.background=a;this.viewportHolder.style.background=a};q.prototype.toString=function(){return this.id};q.prototype.addFeatureInfoPlugin=function(a){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(a)};q.prototype.init=function(){var a=this;a.dasSource.style?(this.setStylesheet({styles:a.dasSource.style}),this.browser.refreshTier(this)):(a.status=
"Fetching stylesheet",a.fetchStylesheet(function(b,d){if(d||!b){a.error="No stylesheet";b=new w;var e=new v;e.glyph="BOX";e.BGCOLOR="blue";e.FGCOLOR="black";b.pushStyle({type:"default"},null,e);a.setStylesheet(b)}else a.setStylesheet(b),b.geneHint&&(a.dasSource.collapseSuperGroups=!0,a.bumped=!1,a.updateLabel()),a._updateFromConfig();a.browser.refreshTier(a)}))};q.prototype.setStylesheet=function(a){this.baseStylesheet=l(a);for(a=0;a<this.baseStylesheet.styles.length;++a){var b=this.baseStylesheet.styles[a]=
l(this.baseStylesheet.styles[a]);b._methodRE=b._labelRE=b._typeRE=null;b.style=l(b.style);b.style.id="style"+ ++this.styleIdSeed}this.baseStylesheetValidity=y(n(this.baseStylesheet));this._updateFromConfig()};q.prototype.getSource=function(){return this.featureSource};q.prototype.getDesiredTypes=function(a){if(a=this.getActiveStyleFilters(a))return a.typeList()};q.prototype.getActiveStyleFilters=function(d){d=this.browser.zoomForCurrentScale();if(this.stylesheet){for(var e=new a,g=this.stylesheet.styles,
l=0;l<g.length;++l){var n=g[l];n.zoom&&n.zoom!=d||e.add(new b(n.type,n.method,n.label))}return e}};q.prototype.needsSequence=function(a){return this.sequenceSource&&5>a||(this.dasSource.bamURI||this.dasSource.bamBlob||this.dasSource.bwgURI||this.dasSource.bwgBlob)&&20>a?!0:!1};q.prototype.viewFeatures=function(a,b,d,e,g){this.currentFeatures=e;this.currentSequence=g;this.notifyFeaturesLoaded();this.knownChr=a;this.knownCoverage=b;this.status&&(this.status=null,this._notifierToStatus());this.draw()};
q.prototype.draw=function(){var a=this.currentSequence;this.sequenceSource?g(this,a):e(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};q.prototype.findNextFeature=function(a,b,d,e,g){if(this.quantLeapThreshold)b=b+(this.browser.viewEnd-this.browser.viewStart+1)*d/2|0,this.featureSource.quantFindNextFeature(a,b,d,this.quantLeapThreshold,g);else{if(this.knownCoverage&&b>=this.knownCoverage.min()&&b<=this.knownCoverage.max()&&this.currentFeatures){for(var c=null,f=0;f<this.currentFeatures.length;++f){var h=
this.currentFeatures[f];if(h.min&&h.max&&!(h.parents&&0<h.parents.length))if(0>d)if(1==e&&h.max>=b&&h.min<b){if(!c||h.min>c.min||h.min==c.min&&h.max<c.max)c=h}else h.max<b&&(!c||h.max>c.max||h.max==c.max&&h.min<c.min||h.min==c.mmin&&c.max>=b)&&(c=h);else if(1==e&&h.min<=b&&h.max>b){if(!c||h.max<c.max||h.max==c.max&&h.min>c.min)c=h}else h.min>b&&(!c||h.min<c.min||h.min==c.min&&h.max>c.max||h.max==c.max&&c.min<=b)&&(c=h)}if(c)return g(c);b=0>d?this.browser.knownSpace.min:this.browser.knownSpace.max}this.trySourceFNF(a,
b,d,g)}};q.prototype.trySourceFNF=function(a,b,d,e){var g=this;this.featureSource.findNextFeature(a,b,d,function(a){a||e(a);var b=g.browser.getSequenceSource();b||e(a);b.getSeqInfo(a.segment,function(b){b?e(a):g.trySourceFNF(a.segment,0<d?1E10:0,d,e)})})};q.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};q.prototype.updateHeight=function(){this.currentHeight=
Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};q.prototype.drawOverlay=function(){var a=this.browser,b=a.retina&&1<window.devicePixelRatio;this.overlay.height=this.viewport.height;this.overlay.width=b?2*a.featurePanelWidth:a.featurePanelWidth;var d=this.overlay.getContext("2d");b&&d.scale(2,2);var e=b=a.viewStart,g=a.viewEnd;if(this.overlayLabelCanvas){var c=(this.glyphCacheOrigin-
this.browser.viewStart)*this.browser.scale;d.save();d.translate(c,0);var f=-c+2;this.dasSource.tierGroup&&(f+=15);this.overlayLabelCanvas.draw(d,f,a.featurePanelWidth-c);d.restore()}for(c=0;c<a.highlights.length;++c)f=a.highlights[c],(f.chr===a.chr||f.chr==="chr"+a.chr)&&f.min<g&&f.max>e&&(d.globalAlpha=a.defaultHighlightAlpha,d.fillStyle=a.defaultHighlightFill,d.fillRect((f.min-b)*a.scale,0,(f.max-f.min)*a.scale,this.overlay.height));this.overlay.style.width=a.featurePanelWidth;this.overlay.style.height=
this.viewport.style.height;this.overlay.style.left="0px"};q.prototype.updateStatus=function(a){a?(this.status=a,this._notifierToStatus()):this.status&&(this.status=null,this._notifierToStatus())};q.prototype.notify=function(a,b){"number"!==typeof b&&(b=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(a){if(this._notifierOn(a),0<b){var d=this;this.notifierFadeTimeout=setTimeout(function(){d._notifierToStatus()},b)}}else this._notifierToStatus()};
q.prototype._notifierOn=function(a){this.notifier.textContent=a;this.notifier.style.opacity=.8};q.prototype._notifierOff=function(){this.notifier.style.opacity=0};q.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status):this._notifierOff()};q.prototype.setConfig=function(a){this.config=a||{};this._updateFromConfig();this.notifyTierListeners()};q.prototype.mergeStylesheet=function(a){this.mergeConfig({stylesheet:a,stylesheetValidity:this.baseStylesheetValidity})};q.prototype.mergeConfig=
function(a){for(var b in a)this.config[b]=a[b];this._updateFromConfig();this.notifyTierListeners()};q.prototype._updateFromConfig=function(){var a=!1,b=!1;this.nameElement.textContent="string"===typeof this.config.name?this.config.name:this.dasSource.name;var d=this.config.height||this.dasSource.forceHeight;d!=this.forceHeight&&(this.forceHeight=d,a=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,a=!0);d=void 0!=this.config.forceMin?this.config.forceMin:
this.dasSource.forceMin;this.forceMin!=d&&(this.forceMin=d,a=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,a=!0);d=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=d&&(this.forceMax=d,a=!0);d=null;void 0!==this.config.quantLeapThreshold?d=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(d=this.dasSource.quantLeapThreshold);d!=this.quantLeapThreshold&&(this.quantLeapThreshold=
d,a=!0);d=null;this.config.stylesheetValidity==this.baseStylesheetValidity&&(d=this.config.stylesheet);d=d||this.baseStylesheet;this.stylesheet!==d&&(this.stylesheet=d,a=!0);d=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;d!==this.pinned&&(this.pinned=d,b=!0);d=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;d!=this.subtierMax&&(this.subtierMax=d,a=!0);d=void 0!==this.config.bumped?this.config.bumped:
void 0!==this.dasSource.bumped?this.dasSource.bumped:this.dasSource.collapseSuperGroups?!1:!0;d!==this.bumped&&(this.bumped=d,a=!0,this.updateLabel());a&&this.scheduleRedraw();b&&this.browser.reorderTiers()};q.prototype.scheduleRedraw=function(){if(this.currentFeatures){var a=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){a.draw();a.redrawTimeout=null},10))}};q.prototype.addTierListener=function(a){this.listeners.push(a)};q.prototype.notifyTierListeners=function(a){for(var b=0;b<
this.listeners.length;++b)try{this.listeners[b](a)}catch(d){console.log(d)}this.browser.notifyTier()};q.prototype.addFeaturesLoadedListener=function(a){this.featuresLoadedListeners.push(a)};q.prototype.notifyFeaturesLoaded=function(){for(var a=0;a<this.featuresLoadedListeners.length;++a)try{this.featuresLoadedListeners[a].call(this)}catch(b){console.log(b)}};if("undefined"!==typeof x){x.exports={DasTier:q};var e=d("./feature-draw").drawFeatureTier,g=d("./sequence-draw").drawSeqTier}},{"./das":10,
"./feature-draw":17,"./sequence-draw":30,"./sha1":32,"./style":35,"./utils":49}],44:[function(d,x,t){if("undefined"!==typeof d){var q=d("./cbrowser"),q=q.Browser,p=d("./tsmart-utils").displayError;x=d("./das");var l=x.DASSegment,n=x.DASRegistry}if("undefined"!==typeof d){q=d("./cbrowser");q=q.Browser;d("./utils");d("./thub");d("./domui");d("./probe");d("./bin");d("./lh3utils");d("./bam");d("./tabix");x=d("./das");var w=x.DASSource,l=x.DASSegment,n=x.DASRegistry}q.prototype.addTrackByNode=function(d,
q,b){var a=this,r,e,g=function(a,b,d){var c=[];b=btoa(b);a=""+a;b&&(a+="-"+b);"acgh"==d?(c[0]=new w({name:"acgh-gain",uri:pageInfo.basePath+"/das/acgh-gain-"+a+"/"}),c[1]=new w({name:"acgh-loss",uri:pageInfo.basePath+"/das/acgh-loss-"+a+"/"}),c[2]=new w({name:"acgh-normal",uri:pageInfo.basePath+"/das/acgh-normal-"+a+"/"}),c[3]=new w({name:"acgh-amp",uri:pageInfo.basePath+"/das/acgh-amp-"+a+"/"}),c[4]=new w({name:"acgh-inv",uri:pageInfo.basePath+"/das/acgh-inv-"+a+"/"})):"vcf"==d?(c[0]=new w({name:"smaf",
uri:pageInfo.basePath+"/das/smaf-"+a+"/"}),c[1]=new w({name:"qd",uri:pageInfo.basePath+"/das/qd-"+a+"/"}),c[3]=new w({name:"gv",uri:pageInfo.basePath+"/das/gv-"+a+"/"}),c[4]=new w({name:"vcf",uri:pageInfo.basePath+"/das/vcf-"+a+"/"})):console.log("Unknown data type",d);return c},m=function(a,b,d,c,f){a.forEach(function(a){a.features(d,{},function(d){!a.name&&(d=/\/([^/]+)\/?$/.exec(a.uri))&&(a.name=d[1]);c(a,b,f)})})};GLOBAL.CurrentSubsetIDs[1]=null;GLOBAL.CurrentSubsetIDs[2]=null;var k=function(a,
b){var d=new XMLHttpRequest;d.open("POST",pageInfo.basePath+"/HighDimension/nodeDetails",!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");d.onreadystatechange=function(){if(4==d.readyState)return 200==d.status||206==d.status?b(d.responseText):b(null)};var c="conceptKeys="+encodeURIComponent([a.id]);d.send(c)};runAllQueries(function(){function b(c,d,e,g){function k(){if(g)a.sources.push(c),a.makeTier(c);else return b(c,d,e,!0)}var l=c.uri;if(g){var m=/(.+)\/[^\/]+\/?/.exec(l);
m&&(l=m[1]+"/sources")}(new n(l,{credentials:c.credentials})).sources(function(b){if(!b||0==b.length)return k();var g=null;if(1==b.length)g=b[0];else for(var l=0;l<b.length;++l)if(b[l].uri===c.uri){g=b[l];break}if(g&&(c.name=g.name+d,c.desc=g.desc,c.maxbins=g.maxbins?!0:!1,g.capabilities&&(c.capabilities=g.capabilities),-1==a.coordSystem.compatibleIds.indexOf(e))){b=!1;g=a.coordSystem.auth+a.coordSystem.version+"/"+a.coordSystem.ucscName;if(a.chains)for(var m in a.chains)0<=a.chains[m].coords.compatibleIds.indexOf(e)&&
(c.mapping=m,b=!0,alert("Track '"+c.name+"' will be mapped from genome release '"+e+"' to '"+g+"' using mapping '"+m+"'"));b||(e?alert("Could not find a coordinate mapping for the genome release specified in the data ("+e+") to the genome browser's coordinate system ("+g+"). If the coordinate systems differ, displayed information will be incorrect."):alert("No genome release version specified for the selected data. Make sure it was specified correctly at upload in the platform (gpl_info). Track will be displayed as if it were in the genome browser's coordinate system ("+
g+"). The displayed information might be incorrect."))}a.sources.push(c);a.makeTier(c)},function(){return k()})}r=GLOBAL.CurrentSubsetIDs[1];e=GLOBAL.CurrentSubsetIDs[2];var q=a.knownSpace;if(q){var t=Math.max(q.min,(q.min+q.max-100)/2)|0,c=new l(q.chr,t,Math.min(t+99,q.max));k(d,function(f){var h="",k="";f=JSON.parse(f);for(var l in f){var h=l,n=f[l].platforms[0];n.genomeReleaseId&&(k=n.genomeReleaseId.split(".")[0])}l=-1!=d.attributes.visualattributes.indexOf("HIGH_DIMENSIONAL")?!0:!1;l?(l=g(r,
d.id,h),m(l,e?"-subset 1":"",c,b,k),e&&(l=g(e,d.id,h),m(l,"-subset 2",c,b,k)),a.createAddInfoButton()):p("Error","Cannot display non-High Dimensional node")})}else alert("Can't confirm track-addition to an unit browser.")})};q.prototype.createAddInfoButton=function(){var d=this,l=jQuery(".pull-right.btn-group").children();jQuery(l[0]).click(function(){if(!(0<jQuery("#btnAddVCFINFO").length)){var b=d.makeButton("Add VCF INFO","Add a custom track with a particular field from the INFO column in a VCF file");
b.id="btnAddVCFINFO";b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();a=d.scanCurrentTracksForVCF();if(0<a.length){var b=prompt("You can add custom track from the INFO column. If you know the VCF file's INFO column contains for example: \n\nDP=89;AF1=1;AC1=2;DP4=0,0,81,0;MQ=60;FQ=-271,\n\n you can add a track for DP to see the values of DP plotted. \nPlease, first drop a VCF node from the concept tree on the genome browser. \nNote: please remember to remove the track and add it again if you change the patient subset selection criteria",
"DP");null!=b&&(d.addVCFInfoTrack(b,a[0].id,a[0].concept,1<a.length?"-subset 1":""),1<a.length&&d.addVCFInfoTrack(b,a[1].id,a[1].concept,"-subset 2"))}else alert("Please, first drop a VCF node from the concept tree on the genome browser.")});jQuery(".nav").prepend(b)}})};q.prototype.addVCFInfoTrack=function(d,l,b,a){this.addTier(new w({name:"VCF-"+d.trim()+a,uri:pageInfo.basePath+"/das/vcfInfo-"+d.trim()+"-"+l+"-"+b+"/"}))};q.prototype.scanCurrentTracksForVCF=function(){for(var d=[],l=0;l<this.sources.length;l++){var b=
this.sources[l];if(b.uri&&(-1<b.uri.indexOf("vcf-")||-1<b.uri.indexOf("smaf-")||-1<b.uri.indexOf("qd-")||-1<b.uri.indexOf("gv-"))){var a=/([^\-]+)-([^\-]+)-([^\/]+)\/$/.exec(b.uri);if(a){for(var b=a[2],a=a[3],n=null,e=0;e<d.length;e++)d[e].id==b&&d[e].concept==a&&(n=d[e]);null==n&&(n={id:b,concept:a},d.push(n))}}}return d}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./lh3utils":23,"./probe":27,"./tabix":39,"./thub":40,"./tsmart-utils":47,"./utils":49}],45:[function(d,x,t){function q(a,
c){for(var b=0;b<a.length;++b){var f=a[b];f===c?f.classList.add("active"):f.classList.remove("active")}}if("undefined"!==typeof d){x=d("./cbrowser");var p=x.Browser,l=x.sourcesAreEqual;x=d("./utils");var n=x.makeElement,w=x.removeChildren,v=x.Observed;x=d("./thub");var y=x.THUB_COMPARE,b=x.connectTrackHub,a=d("./domui").makeTreeTableSection,r=d("./probe").probeResource;x=d("./bin");var e=x.URLFetchable,g=x.BlobFetchable,m=x.readInt,k=d("./lh3utils").unbgzf,u=d("./bam").BAI_MAGIC,G=d("./tabix").TABIX_MAGIC;
d=d("./das");var P=d.DASSource,c=d.DASSegment,f=d.DASRegistry,h=d.coordsMatch}p.prototype.currentlyActive=function(a){for(var c=0;c<this.tiers.length;++c)if(l(this.tiers[c].dasSource,a))return this.tiers[c];return!1};p.prototype.makeButton=function(a,c){var b=n("a",a,{href:"#"});c&&this.makeTooltip(b,c);return n("li",b)};p.prototype.showTrackAdder=function(d){function l(c){ga.style.display="none";ka.style.display="none";fa.style.display="none";T=!1;w(Q);for(var b=n("div",null,{},{width:"100%"}),f=
[],d=0;d<c.length;++d)f.push(c[d]);f.sort(function(a,c){return a.shortLabel.toLowerCase().trim().localeCompare(c.shortLabel.toLowerCase().trim())});c=[];for(var h=[],d=0;d<f.length;++d){var e=f[d];e.children&&0<e.children.length&&"multiWig"!=e.container?c.push(e):h.push(e)}0<h.length&&c.push({shortLabel:"Others",priority:-1E8,children:h});c.sort(y);for(var g=[],f=0;f<c.length;++f){e=h=c[f];!e.dimensions&&e._parent&&e._parent.dimensions&&(e=e._parent);d={};if(e.dimensions)for(var k=e.dimensions.split(/(\w+)=(\w+)/),
m=0;m<k.length-2;m+=3)d[k[m+1]]=k[m+2];if(d.dimX&&d.dimY){for(var p=d.dimX,r=d.dimY,d=e.subgroups[p],k=e.subgroups[r],m={},q=0;q<h.children.length;++q){var z=h.children[q],e=z.sgm[p],A=z.sgm[r];m[e]||(m[e]={});m[e][A]=z}r=n("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});e=n("tr");e.appendChild(n("th",null,{},{width:"150px",height:"100px"}));for(A=0;A<d.titles.length;++A)p=n("th",n("div",d.titles[A],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",
webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),e.appendChild(p);r.appendChild(e);for(var v=n("tbody",null,{className:"table table-striped table-condensed"}),F=0;F<k.titles.length;++F){var A=k.tags[F],E=n("tr");E.appendChild(n("th",k.titles[F]),{});for(var u=0;u<d.titles.length;++u){var e=d.tags[u],t=n("td");if(m[e]&&m[e][A]){e=m[e][A];q=e.toDallianceSource();if(!q)continue;p=n("tr");z=n("td");z.style.textAlign="center";var D=n("input");
D.type="checkbox";D.dalliance_source=q;sa&&(D.dalliance_mapping=sa);g.push(D);t.appendChild(D);D.addEventListener("change",function(a){a.target.checked?H.addTier(a.target.dalliance_source):H.removeTier(a.target.dalliance_source)})}E.appendChild(t)}v.appendChild(E)}r.appendChild(v);b.appendChild(a(h.shortLabel,r,0==f))}else{k=n("tbody",null,{className:"table table-striped table-condensed"});m=n("table",k,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});A=0;h.children.sort(y);
for(d=0;d<h.children.length;++d)if(e=h.children[d],q=e.toDallianceSource())p=n("tr"),z=n("td",null,{},{width:"30px"}),z.style.textAlign="center",D=n("input"),D.type="checkbox",D.dalliance_source=q,sa&&(D.dalliance_mapping=sa),g.push(D),z.appendChild(D),D.addEventListener("change",function(a){a.target.checked?H.addTier(a.target.dalliance_source):H.removeTier(a.target.dalliance_source)}),p.appendChild(z),r=n("td"),r.appendChild(document.createTextNode(e.shortLabel)),e.longLabel&&0<e.longLabel.length&&
H.makeTooltip(r,e.longLabel),p.appendChild(r),k.appendChild(p),++A;1<c.length||"Others"!==h.shortLabel?b.appendChild(a(h.shortLabel,m,0==f)):b.appendChild(m)}}var M=function(){for(var a=0;a<g.length;++a){var c=g[a],b=H.currentlyActive(c.dalliance_source);b?(c.checked=!0,c.disabled=null!=b.sequenceSource):c.checked=!1}};M();H.addTierListener(function(a){M()});Q.appendChild(b)}function p(){q(B,pa);T="bin";ga.style.display="none";ka.style.display="inline";fa.style.display="none";w(Q);var a=n("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(n("h3","Add custom URL-based data"));a.appendChild(n("p",["You can add indexed binary data hosted on an web server that supports CORS (",n("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(n("br"));a.appendChild(document.createTextNode("URL: "));ca=n("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});
a.appendChild(ca);a.appendChild(n("br"));a.appendChild(n("b","- or -"));a.appendChild(n("br"));a.appendChild(document.createTextNode("File: "));ia=n("input",null,{type:"file",multiple:"multiple"});a.appendChild(ia);a.appendChild(n("p",'Clicking the "Add" button below will initiate a series of test queries.'));Q.appendChild(a);ca.focus()}function E(){q(B,ja);ga.style.display="none";ka.style.display="inline";fa.style.display="none";T="hub-connect";ga.style.visibility="hidden";w(Q);var a=n("div",null,
{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(n("h3","Connect to a track hub."));a.appendChild(n("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));ca=n("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(ca);Q.appendChild(a);ca.focus()}function t(){q(B,na);ga.style.display="none";ka.style.display="inline";fa.style.display="none";T="das";w(Q);var a=n("div",null,{},{paddingLeft:"10px",
paddingRight:"10px"});a.appendChild(n("h3","Add custom DAS data"));a.appendChild(n("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(n("br"));ca=n("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(ca);a.appendChild(n("p",'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));
Q.appendChild(a);ca.focus()}function x(){if(T)if("das"===T){var a=ca.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);var c=new P({name:"temporary",uri:a});Y(c)}else if("bin"===T)if((a=ia.files)&&0<a.length){c=ha=[];T="multiple";for(var b=0;b<a.length;++b){var f=a[b];f&&c.push({blob:f})}for(b=0;b<c.length;++b)ea(c[b]);la()}else a=ca.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),U({uri:a});else if("reset"===T)t();else if("reset-bin"===T)p();else if("reset-hub"===T)E();else if("prompt-bai"===T)(a=
ia.files)&&0<a.length&&a[0]?(da.baiBlob=a[0],C(da)):(a=da,ga.style.display="none",ka.style.display="inline",fa.style.display="inline",w(Q),T="prompt-bai",Q.appendChild(n("h2","Select an index file")),Q.appendChild(n("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
Q.appendChild(document.createTextNode("Index file: ")),ia=n("input",null,{type:"file"}),Q.appendChild(ia),da=a);else if("prompt-tbi"===T)(a=ia.files)&&0<a.length&&a[0]?(da.indexBlob=a[0],I(da)):(a=da,ga.style.display="none",ka.style.display="inline",fa.style.display="inline",w(Q),T="prompt-tbi",Q.appendChild(n("h2","Select an index file")),Q.appendChild(n("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
Q.appendChild(document.createTextNode("Index file: ")),ia=n("input",null,{type:"file"}),Q.appendChild(ia),da=a);else if("finalize"===T||"finalize-bin"===T)da.name=ra.value,a=oa.value,da.mapping="__default__"!=a?a:void 0,qa&&(da.maxbins=qa.checked),1<ta.value.length&&1<va.value.length&&(da.xUser=ta.value,da.xPass=va.value),H.addTier(da),"finalize-bin"==T?p():t();else if("hub-connect"===T)a=ca.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),D(a);else{if("multiple"===T){for(a=0;a<ha.length;++a)if(c=
ha[a],!c.hidden&&("bam"!=c.tier_type||c.indexBlob||c.indexUri)&&("tabix"!=c.tier_type||c.indexBlob||c.indexUri)&&(c=xa(c)))c.noPersist=!0,H.addTier(c);p()}}else H.removeAllPopups()}function D(a,c,f){c=c||{};for(var d=0;d<H.hubObjects.length;++d){var h=H.hubObjects[d];if(h.hub.url==a){for(d=0;d<B.length;++d)B[d].hub==h&&q(B,B[d]);h.getTracks(function(a,c){c&&console.log(c);l(a)});return}}b(a,function(b,d){if(d){if(!f)return D(a,{credentials:!0},!0);w(Q);Q.appendChild(n("h2","Error connecting to track hub"));
Q.appendChild(n("p",d));T="reset-hub"}else{var h=null,e=null,g;for(g in b.genomes){var k=null,m=!1;if(g==H.coordSystem.ucscName)m=!0;else for(var p in H.chains)g==H.chains[p].coords.ucscName&&(k=p,m=!0);m&&(m={url:a,genome:g},c.credentials&&(m.credentials=!0),k&&(m.mapping=k,b.genomes[g].mapping=k),H.hubs.push(m),H.hubObjects.push(b.genomes[g]),m=X(b.genomes[g]),ua.appendChild(m),k&&h||(h=b.genomes[g],e=m))}h?(H.notifyTier(),q(B,e),h.getTracks(function(a,c){l(a)})):(w(Q),Q.appendChild(n("h2","No data for this genome")),
Q.appendChild(n("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),Q.appendChild(n("p","coordSystem.ucscName = "+H.coordSystem.ucscName)),T="reset-hub")}},c)}function Z(a,c){var b=a.uri;if(c){var d=/(.+)\/[^\/]+\/?/.exec(b);d&&(b=d[1]+"/sources")}(new f(b,{credentials:a.credentials})).sources(function(b){if(!b||0==b.length)return c?O(a):Z(a,!0);var f=null;if(1==b.length)f=b[0];else for(var d=0;d<b.length;++d)if(b[d].uri===a.uri){f=
b[d];break}d=b=!1;if(f&&(a.name=f.name,a.desc=f.desc,a.maxbins=f.maxbins?!0:!1,f.capabilities&&(a.capabilities=f.capabilities),d=!0,f.coords&&1==f.coords.length))if(f=f.coords[0],h(f,H.coordSystem))b=!0;else if(H.chains)for(var e in H.chains)h(f,H.chains[e].coords)&&(a.mapping=e,b=!0);return O(a,b,d)},function(){return c?O(a):Z(a,!0)})}function C(a){(a.baiBlob?new g(a.baiBlob):new e(a.bamURI+".bai",{credentials:a.credentials})).slice(0,256).fetch(function(c){var b=!1;c&&(c=new Uint8Array(c),b=m(c,
0)==u);return b?O(a,!1,!1,!0):K("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function I(a){(a.indexBlob?new g(a.indexBlob):new e(a.uri+".tbi")).slice(0,65536).fetch(function(c){var b=!1;if(c){var f=new Uint8Array(c);if(31==f[0]||139==f[1])c=k(c),f=new Uint8Array(c),b=m(f,0)==G}return b?O(a,!1,!1,!0):K('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
function K(a){ga.style.display="none";ka.style.display="inline";fa.style.display="inline";w(Q);a=a||"Custom data format not recognized";Q.appendChild(n("h2","Error adding custom data"));Q.appendChild(n("p",a));Q.appendChild(n("p","Currently supported formats are bigBed, bigWig, and BAM."));T="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var H=this;d=n("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
verticalAlign:"top",paddingRight:"15px"});var B=[],N,S;if(!this.noRegistryTabs){var J=this.makeButton("Registry","Browse compatible datasources from the DAS registry");B.push(J);for(var L in this.mappableSources)(function(a){var c=H.makeButton(H.chains[a].srcTag,"Browse datasources mapped from "+H.chains[a].srcTag);B.push(c);c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();q(B,c);N(H.mappableSources[a],a)},!1)})(L)}L={};for(var V=0;V<this.defaultSources.length;++V){var ba=
this.defaultSources[V],W=ba.group||"Defaults";L[W]?L[W].push(ba):L[W]=[ba]}var X=function(a){var c=a.hub,b=n("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),f=c.shortLabel||"Unknown";a.mapping&&(f=f+" ("+a.genome+")");var f=n("span",[f," ",b]),d=H.makeButton(f,c.longLabel);d.hub=a;B.push(d);d.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();q(B,d);w(Q);c=H.makeLoader(24);c.style.marginLeft="auto";c.style.marginRight="auto";c.style.marginTop="100px";Q.appendChild(n("div",
c,null,{textAlign:"center"}));ga.style.display="none";ka.style.display="none";fa.style.display="none";a.getTracks(function(a,c){c&&console.log(c);l(a)})},!1);b.addEventListener("click",function(c){c.preventDefault();c.stopPropagation();var b=n("li",n("a","Remove hub")),f=n("li",n("a","Enable all")),h=n("li",n("a","Disable all")),e=n("ul",[b,f,h],{className:"dropdown-menu"},{display:"block"}),g=c.clientX;c=c.clientY;g+=document.documentElement.scrollLeft||document.body.scrollLeft;c+=document.documentElement.scrollTop||
document.body.scrollTop;e.style.position="absolute";e.style.top=""+(c+10)+"px";e.style.left=""+(g-30)+"px";H.hPopupHolder.appendChild(e);var k=function(a){console.log("cc");document.body.removeEventListener("click",k,!0);H.hPopupHolder.removeChild(e)};document.body.addEventListener("click",k,!0);b.addEventListener("click",function(c){for(c=0;c<H.hubObjects.length;++c)if(H.hubObjects[c].absURL==a.absURL){H.hubObjects.splice(c,1);break}for(c=0;c<H.hubs.length;++c){var b=H.hubs[c];"string"===typeof b&&
(b={url:b});if(b.url==a.hub.url&&!b.genome||b.genome==a.genome){H.hubs.splice(c,1);break}}H.notifyTier();ua.removeChild(d);q(B,ja);E()},!1);f.addEventListener("click",function(c){a.getTracks(function(a,c){c&&console.log(c);for(var b=0;b<a.length;++b){var f=a[b].toDallianceSource();H.currentlyActive(f)||H.addTier(f)}})},!1);h.addEventListener("click",function(c){a.getTracks(function(a,c){c&&console.log(c);for(var b=0;b<a.length;++b){var f=a[b].toDallianceSource();H.currentlyActive(f)&&H.removeTier(f)}})},
!1)},!1);return d},aa=null,ma=null;for(W in L)(function(a,c){var b=H.makeButton(a,"Browse the default set of data for this browser");b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();q(B,b);N(new v(c))},!1);B.push(b);aa||(aa=b,ma=c)})(W,L[W]);var na=this.makeButton("DAS","Add arbitrary DAS data");B.push(na);var pa=this.makeButton("Binary","Add data in bigwig or bigbed format");B.push(pa);for(W=0;W<this.hubObjects.length;++W)X(this.hubObjects[W]);var ja=this.makeButton("+",
"Connect to a new track-hub");B.push(ja);var ua=n("ul",B,{className:"nav nav-tabs"},{marginBottom:"0px"});d.appendChild(ua);var ca,ra,oa,qa,ia,ta,va,T=!1,da=null,W=n("form",null,{},{display:"inline-block",width:"100%"});W.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();x();return!1},!0);var Q=n("div");Q.style.position="relative";Q.style.overflow="scroll";W.appendChild(Q);var sa,wa;N=function(a,c){ga.style.display="none";ka.style.display="none";fa.style.display="none";
wa&&wa.removeListener(S);sa=c;wa=a;wa.addListenerAndFire(S)};S=function(a){T=!1;var c=[];w(Q);if(a){for(var b=n("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),f=n("table",b,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),d=0,h=[],e=0;e<a.length;++e)h.push(a[e]);h.sort(function(a,c){return a.name.toLowerCase().trim().localeCompare(c.name.toLowerCase().trim())});for(e=0;e<h.length;++e){a=h[e];var g=n("tr"),k=n("td",null,{},{width:"30px"});
k.style.textAlign="center";if(!a.props||a.props.cors){var l=n("input");l.type="checkbox";l.dalliance_source=a;sa&&(l.dalliance_mapping=sa);k.appendChild(l);c.push(l);l.addEventListener("change",function(a){a.target.checked?H.addTier(a.target.dalliance_source):H.removeTier(a.target.dalliance_source)})}else k.appendChild(document.createTextNode("!")),H.makeTooltip(k,n("span",["This data source isn't accessible because it doesn't support ",n("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));g.appendChild(k);
k=n("td");k.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&H.makeTooltip(k,a.desc);g.appendChild(k);b.appendChild(g);++d}var m=function(){for(var a=0;a<c.length;++a){var b=c[a];H.currentlyActive(b.dalliance_source)?b.checked=!0:b.checked=!1}};m();H.addTierListener(function(a){m()});Q.appendChild(f)}else Q.appendChild(n("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};J&&J.addEventListener("click",function(a){a.preventDefault();
a.stopPropagation();q(B,J);N(H.availableSources)},!1);pa.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();p()},!1);ja.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();E()},!1);na.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();t()},!1);var ka=n("button","Add",{className:"btn btn-primary"});ka.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();x()},!1);var Y=function(a,b){var f=H.knownSpace;if(f){var d=
Math.max(f.min,(f.min+f.max-100)/2)|0,f=new c(f.chr,d,Math.min(d+99,f.max));a.features(f,{},function(c,f){if(f)b?(w(Q),Q.appendChild(n("h2","Custom data not found")),Q.appendChild(n("p","DAS uri: "+a.uri+" is not answering features requests")),T="reset"):(a.credentials=!0,Y(a,!0));else{var d=/\/([^/]+)\/?$/.exec(a.uri);d&&(a.name=d[1]);Z(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},xa=function(a){var c={name:a.name};a.credentials&&(c.credentials=a.credentials);a.mapping&&
"__default__"!=a.mapping&&(c.mapping=a.mapping);if("bwg"==a.tier_type)return a.blob?c.bwgBlob=a.blob:a.uri&&(c.bwgURI=a.uri),c;if("bam"==a.tier_type)return a.blob?(c.bamBlob=a.blob,c.baiBlob=a.indexBlob):(c.bamURI=a.uri,c.baiURI=a.indexUri),c;if("tabix"==a.tier_type)return c.tier_type="tabix",c.payload=a.payload,a.blob?(c.blob=a.blob,c.indexBlob=a.indexBlob):(c.uri=a.uri,c.indexUri=a.indexUri),c;if("memstore"==a.tier_type)return c.tier_type="memstore",c.payload=a.payload,a.blob?c.blob=a.blob:c.uri=
a.uri,c},U=function(a){r(a,function(a,c){if(c)w(Q),Q.appendChild(n("h2","Couldn't access custom data")),Q.appendChild(n("p",""+c)),T="reset-bin";else{var b=xa(a);return"bam"==a.tier_type?C(b):"tabix"==a.tier_type?I(b):O(b,!1,!1,!0)}})},O=function(a,c,b,f){ga.style.display="none";ka.style.display="inline";fa.style.display="inline";w(Q);Q.appendChild(n("h2","Add custom data: step 2"));Q.appendChild(document.createTextNode("Label: "));ra=n("input","",{value:a.name});Q.appendChild(ra);ta=n("input","");
va=n("input","");Q.appendChild(n("br"));Q.appendChild(n("br"));Q.appendChild(n("h4","Coordinate system: "));oa=n("select",null);oa.appendChild(n("option",H.nameForCoordSystem(H.coordSystem),{value:"__default__"}));if(H.chains)for(var d in H.chains)oa.appendChild(n("option",H.nameForCoordSystem(H.chains[d].coords),{value:d}));oa.value=a.mapping||"__default__";Q.appendChild(oa);c?Q.appendChild(n("p","(Based on server response, probably doesn't need changing.)")):(Q.appendChild(n("p",[n("b","Warning: "),
"unable to determine the correct value from server responses.  Please check carefully."])),Q.appendChild(n("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));f||(Q.appendChild(document.createTextNode("Quantitative: ")),qa=n("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(qa.checked=a.maxbins),Q.appendChild(qa),b?Q.appendChild(n("p","(Based on server response, probably doesn't need changing.)")):Q.appendChild(n("p",[n("b","Warning: "),
"unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&Q.appendChild(n("p",[n("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));ra.focus();T="bin"===T||"prompt-bai"===T||"prompt-tbi"===T?"finalize-bin":"finalize";da=a},ha=null,ea=function(a){r(a,function(a,c){c&&(a.error=c);for(var b=[],f={},d={},h=0;h<ha.length;++h){var e=ha[h];"bam"!=e.tier_type||e.indexBlob||(f[e.blob.name]=e);"tabix"!=
e.tier_type||e.indexBlob||(d[e.blob.name]=e)}for(h=0;h<ha.length;++h)if(e=ha[h],"bai"===e.tier_type){var g=/(.+)\.bai$/.exec(e.blob.name);g&&f[g[1]]&&(f[g[1]].indexBlob=e.blob,b.push(h))}else"tabix-index"===e.tier_type&&(g=/(.+)\.tbi$/.exec(e.blob.name))&&d[g[1]]&&(d[g[1]].indexBlob=e.blob,b.push(h));for(f=b.length-1;0<=f;--f)ha.splice(b[f],1);la()})},la=function(){w(Q);var a=!1,c=n("table",ha.filter(function(a){return!a.hidden}).map(function(c){n("tr").appendChild(n("td",c.name||c.blob.name));var b;
b=c.error?n("span","Error",null,{color:"red"}):c.tier_type?c.payload||c.tier_type:H.makeLoader(16);var f,d="unknown";"bwg"==c.tier_type||"memstore"==c.tier_type?d="okay":"bam"==c.tier_type?d=c.indexBlob?"okay":"needs-index":"tabix"==c.tier_type&&(d=c.indexBlob?"okay":"needs-index");if("okay"==d){f=n("select",null,null,{width:"150px"});f.appendChild(n("option",H.nameForCoordSystem(H.coordSystem),{value:"__default__"}));if(H.chains)for(var h in H.chains)f.appendChild(n("option",H.nameForCoordSystem(H.chains[h].coords),
{value:h}));f.value=c.mapping||"__default__";f.addEventListener("change",function(a){c.mapping=f.value;console.log(c)},!1)}else"needs-index"==d&&(f=n("span","Needs index",{},{color:"red"}),a=!0);return n("tr",[n("td",c.name||c.blob.name),n("td",b),n("td",f)])}),{className:"table table-striped table-condensed"});Q.appendChild(c);if(a){Q.appendChild(n("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
Q.appendChild(document.createTextNode("Index file(s): "));var b=n("input",null,{type:"file",multiple:"multiple"});Q.appendChild(b);b.addEventListener("change",function(a){console.log("fileset changed");a=b.files||[];for(var c=0;c<a.length;++c){var f=a[c];f&&(f={blob:f,hidden:!0},ha.push(f),ea(f))}},!1)}},fa=n("button","Cancel",{className:"btn"});fa.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===T?p():t()},!1);var ga=n("button","Refresh",{className:"btn"});
ga.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();H.queryRegistry(sa)},!1);this.makeTooltip(ga,"Click to re-fetch data from the DAS registry");L=n("div",[ka," ",fa," ",ga]);L.style.margin="10px";W.appendChild(L);d.appendChild(W);N(H.availableSources);this.showToolPanel(d);this.setUiMode("add");aa&&(q(B,aa),N(new v(ma)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./lh3utils":23,"./probe":27,"./tabix":39,"./thub":40,"./utils":49}],46:[function(d,x,t){function q(d,
n,q){n.fetchAsText(function(n){if(!n)return q(null,"Couldn't fetch index-index");n=n.split(/(.+)([0-9A-F]{10})\n/);for(var t=[],b=[],a=1;a<n.length;a+=3)t.push(n[a]),b.push(parseInt(n[a+1],16));return q(new p(t,b,d))})}function p(d,n,p){this.keys=d;this.offsets=n;this.ix=p}p.prototype.lookup=function(d,n){for(var p,q=(d+"     ").substring(0,5).toLowerCase(),t=0;t<this.keys.length;++t)if(0>q.localeCompare(this.keys[t])){p=this.ix.slice(this.offsets[t-1],this.offsets[t]-this.offsets[t-1]);break}p||
(p=this.ix.slice(this.offsets[this.offsets.length-1]));p.fetchAsText(function(b){b=b.split("\n");for(var a=0;a<b.length;++a)if(0==b[a].indexOf(d.toLowerCase()+" "))return n(b[a].split(" "));return n(null)})};"undefined"!==typeof x&&(x.exports={connectTrix:q})},{}],47:[function(d,x,t){},{}],48:[function(d,x,t){function q(){}function p(a,b){var d=new q;d.data=a;d.data.slice(0,12500).fetch(function(a){if(!a)return b(null,"Couldn't access data");var k=new Uint8Array(a);a=n(k,0);if(440477507==a)d.readInt=
n;else if(1126646042==a)d.readInt=w;else return b(null,"Not a .2bit file, magic=0x"+a.toString(16));a=d.readInt(k,4);if(0!=a)return b(null,"Unsupported version "+a);d.seqCount=d.readInt(k,8);d.seqDict={};var p=16,r=0,q=0,c=function(){for(;r<d.seqCount;){var a=k[p];if(p+a+6>=k.length)return d.data.slice(q+p,12500).fetch(function(a){q+=p;p=0;k=new Uint8Array(a);c()});++p;for(var h="",m=1;m<=a;++m)h+=String.fromCharCode(k[p++]);a=d.readInt(k,p);p+=4;d.seqDict[h]=new l(d,a);++r}return b(d)};c()})}function l(a,
b){this.tbf=a;this.offset=b}if("undefined"!==typeof d){t=d("./bin");var n=t.readInt,w=t.readIntBE;d=d("./spans");var v=d.Range,y=d.union,b=d.intersection}q.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};q.prototype.fetch=function(a,b,d,l){var k=this.getSeq(a);if(k){if(d<=b)return l("");k.fetch(b,d,l)}else return l(null,"Couldn't find "+a)};l.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(d){if(!d)return a("Fetch failed");
d=new Uint8Array(d);b._length=b.tbf.readInt(d,0);b.nBlockCnt=b.tbf.readInt(d,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(d){if(!d)return a("Fetch failed");d=new Uint8Array(d);for(var g=null,l=0;l<b.nBlockCnt;++l)var n=b.tbf.readInt(d,4*l),p=b.tbf.readInt(d,4*(l+b.nBlockCnt)),n=new v(n,n+p-1),g=g?y(g,n):n;b.nBlocks=g;b.mBlockCnt=b.tbf.readInt(d,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var a=["T","C","A","G"];
l.prototype.fetch=function(d,e,g){--d;--e;var l=this;this.init(function(k){if(k)return g(null,k);var n=d>>2;k=e+3>>2;if(0>n||k>l.seqLength)return g("Coordinates out of bounds: "+d+":"+e);l.tbf.data.slice(l.seqOffset+n,k-n).salted().fetch(function(k){function p(b){for(;q<=b;){var f=q&3,d=c[(q>>2)-n];h+=a[0==f?d>>6&3:1==f?d>>4&3:2==f?d>>2&3:d&3];++q}}if(null==k)return g("SeqFetch failed");var c=new Uint8Array(k);k=[];if(l.nBlocks){var f=b(new v(d,e),l.nBlocks);f&&(k=f.ranges())}for(var h="",q=d,f=0;f<
k.length;++f){var A=k[f];if(q>A.min())throw"N mismatch...";for(q<A.min()&&p(A.min()-1);q<=A.max();)h+="N",++q}q<=e&&p(e);return g(h)})})};l.prototype.length=function(a){var b=this;this.init(function(d){return d?a(null,d):a(b._length)})};"undefined"!==typeof x&&(x.exports={makeTwoBit:p})},{"./bin":4,"./spans":34}],49:[function(d,x,t){function q(a,c){for(var b=0;b<a.length;++b)if(a[b]==c)return;a.push(c)}function p(a,c,b){a[c]?a[c].push(b):a[c]=[b]}function l(a,c,b){var d=a[c];if(d){for(a=0;a<d.length;++a)if(d[a]==
b)return;d.push(b)}else a[c]=[b]}function n(a,c,b,d){if(a)return a;if(c)return c;if(b)return b;if(d)return d}function q(a,c){for(var b=0;b<a.length;++b)if(a[b]==c)return;a.push(c)}function w(a,c){if(!a)return-1;for(var b=0;b<a.length;++b)if(a[b]===c)return b;return-1}function v(a,c,b,d){a=document.createElement(a);if(c){c instanceof Array||(c=[c]);for(var e=0;e<c.length;++e){var g=c[e];g&&("string"==typeof g?g=document.createTextNode(g):"number"==typeof g&&(g=document.createTextNode(""+g)),a.appendChild(g))}}if(b)for(var k in b)try{a[k]=
b[k]}catch(l){throw console.log("error setting "+k),l;}if(d)for(k in d)a.style[k]=d[k];return a}function y(a,c,b,d){a=document.createElementNS(a,c);if(b)for(b instanceof Array||(b=[b]),c=0;c<b.length;++c){var e=b[c];"string"==typeof e&&(e=document.createTextNode(e));a.appendChild(e)}if(d)for(var g in d){b=a;c=g;var e=d[g],k=P[c];if(!k){for(var k="",l=0;l<c.length;++l)var m=c.substring(l,l+1),n=m.toLowerCase(),k=n!=m?k+"-"+n:k+m;P[c]=k}b.setAttribute(k,e)}return a}function b(a){if(a&&a.childNodes)for(;0<
a.childNodes.length;)a.removeChild(a.firstChild)}function a(c,b){if("undefined"===typeof c)return"undefined";if(null==c)return"null";if("string"==typeof c)return"'"+c+"'";if("number"==typeof c||"boolean"==typeof c)return""+c;if("object"==typeof c){if(c instanceof Array){for(var d=null,e=0;e<c.length;++e)d=(null==d?"":d+", ")+a(c[e],b);return"["+(d?d:"")+"]"}b=b||{};d=null;for(e in c)b[e]||void 0!=e&&"function"!=typeof c[e]&&(d=(null==d?"":d+", ")+e+": "+a(c[e],b));return"{"+(d?d:"")+"}"}return typeof c}
function r(a){var c={},b;for(b in a)c[b]=a[b];return c}function e(a){this.value=a;this.listeners=[]}function g(){this.queue=[]}function m(a,b,d){d.salt&&(a=a+"?salt="+G(""+Date.now()+","+ ++c));var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(300<=e.status?b(null,"Error code "+e.status):b(e.responseText))};e.open("GET",a,!0);e.responseType="text";d&&d.credentials&&(e.withCredentials=!0);e.send("")}function k(a,c){if(0==c.indexOf("http:")||0==c.indexOf("https:"))return c;
var b=a.lastIndexOf("/");return 0<=b?a.substr(0,b+1)+c:c}function u(a){return v("a",null,{href:a}).href}if("undefined"!==typeof d)var G=d("./sha1").b64_sha1;var P={};e.prototype.addListener=function(a){this.listeners.push(a)};e.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};e.prototype.removeListener=function(a){var c=this.listeners;a=w(c,a);0<=a&&c.splice(a,1)};e.prototype.get=function(){return this.value};e.prototype.set=function(a){this.value=a;for(var c=0;c<this.listeners.length;++c)this.listeners[c](a)};
g.prototype.provide=function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var c=0;c<this.queue.length;++c)this.queue[c](a);this.queue=null};g.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var c=0;d={TTT:"F",TTC:"F",TTA:"L",TTG:"L",CTT:"L",CTC:"L",CTA:"L",CTG:"L",ATT:"I",ATC:"I",ATA:"I",ATG:"M",GTT:"V",GTC:"V",GTA:"V",GTG:"V",TCT:"S",TCC:"S",TCA:"S",TCG:"S",CCT:"P",CCC:"P",CCA:"P",CCG:"P",ACT:"T",ACC:"T",ACA:"T",
ACG:"T",GCT:"A",GCC:"A",GCA:"A",GCG:"A",TAT:"Y",TAC:"Y",TAA:"*",TAG:"*",CAT:"H",CAC:"H",CAA:"Q",CAG:"Q",AAT:"N",AAC:"N",AAA:"K",AAG:"K",GAT:"D",GAC:"D",GAA:"E",GAG:"E",TGT:"C",TGC:"C",TGA:"*",TGG:"W",CGT:"R",CGC:"R",CGA:"R",CGG:"R",AGT:"S",AGC:"S",AGA:"R",AGG:"R",GGT:"G",GGC:"G",GGA:"G",GGG:"G"};"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof x&&(x.exports={textXHR:m,relativeURL:k,resolveUrlToPage:u,shallowCopy:r,
pusho:p,pushnew:q,pushnewo:l,arrayIndexOf:w,pick:n,makeElement:v,makeElementNS:y,removeChildren:b,miniJSONify:a,Observed:e,Awaited:g,AMINO_ACID_TRANSLATION:d})},{"./sha1":32}],50:[function(d,x,t){function q(){this.info=[]}function p(a,b){this.parser=a;this.sink=b}if("undefined"!==typeof d){var l=d("./sourceadapters").registerParserFactory;d=d("./das");var n=d.DASStylesheet,w=d.DASStyle,v=d.DASFeature}var y=/([^;=]+)(=([^;]+))?;?/,b=/##INFO=<([^>]+)>/,a=/([^,=]+)=([^,]+|"[^"]+"),?/;q.prototype.createSession=
function(a){return new p(this,a)};p.prototype.parse=function(d){if(0!=d.length)if("#"==d[0]){if(1<d.length&&"#"==d[1]&&(d=b.exec(d))){var e=d[1].split(a),g=null,l=null;for(d=0;d<e.length-1;d+=3){var k=e[d+1],n=e[d+2].replace(/"/g,"");"ID"==k?g=n:"Description"==k&&(l=n)}g&&l&&this.parser.info.push({id:g,desc:l})}}else{e=d.split("\t");g=new v;g.segment=e[0];g.id=e[2];g.refAllele=e[3];g.altAlleles=e[4].split(",");g.min=parseInt(e[1]);g.max=g.min+g.refAllele.length-1;e=e[7].split(y);g.info={};for(d=0;d<
e.length;d+=4)g.info[e[d+1]]=e[d+3];d=g.altAlleles[0];e=g.refAllele;d.length>e.length?(g.type="insertion",0==d.indexOf(e)?(g.insertion=d.substr(e.length),g.min+=e.length,g.max=g.min-1):g.insertion=d):g.type=d.length<e.length?"deletion":"substitution";this.sink(g)}};p.prototype.flush=function(){};q.prototype.getStyleSheet=function(a){var b=new n,d=new w;d.glyph="__INSERTION";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"insertion"},
null,d);d=new w;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(255, 60, 60)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"deletion"},null,d);d=new w;d.glyph="PLIMSOLL";d.BUMP="yes";d.LABEL="no";d.FGCOLOR="rgb(50,80,255)";d.BGCOLOR="#888888";d.STROKECOLOR="black";b.pushStyle({type:"default"},null,d);return a(b)};q.prototype.getDefaultFIPs=function(a){var b=this;a(function(a,d){d.add("Ref. allele",a.refAllele);d.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var k=
0;k<b.info.length;++k){var l=b.info[k],n=a.info[l.id];void 0!==n&&d.add(l.desc,n)}})};l("vcf",function(){return new q})},{"./das":10,"./sourceadapters":33}],51:[function(d,x,t){d={CONFIG:5,MAJOR:0,MINOR:12,MICRO:9,PATCH:"",BRANCH:"dev",toString:function(){var d=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(d+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(d=d+"-"+this.BRANCH);return d}};"undefined"!==typeof x&&(x.exports=d)},{}],52:[function(d,x,t){function q(){function d(a){a=Math.min(a,200);
e=a=Math.max(a,0);v.style.left=""+e+"px"}function n(a){a=Math.min(a,200);g=a=Math.max(a,0);t.style.left=""+g+"px"}var q=p("hr",null,{className:"slider-track"}),v=p("hr",null,{className:"slider-thumb active"}),t=p("hr",null,{className:"slider-thumb"}),b=p("div",[q,v,t],{className:"slider"}),a=0,r=200,e=50,g=100,m=[];b.removeLabels=function(){for(var a=0;a<m.length;++a)b.removeChild(m[a]);m=[]};b.addLabel=function(c,d){var e=p("div",d,{className:"slider-label"},{left:""+(0+200*(c-a)/(r-a)|0)+"px"});
b.appendChild(e);m.push(e)};var k=document.createEvent("HTMLEvents");k.initEvent("change",!0,!1);Object.defineProperty(b,"value",{get:function(){return a+(e-0)*(r-a)/200},set:function(c){d(0+200*(c-a)/(r-a))}});Object.defineProperty(b,"value2",{get:function(){return a+(g-0)*(r-a)/200},set:function(c){n(0+200*(c-a)/(r-a))}});Object.defineProperty(b,"active",{get:function(){return v.classList.contains("active")?1:2},set:function(a){1==a?(v.classList.add("active"),t.classList.remove("active")):(t.classList.add("active"),
v.classList.remove("active"))}});Object.defineProperty(b,"min",{get:function(){return a},set:function(c){a=c}});Object.defineProperty(b,"max",{get:function(){return r},set:function(a){r=a}});var u,x,q=function(a){x=this==v?1:2;x!=b.active&&(b.active=x,b.dispatchEvent(k));a.stopPropagation();a.preventDefault();window.addEventListener("mousemove",P,!1);window.addEventListener("mouseup",c,!1);u=a.clientX-(1==x?e:g)};v.addEventListener("mousedown",q,!1);t.addEventListener("mousedown",q,!1);var P=function(a){1==
x?d(a.clientX-u):n(a.clientX-u);b.dispatchEvent(k)},c=function(a){window.removeEventListener("mousemove",P,!1);window.removeEventListener("mouseup",c,!1)};return b}if("undefined"!==typeof d)var p=d("./utils").makeElement;"undefined"!==typeof x&&(x.exports=q)},{"./utils":49}],53:[function(d,x,t){x=d("./promise/promise").Promise;d=d("./promise/polyfill").polyfill;t.Promise=x;t.polyfill=d},{"./promise/polyfill":58,"./promise/promise":59}],54:[function(d,x,t){var q=d("./utils").isArray,p=d("./utils").isFunction;
t.all=function(d){if(!q(d))throw new TypeError("You must pass an array to all.");return new this(function(n,q){function v(a){return function(d){t[a]=d;0===--b&&n(t)}}var t=[],b=d.length,a;0===b&&n([]);for(var r=0;r<d.length;r++)(a=d[r])&&p(a.then)?a.then(v(r),q):(t[r]=a,0===--b&&n(t))})}},{"./utils":63}],55:[function(d,x,t){(function(d,p){function l(){return function(){d.nextTick(v)}}function n(){var a=0,d=new b(v),e=document.createTextNode("");d.observe(e,{characterData:!0});return function(){e.data=
a=++a%2}}function w(){return function(){a.setTimeout(v,1)}}function v(){for(var a=0;a<r.length;a++){var b=r[a];(0,b[0])(b[1])}r=[]}var x="undefined"!==typeof window?window:{},b=x.MutationObserver||x.WebKitMutationObserver,a="undefined"!==typeof p?p:void 0===this?window:this,r=[],e;e="undefined"!==typeof d&&"[object process]"==={}.toString.call(d)?l():b?n():w();t.asap=function(a,b){1===r.push([a,b])&&e()}}).call(this,d("1YiZ5S"),"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},
{"1YiZ5S":64}],56:[function(d,x,t){t.cast=function(d){return d&&"object"===typeof d&&d.constructor===this?d:new this(function(p){p(d)})}},{}],57:[function(d,x,t){var q={instrument:!1};t.config=q;t.configure=function(d,l){if(2===arguments.length)q[d]=l;else return q[d]}},{}],58:[function(d,x,t){(function(q){var p=d("./promise").Promise,l=d("./utils").isFunction;t.polyfill=function(){var d;d="undefined"!==typeof q?q:"undefined"!==typeof window&&window.document?window:self;"Promise"in d&&"cast"in d.Promise&&
"resolve"in d.Promise&&"reject"in d.Promise&&"all"in d.Promise&&"race"in d.Promise&&function(){var p;new d.Promise(function(d){p=d});return l(p)}()||(d.Promise=p)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":59,"./utils":63}],59:[function(d,x,t){function q(a){if(!k(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof q))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
this._subscribers=[];p(a,this)}function p(c,b){function f(a){y(b,a)}function d(c){a(b,c)}try{c(f,d)}catch(e){d(e)}}function l(c,b,f,d){var e=k(f),h,g,l,m;if(e)try{h=f(d),l=!0}catch(n){m=!0,g=n}else h=d,l=!0;v(b,h)||(e&&l?y(b,h):m?a(b,g):c===z?y(b,h):c===A&&a(b,h))}function n(a,c,b,f){a=a._subscribers;var d=a.length;a[d]=c;a[d+z]=b;a[d+A]=f}function w(a,c){for(var b,d,f=a._subscribers,e=a._detail,h=0;h<f.length;h+=3)b=f[h],d=f[h+c],l(c,b,d,e);a._subscribers=null}function v(c,d){var f=null,e;try{if(c===
d)throw new TypeError("A promises callback cannot return that same promise.");if(m(d)&&(f=d.then,k(f)))return f.call(d,function(a){if(e)return!0;e=!0;d!==a?y(c,a):b(c,a)},function(b){if(e)return!0;e=!0;a(c,b)}),!0}catch(h){if(e)return!0;a(c,h);return!0}return!1}function y(a,c){a===c?b(a,c):v(a,c)||b(a,c)}function b(a,c){a._state===f&&(a._state=h,a._detail=c,g.async(r,a))}function a(a,c){a._state===f&&(a._state=h,a._detail=c,g.async(e,a))}function r(a){w(a,a._state=z)}function e(a){w(a,a._state=A)}
var g=d("./config").config;d("./config");var m=d("./utils").objectOrFunction,k=d("./utils").isFunction;d("./utils");x=d("./cast").cast;var u=d("./all").all,G=d("./race").race,P=d("./resolve").resolve,c=d("./reject").reject;d=d("./asap").asap;g.async=d;var f=void 0,h=0,z=1,A=2;q.prototype={constructor:q,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(a,c){var b=this,d=new this.constructor(function(){});if(this._state){var f=arguments;g.async(function(){l(b._state,d,f[b._state-1],b._detail)})}else n(this,
d,a,c);return d},"catch":function(a){return this.then(null,a)}};q.all=u;q.cast=x;q.race=G;q.resolve=P;q.reject=c;t.Promise=q},{"./all":54,"./asap":55,"./cast":56,"./config":57,"./race":60,"./reject":61,"./resolve":62,"./utils":63}],60:[function(d,x,t){var q=d("./utils").isArray;t.race=function(d){if(!q(d))throw new TypeError("You must pass an array to race.");return new this(function(l,n){for(var q,v=0;v<d.length;v++)(q=d[v])&&"function"===typeof q.then?q.then(l,n):l(q)})}},{"./utils":63}],61:[function(d,
x,t){t.reject=function(d){return new this(function(p,l){l(d)})}},{}],62:[function(d,x,t){t.resolve=function(d){return new this(function(p,l){p(d)})}},{}],63:[function(d,x,t){function q(d){return"function"===typeof d}d=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=function(d){return q(d)||"object"===typeof d&&null!==d};t.isFunction=q;t.isArray=function(d){return"[object Array]"===Object.prototype.toString.call(d)};t.now=d},{}],64:[function(d,x,t){function q(){}d=x.exports={};
d.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(d){return window.setImmediate(d)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var d=[];window.addEventListener("message",function(l){var n=l.source;n!==window&&null!==n||"process-tick"!==l.data||(l.stopPropagation(),0<d.length&&d.shift()())},!0);return function(l){d.push(l);window.postMessage("process-tick","*")}}return function(d){setTimeout(d,0)}}();d.title="browser";d.browser=
!0;d.env={};d.argv=[];d.on=q;d.addListener=q;d.once=q;d.off=q;d.removeListener=q;d.removeAllListeners=q;d.emit=q;d.binding=function(d){throw Error("process.binding is not supported");};d.cwd=function(){return"/"};d.chdir=function(d){throw Error("process.chdir is not supported");}},{}],65:[function(d,x,t){function q(){}function p(){this.was=[0]}function l(a,b,d){this.hufts=new Int32Array(4320);this.window=new Uint8Array(d);this.end=d;this.checkfn=b;this.mode=0;this.reset(a,null);this.index=this.table=
this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new n;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new w}function n(){}function w(){}function v(a,b,d,e,g){if(0!=g){if(!a)throw"Undef src";if(!d)throw"Undef dest";if(0==b&&g==a.length)d.set(a,e);else if(P)a=a.subarray(b,b+g),d.set(a,e);else if(1==a.BYTES_PER_ELEMENT&&100<g)a=new Uint8Array(a.buffer,a.byteOffset+b,g),d.set(a,e);else for(var k=0;k<g;++k)d[e+k]=a[b+k]}}function y(a,
b,d,e){a=b?d?new Uint8Array(a,b,d):new Uint8Array(a,b,a.byteLength-b):new Uint8Array(a);d=new q;d.inflateInit(15,!0);d.next_in=a;d.next_in_index=0;d.avail_in=a.length;a=[];for(var g=0;;){var k=new Uint8Array(32E3);d.next_out=k;d.next_out_index=0;d.avail_out=k.length;var l=d.inflate(0);if(0!=l&&1!=l&&-5!=l)throw d.msg;if(0!=d.avail_out){var m=new Uint8Array(k.length-d.avail_out);v(k,0,m,0,k.length-d.avail_out);k=m}a.push(k);g+=k.length;if(1==l||-5==l)break}e&&(e[0]=(b||0)+d.next_in_index);if(1==a.length)return a[0].buffer;
b=new Uint8Array(g);for(d=e=0;d<a.length;++d)g=a[d],v(g,0,b,e,g.length),e+=g.length;return b.buffer}var b=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],a=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,
36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,
8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,
234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,
8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,
83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,
9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,
109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,
0,8,15,0,8,143,0,8,79,0,9,255],r=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],g=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],m=[1,2,3,4,5,7,9,
13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];q.prototype.inflateInit=function(a,b){a||(a=15);b&&(b=!1);this.istate=new p;return this.istate.inflateInit(this,b?-a:a)};q.prototype.inflate=function(a){return null==this.istate?-2:this.istate.inflate(this,a)};q.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};
q.prototype.inflateSync=function(){return istate.inflateSync(this)};q.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};p.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,null);return 0};p.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return 0};p.prototype.inflateInit=function(a,b){this.blocks=a.msg=
null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new l(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return 0};p.prototype.inflate=function(a,b){var d,e;if(null==a||null==a.istate||null==a.next_in)return-2;b=4==b?-5:0;for(d=-5;;)switch(a.istate.mode){case 0:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;if(8!=((a.istate.method=a.next_in[a.next_in_index++])&15)){a.istate.mode=13;a.msg="unknown compression method";a.istate.marker=
5;break}if((a.istate.method>>4)+8>a.istate.wbits){a.istate.mode=13;a.msg="invalid window size";a.istate.marker=5;break}a.istate.mode=1;case 1:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;e=a.next_in[a.next_in_index++]&255;if(0!=((a.istate.method<<8)+e)%31){a.istate.mode=13;a.msg="incorrect header check";a.istate.marker=5;break}if(0==(e&32)){a.istate.mode=7;break}a.istate.mode=2;case 2:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<
24&4278190080;a.istate.mode=3;case 3:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<16&16711680;a.istate.mode=4;case 4:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=5;case 5:if(0==a.avail_in)return d;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;a.adler=a.istate.need;a.istate.mode=6;return 2;case 6:return a.istate.mode=13,a.msg=
"need dictionary",a.istate.marker=0,-2;case 7:d=a.istate.blocks.proc(a,d);if(-3==d){a.istate.mode=13;a.istate.marker=0;break}0==d&&(d=b);if(1!=d)return d;d=b;a.istate.blocks.reset(a,a.istate.was);if(0!=a.istate.nowrap){a.istate.mode=12;break}a.istate.mode=8;case 8:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need=(a.next_in[a.next_in_index++]&255)<<24&4278190080;a.istate.mode=9;case 9:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&
255)<<16&16711680;a.istate.mode=10;case 10:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=(a.next_in[a.next_in_index++]&255)<<8&65280;a.istate.mode=11;case 11:if(0==a.avail_in)return d;d=b;a.avail_in--;a.total_in++;a.istate.need+=a.next_in[a.next_in_index++]&255;if(a.istate.was[0]!=a.istate.need){a.istate.mode=13;a.msg="incorrect data check";a.istate.marker=5;break}a.istate.mode=12;case 12:return 1;case 13:return-3;default:return-2}};p.prototype.inflateSetDictionary=function(a,
b,d){var e=0,g=d;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,d)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);g>=1<<a.istate.wbits&&(g=(1<<a.istate.wbits)-1,e=d-g);a.istate.blocks.set_dictionary(b,e,g);a.istate.mode=7;return 0};var u=[0,0,255,255];p.prototype.inflateSync=function(a){var b,d,e;if(null==a||null==a.istate)return-2;13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return-5;d=a.next_in_index;for(e=a.istate.marker;0!=
b&&4>e;)a.next_in[d]==u[e]?e++:e=0!=a.next_in[d]?0:4-e,d++,b--;a.total_in+=d-a.next_in_index;a.next_in_index=d;a.avail_in=b;a.istate.marker=e;if(4!=e)return-3;b=a.total_in;d=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=d;a.istate.mode=7;return 0};p.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};var G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];l.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&
this.codes.free(a);this.read=this.write=this.bitb=this.bitk=this.mode=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};l.prototype.proc=function(c,d){var e,g,k,l,m,n,p;l=c.next_in_index;m=c.avail_in;g=this.bitb;k=this.bitk;n=this.write;for(p=n<this.read?this.read-n-1:this.end-n;;)switch(this.mode){case 0:for(;3>k;){if(0!=m)d=0;else return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);m--;g|=(c.next_in[l++]&
255)<<k;k+=8}e=g&7;this.last=e&1;switch(e>>>1){case 0:g>>>=3;k-=3;e=k&7;g>>>=e;k-=e;this.mode=1;break;case 1:var q=new Int32Array(1),t=new Int32Array(1),u=[],w=[];e=t;var x=u,y=w;q[0]=9;e[0]=5;x[0]=a;y[0]=r;this.codes.init(q[0],t[0],u[0],0,w[0],0,c);g>>>=3;k-=3;this.mode=6;break;case 2:g>>>=3;k-=3;this.mode=3;break;case 3:return g>>>=3,k-=3,this.mode=13,c.msg="invalid block type",d=-3,this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,
d)}break;case 1:for(;32>k;){if(0!=m)d=0;else return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);m--;g|=(c.next_in[l++]&255)<<k;k+=8}if((~g>>>16&65535)!=(g&65535))return this.mode=13,c.msg="invalid stored block lengths",d=-3,this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);this.left=g&65535;g=k=0;this.mode=0!=this.left?2:0!=this.last?7:0;break;case 2:if(0==
m)return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,write=n,this.inflate_flush(c,d);if(0==p&&(n==end&&0!=read&&(n=0,p=n<this.read?this.read-n-1:this.end-n),0==p&&(this.write=n,d=this.inflate_flush(c,d),n=this.write,p=n<this.read?this.read-n-1:this.end-n,n==this.end&&0!=this.read&&(n=0,p=n<this.read?this.read-n-1:this.end-n),0==p)))return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,
d);d=0;e=this.left;e>m&&(e=m);e>p&&(e=p);v(c.next_in,l,this.window,n,e);l+=e;m-=e;n+=e;p-=e;if(0!=(this.left-=e))break;this.mode=0!=this.last?7:0;break;case 3:for(;14>k;){if(0!=m)d=0;else return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);m--;g|=(c.next_in[l++]&255)<<k;k+=8}this.table=e=g&16383;if(29<(e&31)||29<(e>>5&31))return this.mode=9,c.msg="too many length or distance symbols",d=-3,this.bitb=g,this.bitk=k,c.avail_in=
m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);e=258+(e&31)+(e>>5&31);if(null==this.blens||this.blens.length<e)this.blens=new Int32Array(e);else for(p=0;p<e;p++)this.blens[p]=0;g>>>=14;k-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>k;){if(0!=m)d=0;else return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);m--;g|=(c.next_in[l++]&255)<<k;k+=8}this.blens[G[this.index++]]=
g&7;g>>>=3;k-=3}for(;19>this.index;)this.blens[G[this.index++]]=0;this.bb[0]=7;e=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,c);if(0!=e)return d=e,-3==d&&(this.blens=null,this.mode=9),this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,write=n,this.inflate_flush(c,d);this.index=0;this.mode=5;case 5:for(;;){e=this.table;if(!(this.index<258+(e&31)+(e>>5&31)))break;for(e=this.bb[0];k<e;){if(0!=m)d=0;else return this.bitb=g,this.bitk=k,c.avail_in=
m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);m--;g|=(c.next_in[l++]&255)<<k;k+=8}e=this.hufts[3*(this.tb[0]+(g&b[e]))+1];t=this.hufts[3*(this.tb[0]+(g&b[e]))+2];if(16>t)g>>>=e,k-=e,this.blens[this.index++]=t;else{p=18==t?7:t-14;for(q=18==t?11:3;k<e+p;){if(0!=m)d=0;else return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);m--;g|=(c.next_in[l++]&255)<<k;k+=8}g>>>=e;k-=e;q+=g&b[p];g>>>=
p;k-=p;p=this.index;e=this.table;if(p+q>258+(e&31)+(e>>5&31)||16==t&&1>p)return this.blens=null,this.mode=9,c.msg="invalid bit length repeat",d=-3,this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);t=16==t?this.blens[p-1]:0;do this.blens[p++]=t;while(0!=--q);this.index=p}}this.tb[0]=-1;q=new Int32Array(1);t=new Int32Array(1);u=new Int32Array(1);w=new Int32Array(1);q[0]=9;t[0]=6;e=this.table;e=this.inftree.inflate_trees_dynamic(257+
(e&31),1+(e>>5&31),this.blens,q,t,u,w,this.hufts,c);if(0!=e)return-3==e&&(this.blens=null,this.mode=13),d=e,this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);this.codes.init(q[0],t[0],this.hufts,u[0],this.hufts,w[0],c);this.mode=6;case 6:this.bitb=g;this.bitk=k;c.avail_in=m;c.total_in+=l-c.next_in_index;c.next_in_index=l;this.write=n;if(1!=(d=this.codes.proc(this,c,d)))return this.inflate_flush(c,d);d=0;this.codes.free(c);l=c.next_in_index;
m=c.avail_in;g=this.bitb;k=this.bitk;n=this.write;p=n<this.read?this.read-n-1:this.end-n;if(0==this.last){this.mode=0;break}this.mode=7;case 7:this.write=n;d=this.inflate_flush(c,d);n=this.write;if(this.read!=this.write)return this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);mode=12;case 8:return d=1,this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);case 9:return d=
-3,this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d);default:return d=-2,this.bitb=g,this.bitk=k,c.avail_in=m,c.total_in+=l-c.next_in_index,c.next_in_index=l,this.write=n,this.inflate_flush(c,d)}};l.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};l.prototype.set_dictionary=function(a,b,d){v(a,b,window,0,d);this.read=this.write=d};l.prototype.sync_point=function(){return 1==this.mode};l.prototype.inflate_flush=
function(a,b){var d,e,g;e=a.next_out_index;g=this.read;d=(g<=this.write?this.write:this.end)-g;d>a.avail_out&&(d=a.avail_out);0!=d&&-5==b&&(b=0);a.avail_out-=d;a.total_out+=d;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,g,d));v(this.window,g,a.next_out,e,d);e+=d;g+=d;g==this.end&&(g=0,this.write==this.end&&(this.write=0),d=this.write-g,d>a.avail_out&&(d=a.avail_out),0!=d&&-5==b&&(b=0),a.avail_out-=d,a.total_out+=d,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,
this.window,g,d)),v(this.window,g,a.next_out,e,d),e+=d,g+=d);a.next_out_index=e;this.read=g;return b};n.prototype.init=function(a,b,d,e,g,k,l){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=d;this.ltree_index=e;this.dtree=g;this.dtree_index=k;this.tree=null};n.prototype.proc=function(a,d,e){var g,k,l=0,m=0,n=0,p,q,r,n=d.next_in_index;p=d.avail_in;l=a.bitb;m=a.bitk;q=a.write;for(r=q<a.read?a.read-q-1:a.end-q;;)switch(this.mode){case 0:if(258<=r&&10<=p&&(a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=
n-d.next_in_index,d.next_in_index=n,a.write=q,e=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,a,d),n=d.next_in_index,p=d.avail_in,l=a.bitb,m=a.bitk,q=a.write,r=q<a.read?a.read-q-1:a.end-q,0!=e)){this.mode=1==e?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=1;case 1:for(g=this.need;m<g;){if(0!=p)e=0;else return a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,
e);p--;l|=(d.next_in[n++]&255)<<m;m+=8}g=3*(this.tree_index+(l&b[g]));l>>>=this.tree[g+1];m-=this.tree[g+1];k=this.tree[g];if(0==k){this.lit=this.tree[g+2];this.mode=6;break}if(0!=(k&16)){this.get=k&15;this.len=this.tree[g+2];this.mode=2;break}if(0==(k&64)){this.need=k;this.tree_index=g/3+this.tree[g+2];break}if(0!=(k&32)){this.mode=7;break}this.mode=9;d.msg="invalid literal/length code";e=-3;a.bitb=l;a.bitk=m;d.avail_in=p;d.total_in+=n-d.next_in_index;d.next_in_index=n;a.write=q;return a.inflate_flush(d,
e);case 2:for(g=this.get;m<g;){if(0!=p)e=0;else return a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,e);p--;l|=(d.next_in[n++]&255)<<m;m+=8}this.len+=l&b[g];l>>=g;m-=g;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(g=this.need;m<g;){if(0!=p)e=0;else return a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,e);p--;l|=(d.next_in[n++]&
255)<<m;m+=8}g=3*(this.tree_index+(l&b[g]));l>>=this.tree[g+1];m-=this.tree[g+1];k=this.tree[g];if(0!=(k&16)){this.get=k&15;this.dist=this.tree[g+2];this.mode=4;break}if(0==(k&64)){this.need=k;this.tree_index=g/3+this.tree[g+2];break}this.mode=9;d.msg="invalid distance code";e=-3;a.bitb=l;a.bitk=m;d.avail_in=p;d.total_in+=n-d.next_in_index;d.next_in_index=n;a.write=q;return a.inflate_flush(d,e);case 4:for(g=this.get;m<g;){if(0!=p)e=0;else return a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,
d.next_in_index=n,a.write=q,a.inflate_flush(d,e);p--;l|=(d.next_in[n++]&255)<<m;m+=8}this.dist+=l&b[g];l>>=g;m-=g;this.mode=5;case 5:for(g=q-this.dist;0>g;)g+=a.end;for(;0!=this.len;){if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,e=a.inflate_flush(d,e),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,
e);a.window[q++]=a.window[g++];r--;g==a.end&&(g=0);this.len--}this.mode=0;break;case 6:if(0==r&&(q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r&&(a.write=q,e=a.inflate_flush(d,e),q=a.write,r=q<a.read?a.read-q-1:a.end-q,q==a.end&&0!=a.read&&(q=0,r=q<a.read?a.read-q-1:a.end-q),0==r)))return a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,e);e=0;a.window[q++]=this.lit;r--;this.mode=0;break;case 7:7<m&&(m-=8,p++,n--);a.write=q;
e=a.inflate_flush(d,e);q=a.write;if(a.read!=a.write)return a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,e);this.mode=8;case 8:return e=1,a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,e);case 9:return e=-3,a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,e);default:return e=-2,a.bitb=l,a.bitk=m,d.avail_in=p,d.total_in+=
n-d.next_in_index,d.next_in_index=n,a.write=q,a.inflate_flush(d,e)}};n.prototype.free=function(a){};n.prototype.inflate_fast=function(a,d,e,g,k,l,m,n){var p,q,r,t,u,w,x,B,y,G,J,L;w=n.next_in_index;x=n.avail_in;t=m.bitb;u=m.bitk;B=m.write;y=B<m.read?m.read-B-1:m.end-B;a=b[a];G=b[d];do{for(;20>u;)x--,t|=(n.next_in[w++]&255)<<u,u+=8;p=t&a;q=e;r=g;L=3*(r+p);if(0==(d=q[L]))t>>=q[L+1],u-=q[L+1],m.window[B++]=q[L+2],y--;else{do{t>>=q[L+1];u-=q[L+1];if(0!=(d&16)){d&=15;J=q[L+2]+(t&b[d]);t>>=d;for(u-=d;15>
u;)x--,t|=(n.next_in[w++]&255)<<u,u+=8;p=t&G;q=k;r=l;L=3*(r+p);d=q[L];do if(t>>=q[L+1],u-=q[L+1],0!=(d&16)){for(d&=15;u<d;)x--,t|=(n.next_in[w++]&255)<<u,u+=8;p=q[L+2]+(t&b[d]);t>>=d;u-=d;y-=J;if(B>=p)p=B-p,m.window[B++]=m.window[p++],m.window[B++]=m.window[p++],J-=2;else{p=B-p;do p+=m.end;while(0>p);d=m.end-p;if(J>d){J-=d;if(0<B-p&&d>B-p){do m.window[B++]=m.window[p++];while(0!=--d)}else v(m.window,p,m.window,B,d),B+=d;p=0}}do m.window[B++]=m.window[p++];while(0!=--J);break}else if(0==(d&64))p+=
q[L+2],p+=t&b[d],L=3*(r+p),d=q[L];else return n.msg="invalid distance code",J=n.avail_in-x,J=u>>3<J?u>>3:J,x+=J,w-=J,u-=J<<3,m.bitb=t,m.bitk=u,n.avail_in=x,n.total_in+=w-n.next_in_index,n.next_in_index=w,m.write=B,-3;while(1);break}if(0==(d&64)){if(p+=q[L+2],p+=t&b[d],L=3*(r+p),0==(d=q[L])){t>>=q[L+1];u-=q[L+1];m.window[B++]=q[L+2];y--;break}}else{if(0!=(d&32))return J=n.avail_in-x,J=u>>3<J?u>>3:J,x+=J,w-=J,u-=J<<3,m.bitb=t,m.bitk=u,n.avail_in=x,n.total_in+=w-n.next_in_index,n.next_in_index=w,m.write=
B,1;n.msg="invalid literal/length code";J=n.avail_in-x;J=u>>3<J?u>>3:J;x+=J;w-=J;u-=J<<3;m.bitb=t;m.bitk=u;n.avail_in=x;n.total_in+=w-n.next_in_index;n.next_in_index=w;m.write=B;return-3}}while(1)}}while(258<=y&&10<=x);J=n.avail_in-x;J=u>>3<J?u>>3:J;w-=J;m.bitb=t;m.bitk=u-(J<<3);n.avail_in=x+J;n.total_in+=w-n.next_in_index;n.next_in_index=w;m.write=B;return 0};w.prototype.huft_build=function(a,b,d,e,g,k,l,m,n,p,q){var r,t,u,w,x,y,G,J,L;y=0;t=d;do this.c[a[b+y]]++,y++,t--;while(0!=t);if(this.c[0]==
d)return l[0]=-1,m[0]=0;x=m[0];for(u=1;15>=u&&0==this.c[u];u++);w=u;x<u&&(x=u);for(t=15;0!=t&&0==this.c[t];t--);p=t;x>t&&(x=t);m[0]=x;for(m=1<<u;u<t;u++,m<<=1)if(0>(m-=this.c[u]))return-3;if(0>(m-=this.c[t]))return-3;this.c[t]+=m;this.x[1]=u=0;y=1;for(G=2;0!=--t;)this.x[G]=u+=this.c[y],G++,y++;y=t=0;do 0!=(u=a[b+y])&&(this.v[this.x[u]++]=t),y++;while(++t<d);d=this.x[p];y=this.x[0]=t=0;b=-1;J=-x;for(L=G=this.u[0]=0;w<=p;w++)for(a=this.c[w];0!=a--;){for(;w>J+x;){b++;J+=x;L=p-J;L=L>x?x:L;if((r=1<<(u=
w-J))>a+1&&(r-=a+1,G=w,u<L))for(;++u<L&&!((r<<=1)<=this.c[++G]);)r-=this.c[G];L=1<<u;if(1440<this.hn[0]+L)return-3;this.u[b]=G=this.hn[0];this.hn[0]+=L;0!=b?(this.x[b]=t,this.r[0]=u,this.r[1]=x,u=t>>>J-x,this.r[2]=G-this.u[b-1]-u,v(this.r,0,n,3*(this.u[b-1]+u),3)):l[0]=G}this.r[1]=w-J;y>=d?this.r[0]=192:q[y]<e?(this.r[0]=256>this.v[y]?0:96,this.r[2]=this.v[y++]):(this.r[0]=k[this.v[y]-e]+16+64,this.r[2]=g[this.v[y++]-e]);r=1<<w-J;for(u=t>>>J;u<L;u+=r)v(this.r,0,n,3*(G+u),3);for(u=1<<w-1;0!=(t&u);u>>>=
1)t^=u;t^=u;for(u=(1<<J)-1;(t&u)!=this.x[b];)b--,J-=x,u=(1<<J)-1}return 0!=m&&1!=p?-5:0};w.prototype.inflate_trees_bits=function(a,b,d,e,g){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,d,b,e,this.hn,this.v);if(-3==a)g.msg="oversubscribed dynamic bit lengths tree";else if(-5==a||0==b[0])g.msg="incomplete dynamic bit lengths tree",a=-3;return a};w.prototype.inflate_trees_dynamic=function(a,b,d,l,n,p,q,r,t){this.initWorkArea(288);this.hn[0]=0;p=this.huft_build(d,0,a,257,e,
g,p,l,r,this.hn,this.v);if(0!=p||0==l[0])return-3==p?t.msg="oversubscribed literal/length tree":-4!=p&&(t.msg="incomplete literal/length tree",p=-3),p;this.initWorkArea(288);p=this.huft_build(d,a,b,0,m,k,q,n,r,this.hn,this.v);return 0!=p||0==n[0]&&257<a?(-3==p?t.msg="oversubscribed distance tree":-5==p?(t.msg="incomplete distance tree",p=-3):-4!=p&&(t.msg="empty distance tree with lengths",p=-3),p):0};w.prototype.initWorkArea=function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),
this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;v(this.c,0,this.u,0,15);v(this.c,0,this.x,0,16)};var P="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof x&&(x.exports={inflateBuffer:y,arrayCopy:v})},{}]},{},[16]);
